2025-05-22 01:29:07,211 - backend.ml_service - INFO - Логирование настроено с уровнем DEBUG
2025-05-22 01:29:07,213 - backend.ml_service - INFO - Логи записываются в файл: C:\Users\alex\Desktop\AnomaLens3.0\logs\ml_service_2025-05-22.log
2025-05-22 01:29:33,062 - backend.ml_service.multilevel_service - INFO - Базовый путь для моделей (MultilevelService): C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models
2025-05-22 01:29:33,063 - backend.ml_service.multilevel_service - INFO - Создание/инициализация многоуровневой системы на основе настроек из config.yaml.
2025-05-22 01:29:33,063 - backend.ml_service.multilevel_service - DEBUG - Используется следующая конфигурация для MultilevelAnomalyDetector: {
  "transaction_level": [
    {
      "type": "transaction_vae",
      "model_filename": "ml_trans_vae_model.joblib",
      "weight": 1.0,
      "features": [
        "price",
        "freight_value",
        "product_weight_g",
        "freight_to_price_ratio"
      ],
      "encoding_dim": 10,
      "hidden_dim1": 32,
      "hidden_dim2": 16,
      "epochs": 25,
      "kld_weight": 0.5,
      "dropout_rate": 0.1,
      "shap_background_samples": 50
    },
    {
      "type": "category_price_outlier",
      "model_filename": "ml_category_price_model.joblib",
      "weight": 1.0,
      "category_col": "product_category_name",
      "price_col": "price",
      "threshold": 2.8,
      "min_samples_per_category": 10
    }
  ],
  "behavior_level": [
    {
      "type": "graph",
      "model_filename": "ml_graph_model_v3.joblib",
      "weight": 1.0,
      "use_seller_state_spread": true,
      "use_category_diversity": true,
      "use_seller_degree": true,
      "seller_state_weight": 0.3,
      "category_diversity_weight": 0.4,
      "seller_degree_weight": 0.3
    },
    {
      "type": "seller_pricing_behavior",
      "model_filename": "ml_seller_pricing_model.joblib",
      "weight": 1.0,
      "volatility_threshold": 0.5,
      "range_threshold": 5.0,
      "freight_ratio_threshold": 1.0,
      "min_transactions": 5
    }
  ],
  "time_series_level": [
    {
      "type": "seasonal_deviation",
      "model_filename": "seasonal_deviation_model.joblib",
      "weight": 1.0,
      "window_size": 7,
      "threshold": 2.5
    },
    {
      "type": "cumulative_sum",
      "model_filename": "cumulative_sum_model.joblib",
      "weight": 1.0,
      "window_size": 14,
      "threshold": 2.5,
      "drift_threshold": 4.5
    }
  ],
  "combination_weights": {
    "transaction": 0.4,
    "behavior": 0.3,
    "time_series": 0.3
  },
  "transaction_level_combination_method": "weighted_average",
  "behavior_level_combination_method": "weighted_average",
  "time_series_level_combination_method": "average"
}
2025-05-22 01:29:33,064 - backend.ml_service.multilevel_detector - INFO - Инициализация многоуровневой системы обнаружения аномалий...
2025-05-22 01:29:33,064 - backend.ml_service.multilevel_detector - INFO - Инициализация детекторов для уровня 'transaction'...
2025-05-22 01:29:33,064 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) VAEDetector инициализирован. Устройство: cpu, Входная размерность: 4, Признаки: ['price', 'freight_value', 'product_weight_g', 'freight_to_price_ratio']
2025-05-22 01:29:33,064 - backend.ml_service.detector - DEBUG - (transaction_vae_price) Сброс базового состояния детектора (из AnomalyDetector._reset_state).
2025-05-22 01:29:33,064 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Специфичное состояние VAEDetector (порог, SHAP) сброшено.
2025-05-22 01:29:33,065 - backend.ml_service.transaction_detectors - INFO - (transaction_vae_price) TransactionVAEDetector инициализирован. Конфигурационные признаки: ['price', 'freight_value', 'product_weight_g', 'freight_to_price_ratio'], Реально используемые признаки (с генерируемыми): ['price', 'freight_value', 'product_weight_g', 'freight_to_price_ratio'], encoding_dim(latent_dim): 10, hidden_dim1(hidden_dim): 32, hidden_dim2: 16, epochs: 25, batch_size: 64, lr: 0.001, kld_w: 0.5, dropout: 0.1
2025-05-22 01:29:33,065 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора transaction_vae_price типа transaction_vae
2025-05-22 01:29:33,065 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='ml_trans_vae_model.joblib' установлен для transaction_vae_price
2025-05-22 01:29:33,065 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib'
2025-05-22 01:29:33,065 - backend.ml_service.detector - INFO - Попытка загрузки модели transaction_vae_price из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib...
2025-05-22 01:29:33,109 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Загружен порог аномальности: 3.656726
2025-05-22 01:29:33,109 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) StandardScaler успешно инициализирован с параметрами: n_features_in_=4, mean_=(4,), scale_=(4,)
2025-05-22 01:29:33,110 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Фоновые данные SHAP загружены (torch.Size([50, 4]))
2025-05-22 01:29:33,112 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Модель VAE успешно загружена и перемещена на cpu.
2025-05-22 01:29:33,112 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Попытка пересоздания SHAP GradientExplainer после загрузки...
2025-05-22 01:29:33,117 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) SHAP GradientExplainer успешно ПЕРЕСОЗДАН при загрузке модели. Device=cpu, background_data.shape=torch.Size([50, 4])
2025-05-22 01:29:33,117 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Статус SHAP после загрузки: background_data shape=torch.Size([50, 4]), device=cpu, explainer=создан
2025-05-22 01:29:33,117 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Детектор VAE (is_trained=True) успешно загружен.
2025-05-22 01:29:33,117 - backend.ml_service.detector - INFO - Модель transaction_vae_price успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib. is_trained=True
2025-05-22 01:29:33,118 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора transaction_vae_price из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib
2025-05-22 01:29:33,118 - backend.ml_service.multilevel_detector - INFO -   Детектор 'transaction_vae_price' (тип: transaction_vae) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib.
2025-05-22 01:29:33,118 - backend.ml_service.multilevel_detector - INFO -   Детектор 'transaction_vae_price' (тип: transaction_vae) инициализирован с весом 1.0.
2025-05-22 01:29:33,118 - backend.ml_service.transaction_detectors - INFO - CategoryPriceOutlierDetector 'category_price_outlier_model' инициализирован с параметрами: category_col='product_category_name', price_col='price', threshold=2.8, min_samples_per_category=10
2025-05-22 01:29:33,119 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора category_price_outlier_model типа category_price_outlier
2025-05-22 01:29:33,119 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='ml_category_price_model.joblib' установлен для category_price_outlier_model
2025-05-22 01:29:33,119 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib'
2025-05-22 01:29:33,119 - backend.ml_service.detector - INFO - Попытка загрузки модели category_price_outlier_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib...
2025-05-22 01:29:33,130 - backend.ml_service.detector - INFO - Модель category_price_outlier_model успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib. is_trained=True
2025-05-22 01:29:33,131 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора category_price_outlier_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib
2025-05-22 01:29:33,131 - backend.ml_service.multilevel_detector - INFO -   Детектор 'category_price_outlier_model' (тип: category_price_outlier) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib.
2025-05-22 01:29:33,131 - backend.ml_service.multilevel_detector - INFO -   Детектор 'category_price_outlier_model' (тип: category_price_outlier) инициализирован с весом 1.0.
2025-05-22 01:29:33,131 - backend.ml_service.multilevel_detector - INFO - Инициализация детекторов для уровня 'behavior'...
2025-05-22 01:29:33,131 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора graph_graph_analysis типа graph
2025-05-22 01:29:33,131 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='ml_graph_model_v3.joblib' установлен для graph_graph_analysis
2025-05-22 01:29:33,131 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib'
2025-05-22 01:29:33,132 - backend.ml_service.detector - INFO - Попытка загрузки модели graph_graph_analysis из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib...
2025-05-22 01:29:33,139 - backend.ml_service.detector - INFO - Модель graph_graph_analysis успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib. is_trained=True
2025-05-22 01:29:33,139 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора graph_graph_analysis из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib
2025-05-22 01:29:33,139 - backend.ml_service.multilevel_detector - INFO -   Детектор 'graph_graph_analysis' (тип: graph) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib.
2025-05-22 01:29:33,140 - backend.ml_service.multilevel_detector - INFO -   Детектор 'graph_graph_analysis' (тип: graph) инициализирован с весом 1.0.
2025-05-22 01:29:33,140 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора seller_pricing_behavior_model типа seller_pricing_behavior
2025-05-22 01:29:33,140 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='ml_seller_pricing_model.joblib' установлен для seller_pricing_behavior_model
2025-05-22 01:29:33,140 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib'
2025-05-22 01:29:33,140 - backend.ml_service.detector - INFO - Попытка загрузки модели seller_pricing_behavior_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib...
2025-05-22 01:29:33,146 - backend.ml_service.detector - INFO - Модель seller_pricing_behavior_model успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib. is_trained=True
2025-05-22 01:29:33,147 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора seller_pricing_behavior_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib
2025-05-22 01:29:33,147 - backend.ml_service.multilevel_detector - INFO -   Детектор 'seller_pricing_behavior_model' (тип: seller_pricing_behavior) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib.
2025-05-22 01:29:33,147 - backend.ml_service.multilevel_detector - INFO -   Детектор 'seller_pricing_behavior_model' (тип: seller_pricing_behavior) инициализирован с весом 1.0.
2025-05-22 01:29:33,147 - backend.ml_service.multilevel_detector - INFO - Инициализация детекторов для уровня 'time_series'...
2025-05-22 01:29:33,147 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора seasonal_deviation_model типа seasonal_deviation
2025-05-22 01:29:33,147 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='seasonal_deviation_model.joblib' установлен для seasonal_deviation_model
2025-05-22 01:29:33,148 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib'
2025-05-22 01:29:33,148 - backend.ml_service.detector - INFO - Попытка загрузки модели seasonal_deviation_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib...
2025-05-22 01:29:33,155 - backend.ml_service.detector - INFO - Модель seasonal_deviation_model успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib. is_trained=True
2025-05-22 01:29:33,156 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора seasonal_deviation_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib
2025-05-22 01:29:33,156 - backend.ml_service.multilevel_detector - INFO -   Детектор 'seasonal_deviation_model' (тип: seasonal_deviation) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib.
2025-05-22 01:29:33,156 - backend.ml_service.multilevel_detector - INFO -   Детектор 'seasonal_deviation_model' (тип: seasonal_deviation) инициализирован с весом 1.0.
2025-05-22 01:29:33,156 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора cumulative_sum_model типа cumulative_sum
2025-05-22 01:29:33,156 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='cumulative_sum_model.joblib' установлен для cumulative_sum_model
2025-05-22 01:29:33,157 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib'
2025-05-22 01:29:33,157 - backend.ml_service.detector - INFO - Попытка загрузки модели cumulative_sum_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib...
2025-05-22 01:29:33,163 - backend.ml_service.time_series_detectors - INFO - (cumulative_sum_model) Загружены baseline_mean=3696.0057142857145, baseline_std=4060.74644512314 из model_state.
2025-05-22 01:29:33,163 - backend.ml_service.time_series_detectors - INFO - (cumulative_sum_model) Детектор CUSUM успешно загружен и помечен как обученный.
2025-05-22 01:29:33,164 - backend.ml_service.detector - INFO - Модель cumulative_sum_model успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib. is_trained=True
2025-05-22 01:29:33,164 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора cumulative_sum_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib
2025-05-22 01:29:33,164 - backend.ml_service.multilevel_detector - INFO -   Детектор 'cumulative_sum_model' (тип: cumulative_sum) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib.
2025-05-22 01:29:33,164 - backend.ml_service.multilevel_detector - INFO -   Детектор 'cumulative_sum_model' (тип: cumulative_sum) инициализирован с весом 1.0.
2025-05-22 01:29:33,164 - backend.ml_service.multilevel_detector - INFO - Многоуровневая система инициализирована: 2 транзакционных детекторов (метод: weighted_average), 2 поведенческих детекторов (метод: weighted_average), 2 детекторов временных рядов (метод: average)
2025-05-22 01:29:33,164 - backend.ml_service.multilevel_service - INFO - Многоуровневая система успешно создана на основе конфигурации из settings.yaml.
2025-05-22 01:29:33,180 - backend.ml_service - INFO - ML Service Logger активен. Уровень: DEBUG. Директория логов ml_service: C:\Users\alex\Desktop\AnomaLens3.0\logs
2025-05-22 01:49:44,386 - backend.ml_service - INFO - Логирование настроено с уровнем DEBUG
2025-05-22 01:49:44,387 - backend.ml_service - INFO - Логи записываются в файл: C:\Users\alex\Desktop\AnomaLens3.0\logs\ml_service_2025-05-22.log
2025-05-22 01:49:49,523 - backend.ml_service.multilevel_service - INFO - Базовый путь для моделей (MultilevelService): C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models
2025-05-22 01:49:49,523 - backend.ml_service.multilevel_service - INFO - Создание/инициализация многоуровневой системы на основе настроек из config.yaml.
2025-05-22 01:49:49,524 - backend.ml_service.multilevel_service - DEBUG - Используется следующая конфигурация для MultilevelAnomalyDetector: {
  "transaction_level": [
    {
      "type": "transaction_vae",
      "model_filename": "ml_trans_vae_model.joblib",
      "weight": 1.0,
      "features": [
        "price",
        "freight_value",
        "product_weight_g",
        "freight_to_price_ratio"
      ],
      "encoding_dim": 10,
      "hidden_dim1": 32,
      "hidden_dim2": 16,
      "epochs": 25,
      "kld_weight": 0.5,
      "dropout_rate": 0.1,
      "shap_background_samples": 50
    },
    {
      "type": "category_price_outlier",
      "model_filename": "ml_category_price_model.joblib",
      "weight": 1.0,
      "category_col": "product_category_name",
      "price_col": "price",
      "threshold": 2.8,
      "min_samples_per_category": 10
    }
  ],
  "behavior_level": [
    {
      "type": "graph",
      "model_filename": "ml_graph_model_v3.joblib",
      "weight": 1.0,
      "use_seller_state_spread": true,
      "use_category_diversity": true,
      "use_seller_degree": true,
      "seller_state_weight": 0.3,
      "category_diversity_weight": 0.4,
      "seller_degree_weight": 0.3
    },
    {
      "type": "seller_pricing_behavior",
      "model_filename": "ml_seller_pricing_model.joblib",
      "weight": 1.0,
      "volatility_threshold": 0.5,
      "range_threshold": 5.0,
      "freight_ratio_threshold": 1.0,
      "min_transactions": 5
    }
  ],
  "time_series_level": [
    {
      "type": "seasonal_deviation",
      "model_filename": "seasonal_deviation_model.joblib",
      "weight": 1.0,
      "window_size": 7,
      "threshold": 2.5
    },
    {
      "type": "cumulative_sum",
      "model_filename": "cumulative_sum_model.joblib",
      "weight": 1.0,
      "window_size": 14,
      "threshold": 2.5,
      "drift_threshold": 4.5
    }
  ],
  "combination_weights": {
    "transaction": 0.4,
    "behavior": 0.3,
    "time_series": 0.3
  },
  "transaction_level_combination_method": "weighted_average",
  "behavior_level_combination_method": "weighted_average",
  "time_series_level_combination_method": "average"
}
2025-05-22 01:49:49,524 - backend.ml_service.multilevel_detector - INFO - Инициализация многоуровневой системы обнаружения аномалий...
2025-05-22 01:49:49,525 - backend.ml_service.multilevel_detector - INFO - Инициализация детекторов для уровня 'transaction'...
2025-05-22 01:49:49,525 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) VAEDetector инициализирован. Устройство: cpu, Входная размерность: 4, Признаки: ['price', 'freight_value', 'product_weight_g', 'freight_to_price_ratio']
2025-05-22 01:49:49,525 - backend.ml_service.detector - DEBUG - (transaction_vae_price) Сброс базового состояния детектора (из AnomalyDetector._reset_state).
2025-05-22 01:49:49,525 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Специфичное состояние VAEDetector (порог, SHAP) сброшено.
2025-05-22 01:49:49,526 - backend.ml_service.transaction_detectors - INFO - (transaction_vae_price) TransactionVAEDetector инициализирован. Конфигурационные признаки: ['price', 'freight_value', 'product_weight_g', 'freight_to_price_ratio'], Реально используемые признаки (с генерируемыми): ['price', 'freight_value', 'product_weight_g', 'freight_to_price_ratio'], encoding_dim(latent_dim): 10, hidden_dim1(hidden_dim): 32, hidden_dim2: 16, epochs: 25, batch_size: 64, lr: 0.001, kld_w: 0.5, dropout: 0.1
2025-05-22 01:49:49,526 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора transaction_vae_price типа transaction_vae
2025-05-22 01:49:49,526 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='ml_trans_vae_model.joblib' установлен для transaction_vae_price
2025-05-22 01:49:49,527 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib'
2025-05-22 01:49:49,527 - backend.ml_service.detector - INFO - Попытка загрузки модели transaction_vae_price из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib...
2025-05-22 01:49:49,545 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Загружен порог аномальности: 3.656726
2025-05-22 01:49:49,546 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) StandardScaler успешно инициализирован с параметрами: n_features_in_=4, mean_=(4,), scale_=(4,)
2025-05-22 01:49:49,546 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Фоновые данные SHAP загружены (torch.Size([50, 4]))
2025-05-22 01:49:49,551 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Модель VAE успешно загружена и перемещена на cpu.
2025-05-22 01:49:49,551 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Попытка пересоздания SHAP GradientExplainer после загрузки...
2025-05-22 01:49:49,562 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) SHAP GradientExplainer успешно ПЕРЕСОЗДАН при загрузке модели. Device=cpu, background_data.shape=torch.Size([50, 4])
2025-05-22 01:49:49,563 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Статус SHAP после загрузки: background_data shape=torch.Size([50, 4]), device=cpu, explainer=создан
2025-05-22 01:49:49,563 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Детектор VAE (is_trained=True) успешно загружен.
2025-05-22 01:49:49,564 - backend.ml_service.detector - INFO - Модель transaction_vae_price успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib. is_trained=True
2025-05-22 01:49:49,564 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора transaction_vae_price из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib
2025-05-22 01:49:49,565 - backend.ml_service.multilevel_detector - INFO -   Детектор 'transaction_vae_price' (тип: transaction_vae) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib.
2025-05-22 01:49:49,566 - backend.ml_service.multilevel_detector - INFO -   Детектор 'transaction_vae_price' (тип: transaction_vae) инициализирован с весом 1.0.
2025-05-22 01:49:49,566 - backend.ml_service.transaction_detectors - INFO - CategoryPriceOutlierDetector 'category_price_outlier_model' инициализирован с параметрами: category_col='product_category_name', price_col='price', threshold=2.8, min_samples_per_category=10
2025-05-22 01:49:49,566 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора category_price_outlier_model типа category_price_outlier
2025-05-22 01:49:49,566 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='ml_category_price_model.joblib' установлен для category_price_outlier_model
2025-05-22 01:49:49,566 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib'
2025-05-22 01:49:49,567 - backend.ml_service.detector - INFO - Попытка загрузки модели category_price_outlier_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib...
2025-05-22 01:49:49,569 - backend.ml_service.detector - INFO - Модель category_price_outlier_model успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib. is_trained=True
2025-05-22 01:49:49,570 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора category_price_outlier_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib
2025-05-22 01:49:49,570 - backend.ml_service.multilevel_detector - INFO -   Детектор 'category_price_outlier_model' (тип: category_price_outlier) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib.
2025-05-22 01:49:49,570 - backend.ml_service.multilevel_detector - INFO -   Детектор 'category_price_outlier_model' (тип: category_price_outlier) инициализирован с весом 1.0.
2025-05-22 01:49:49,570 - backend.ml_service.multilevel_detector - INFO - Инициализация детекторов для уровня 'behavior'...
2025-05-22 01:49:49,571 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора graph_graph_analysis типа graph
2025-05-22 01:49:49,571 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='ml_graph_model_v3.joblib' установлен для graph_graph_analysis
2025-05-22 01:49:49,571 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib'
2025-05-22 01:49:49,572 - backend.ml_service.detector - INFO - Попытка загрузки модели graph_graph_analysis из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib...
2025-05-22 01:49:49,572 - backend.ml_service.detector - INFO - Модель graph_graph_analysis успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib. is_trained=True
2025-05-22 01:49:49,572 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора graph_graph_analysis из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib
2025-05-22 01:49:49,573 - backend.ml_service.multilevel_detector - INFO -   Детектор 'graph_graph_analysis' (тип: graph) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib.
2025-05-22 01:49:49,573 - backend.ml_service.multilevel_detector - INFO -   Детектор 'graph_graph_analysis' (тип: graph) инициализирован с весом 1.0.
2025-05-22 01:49:49,573 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора seller_pricing_behavior_model типа seller_pricing_behavior
2025-05-22 01:49:49,573 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='ml_seller_pricing_model.joblib' установлен для seller_pricing_behavior_model
2025-05-22 01:49:49,573 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib'
2025-05-22 01:49:49,574 - backend.ml_service.detector - INFO - Попытка загрузки модели seller_pricing_behavior_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib...
2025-05-22 01:49:49,574 - backend.ml_service.detector - INFO - Модель seller_pricing_behavior_model успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib. is_trained=True
2025-05-22 01:49:49,575 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора seller_pricing_behavior_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib
2025-05-22 01:49:49,575 - backend.ml_service.multilevel_detector - INFO -   Детектор 'seller_pricing_behavior_model' (тип: seller_pricing_behavior) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib.
2025-05-22 01:49:49,576 - backend.ml_service.multilevel_detector - INFO -   Детектор 'seller_pricing_behavior_model' (тип: seller_pricing_behavior) инициализирован с весом 1.0.
2025-05-22 01:49:49,577 - backend.ml_service.multilevel_detector - INFO - Инициализация детекторов для уровня 'time_series'...
2025-05-22 01:49:49,577 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора seasonal_deviation_model типа seasonal_deviation
2025-05-22 01:49:49,577 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='seasonal_deviation_model.joblib' установлен для seasonal_deviation_model
2025-05-22 01:49:49,577 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib'
2025-05-22 01:49:49,577 - backend.ml_service.detector - INFO - Попытка загрузки модели seasonal_deviation_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib...
2025-05-22 01:49:49,578 - backend.ml_service.detector - INFO - Модель seasonal_deviation_model успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib. is_trained=True
2025-05-22 01:49:49,579 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора seasonal_deviation_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib
2025-05-22 01:49:49,579 - backend.ml_service.multilevel_detector - INFO -   Детектор 'seasonal_deviation_model' (тип: seasonal_deviation) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib.
2025-05-22 01:49:49,579 - backend.ml_service.multilevel_detector - INFO -   Детектор 'seasonal_deviation_model' (тип: seasonal_deviation) инициализирован с весом 1.0.
2025-05-22 01:49:49,580 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора cumulative_sum_model типа cumulative_sum
2025-05-22 01:49:49,580 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='cumulative_sum_model.joblib' установлен для cumulative_sum_model
2025-05-22 01:49:49,580 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib'
2025-05-22 01:49:49,580 - backend.ml_service.detector - INFO - Попытка загрузки модели cumulative_sum_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib...
2025-05-22 01:49:49,581 - backend.ml_service.time_series_detectors - INFO - (cumulative_sum_model) Загружены baseline_mean=3696.0057142857145, baseline_std=4060.74644512314 из model_state.
2025-05-22 01:49:49,581 - backend.ml_service.time_series_detectors - INFO - (cumulative_sum_model) Детектор CUSUM успешно загружен и помечен как обученный.
2025-05-22 01:49:49,581 - backend.ml_service.detector - INFO - Модель cumulative_sum_model успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib. is_trained=True
2025-05-22 01:49:49,582 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора cumulative_sum_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib
2025-05-22 01:49:49,582 - backend.ml_service.multilevel_detector - INFO -   Детектор 'cumulative_sum_model' (тип: cumulative_sum) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib.
2025-05-22 01:49:49,582 - backend.ml_service.multilevel_detector - INFO -   Детектор 'cumulative_sum_model' (тип: cumulative_sum) инициализирован с весом 1.0.
2025-05-22 01:49:49,583 - backend.ml_service.multilevel_detector - INFO - Многоуровневая система инициализирована: 2 транзакционных детекторов (метод: weighted_average), 2 поведенческих детекторов (метод: weighted_average), 2 детекторов временных рядов (метод: average)
2025-05-22 01:49:49,583 - backend.ml_service.multilevel_service - INFO - Многоуровневая система успешно создана на основе конфигурации из settings.yaml.
2025-05-22 01:49:49,595 - backend.ml_service - INFO - ML Service Logger активен. Уровень: DEBUG. Директория логов ml_service: C:\Users\alex\Desktop\AnomaLens3.0\logs
2025-05-22 01:54:27,671 - backend.ml_service - INFO - Логирование настроено с уровнем DEBUG
2025-05-22 01:54:27,676 - backend.ml_service - INFO - Логи записываются в файл: C:\Users\alex\Desktop\AnomaLens3.0\logs\ml_service_2025-05-22.log
2025-05-22 01:54:34,471 - backend.ml_service.multilevel_service - INFO - Базовый путь для моделей (MultilevelService): C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models
2025-05-22 01:54:34,471 - backend.ml_service.multilevel_service - INFO - Создание/инициализация многоуровневой системы на основе настроек из config.yaml.
2025-05-22 01:54:34,472 - backend.ml_service.multilevel_service - DEBUG - Используется следующая конфигурация для MultilevelAnomalyDetector: {
  "transaction_level": [
    {
      "type": "transaction_vae",
      "model_filename": "ml_trans_vae_model.joblib",
      "weight": 1.0,
      "features": [
        "price",
        "freight_value",
        "product_weight_g",
        "freight_to_price_ratio"
      ],
      "encoding_dim": 10,
      "hidden_dim1": 32,
      "hidden_dim2": 16,
      "epochs": 25,
      "kld_weight": 0.5,
      "dropout_rate": 0.1,
      "shap_background_samples": 50
    },
    {
      "type": "category_price_outlier",
      "model_filename": "ml_category_price_model.joblib",
      "weight": 1.0,
      "category_col": "product_category_name",
      "price_col": "price",
      "threshold": 2.8,
      "min_samples_per_category": 10
    }
  ],
  "behavior_level": [
    {
      "type": "graph",
      "model_filename": "ml_graph_model_v3.joblib",
      "weight": 1.0,
      "use_seller_state_spread": true,
      "use_category_diversity": true,
      "use_seller_degree": true,
      "seller_state_weight": 0.3,
      "category_diversity_weight": 0.4,
      "seller_degree_weight": 0.3
    },
    {
      "type": "seller_pricing_behavior",
      "model_filename": "ml_seller_pricing_model.joblib",
      "weight": 1.0,
      "volatility_threshold": 0.5,
      "range_threshold": 5.0,
      "freight_ratio_threshold": 1.0,
      "min_transactions": 5
    }
  ],
  "time_series_level": [
    {
      "type": "seasonal_deviation",
      "model_filename": "seasonal_deviation_model.joblib",
      "weight": 1.0,
      "window_size": 7,
      "threshold": 2.5
    },
    {
      "type": "cumulative_sum",
      "model_filename": "cumulative_sum_model.joblib",
      "weight": 1.0,
      "window_size": 14,
      "threshold": 2.5,
      "drift_threshold": 4.5
    }
  ],
  "combination_weights": {
    "transaction": 0.4,
    "behavior": 0.3,
    "time_series": 0.3
  },
  "transaction_level_combination_method": "weighted_average",
  "behavior_level_combination_method": "weighted_average",
  "time_series_level_combination_method": "average"
}
2025-05-22 01:54:34,472 - backend.ml_service.multilevel_detector - INFO - Инициализация многоуровневой системы обнаружения аномалий...
2025-05-22 01:54:34,473 - backend.ml_service.multilevel_detector - INFO - Инициализация детекторов для уровня 'transaction'...
2025-05-22 01:54:34,473 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) VAEDetector инициализирован. Устройство: cpu, Входная размерность: 4, Признаки: ['price', 'freight_value', 'product_weight_g', 'freight_to_price_ratio']
2025-05-22 01:54:34,474 - backend.ml_service.detector - DEBUG - (transaction_vae_price) Сброс базового состояния детектора (из AnomalyDetector._reset_state).
2025-05-22 01:54:34,475 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Специфичное состояние VAEDetector (порог, SHAP) сброшено.
2025-05-22 01:54:34,476 - backend.ml_service.transaction_detectors - INFO - (transaction_vae_price) TransactionVAEDetector инициализирован. Конфигурационные признаки: ['price', 'freight_value', 'product_weight_g', 'freight_to_price_ratio'], Реально используемые признаки (с генерируемыми): ['price', 'freight_value', 'product_weight_g', 'freight_to_price_ratio'], encoding_dim(latent_dim): 10, hidden_dim1(hidden_dim): 32, hidden_dim2: 16, epochs: 25, batch_size: 64, lr: 0.001, kld_w: 0.5, dropout: 0.1
2025-05-22 01:54:34,477 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора transaction_vae_price типа transaction_vae
2025-05-22 01:54:34,477 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='ml_trans_vae_model.joblib' установлен для transaction_vae_price
2025-05-22 01:54:34,477 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib'
2025-05-22 01:54:34,477 - backend.ml_service.detector - INFO - Попытка загрузки модели transaction_vae_price из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib...
2025-05-22 01:54:34,499 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Загружен порог аномальности: 3.656726
2025-05-22 01:54:34,499 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) StandardScaler успешно инициализирован с параметрами: n_features_in_=4, mean_=(4,), scale_=(4,)
2025-05-22 01:54:34,499 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Фоновые данные SHAP загружены (torch.Size([50, 4]))
2025-05-22 01:54:34,504 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Модель VAE успешно загружена и перемещена на cpu.
2025-05-22 01:54:34,504 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Попытка пересоздания SHAP GradientExplainer после загрузки...
2025-05-22 01:54:34,511 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) SHAP GradientExplainer успешно ПЕРЕСОЗДАН при загрузке модели. Device=cpu, background_data.shape=torch.Size([50, 4])
2025-05-22 01:54:34,512 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Статус SHAP после загрузки: background_data shape=torch.Size([50, 4]), device=cpu, explainer=создан
2025-05-22 01:54:34,512 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Детектор VAE (is_trained=True) успешно загружен.
2025-05-22 01:54:34,512 - backend.ml_service.detector - INFO - Модель transaction_vae_price успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib. is_trained=True
2025-05-22 01:54:34,513 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора transaction_vae_price из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib
2025-05-22 01:54:34,513 - backend.ml_service.multilevel_detector - INFO -   Детектор 'transaction_vae_price' (тип: transaction_vae) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib.
2025-05-22 01:54:34,513 - backend.ml_service.multilevel_detector - INFO -   Детектор 'transaction_vae_price' (тип: transaction_vae) инициализирован с весом 1.0.
2025-05-22 01:54:34,514 - backend.ml_service.transaction_detectors - INFO - CategoryPriceOutlierDetector 'category_price_outlier_model' инициализирован с параметрами: category_col='product_category_name', price_col='price', threshold=2.8, min_samples_per_category=10
2025-05-22 01:54:34,514 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора category_price_outlier_model типа category_price_outlier
2025-05-22 01:54:34,514 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='ml_category_price_model.joblib' установлен для category_price_outlier_model
2025-05-22 01:54:34,514 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib'
2025-05-22 01:54:34,514 - backend.ml_service.detector - INFO - Попытка загрузки модели category_price_outlier_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib...
2025-05-22 01:54:34,517 - backend.ml_service.detector - INFO - Модель category_price_outlier_model успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib. is_trained=True
2025-05-22 01:54:34,517 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора category_price_outlier_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib
2025-05-22 01:54:34,517 - backend.ml_service.multilevel_detector - INFO -   Детектор 'category_price_outlier_model' (тип: category_price_outlier) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib.
2025-05-22 01:54:34,517 - backend.ml_service.multilevel_detector - INFO -   Детектор 'category_price_outlier_model' (тип: category_price_outlier) инициализирован с весом 1.0.
2025-05-22 01:54:34,518 - backend.ml_service.multilevel_detector - INFO - Инициализация детекторов для уровня 'behavior'...
2025-05-22 01:54:34,518 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора graph_graph_analysis типа graph
2025-05-22 01:54:34,518 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='ml_graph_model_v3.joblib' установлен для graph_graph_analysis
2025-05-22 01:54:34,518 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib'
2025-05-22 01:54:34,518 - backend.ml_service.detector - INFO - Попытка загрузки модели graph_graph_analysis из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib...
2025-05-22 01:54:34,519 - backend.ml_service.detector - INFO - Модель graph_graph_analysis успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib. is_trained=True
2025-05-22 01:54:34,519 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора graph_graph_analysis из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib
2025-05-22 01:54:34,519 - backend.ml_service.multilevel_detector - INFO -   Детектор 'graph_graph_analysis' (тип: graph) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib.
2025-05-22 01:54:34,519 - backend.ml_service.multilevel_detector - INFO -   Детектор 'graph_graph_analysis' (тип: graph) инициализирован с весом 1.0.
2025-05-22 01:54:34,520 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора seller_pricing_behavior_model типа seller_pricing_behavior
2025-05-22 01:54:34,520 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='ml_seller_pricing_model.joblib' установлен для seller_pricing_behavior_model
2025-05-22 01:54:34,520 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib'
2025-05-22 01:54:34,520 - backend.ml_service.detector - INFO - Попытка загрузки модели seller_pricing_behavior_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib...
2025-05-22 01:54:34,521 - backend.ml_service.detector - INFO - Модель seller_pricing_behavior_model успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib. is_trained=True
2025-05-22 01:54:34,521 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора seller_pricing_behavior_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib
2025-05-22 01:54:34,521 - backend.ml_service.multilevel_detector - INFO -   Детектор 'seller_pricing_behavior_model' (тип: seller_pricing_behavior) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib.
2025-05-22 01:54:34,521 - backend.ml_service.multilevel_detector - INFO -   Детектор 'seller_pricing_behavior_model' (тип: seller_pricing_behavior) инициализирован с весом 1.0.
2025-05-22 01:54:34,521 - backend.ml_service.multilevel_detector - INFO - Инициализация детекторов для уровня 'time_series'...
2025-05-22 01:54:34,522 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора seasonal_deviation_model типа seasonal_deviation
2025-05-22 01:54:34,522 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='seasonal_deviation_model.joblib' установлен для seasonal_deviation_model
2025-05-22 01:54:34,523 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib'
2025-05-22 01:54:34,523 - backend.ml_service.detector - INFO - Попытка загрузки модели seasonal_deviation_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib...
2025-05-22 01:54:34,524 - backend.ml_service.detector - INFO - Модель seasonal_deviation_model успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib. is_trained=True
2025-05-22 01:54:34,524 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора seasonal_deviation_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib
2025-05-22 01:54:34,524 - backend.ml_service.multilevel_detector - INFO -   Детектор 'seasonal_deviation_model' (тип: seasonal_deviation) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib.
2025-05-22 01:54:34,524 - backend.ml_service.multilevel_detector - INFO -   Детектор 'seasonal_deviation_model' (тип: seasonal_deviation) инициализирован с весом 1.0.
2025-05-22 01:54:34,525 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора cumulative_sum_model типа cumulative_sum
2025-05-22 01:54:34,525 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='cumulative_sum_model.joblib' установлен для cumulative_sum_model
2025-05-22 01:54:34,525 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib'
2025-05-22 01:54:34,525 - backend.ml_service.detector - INFO - Попытка загрузки модели cumulative_sum_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib...
2025-05-22 01:54:34,526 - backend.ml_service.time_series_detectors - INFO - (cumulative_sum_model) Загружены baseline_mean=3696.0057142857145, baseline_std=4060.74644512314 из model_state.
2025-05-22 01:54:34,526 - backend.ml_service.time_series_detectors - INFO - (cumulative_sum_model) Детектор CUSUM успешно загружен и помечен как обученный.
2025-05-22 01:54:34,526 - backend.ml_service.detector - INFO - Модель cumulative_sum_model успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib. is_trained=True
2025-05-22 01:54:34,526 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора cumulative_sum_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib
2025-05-22 01:54:34,526 - backend.ml_service.multilevel_detector - INFO -   Детектор 'cumulative_sum_model' (тип: cumulative_sum) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib.
2025-05-22 01:54:34,527 - backend.ml_service.multilevel_detector - INFO -   Детектор 'cumulative_sum_model' (тип: cumulative_sum) инициализирован с весом 1.0.
2025-05-22 01:54:34,527 - backend.ml_service.multilevel_detector - INFO - Многоуровневая система инициализирована: 2 транзакционных детекторов (метод: weighted_average), 2 поведенческих детекторов (метод: weighted_average), 2 детекторов временных рядов (метод: average)
2025-05-22 01:54:34,527 - backend.ml_service.multilevel_service - INFO - Многоуровневая система успешно создана на основе конфигурации из settings.yaml.
2025-05-22 01:54:34,542 - backend.ml_service - INFO - ML Service Logger активен. Уровень: DEBUG. Директория логов ml_service: C:\Users\alex\Desktop\AnomaLens3.0\logs
2025-05-22 02:00:35,653 - backend.ml_service - INFO - Логирование настроено с уровнем DEBUG
2025-05-22 02:00:35,653 - backend.ml_service - INFO - Логи записываются в файл: C:\Users\alex\Desktop\AnomaLens3.0\logs\ml_service_2025-05-22.log
2025-05-22 02:00:40,016 - backend.ml_service.multilevel_service - INFO - Базовый путь для моделей (MultilevelService): C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models
2025-05-22 02:00:40,017 - backend.ml_service.multilevel_service - INFO - Создание/инициализация многоуровневой системы на основе настроек из config.yaml.
2025-05-22 02:00:40,017 - backend.ml_service.multilevel_service - DEBUG - Используется следующая конфигурация для MultilevelAnomalyDetector: {
  "transaction_level": [
    {
      "type": "transaction_vae",
      "model_filename": "ml_trans_vae_model.joblib",
      "weight": 1.0,
      "features": [
        "price",
        "freight_value",
        "product_weight_g",
        "freight_to_price_ratio"
      ],
      "encoding_dim": 10,
      "hidden_dim1": 32,
      "hidden_dim2": 16,
      "epochs": 25,
      "kld_weight": 0.5,
      "dropout_rate": 0.1,
      "shap_background_samples": 50
    },
    {
      "type": "category_price_outlier",
      "model_filename": "ml_category_price_model.joblib",
      "weight": 1.0,
      "category_col": "product_category_name",
      "price_col": "price",
      "threshold": 2.8,
      "min_samples_per_category": 10
    }
  ],
  "behavior_level": [
    {
      "type": "graph",
      "model_filename": "ml_graph_model_v3.joblib",
      "weight": 1.0,
      "use_seller_state_spread": true,
      "use_category_diversity": true,
      "use_seller_degree": true,
      "seller_state_weight": 0.3,
      "category_diversity_weight": 0.4,
      "seller_degree_weight": 0.3
    },
    {
      "type": "seller_pricing_behavior",
      "model_filename": "ml_seller_pricing_model.joblib",
      "weight": 1.0,
      "volatility_threshold": 0.5,
      "range_threshold": 5.0,
      "freight_ratio_threshold": 1.0,
      "min_transactions": 5
    }
  ],
  "time_series_level": [
    {
      "type": "seasonal_deviation",
      "model_filename": "seasonal_deviation_model.joblib",
      "weight": 1.0,
      "window_size": 7,
      "threshold": 2.5
    },
    {
      "type": "cumulative_sum",
      "model_filename": "cumulative_sum_model.joblib",
      "weight": 1.0,
      "window_size": 14,
      "threshold": 2.5,
      "drift_threshold": 4.5
    }
  ],
  "combination_weights": {
    "transaction": 0.4,
    "behavior": 0.3,
    "time_series": 0.3
  },
  "transaction_level_combination_method": "weighted_average",
  "behavior_level_combination_method": "weighted_average",
  "time_series_level_combination_method": "average"
}
2025-05-22 02:00:40,018 - backend.ml_service.multilevel_detector - INFO - Инициализация многоуровневой системы обнаружения аномалий...
2025-05-22 02:00:40,018 - backend.ml_service.multilevel_detector - INFO - Инициализация детекторов для уровня 'transaction'...
2025-05-22 02:00:40,018 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) VAEDetector инициализирован. Устройство: cpu, Входная размерность: 4, Признаки: ['price', 'freight_value', 'product_weight_g', 'freight_to_price_ratio']
2025-05-22 02:00:40,018 - backend.ml_service.detector - DEBUG - (transaction_vae_price) Сброс базового состояния детектора (из AnomalyDetector._reset_state).
2025-05-22 02:00:40,018 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Специфичное состояние VAEDetector (порог, SHAP) сброшено.
2025-05-22 02:00:40,018 - backend.ml_service.transaction_detectors - INFO - (transaction_vae_price) TransactionVAEDetector инициализирован. Конфигурационные признаки: ['price', 'freight_value', 'product_weight_g', 'freight_to_price_ratio'], Реально используемые признаки (с генерируемыми): ['price', 'freight_value', 'product_weight_g', 'freight_to_price_ratio'], encoding_dim(latent_dim): 10, hidden_dim1(hidden_dim): 32, hidden_dim2: 16, epochs: 25, batch_size: 64, lr: 0.001, kld_w: 0.5, dropout: 0.1
2025-05-22 02:00:40,019 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора transaction_vae_price типа transaction_vae
2025-05-22 02:00:40,019 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='ml_trans_vae_model.joblib' установлен для transaction_vae_price
2025-05-22 02:00:40,019 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib'
2025-05-22 02:00:40,019 - backend.ml_service.detector - INFO - Попытка загрузки модели transaction_vae_price из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib...
2025-05-22 02:00:40,031 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Загружен порог аномальности: 3.656726
2025-05-22 02:00:40,031 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) StandardScaler успешно инициализирован с параметрами: n_features_in_=4, mean_=(4,), scale_=(4,)
2025-05-22 02:00:40,031 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Фоновые данные SHAP загружены (torch.Size([50, 4]))
2025-05-22 02:00:40,034 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Модель VAE успешно загружена и перемещена на cpu.
2025-05-22 02:00:40,034 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Попытка пересоздания SHAP GradientExplainer после загрузки...
2025-05-22 02:00:40,039 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) SHAP GradientExplainer успешно ПЕРЕСОЗДАН при загрузке модели. Device=cpu, background_data.shape=torch.Size([50, 4])
2025-05-22 02:00:40,039 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Статус SHAP после загрузки: background_data shape=torch.Size([50, 4]), device=cpu, explainer=создан
2025-05-22 02:00:40,040 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Детектор VAE (is_trained=True) успешно загружен.
2025-05-22 02:00:40,040 - backend.ml_service.detector - INFO - Модель transaction_vae_price успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib. is_trained=True
2025-05-22 02:00:40,040 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора transaction_vae_price из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib
2025-05-22 02:00:40,040 - backend.ml_service.multilevel_detector - INFO -   Детектор 'transaction_vae_price' (тип: transaction_vae) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib.
2025-05-22 02:00:40,041 - backend.ml_service.multilevel_detector - INFO -   Детектор 'transaction_vae_price' (тип: transaction_vae) инициализирован с весом 1.0.
2025-05-22 02:00:40,041 - backend.ml_service.transaction_detectors - INFO - CategoryPriceOutlierDetector 'category_price_outlier_model' инициализирован с параметрами: category_col='product_category_name', price_col='price', threshold=2.8, min_samples_per_category=10
2025-05-22 02:00:40,041 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора category_price_outlier_model типа category_price_outlier
2025-05-22 02:00:40,041 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='ml_category_price_model.joblib' установлен для category_price_outlier_model
2025-05-22 02:00:40,041 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib'
2025-05-22 02:00:40,042 - backend.ml_service.detector - INFO - Попытка загрузки модели category_price_outlier_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib...
2025-05-22 02:00:40,044 - backend.ml_service.detector - INFO - Модель category_price_outlier_model успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib. is_trained=True
2025-05-22 02:00:40,044 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора category_price_outlier_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib
2025-05-22 02:00:40,044 - backend.ml_service.multilevel_detector - INFO -   Детектор 'category_price_outlier_model' (тип: category_price_outlier) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib.
2025-05-22 02:00:40,044 - backend.ml_service.multilevel_detector - INFO -   Детектор 'category_price_outlier_model' (тип: category_price_outlier) инициализирован с весом 1.0.
2025-05-22 02:00:40,045 - backend.ml_service.multilevel_detector - INFO - Инициализация детекторов для уровня 'behavior'...
2025-05-22 02:00:40,045 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора graph_graph_analysis типа graph
2025-05-22 02:00:40,045 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='ml_graph_model_v3.joblib' установлен для graph_graph_analysis
2025-05-22 02:00:40,045 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib'
2025-05-22 02:00:40,045 - backend.ml_service.detector - INFO - Попытка загрузки модели graph_graph_analysis из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib...
2025-05-22 02:00:40,046 - backend.ml_service.detector - INFO - Модель graph_graph_analysis успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib. is_trained=True
2025-05-22 02:00:40,046 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора graph_graph_analysis из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib
2025-05-22 02:00:40,046 - backend.ml_service.multilevel_detector - INFO -   Детектор 'graph_graph_analysis' (тип: graph) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib.
2025-05-22 02:00:40,046 - backend.ml_service.multilevel_detector - INFO -   Детектор 'graph_graph_analysis' (тип: graph) инициализирован с весом 1.0.
2025-05-22 02:00:40,046 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора seller_pricing_behavior_model типа seller_pricing_behavior
2025-05-22 02:00:40,047 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='ml_seller_pricing_model.joblib' установлен для seller_pricing_behavior_model
2025-05-22 02:00:40,047 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib'
2025-05-22 02:00:40,047 - backend.ml_service.detector - INFO - Попытка загрузки модели seller_pricing_behavior_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib...
2025-05-22 02:00:40,047 - backend.ml_service.detector - INFO - Модель seller_pricing_behavior_model успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib. is_trained=True
2025-05-22 02:00:40,048 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора seller_pricing_behavior_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib
2025-05-22 02:00:40,048 - backend.ml_service.multilevel_detector - INFO -   Детектор 'seller_pricing_behavior_model' (тип: seller_pricing_behavior) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib.
2025-05-22 02:00:40,048 - backend.ml_service.multilevel_detector - INFO -   Детектор 'seller_pricing_behavior_model' (тип: seller_pricing_behavior) инициализирован с весом 1.0.
2025-05-22 02:00:40,048 - backend.ml_service.multilevel_detector - INFO - Инициализация детекторов для уровня 'time_series'...
2025-05-22 02:00:40,048 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора seasonal_deviation_model типа seasonal_deviation
2025-05-22 02:00:40,049 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='seasonal_deviation_model.joblib' установлен для seasonal_deviation_model
2025-05-22 02:00:40,049 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib'
2025-05-22 02:00:40,049 - backend.ml_service.detector - INFO - Попытка загрузки модели seasonal_deviation_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib...
2025-05-22 02:00:40,049 - backend.ml_service.detector - INFO - Модель seasonal_deviation_model успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib. is_trained=True
2025-05-22 02:00:40,050 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора seasonal_deviation_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib
2025-05-22 02:00:40,050 - backend.ml_service.multilevel_detector - INFO -   Детектор 'seasonal_deviation_model' (тип: seasonal_deviation) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib.
2025-05-22 02:00:40,050 - backend.ml_service.multilevel_detector - INFO -   Детектор 'seasonal_deviation_model' (тип: seasonal_deviation) инициализирован с весом 1.0.
2025-05-22 02:00:40,050 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора cumulative_sum_model типа cumulative_sum
2025-05-22 02:00:40,050 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='cumulative_sum_model.joblib' установлен для cumulative_sum_model
2025-05-22 02:00:40,050 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib'
2025-05-22 02:00:40,051 - backend.ml_service.detector - INFO - Попытка загрузки модели cumulative_sum_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib...
2025-05-22 02:00:40,051 - backend.ml_service.time_series_detectors - INFO - (cumulative_sum_model) Загружены baseline_mean=3696.0057142857145, baseline_std=4060.74644512314 из model_state.
2025-05-22 02:00:40,052 - backend.ml_service.time_series_detectors - INFO - (cumulative_sum_model) Детектор CUSUM успешно загружен и помечен как обученный.
2025-05-22 02:00:40,052 - backend.ml_service.detector - INFO - Модель cumulative_sum_model успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib. is_trained=True
2025-05-22 02:00:40,052 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора cumulative_sum_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib
2025-05-22 02:00:40,052 - backend.ml_service.multilevel_detector - INFO -   Детектор 'cumulative_sum_model' (тип: cumulative_sum) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib.
2025-05-22 02:00:40,052 - backend.ml_service.multilevel_detector - INFO -   Детектор 'cumulative_sum_model' (тип: cumulative_sum) инициализирован с весом 1.0.
2025-05-22 02:00:40,052 - backend.ml_service.multilevel_detector - INFO - Многоуровневая система инициализирована: 2 транзакционных детекторов (метод: weighted_average), 2 поведенческих детекторов (метод: weighted_average), 2 детекторов временных рядов (метод: average)
2025-05-22 02:00:40,052 - backend.ml_service.multilevel_service - INFO - Многоуровневая система успешно создана на основе конфигурации из settings.yaml.
2025-05-22 02:00:40,065 - backend.ml_service - INFO - ML Service Logger активен. Уровень: DEBUG. Директория логов ml_service: C:\Users\alex\Desktop\AnomaLens3.0\logs
2025-05-22 02:31:36,968 - backend.ml_service - INFO - Логирование настроено с уровнем DEBUG
2025-05-22 02:31:36,971 - backend.ml_service - INFO - Логи записываются в файл: C:\Users\alex\Desktop\AnomaLens3.0\logs\ml_service_2025-05-22.log
2025-05-22 02:31:39,832 - backend.ml_service.multilevel_service - INFO - Базовый путь для моделей (MultilevelService): C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models
2025-05-22 02:31:39,832 - backend.ml_service.multilevel_service - INFO - Создание/инициализация многоуровневой системы на основе настроек из config.yaml.
2025-05-22 02:31:39,832 - backend.ml_service.multilevel_service - DEBUG - Используется следующая конфигурация для MultilevelAnomalyDetector: {
  "transaction_level": [
    {
      "type": "transaction_vae",
      "model_filename": "ml_trans_vae_model.joblib",
      "weight": 1.0,
      "features": [
        "price",
        "freight_value",
        "product_weight_g",
        "freight_to_price_ratio"
      ],
      "encoding_dim": 10,
      "hidden_dim1": 32,
      "hidden_dim2": 16,
      "epochs": 25,
      "kld_weight": 0.5,
      "dropout_rate": 0.1,
      "shap_background_samples": 50
    },
    {
      "type": "category_price_outlier",
      "model_filename": "ml_category_price_model.joblib",
      "weight": 1.0,
      "category_col": "product_category_name",
      "price_col": "price",
      "threshold": 2.8,
      "min_samples_per_category": 10
    }
  ],
  "behavior_level": [
    {
      "type": "graph",
      "model_filename": "ml_graph_model_v3.joblib",
      "weight": 1.0,
      "use_seller_state_spread": true,
      "use_category_diversity": true,
      "use_seller_degree": true,
      "seller_state_weight": 0.3,
      "category_diversity_weight": 0.4,
      "seller_degree_weight": 0.3
    },
    {
      "type": "seller_pricing_behavior",
      "model_filename": "ml_seller_pricing_model.joblib",
      "weight": 1.0,
      "volatility_threshold": 0.5,
      "range_threshold": 5.0,
      "freight_ratio_threshold": 1.0,
      "min_transactions": 5
    }
  ],
  "time_series_level": [
    {
      "type": "seasonal_deviation",
      "model_filename": "seasonal_deviation_model.joblib",
      "weight": 1.0,
      "window_size": 7,
      "threshold": 2.5
    },
    {
      "type": "cumulative_sum",
      "model_filename": "cumulative_sum_model.joblib",
      "weight": 1.0,
      "window_size": 14,
      "threshold": 2.5,
      "drift_threshold": 4.5
    }
  ],
  "combination_weights": {
    "transaction": 0.4,
    "behavior": 0.3,
    "time_series": 0.3
  },
  "transaction_level_combination_method": "weighted_average",
  "behavior_level_combination_method": "weighted_average",
  "time_series_level_combination_method": "average"
}
2025-05-22 02:31:39,833 - backend.ml_service.multilevel_detector - INFO - Инициализация многоуровневой системы обнаружения аномалий...
2025-05-22 02:31:39,833 - backend.ml_service.multilevel_detector - INFO - Инициализация детекторов для уровня 'transaction'...
2025-05-22 02:31:39,833 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) VAEDetector инициализирован. Устройство: cpu, Входная размерность: 4, Признаки: ['price', 'freight_value', 'product_weight_g', 'freight_to_price_ratio']
2025-05-22 02:31:39,834 - backend.ml_service.detector - DEBUG - (transaction_vae_price) Сброс базового состояния детектора (из AnomalyDetector._reset_state).
2025-05-22 02:31:39,834 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Специфичное состояние VAEDetector (порог, SHAP) сброшено.
2025-05-22 02:31:39,834 - backend.ml_service.transaction_detectors - INFO - (transaction_vae_price) TransactionVAEDetector инициализирован. Конфигурационные признаки: ['price', 'freight_value', 'product_weight_g', 'freight_to_price_ratio'], Реально используемые признаки (с генерируемыми): ['price', 'freight_value', 'product_weight_g', 'freight_to_price_ratio'], encoding_dim(latent_dim): 10, hidden_dim1(hidden_dim): 32, hidden_dim2: 16, epochs: 25, batch_size: 64, lr: 0.001, kld_w: 0.5, dropout: 0.1
2025-05-22 02:31:39,834 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора transaction_vae_price типа transaction_vae
2025-05-22 02:31:39,835 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='ml_trans_vae_model.joblib' установлен для transaction_vae_price
2025-05-22 02:31:39,835 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib'
2025-05-22 02:31:39,835 - backend.ml_service.detector - INFO - Попытка загрузки модели transaction_vae_price из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib...
2025-05-22 02:31:39,846 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Загружен порог аномальности: 3.656726
2025-05-22 02:31:39,846 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) StandardScaler успешно инициализирован с параметрами: n_features_in_=4, mean_=(4,), scale_=(4,)
2025-05-22 02:31:39,847 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Фоновые данные SHAP загружены (torch.Size([50, 4]))
2025-05-22 02:31:39,849 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Модель VAE успешно загружена и перемещена на cpu.
2025-05-22 02:31:39,849 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Попытка пересоздания SHAP GradientExplainer после загрузки...
2025-05-22 02:31:39,853 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) SHAP GradientExplainer успешно ПЕРЕСОЗДАН при загрузке модели. Device=cpu, background_data.shape=torch.Size([50, 4])
2025-05-22 02:31:39,853 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Статус SHAP после загрузки: background_data shape=torch.Size([50, 4]), device=cpu, explainer=создан
2025-05-22 02:31:39,854 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Детектор VAE (is_trained=True) успешно загружен.
2025-05-22 02:31:39,854 - backend.ml_service.detector - INFO - Модель transaction_vae_price успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib. is_trained=True
2025-05-22 02:31:39,854 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора transaction_vae_price из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib
2025-05-22 02:31:39,854 - backend.ml_service.multilevel_detector - INFO -   Детектор 'transaction_vae_price' (тип: transaction_vae) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib.
2025-05-22 02:31:39,855 - backend.ml_service.multilevel_detector - INFO -   Детектор 'transaction_vae_price' (тип: transaction_vae) инициализирован с весом 1.0.
2025-05-22 02:31:39,855 - backend.ml_service.transaction_detectors - INFO - CategoryPriceOutlierDetector 'category_price_outlier_model' инициализирован с параметрами: category_col='product_category_name', price_col='price', threshold=2.8, min_samples_per_category=10
2025-05-22 02:31:39,855 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора category_price_outlier_model типа category_price_outlier
2025-05-22 02:31:39,855 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='ml_category_price_model.joblib' установлен для category_price_outlier_model
2025-05-22 02:31:39,855 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib'
2025-05-22 02:31:39,856 - backend.ml_service.detector - INFO - Попытка загрузки модели category_price_outlier_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib...
2025-05-22 02:31:39,857 - backend.ml_service.detector - INFO - Модель category_price_outlier_model успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib. is_trained=True
2025-05-22 02:31:39,857 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора category_price_outlier_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib
2025-05-22 02:31:39,857 - backend.ml_service.multilevel_detector - INFO -   Детектор 'category_price_outlier_model' (тип: category_price_outlier) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib.
2025-05-22 02:31:39,858 - backend.ml_service.multilevel_detector - INFO -   Детектор 'category_price_outlier_model' (тип: category_price_outlier) инициализирован с весом 1.0.
2025-05-22 02:31:39,858 - backend.ml_service.multilevel_detector - INFO - Инициализация детекторов для уровня 'behavior'...
2025-05-22 02:31:39,858 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора graph_graph_analysis типа graph
2025-05-22 02:31:39,858 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='ml_graph_model_v3.joblib' установлен для graph_graph_analysis
2025-05-22 02:31:39,858 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib'
2025-05-22 02:31:39,858 - backend.ml_service.detector - INFO - Попытка загрузки модели graph_graph_analysis из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib...
2025-05-22 02:31:39,859 - backend.ml_service.detector - INFO - Модель graph_graph_analysis успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib. is_trained=True
2025-05-22 02:31:39,859 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора graph_graph_analysis из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib
2025-05-22 02:31:39,859 - backend.ml_service.multilevel_detector - INFO -   Детектор 'graph_graph_analysis' (тип: graph) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib.
2025-05-22 02:31:39,859 - backend.ml_service.multilevel_detector - INFO -   Детектор 'graph_graph_analysis' (тип: graph) инициализирован с весом 1.0.
2025-05-22 02:31:39,860 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора seller_pricing_behavior_model типа seller_pricing_behavior
2025-05-22 02:31:39,860 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='ml_seller_pricing_model.joblib' установлен для seller_pricing_behavior_model
2025-05-22 02:31:39,860 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib'
2025-05-22 02:31:39,860 - backend.ml_service.detector - INFO - Попытка загрузки модели seller_pricing_behavior_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib...
2025-05-22 02:31:39,860 - backend.ml_service.detector - INFO - Модель seller_pricing_behavior_model успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib. is_trained=True
2025-05-22 02:31:39,861 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора seller_pricing_behavior_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib
2025-05-22 02:31:39,861 - backend.ml_service.multilevel_detector - INFO -   Детектор 'seller_pricing_behavior_model' (тип: seller_pricing_behavior) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib.
2025-05-22 02:31:39,861 - backend.ml_service.multilevel_detector - INFO -   Детектор 'seller_pricing_behavior_model' (тип: seller_pricing_behavior) инициализирован с весом 1.0.
2025-05-22 02:31:39,861 - backend.ml_service.multilevel_detector - INFO - Инициализация детекторов для уровня 'time_series'...
2025-05-22 02:31:39,861 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора seasonal_deviation_model типа seasonal_deviation
2025-05-22 02:31:39,861 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='seasonal_deviation_model.joblib' установлен для seasonal_deviation_model
2025-05-22 02:31:39,862 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib'
2025-05-22 02:31:39,862 - backend.ml_service.detector - INFO - Попытка загрузки модели seasonal_deviation_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib...
2025-05-22 02:31:39,862 - backend.ml_service.detector - INFO - Модель seasonal_deviation_model успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib. is_trained=True
2025-05-22 02:31:39,862 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора seasonal_deviation_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib
2025-05-22 02:31:39,862 - backend.ml_service.multilevel_detector - INFO -   Детектор 'seasonal_deviation_model' (тип: seasonal_deviation) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib.
2025-05-22 02:31:39,863 - backend.ml_service.multilevel_detector - INFO -   Детектор 'seasonal_deviation_model' (тип: seasonal_deviation) инициализирован с весом 1.0.
2025-05-22 02:31:39,863 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора cumulative_sum_model типа cumulative_sum
2025-05-22 02:31:39,863 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='cumulative_sum_model.joblib' установлен для cumulative_sum_model
2025-05-22 02:31:39,863 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib'
2025-05-22 02:31:39,863 - backend.ml_service.detector - INFO - Попытка загрузки модели cumulative_sum_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib...
2025-05-22 02:31:39,864 - backend.ml_service.time_series_detectors - INFO - (cumulative_sum_model) Загружены baseline_mean=3696.0057142857145, baseline_std=4060.74644512314 из model_state.
2025-05-22 02:31:39,864 - backend.ml_service.time_series_detectors - INFO - (cumulative_sum_model) Детектор CUSUM успешно загружен и помечен как обученный.
2025-05-22 02:31:39,864 - backend.ml_service.detector - INFO - Модель cumulative_sum_model успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib. is_trained=True
2025-05-22 02:31:39,865 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора cumulative_sum_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib
2025-05-22 02:31:39,865 - backend.ml_service.multilevel_detector - INFO -   Детектор 'cumulative_sum_model' (тип: cumulative_sum) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib.
2025-05-22 02:31:39,865 - backend.ml_service.multilevel_detector - INFO -   Детектор 'cumulative_sum_model' (тип: cumulative_sum) инициализирован с весом 1.0.
2025-05-22 02:31:39,865 - backend.ml_service.multilevel_detector - INFO - Многоуровневая система инициализирована: 2 транзакционных детекторов (метод: weighted_average), 2 поведенческих детекторов (метод: weighted_average), 2 детекторов временных рядов (метод: average)
2025-05-22 02:31:39,865 - backend.ml_service.multilevel_service - INFO - Многоуровневая система успешно создана на основе конфигурации из settings.yaml.
2025-05-22 02:31:39,874 - backend.ml_service - INFO - ML Service Logger активен. Уровень: DEBUG. Директория логов ml_service: C:\Users\alex\Desktop\AnomaLens3.0\logs
2025-05-22 02:46:18,903 - backend.ml_service.multilevel_service - INFO - [TaskID: 2e73360b-e5d5-4553-a019-eb2a30a07817] Обертка detect_async_task_wrapper запущена.
2025-05-22 02:46:18,905 - backend.ml_service.multilevel_service - INFO - Начало обнаружения аномалий (multilevel) с сохранением в БД...
2025-05-22 02:46:18,905 - backend.ml_service.multilevel_service - INFO - Загрузка данных из БД для multilevel detect...
2025-05-22 02:46:18,906 - backend.ml_service.common - INFO - Загрузка данных из БД за период: 1998-01-04 02:46:18.900105 - None (с ассоциациями)
2025-05-22 02:46:23,267 - backend.ml_service.common - INFO - Загружено 118310 записей OrderItem.
2025-05-22 02:46:23,267 - backend.ml_service.multilevel_service - INFO - Данные для multilevel detect (118310 строк) подготовлены. Применение инженерии признаков...
2025-05-22 02:46:23,415 - backend.ml_service.common - INFO - Добавлен признак: 'price_deviation_from_category_mean'
2025-05-22 02:46:23,418 - backend.ml_service.common - INFO - Добавлен признак: 'freight_to_price_ratio'
2025-05-22 02:46:23,418 - backend.ml_service.multilevel_service - INFO - Инженерия признаков для детекции завершена.
2025-05-22 02:46:23,418 - backend.ml_service.multilevel_service - INFO - Запуск multilevel_detector.detect()...
2025-05-22 02:46:23,442 - backend.ml_service.multilevel_detector - INFO - Запуск анализа на уровне: transaction...
2025-05-22 02:46:23,444 - backend.ml_service.multilevel_detector - INFO - Уровень 'transaction': Запуск детектора 'transaction_vae_price'...
2025-05-22 02:46:23,466 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Запуск детекции...
2025-05-22 02:46:23,725 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) [Detect_Preprocess] Scaler type: <class 'sklearn.preprocessing._data.StandardScaler'>
2025-05-22 02:46:23,726 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) [Detect_Preprocess] Scaler has mean_: True
2025-05-22 02:46:23,726 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) [Detect_Preprocess] Scaler mean_ shape: (4,)
2025-05-22 02:46:23,726 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) [Detect_Preprocess] Scaler params: {'copy': True, 'with_mean': True, 'with_std': True}
2025-05-22 02:46:23,726 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) StandardScaler обучен (mean_ присутствует). Выполняется transform.
2025-05-22 02:46:24,773 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Детекция завершена. Время: 1.31 сек.
2025-05-22 02:46:24,788 - backend.ml_service.multilevel_detector - INFO - Детектор 'transaction_vae_price' обработан. Распределение нормализованных скоров: Min=0.0000, Max=0.9969, Mean=0.0067
2025-05-22 02:46:24,788 - backend.ml_service.multilevel_detector - INFO - Уровень 'transaction': Запуск детектора 'category_price_outlier_model'...
2025-05-22 02:46:25,212 - backend.ml_service.transaction_detectors - INFO - Для 10 товаров с неизвестными категориями присвоен высокий скор аномальности.
2025-05-22 02:46:25,214 - backend.ml_service.transaction_detectors - INFO - Детектор category_price_outlier_model: обнаружено 2104 аномалий из 118310 транзакций
2025-05-22 02:46:25,238 - backend.ml_service.multilevel_detector - INFO - Детектор 'category_price_outlier_model' обработан. Распределение нормализованных скоров: Min=0.0000, Max=1.0000, Mean=0.0115
2025-05-22 02:46:25,252 - backend.ml_service.multilevel_detector - DEBUG - _combine_scores_for_single_level (Уровень: transaction): Матрица скоров (shape (2, 118310)), метод: weighted_average
2025-05-22 02:46:25,257 - backend.ml_service.multilevel_detector - DEBUG - _combine_scores_for_single_level (Уровень: transaction, метод: weighted_average): Используемые веса: {'transaction_vae_price': 1.0, 'category_price_outlier_model': 1.0}, массив весов: [1. 1.]
2025-05-22 02:46:25,258 - backend.ml_service.multilevel_detector - DEBUG - _combine_scores_for_single_level (Уровень: transaction, метод: weighted_average): Распределение combined_scores: Min=0.0000, Max=0.9533, Mean=0.0091
2025-05-22 02:46:25,279 - backend.ml_service.multilevel_detector - INFO - Анализ на уровне 'transaction' завершен. Добавлен столбец 'transaction_score' и индивидуальные скоры детекторов.
2025-05-22 02:46:25,281 - backend.ml_service.multilevel_detector - INFO - Запуск анализа на уровне: behavior...
2025-05-22 02:46:25,410 - backend.ml_service.multilevel_detector - INFO - Детектор 'graph_graph_analysis' типа GraphAnomalyDetector получит оригинальные данные, а не агрегированные
2025-05-22 02:46:25,410 - backend.ml_service.multilevel_detector - INFO - Уровень 'behavior': Запуск детектора 'graph_graph_analysis'...
2025-05-22 02:46:25,431 - backend.ml_service.graph_detector - INFO - Построение графа...
2025-05-22 02:46:31,789 - backend.ml_service.graph_detector - INFO - Граф построен за 6.26 сек. Узлов: 346028, Ребер: 436616
2025-05-22 02:46:31,856 - backend.ml_service.graph_detector - INFO - Расчет графовых аномальных скоров для 112650 узлов OrderItem...
2025-05-22 02:46:34,066 - backend.ml_service.graph_detector - INFO - Детектор graph_graph_analysis: обнаружено 0 аномалий из 118310 (112650 обработано графом)
2025-05-22 02:46:34,123 - backend.ml_service.multilevel_detector - INFO - Детектор 'graph_graph_analysis' обработан. Распределение нормализованных скоров: Min=0.0000, Max=0.6667, Mean=0.1571
2025-05-22 02:46:34,123 - backend.ml_service.multilevel_detector - INFO - Уровень 'behavior': Запуск детектора 'seller_pricing_behavior_model'...
2025-05-22 02:46:34,127 - backend.ml_service.behavior_detectors - INFO - Детектор seller_pricing_behavior_model: обнаружено 389 аномалий из 3095 продавцов
2025-05-22 02:46:34,141 - backend.ml_service.multilevel_detector - INFO - Детектор 'seller_pricing_behavior_model' обработан. Распределение нормализованных скоров: Min=0.0000, Max=1.0000, Mean=0.0644
2025-05-22 02:46:34,142 - backend.ml_service.multilevel_detector - DEBUG - _combine_scores_for_single_level (Уровень: behavior): Матрица скоров (shape (2, 3095)), метод: weighted_average
2025-05-22 02:46:34,143 - backend.ml_service.multilevel_detector - DEBUG - _combine_scores_for_single_level (Уровень: behavior, метод: weighted_average): Используемые веса: {'graph_graph_analysis': 1.0, 'seller_pricing_behavior_model': 1.0}, массив весов: [1. 1.]
2025-05-22 02:46:34,144 - backend.ml_service.multilevel_detector - DEBUG - _combine_scores_for_single_level (Уровень: behavior, метод: weighted_average): Распределение combined_scores: Min=0.0000, Max=0.5785, Mean=0.1108
2025-05-22 02:46:34,145 - backend.ml_service.multilevel_detector - INFO - Анализ на уровне 'behavior' завершен. Добавлен столбец 'behavior_score' и индивидуальные скоры детекторов.
2025-05-22 02:46:34,347 - backend.ml_service.multilevel_detector - INFO - Запуск анализа на уровне: time_series...
2025-05-22 02:46:34,441 - backend.ml_service.multilevel_detector - INFO - Уровень 'time_series': Запуск детектора 'seasonal_deviation_model'...
2025-05-22 02:46:34,447 - backend.ml_service.time_series_detectors - INFO - Детектор seasonal_deviation_model: обнаружено 160 аномалий из 616 временных точек
2025-05-22 02:46:34,447 - backend.ml_service.multilevel_detector - INFO - Детектор 'seasonal_deviation_model' обработан. Распределение нормализованных скоров: Min=0.0012, Max=1.0000, Mean=0.6384
2025-05-22 02:46:34,447 - backend.ml_service.multilevel_detector - INFO - Уровень 'time_series': Запуск детектора 'cumulative_sum_model'...
2025-05-22 02:46:34,488 - backend.ml_service.time_series_detectors - INFO - Детектор cumulative_sum_model: обнаружено 614 аномалий из 616 временных точек
2025-05-22 02:46:34,489 - backend.ml_service.multilevel_detector - INFO - Детектор 'cumulative_sum_model' обработан. Распределение нормализованных скоров: Min=0.0000, Max=1.0000, Mean=0.3781
2025-05-22 02:46:34,489 - backend.ml_service.multilevel_detector - DEBUG - _combine_scores_for_single_level (Уровень: time_series): Матрица скоров (shape (2, 616)), метод: average
2025-05-22 02:46:34,490 - backend.ml_service.multilevel_detector - DEBUG - _combine_scores_for_single_level (Уровень: time_series, метод: average): Распределение combined_scores: Min=0.0298, Max=1.0000, Mean=0.5082
2025-05-22 02:46:34,491 - backend.ml_service.multilevel_detector - INFO - Анализ на уровне 'time_series' завершен. Добавлен столбец 'time_series_score' и индивидуальные скоры детекторов.
2025-05-22 02:46:34,527 - backend.ml_service.multilevel_detector - INFO - Слияние временных данных: result_df имеет 118310 строк, 616 уникальных дат
2025-05-22 02:46:34,527 - backend.ml_service.multilevel_detector - INFO - Слияние временных данных: ts_scores_to_merge имеет 616 строк, 616 уникальных дат
2025-05-22 02:46:34,606 - backend.ml_service.multilevel_detector - DEBUG - Распределение transaction_level_score: Min=0.0000, Max=0.9533, Mean=0.0091
2025-05-22 02:46:34,607 - backend.ml_service.multilevel_detector - DEBUG - Распределение behavior_level_score: Min=0.0000, Max=0.5785, Mean=0.1589
2025-05-22 02:46:34,608 - backend.ml_service.multilevel_detector - DEBUG - Распределение time_series_level_score: Min=0.0298, Max=1.0000, Mean=0.5518
2025-05-22 02:46:34,608 - backend.ml_service.multilevel_detector - INFO - Расчет итогового многоуровневого скора...
2025-05-22 02:46:34,610 - backend.ml_service.multilevel_detector - DEBUG - Распределение multilevel_score (перед порогом): Min=0.0120, Max=0.6082, Mean=0.2169
2025-05-22 02:46:34,611 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 1385, order_id: 64834bc188a370357ed08e9eabe5f92e, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,612 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:34,613 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-15 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,614 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-15 00:00:00
2025-05-22 02:46:34,624 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
600 2018-08-15          285      46326.8  141.672171             208               285               2018-08-15  37936.561429         1.221165           0.990972                                1.0                       0.981944    2018-08-15
2025-05-22 02:46:34,625 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-15 00:00:00", "current_value": 46326.8, "expected_value": 25669.474712643678, "absolute_deviation": 20657.325287356325, "relative_deviation": 0.8047428129560211, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-15 00:00:00 значение total_sales (46326.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}]
2025-05-22 02:46:34,626 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,626 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-15 00:00:00", "current_value": 46326.8, "expected_value": 25669.474712643678, "absolute_deviation": 20657.325287356325, "relative_deviation": 0.8047428129560211, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-15 00:00:00 значение total_sales (46326.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}]
2025-05-22 02:46:34,626 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 1385, order_id: 64834bc188a370357ed08e9eabe5f92e, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9819, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,626 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:34,627 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-15 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,628 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-15 00:00:00
2025-05-22 02:46:34,631 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
600 2018-08-15          285      46326.8  141.672171             208               285               2018-08-15  37936.561429         1.221165           0.990972                                1.0                       0.981944    2018-08-15
2025-05-22 02:46:34,631 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-15 00:00:00", "current_value": 46326.8, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 42630.79428571429, "deviation_in_std": 10.498265494244997, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (46326.80) отклоняется от базовой линии (3696.01) на 42630.79, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:34,632 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,632 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-15 00:00:00", "current_value": 46326.8, "expected_value": 25669.474712643678, "absolute_deviation": 20657.325287356325, "relative_deviation": 0.8047428129560211, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-15 00:00:00 значение total_sales (46326.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9819435388597458, "explanation": {"detector_specific_info": {"date": "2018-08-15 00:00:00", "current_value": 46326.8, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 42630.79428571429, "deviation_in_std": 10.498265494244997, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (46326.80) отклоняется от базовой линии (3696.01) на 42630.79, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:34,632 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 1415, order_id: 1d554a2374156f36bdb7e0e6dbcad2d0, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.2171, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:34,632 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 1415, order_id: 1d554a2374156f36bdb7e0e6dbcad2d0, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.7849, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,633 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:34,633 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=7299e27ed73d2ad986de7f7c77d919fa in aggregated_behavior_data_with_scores
2025-05-22 02:46:34,634 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:34,637 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                             seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                                   categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
1412  7299e27ed73d2ad986de7f7c77d919fa   98.885094  148.935573    371       5.99     1500.0     19.280997    10.805647  [consoles_games, brinquedos, bebes, utilidades_domesticas, esporte_lazer, eletroportateis, alimentos, cool_stuff, automotivo, artes, relogios_presentes, moveis_decoracao, cama_mesa_banho]              13          1.506148         250.417362                0.194984                 13             0.03504              0.791985         0.50099                          0.217125                                   0.784855
2025-05-22 02:46:34,637 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}]
2025-05-22 02:46:34,638 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,638 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.7848545894928308, "explanation": {"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}}]
2025-05-22 02:46:34,638 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 1415, order_id: 1d554a2374156f36bdb7e0e6dbcad2d0, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.9519, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,638 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:34,639 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-19 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,640 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-19 00:00:00
2025-05-22 02:46:34,642 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
573 2018-07-19          253     39792.17  132.640567             187               253               2018-07-19  33204.071429         1.198412           0.927888                           0.951939                       0.903837    2018-07-19
2025-05-22 02:46:34,643 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-19 00:00:00", "current_value": 39792.17, "expected_value": 24263.594318181815, "absolute_deviation": 15528.575681818184, "relative_deviation": 0.6399948613623957, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-19 00:00:00 значение total_sales (39792.17) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}]
2025-05-22 02:46:34,644 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,644 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9519393357564666, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-19 00:00:00", "current_value": 39792.17, "expected_value": 24263.594318181815, "absolute_deviation": 15528.575681818184, "relative_deviation": 0.6399948613623957, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-19 00:00:00 значение total_sales (39792.17) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}]
2025-05-22 02:46:34,645 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 1415, order_id: 1d554a2374156f36bdb7e0e6dbcad2d0, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9038, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,645 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:34,645 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-19 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,646 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-19 00:00:00
2025-05-22 02:46:34,648 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
573 2018-07-19          253     39792.17  132.640567             187               253               2018-07-19  33204.071429         1.198412           0.927888                           0.951939                       0.903837    2018-07-19
2025-05-22 02:46:34,648 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-07-19 00:00:00", "current_value": 39792.17, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 36096.16428571429, "deviation_in_std": 8.889046576415753, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (39792.17) отклоняется от базовой линии (3696.01) на 36096.16, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:34,649 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,649 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9519393357564666, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-19 00:00:00", "current_value": 39792.17, "expected_value": 24263.594318181815, "absolute_deviation": 15528.575681818184, "relative_deviation": 0.6399948613623957, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-19 00:00:00 значение total_sales (39792.17) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9038369376412337, "explanation": {"detector_specific_info": {"date": "2018-07-19 00:00:00", "current_value": 39792.17, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 36096.16428571429, "deviation_in_std": 8.889046576415753, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (39792.17) отклоняется от базовой линии (3696.01) на 36096.16, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:34,650 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 1676, order_id: 7a9d100d2a88bd95c3f8acd4af29d3e8, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.2171, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:34,650 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 1676, order_id: 7a9d100d2a88bd95c3f8acd4af29d3e8, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.7849, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,650 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:34,651 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=7299e27ed73d2ad986de7f7c77d919fa in aggregated_behavior_data_with_scores
2025-05-22 02:46:34,651 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:34,654 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                             seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                                   categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
1412  7299e27ed73d2ad986de7f7c77d919fa   98.885094  148.935573    371       5.99     1500.0     19.280997    10.805647  [consoles_games, brinquedos, bebes, utilidades_domesticas, esporte_lazer, eletroportateis, alimentos, cool_stuff, automotivo, artes, relogios_presentes, moveis_decoracao, cama_mesa_banho]              13          1.506148         250.417362                0.194984                 13             0.03504              0.791985         0.50099                          0.217125                                   0.784855
2025-05-22 02:46:34,655 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}]
2025-05-22 02:46:34,655 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,655 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.7848545894928308, "explanation": {"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}}]
2025-05-22 02:46:34,656 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 1676, order_id: 7a9d100d2a88bd95c3f8acd4af29d3e8, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.9816, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,656 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:34,656 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-01 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,657 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-01 00:00:00
2025-05-22 02:46:34,659 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
525 2018-06-01          184     32683.41  151.312083             140               184               2018-06-01  22878.174286         1.428585           0.892482                           0.981565                       0.803399    2018-06-01
2025-05-22 02:46:34,660 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-01 00:00:00", "current_value": 32683.41, "expected_value": 23364.508863636365, "absolute_deviation": 9318.901136363635, "relative_deviation": 0.3988485780185698, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-01 00:00:00 значение total_sales (32683.41) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}]
2025-05-22 02:46:34,660 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,660 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9815648028904507, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-01 00:00:00", "current_value": 32683.41, "expected_value": 23364.508863636365, "absolute_deviation": 9318.901136363635, "relative_deviation": 0.3988485780185698, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-01 00:00:00 значение total_sales (32683.41) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}]
2025-05-22 02:46:34,661 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 1676, order_id: 7a9d100d2a88bd95c3f8acd4af29d3e8, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.8034, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,661 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:34,661 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-01 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,663 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-01 00:00:00
2025-05-22 02:46:34,665 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
525 2018-06-01          184     32683.41  151.312083             140               184               2018-06-01  22878.174286         1.428585           0.892482                           0.981565                       0.803399    2018-06-01
2025-05-22 02:46:34,665 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-06-01 00:00:00", "current_value": 32683.41, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 28987.404285714285, "deviation_in_std": 7.138442322723072, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (32683.41) отклоняется от базовой линии (3696.01) на 28987.40, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:34,665 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,666 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9815648028904507, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-01 00:00:00", "current_value": 32683.41, "expected_value": 23364.508863636365, "absolute_deviation": 9318.901136363635, "relative_deviation": 0.3988485780185698, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-01 00:00:00 значение total_sales (32683.41) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.8033989187962487, "explanation": {"detector_specific_info": {"date": "2018-06-01 00:00:00", "current_value": 32683.41, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 28987.404285714285, "deviation_in_std": 7.138442322723072, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (32683.41) отклоняется от базовой линии (3696.01) на 28987.40, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:34,666 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 1754, order_id: 9a3492f3f18d2b5cf77e8ce369f84d80, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1769, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:34,666 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 1754, order_id: 9a3492f3f18d2b5cf77e8ce369f84d80, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9184, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,666 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:34,667 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=36a968b544695394e4e9d7572688598f in aggregated_behavior_data_with_scores
2025-05-22 02:46:34,667 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:34,670 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                        categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
642  36a968b544695394e4e9d7572688598f   56.522384  136.831171    172        3.9     1140.9     13.350814      5.53097  [informatica_acessorios, beleza_saude, telefonia, automotivo, tablets_impressao_imagem, instrumentos_musicais, ferramentas_jardim, cool_stuff, consoles_games, moveis_decoracao]              10          2.420832         292.538462                0.236204                 10             0.05814              0.719612        0.547647                          0.176931                                   0.918363
2025-05-22 02:46:34,671 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}]
2025-05-22 02:46:34,672 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,672 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.918363395536566, "explanation": {"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}}]
2025-05-22 02:46:34,672 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 1754, order_id: 9a3492f3f18d2b5cf77e8ce369f84d80, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,672 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:34,673 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-25 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,674 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-25 00:00:00
2025-05-22 02:46:34,675 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
579 2018-07-25          268     40753.19  122.750572             201               268               2018-07-25  35288.758571         1.154849           0.959618                                1.0                       0.919235    2018-07-25
2025-05-22 02:46:34,676 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-25 00:00:00", "current_value": 40753.19, "expected_value": 25669.474712643678, "absolute_deviation": 15083.715287356325, "relative_deviation": 0.5876129315543311, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-25 00:00:00 значение total_sales (40753.19) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}]
2025-05-22 02:46:34,677 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,677 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-25 00:00:00", "current_value": 40753.19, "expected_value": 25669.474712643678, "absolute_deviation": 15083.715287356325, "relative_deviation": 0.5876129315543311, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-25 00:00:00 значение total_sales (40753.19) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}]
2025-05-22 02:46:34,677 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 1754, order_id: 9a3492f3f18d2b5cf77e8ce369f84d80, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9192, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,678 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:34,678 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-25 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,679 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-25 00:00:00
2025-05-22 02:46:34,681 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
579 2018-07-25          268     40753.19  122.750572             201               268               2018-07-25  35288.758571         1.154849           0.959618                                1.0                       0.919235    2018-07-25
2025-05-22 02:46:34,682 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-07-25 00:00:00", "current_value": 40753.19, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 37057.18428571429, "deviation_in_std": 9.125707498979427, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (40753.19) отклоняется от базовой линии (3696.01) на 37057.18, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:34,682 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,683 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-25 00:00:00", "current_value": 40753.19, "expected_value": 25669.474712643678, "absolute_deviation": 15083.715287356325, "relative_deviation": 0.5876129315543311, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-25 00:00:00 значение total_sales (40753.19) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9192352183494302, "explanation": {"detector_specific_info": {"date": "2018-07-25 00:00:00", "current_value": 40753.19, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 37057.18428571429, "deviation_in_std": 9.125707498979427, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (40753.19) отклоняется от базовой линии (3696.01) на 37057.18, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:34,684 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 1763, order_id: 99d49f52685bd8c00ec0c341cc75d68f, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1769, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:34,684 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 1763, order_id: 99d49f52685bd8c00ec0c341cc75d68f, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9184, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,684 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:34,684 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=36a968b544695394e4e9d7572688598f in aggregated_behavior_data_with_scores
2025-05-22 02:46:34,686 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:34,688 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                        categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
642  36a968b544695394e4e9d7572688598f   56.522384  136.831171    172        3.9     1140.9     13.350814      5.53097  [informatica_acessorios, beleza_saude, telefonia, automotivo, tablets_impressao_imagem, instrumentos_musicais, ferramentas_jardim, cool_stuff, consoles_games, moveis_decoracao]              10          2.420832         292.538462                0.236204                 10             0.05814              0.719612        0.547647                          0.176931                                   0.918363
2025-05-22 02:46:34,689 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}]
2025-05-22 02:46:34,689 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,690 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.918363395536566, "explanation": {"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}}]
2025-05-22 02:46:34,690 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 1763, order_id: 99d49f52685bd8c00ec0c341cc75d68f, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,690 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:34,691 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-31 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,692 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-31 00:00:00
2025-05-22 02:46:34,694 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
585 2018-07-31          320     46295.06  119.935389             220               320               2018-07-31  36263.578571         1.276627           0.967561                                1.0                       0.935121    2018-07-31
2025-05-22 02:46:34,695 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-31 00:00:00", "current_value": 46295.06, "expected_value": 26189.295057471263, "absolute_deviation": 20105.764942528735, "relative_deviation": 0.7677092834460612, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-31 00:00:00 значение total_sales (46295.06) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}]
2025-05-22 02:46:34,695 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,695 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-31 00:00:00", "current_value": 46295.06, "expected_value": 26189.295057471263, "absolute_deviation": 20105.764942528735, "relative_deviation": 0.7677092834460612, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-31 00:00:00 значение total_sales (46295.06) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}]
2025-05-22 02:46:34,695 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 1763, order_id: 99d49f52685bd8c00ec0c341cc75d68f, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9351, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,695 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:34,696 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-31 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,697 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-31 00:00:00
2025-05-22 02:46:34,699 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
585 2018-07-31          320     46295.06  119.935389             220               320               2018-07-31  36263.578571         1.276627           0.967561                                1.0                       0.935121    2018-07-31
2025-05-22 02:46:34,700 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-07-31 00:00:00", "current_value": 46295.06, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 42599.05428571429, "deviation_in_std": 10.490449197308228, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (46295.06) отклоняется от базовой линии (3696.01) на 42599.05, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:34,701 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,701 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-31 00:00:00", "current_value": 46295.06, "expected_value": 26189.295057471263, "absolute_deviation": 20105.764942528735, "relative_deviation": 0.7677092834460612, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-31 00:00:00 значение total_sales (46295.06) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9351213363620864, "explanation": {"detector_specific_info": {"date": "2018-07-31 00:00:00", "current_value": 46295.06, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 42599.05428571429, "deviation_in_std": 10.490449197308228, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (46295.06) отклоняется от базовой линии (3696.01) на 42599.05, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:34,701 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 2257, order_id: c6bf92017bd40729c135b58b643f64c2, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1769, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:34,702 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 2257, order_id: c6bf92017bd40729c135b58b643f64c2, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9184, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,702 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:34,702 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=36a968b544695394e4e9d7572688598f in aggregated_behavior_data_with_scores
2025-05-22 02:46:34,703 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:34,706 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                        categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
642  36a968b544695394e4e9d7572688598f   56.522384  136.831171    172        3.9     1140.9     13.350814      5.53097  [informatica_acessorios, beleza_saude, telefonia, automotivo, tablets_impressao_imagem, instrumentos_musicais, ferramentas_jardim, cool_stuff, consoles_games, moveis_decoracao]              10          2.420832         292.538462                0.236204                 10             0.05814              0.719612        0.547647                          0.176931                                   0.918363
2025-05-22 02:46:34,707 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}]
2025-05-22 02:46:34,707 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,708 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.918363395536566, "explanation": {"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}}]
2025-05-22 02:46:34,708 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 2257, order_id: c6bf92017bd40729c135b58b643f64c2, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.7785, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,708 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:34,708 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-08 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,709 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-08 00:00:00
2025-05-22 02:46:34,713 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
593 2018-08-08          315     43706.47  119.743753             215               315               2018-08-08  44012.448571         0.993048           0.870271                           0.778542                       0.961999    2018-08-08
2025-05-22 02:46:34,713 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-08 00:00:00", "current_value": 43706.47, "expected_value": 25669.474712643678, "absolute_deviation": 18036.995287356323, "relative_deviation": 0.7026632016927123, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-08 00:00:00 значение total_sales (43706.47) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}]
2025-05-22 02:46:34,714 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,714 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7785418521924519, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-08 00:00:00", "current_value": 43706.47, "expected_value": 25669.474712643678, "absolute_deviation": 18036.995287356323, "relative_deviation": 0.7026632016927123, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-08 00:00:00 значение total_sales (43706.47) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}]
2025-05-22 02:46:34,714 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 2257, order_id: c6bf92017bd40729c135b58b643f64c2, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9620, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,714 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:34,715 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-08 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,715 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-08 00:00:00
2025-05-22 02:46:34,717 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
593 2018-08-08          315     43706.47  119.743753             215               315               2018-08-08  44012.448571         0.993048           0.870271                           0.778542                       0.961999    2018-08-08
2025-05-22 02:46:34,718 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-08 00:00:00", "current_value": 43706.47, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40010.46428571429, "deviation_in_std": 9.852982653907365, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (43706.47) отклоняется от базовой линии (3696.01) на 40010.46, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:34,718 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,718 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7785418521924519, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-08 00:00:00", "current_value": 43706.47, "expected_value": 25669.474712643678, "absolute_deviation": 18036.995287356323, "relative_deviation": 0.7026632016927123, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-08 00:00:00 значение total_sales (43706.47) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9619994271129765, "explanation": {"detector_specific_info": {"date": "2018-08-08 00:00:00", "current_value": 43706.47, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40010.46428571429, "deviation_in_std": 9.852982653907365, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (43706.47) отклоняется от базовой линии (3696.01) на 40010.46, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:34,719 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 2953, order_id: 6127a28915c32d0c35b55f6ccc3f0c36, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,719 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:34,720 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-14 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,721 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-14 00:00:00
2025-05-22 02:46:34,724 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
507 2018-05-14          364     55368.96  130.279906             231               364               2018-05-14      44527.33         1.243483           0.884474                                1.0                       0.768949    2018-05-14
2025-05-22 02:46:34,725 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-14 00:00:00", "current_value": 55368.96, "expected_value": 25862.10588888889, "absolute_deviation": 29506.854111111108, "relative_deviation": 1.140930063386219, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-14 00:00:00 значение total_sales (55368.96) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}]
2025-05-22 02:46:34,725 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,726 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-14 00:00:00", "current_value": 55368.96, "expected_value": 25862.10588888889, "absolute_deviation": 29506.854111111108, "relative_deviation": 1.140930063386219, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-14 00:00:00 значение total_sales (55368.96) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}]
2025-05-22 02:46:34,726 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 2953, order_id: 6127a28915c32d0c35b55f6ccc3f0c36, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.7689, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,726 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:34,727 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-14 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,727 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-14 00:00:00
2025-05-22 02:46:34,729 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
507 2018-05-14          364     55368.96  130.279906             231               364               2018-05-14      44527.33         1.243483           0.884474                                1.0                       0.768949    2018-05-14
2025-05-22 02:46:34,730 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-05-14 00:00:00", "current_value": 55368.96, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 51672.95428571429, "deviation_in_std": 12.724989108288767, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (55368.96) отклоняется от базовой линии (3696.01) на 51672.95, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:34,730 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,730 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-14 00:00:00", "current_value": 55368.96, "expected_value": 25862.10588888889, "absolute_deviation": 29506.854111111108, "relative_deviation": 1.140930063386219, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-14 00:00:00 значение total_sales (55368.96) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.7689488301722409, "explanation": {"detector_specific_info": {"date": "2018-05-14 00:00:00", "current_value": 55368.96, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 51672.95428571429, "deviation_in_std": 12.724989108288767, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (55368.96) отклоняется от базовой линии (3696.01) на 51672.95, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:34,731 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 2954, order_id: 6127a28915c32d0c35b55f6ccc3f0c36, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,731 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:34,731 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-14 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,733 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-14 00:00:00
2025-05-22 02:46:34,734 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
507 2018-05-14          364     55368.96  130.279906             231               364               2018-05-14      44527.33         1.243483           0.884474                                1.0                       0.768949    2018-05-14
2025-05-22 02:46:34,735 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-14 00:00:00", "current_value": 55368.96, "expected_value": 25862.10588888889, "absolute_deviation": 29506.854111111108, "relative_deviation": 1.140930063386219, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-14 00:00:00 значение total_sales (55368.96) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}]
2025-05-22 02:46:34,735 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,735 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-14 00:00:00", "current_value": 55368.96, "expected_value": 25862.10588888889, "absolute_deviation": 29506.854111111108, "relative_deviation": 1.140930063386219, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-14 00:00:00 значение total_sales (55368.96) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}]
2025-05-22 02:46:34,736 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 2954, order_id: 6127a28915c32d0c35b55f6ccc3f0c36, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.7689, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,736 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:34,736 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-14 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,737 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-14 00:00:00
2025-05-22 02:46:34,740 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
507 2018-05-14          364     55368.96  130.279906             231               364               2018-05-14      44527.33         1.243483           0.884474                                1.0                       0.768949    2018-05-14
2025-05-22 02:46:34,741 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-05-14 00:00:00", "current_value": 55368.96, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 51672.95428571429, "deviation_in_std": 12.724989108288767, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (55368.96) отклоняется от базовой линии (3696.01) на 51672.95, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:34,741 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,741 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-14 00:00:00", "current_value": 55368.96, "expected_value": 25862.10588888889, "absolute_deviation": 29506.854111111108, "relative_deviation": 1.140930063386219, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-14 00:00:00 значение total_sales (55368.96) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.7689488301722409, "explanation": {"detector_specific_info": {"date": "2018-05-14 00:00:00", "current_value": 55368.96, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 51672.95428571429, "deviation_in_std": 12.724989108288767, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (55368.96) отклоняется от базовой линии (3696.01) на 51672.95, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:34,741 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 3149, order_id: 3d47aacc4c27ad170b1004695eb0c359, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.2171, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:34,742 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 3149, order_id: 3d47aacc4c27ad170b1004695eb0c359, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.7849, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,742 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:34,742 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=7299e27ed73d2ad986de7f7c77d919fa in aggregated_behavior_data_with_scores
2025-05-22 02:46:34,743 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:34,745 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                             seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                                   categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
1412  7299e27ed73d2ad986de7f7c77d919fa   98.885094  148.935573    371       5.99     1500.0     19.280997    10.805647  [consoles_games, brinquedos, bebes, utilidades_domesticas, esporte_lazer, eletroportateis, alimentos, cool_stuff, automotivo, artes, relogios_presentes, moveis_decoracao, cama_mesa_banho]              13          1.506148         250.417362                0.194984                 13             0.03504              0.791985         0.50099                          0.217125                                   0.784855
2025-05-22 02:46:34,746 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}]
2025-05-22 02:46:34,746 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,746 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.7848545894928308, "explanation": {"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}}]
2025-05-22 02:46:34,747 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 3149, order_id: 3d47aacc4c27ad170b1004695eb0c359, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.8843, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,747 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:34,747 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-30 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,748 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-30 00:00:00
2025-05-22 02:46:34,750 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
584 2018-07-30          284     40179.22  123.249141             214               284               2018-07-30  35694.362857         1.125646           0.907915                           0.884254                       0.931577    2018-07-30
2025-05-22 02:46:34,750 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-30 00:00:00", "current_value": 40179.22, "expected_value": 25862.10588888889, "absolute_deviation": 14317.11411111111, "relative_deviation": 0.5535942885943467, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-30 00:00:00 значение total_sales (40179.22) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}]
2025-05-22 02:46:34,751 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,751 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8842535725733309, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-30 00:00:00", "current_value": 40179.22, "expected_value": 25862.10588888889, "absolute_deviation": 14317.11411111111, "relative_deviation": 0.5535942885943467, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-30 00:00:00 значение total_sales (40179.22) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}]
2025-05-22 02:46:34,751 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 3149, order_id: 3d47aacc4c27ad170b1004695eb0c359, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9316, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,751 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:34,751 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-30 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,752 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-30 00:00:00
2025-05-22 02:46:34,756 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
584 2018-07-30          284     40179.22  123.249141             214               284               2018-07-30  35694.362857         1.125646           0.907915                           0.884254                       0.931577    2018-07-30
2025-05-22 02:46:34,756 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-07-30 00:00:00", "current_value": 40179.22, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 36483.21428571429, "deviation_in_std": 8.984361564738858, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (40179.22) отклоняется от базовой линии (3696.01) на 36483.21, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:34,756 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,757 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8842535725733309, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-30 00:00:00", "current_value": 40179.22, "expected_value": 25862.10588888889, "absolute_deviation": 14317.11411111111, "relative_deviation": 0.5535942885943467, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-30 00:00:00 значение total_sales (40179.22) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9315766663428331, "explanation": {"detector_specific_info": {"date": "2018-07-30 00:00:00", "current_value": 40179.22, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 36483.21428571429, "deviation_in_std": 8.984361564738858, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (40179.22) отклоняется от базовой линии (3696.01) на 36483.21, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:34,757 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 3179, order_id: b239ca7cd485940b31882363b52e6674, level: transaction): Detector Column: 'trans_transaction_vae_price_score', Score: 0.5088, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,757 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'transaction_vae_price': TransactionVAEDetector
2025-05-22 02:46:34,763 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for transaction detector 'transaction_vae_price':
      order_item_id                          order_id                        product_id                         seller_id   price  freight_value order_purchase_timestamp                       customer_id product_category_name  product_name_lenght  product_description_lenght  product_photos_qty  product_weight_g  product_length_cm  product_height_cm  product_width_cm product_category_name_english customer_state seller_state payment_type  payment_installments  payment_value  review_score  price_deviation_from_category_mean  freight_to_price_ratio  transaction_level_score  transaction_is_anomaly  trans_transaction_vae_price_score  trans_category_price_outlier_model_score  behavior_level_score  behavior_is_anomaly  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score  time_series_level_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score  time_series_is_anomaly  multilevel_score  is_anomaly detailed_explanations_json
3179              1  b239ca7cd485940b31882363b52e6674  dd113cb02b2af9c8e5787e8f1f0722f6  821fb029fc6e495ca4f08a35d51e53a5  4059.0         104.51      2018-07-29 08:39:48  e9b0d0eb3015ef1c9ce6cf5b9dcbee9f         esporte_lazer                 51.0                      1511.0                 1.0            8000.0               55.0               25.0              45.0                sports_leisure             MG           SP   debit_card                   1.0        4163.51           4.0                           35.496405                0.025748                 0.510546                    True                           0.508796                                  0.512296              0.433102                False                          0.156335                                   0.709869                 0.879612                           0.830683                       0.928541                    True          0.598032        True                       None
2025-05-22 02:46:34,763 - backend.ml_service.detector - DEBUG - (transaction_vae_price) Метод get_explanation_details не реализован специфично, будет использована реализация get_shap_explanations (если есть).
2025-05-22 02:46:34,765 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) [Detect_Preprocess] Scaler type: <class 'sklearn.preprocessing._data.StandardScaler'>
2025-05-22 02:46:34,765 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) [Detect_Preprocess] Scaler has mean_: True
2025-05-22 02:46:34,765 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) [Detect_Preprocess] Scaler mean_ shape: (4,)
2025-05-22 02:46:34,766 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) [Detect_Preprocess] Scaler params: {'copy': True, 'with_mean': True, 'with_std': True}
2025-05-22 02:46:34,766 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) StandardScaler обучен (mean_ присутствует). Выполняется transform.
2025-05-22 02:46:34,766 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Вычисление SHAP values для 1 экземпляров...
2025-05-22 02:46:34,767 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Используется nsamples=50 для SHAP
2025-05-22 02:46:34,767 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) Запрос SHAP объяснений: explainer=True, background_data_exists=True, model=True
2025-05-22 02:46:34,767 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Создание GradientExplainer с размерами данных: torch.Size([50, 4])
2025-05-22 02:46:34,823 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) SHAP values raw type: <class 'numpy.ndarray'>
2025-05-22 02:46:34,824 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) SHAP values raw (ndarray) shape: (1, 4, 1)
2025-05-22 02:46:34,824 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) SHAP GradientExplainer успешно создан и вычислены SHAP-значения
2025-05-22 02:46:34,824 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) SHAP values_raw уже является ndarray, shape: (1, 4, 1)
2025-05-22 02:46:34,824 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) Начальная форма shap_values_arr: (1, 4, 1), ndim: 3
2025-05-22 02:46:34,824 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) SHAP values после squeeze(-1): (1, 4)
2025-05-22 02:46:34,825 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) SHAP values успешно вычислены для 1 экземпляров.
2025-05-22 02:46:34,825 - backend.ml_service.multilevel_detector - DEBUG - Explanation from transaction detector 'transaction_vae_price': [{"shap_values": {"price": 20.208679474678778, "freight_value": 1.2435060648603702, "product_weight_g": -0.2163617349628389, "freight_to_price_ratio": -0.41147092714124556}}]
2025-05-22 02:46:34,825 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'transaction_vae_price' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,826 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for transaction_level: [{"detector_name": "transaction_vae_price", "detector_type": "TransactionVAEDetector", "score": 0.5087955074845409, "explanation": {"shap_values": {"price": 20.208679474678778, "freight_value": 1.2435060648603702, "product_weight_g": -0.2163617349628389, "freight_to_price_ratio": -0.41147092714124556}}}]
2025-05-22 02:46:34,826 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 3179, order_id: b239ca7cd485940b31882363b52e6674, level: transaction): Detector Column: 'trans_category_price_outlier_model_score', Score: 0.5123, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,826 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'category_price_outlier_model': CategoryPriceOutlierDetector
2025-05-22 02:46:34,833 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for transaction detector 'category_price_outlier_model':
      order_item_id                          order_id                        product_id                         seller_id   price  freight_value order_purchase_timestamp                       customer_id product_category_name  product_name_lenght  product_description_lenght  product_photos_qty  product_weight_g  product_length_cm  product_height_cm  product_width_cm product_category_name_english customer_state seller_state payment_type  payment_installments  payment_value  review_score  price_deviation_from_category_mean  freight_to_price_ratio  transaction_level_score  transaction_is_anomaly  trans_transaction_vae_price_score  trans_category_price_outlier_model_score  behavior_level_score  behavior_is_anomaly  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score  time_series_level_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score  time_series_is_anomaly  multilevel_score  is_anomaly detailed_explanations_json
3179              1  b239ca7cd485940b31882363b52e6674  dd113cb02b2af9c8e5787e8f1f0722f6  821fb029fc6e495ca4f08a35d51e53a5  4059.0         104.51      2018-07-29 08:39:48  e9b0d0eb3015ef1c9ce6cf5b9dcbee9f         esporte_lazer                 51.0                      1511.0                 1.0            8000.0               55.0               25.0              45.0                sports_leisure             MG           SP   debit_card                   1.0        4163.51           4.0                           35.496405                0.025748                 0.510546                    True                           0.508796                                  0.512296              0.433102                False                          0.156335                                   0.709869                 0.879612                           0.830683                       0.928541                    True          0.598032        True                       None
2025-05-22 02:46:34,834 - backend.ml_service.multilevel_detector - DEBUG - Explanation from transaction detector 'category_price_outlier_model': [{"detector_specific_info": {"category": "esporte_lazer", "price": 4059.0, "category_mean_price": 114.34960906263883, "category_std_price": 162.46595646363542, "category_min_price": 4.5, "category_max_price": 4059.0, "category_count": 9004, "z_score": 24.27985823491759, "threshold": 2.8, "explanation": "Цена 4059.00 отличается от средней цены в категории 'esporte_lazer' (114.35) на 24.28 стандартных отклонений (порог: 2.8)."}}]
2025-05-22 02:46:34,834 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'category_price_outlier_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,835 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for transaction_level: [{"detector_name": "transaction_vae_price", "detector_type": "TransactionVAEDetector", "score": 0.5087955074845409, "explanation": {"shap_values": {"price": 20.208679474678778, "freight_value": 1.2435060648603702, "product_weight_g": -0.2163617349628389, "freight_to_price_ratio": -0.41147092714124556}}}, {"detector_name": "category_price_outlier_model", "detector_type": "CategoryPriceOutlierDetector", "score": 0.5122961895818161, "explanation": {"detector_specific_info": {"category": "esporte_lazer", "price": 4059.0, "category_mean_price": 114.34960906263883, "category_std_price": 162.46595646363542, "category_min_price": 4.5, "category_max_price": 4059.0, "category_count": 9004, "z_score": 24.27985823491759, "threshold": 2.8, "explanation": "Цена 4059.00 отличается от средней цены в категории 'esporte_lazer' (114.35) на 24.28 стандартных отклонений (порог: 2.8)."}}}]
2025-05-22 02:46:34,835 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 3179, order_id: b239ca7cd485940b31882363b52e6674, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.8307, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,835 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:34,835 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-29 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,837 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-29 00:00:00
2025-05-22 02:46:34,840 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
583 2018-07-29          188      32085.4  145.842727             150               188               2018-07-29  35787.032857         0.896565           0.879612                           0.830683                       0.928541    2018-07-29
2025-05-22 02:46:34,841 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-29 00:00:00", "current_value": 32085.4, "expected_value": 18683.428202247193, "absolute_deviation": 13401.971797752809, "relative_deviation": 0.7173186661825187, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-29 00:00:00 значение total_sales (32085.40) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}]
2025-05-22 02:46:34,841 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,841 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8306826658975347, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-29 00:00:00", "current_value": 32085.4, "expected_value": 18683.428202247193, "absolute_deviation": 13401.971797752809, "relative_deviation": 0.7173186661825187, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-29 00:00:00 значение total_sales (32085.40) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}]
2025-05-22 02:46:34,842 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 3179, order_id: b239ca7cd485940b31882363b52e6674, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9285, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,842 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:34,842 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-29 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,843 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-29 00:00:00
2025-05-22 02:46:34,846 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
583 2018-07-29          188      32085.4  145.842727             150               188               2018-07-29  35787.032857         0.896565           0.879612                           0.830683                       0.928541    2018-07-29
2025-05-22 02:46:34,846 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-07-29 00:00:00", "current_value": 32085.4, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 28389.394285714287, "deviation_in_std": 6.991176294646339, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (32085.40) отклоняется от базовой линии (3696.01) на 28389.39, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:34,847 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,847 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8306826658975347, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-29 00:00:00", "current_value": 32085.4, "expected_value": 18683.428202247193, "absolute_deviation": 13401.971797752809, "relative_deviation": 0.7173186661825187, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-29 00:00:00 значение total_sales (32085.40) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.928540895759355, "explanation": {"detector_specific_info": {"date": "2018-07-29 00:00:00", "current_value": 32085.4, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 28389.394285714287, "deviation_in_std": 6.991176294646339, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (32085.40) отклоняется от базовой линии (3696.01) на 28389.39, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:34,848 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 4521, order_id: 73ef343c9dbf2f6d45362c9bc150f4b7, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.8977, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,848 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:34,848 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-12 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,849 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-12 00:00:00
2025-05-22 02:46:34,852 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
597 2018-08-12          197     32665.67  139.002851             160               197               2018-08-12  41160.318571          0.79362           0.934894                           0.897745                       0.972043    2018-08-12
2025-05-22 02:46:34,852 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-12 00:00:00", "current_value": 32665.670000000002, "expected_value": 18683.428202247193, "absolute_deviation": 13982.24179775281, "relative_deviation": 0.7483766708334108, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-12 00:00:00 значение total_sales (32665.67) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}]
2025-05-22 02:46:34,853 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,853 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8977452993668317, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-12 00:00:00", "current_value": 32665.670000000002, "expected_value": 18683.428202247193, "absolute_deviation": 13982.24179775281, "relative_deviation": 0.7483766708334108, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-12 00:00:00 значение total_sales (32665.67) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}]
2025-05-22 02:46:34,854 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 4521, order_id: 73ef343c9dbf2f6d45362c9bc150f4b7, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9720, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,854 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:34,854 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-12 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,855 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-12 00:00:00
2025-05-22 02:46:34,858 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
597 2018-08-12          197     32665.67  139.002851             160               197               2018-08-12  41160.318571          0.79362           0.934894                           0.897745                       0.972043    2018-08-12
2025-05-22 02:46:34,859 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-12 00:00:00", "current_value": 32665.670000000002, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 28969.664285714287, "deviation_in_std": 7.1340736677874, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (32665.67) отклоняется от базовой линии (3696.01) на 28969.66, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:34,859 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,860 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8977452993668317, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-12 00:00:00", "current_value": 32665.670000000002, "expected_value": 18683.428202247193, "absolute_deviation": 13982.24179775281, "relative_deviation": 0.7483766708334108, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-12 00:00:00 значение total_sales (32665.67) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9720429031944142, "explanation": {"detector_specific_info": {"date": "2018-08-12 00:00:00", "current_value": 32665.670000000002, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 28969.664285714287, "deviation_in_std": 7.1340736677874, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (32665.67) отклоняется от базовой линии (3696.01) на 28969.66, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:34,860 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 5334, order_id: a8cc5640bb6e6bf0280850917666c4d5, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1769, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:34,860 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 5334, order_id: a8cc5640bb6e6bf0280850917666c4d5, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9184, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,861 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:34,861 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=36a968b544695394e4e9d7572688598f in aggregated_behavior_data_with_scores
2025-05-22 02:46:34,862 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:34,865 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                        categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
642  36a968b544695394e4e9d7572688598f   56.522384  136.831171    172        3.9     1140.9     13.350814      5.53097  [informatica_acessorios, beleza_saude, telefonia, automotivo, tablets_impressao_imagem, instrumentos_musicais, ferramentas_jardim, cool_stuff, consoles_games, moveis_decoracao]              10          2.420832         292.538462                0.236204                 10             0.05814              0.719612        0.547647                          0.176931                                   0.918363
2025-05-22 02:46:34,866 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}]
2025-05-22 02:46:34,866 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,866 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.918363395536566, "explanation": {"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}}]
2025-05-22 02:46:34,867 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 5334, order_id: a8cc5640bb6e6bf0280850917666c4d5, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.7297, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,867 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:34,867 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-17 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,868 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-17 00:00:00
2025-05-22 02:46:34,870 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
602 2018-08-17          255     36361.57  120.802558             203               255               2018-08-17  37849.641429         0.960685           0.858666                           0.729695                       0.987637    2018-08-17
2025-05-22 02:46:34,871 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-17 00:00:00", "current_value": 36361.57, "expected_value": 23364.508863636365, "absolute_deviation": 12997.061136363634, "relative_deviation": 0.5562736718421575, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-17 00:00:00 значение total_sales (36361.57) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}]
2025-05-22 02:46:34,871 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,871 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7296946227452271, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-17 00:00:00", "current_value": 36361.57, "expected_value": 23364.508863636365, "absolute_deviation": 12997.061136363634, "relative_deviation": 0.5562736718421575, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-17 00:00:00 значение total_sales (36361.57) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}]
2025-05-22 02:46:34,872 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 5334, order_id: a8cc5640bb6e6bf0280850917666c4d5, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9876, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,872 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:34,873 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-17 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,873 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-17 00:00:00
2025-05-22 02:46:34,876 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
602 2018-08-17          255     36361.57  120.802558             203               255               2018-08-17  37849.641429         0.960685           0.858666                           0.729695                       0.987637    2018-08-17
2025-05-22 02:46:34,877 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-17 00:00:00", "current_value": 36361.57, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 32665.564285714285, "deviation_in_std": 8.044226530061943, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (36361.57) отклоняется от базовой линии (3696.01) на 32665.56, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:34,877 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,878 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7296946227452271, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-17 00:00:00", "current_value": 36361.57, "expected_value": 23364.508863636365, "absolute_deviation": 12997.061136363634, "relative_deviation": 0.5562736718421575, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-17 00:00:00 значение total_sales (36361.57) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9876365632717872, "explanation": {"detector_specific_info": {"date": "2018-08-17 00:00:00", "current_value": 36361.57, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 32665.564285714285, "deviation_in_std": 8.044226530061943, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (36361.57) отклоняется от базовой линии (3696.01) на 32665.56, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:34,878 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 6120, order_id: 090353bbd0b20f65c374b389aa15dcf4, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.9649, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,879 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:34,879 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-24 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,880 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-24 00:00:00
2025-05-22 02:46:34,882 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
578 2018-07-24          270     42310.55  136.485645             193               270               2018-07-24  35999.875714         1.175297           0.940544                           0.964937                       0.916152    2018-07-24
2025-05-22 02:46:34,883 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-24 00:00:00", "current_value": 42310.55, "expected_value": 26189.295057471263, "absolute_deviation": 16121.25494252874, "relative_deviation": 0.6155665857806157, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-24 00:00:00 значение total_sales (42310.55) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}]
2025-05-22 02:46:34,883 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,883 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9649365873203745, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-24 00:00:00", "current_value": 42310.55, "expected_value": 26189.295057471263, "absolute_deviation": 16121.25494252874, "relative_deviation": 0.6155665857806157, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-24 00:00:00 значение total_sales (42310.55) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}]
2025-05-22 02:46:34,883 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 6120, order_id: 090353bbd0b20f65c374b389aa15dcf4, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9162, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,884 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:34,884 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-24 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,885 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-24 00:00:00
2025-05-22 02:46:34,888 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
578 2018-07-24          270     42310.55  136.485645             193               270               2018-07-24  35999.875714         1.175297           0.940544                           0.964937                       0.916152    2018-07-24
2025-05-22 02:46:34,888 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-07-24 00:00:00", "current_value": 42310.55, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 38614.54428571429, "deviation_in_std": 9.509223195181132, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (42310.55) отклоняется от базовой линии (3696.01) на 38614.54, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:34,889 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,889 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9649365873203745, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-24 00:00:00", "current_value": 42310.55, "expected_value": 26189.295057471263, "absolute_deviation": 16121.25494252874, "relative_deviation": 0.6155665857806157, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-24 00:00:00 значение total_sales (42310.55) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9161516876857093, "explanation": {"detector_specific_info": {"date": "2018-07-24 00:00:00", "current_value": 42310.55, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 38614.54428571429, "deviation_in_std": 9.509223195181132, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (42310.55) отклоняется от базовой линии (3696.01) на 38614.54, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:34,889 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 8299, order_id: 71c467da99c1f688a401a10d9ba6814d, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,890 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:34,890 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-14 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,892 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-14 00:00:00
2025-05-22 02:46:34,895 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
599 2018-08-14          315     44682.42  128.397759             228               315               2018-08-14  37562.228571         1.189557           0.989198                                1.0                       0.978396    2018-08-14
2025-05-22 02:46:34,895 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-14 00:00:00", "current_value": 44682.42, "expected_value": 26189.295057471263, "absolute_deviation": 18493.124942528735, "relative_deviation": 0.7061329792171336, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-14 00:00:00 значение total_sales (44682.42) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}]
2025-05-22 02:46:34,895 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,896 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-14 00:00:00", "current_value": 44682.42, "expected_value": 26189.295057471263, "absolute_deviation": 18493.124942528735, "relative_deviation": 0.7061329792171336, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-14 00:00:00 значение total_sales (44682.42) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}]
2025-05-22 02:46:34,896 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 8299, order_id: 71c467da99c1f688a401a10d9ba6814d, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9784, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,896 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:34,897 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-14 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,898 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-14 00:00:00
2025-05-22 02:46:34,901 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
599 2018-08-14          315     44682.42  128.397759             228               315               2018-08-14  37562.228571         1.189557           0.989198                                1.0                       0.978396    2018-08-14
2025-05-22 02:46:34,902 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-14 00:00:00", "current_value": 44682.42, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40986.41428571429, "deviation_in_std": 10.093320240405061, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (44682.42) отклоняется от базовой линии (3696.01) на 40986.41, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:34,902 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,902 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-14 00:00:00", "current_value": 44682.42, "expected_value": 26189.295057471263, "absolute_deviation": 18493.124942528735, "relative_deviation": 0.7061329792171336, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-14 00:00:00 значение total_sales (44682.42) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9783962277530719, "explanation": {"detector_specific_info": {"date": "2018-08-14 00:00:00", "current_value": 44682.42, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40986.41428571429, "deviation_in_std": 10.093320240405061, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (44682.42) отклоняется от базовой линии (3696.01) на 40986.41, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:34,903 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 8396, order_id: 289745e1222668d6792ce3ccbb27356f, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.2171, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:34,903 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 8396, order_id: 289745e1222668d6792ce3ccbb27356f, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.7849, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,903 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:34,903 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=7299e27ed73d2ad986de7f7c77d919fa in aggregated_behavior_data_with_scores
2025-05-22 02:46:34,904 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:34,907 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                             seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                                   categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
1412  7299e27ed73d2ad986de7f7c77d919fa   98.885094  148.935573    371       5.99     1500.0     19.280997    10.805647  [consoles_games, brinquedos, bebes, utilidades_domesticas, esporte_lazer, eletroportateis, alimentos, cool_stuff, automotivo, artes, relogios_presentes, moveis_decoracao, cama_mesa_banho]              13          1.506148         250.417362                0.194984                 13             0.03504              0.791985         0.50099                          0.217125                                   0.784855
2025-05-22 02:46:34,908 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}]
2025-05-22 02:46:34,909 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,909 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.7848545894928308, "explanation": {"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}}]
2025-05-22 02:46:34,909 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 8396, order_id: 289745e1222668d6792ce3ccbb27356f, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.9816, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,910 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:34,910 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-01 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,911 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-01 00:00:00
2025-05-22 02:46:34,913 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
525 2018-06-01          184     32683.41  151.312083             140               184               2018-06-01  22878.174286         1.428585           0.892482                           0.981565                       0.803399    2018-06-01
2025-05-22 02:46:34,914 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-01 00:00:00", "current_value": 32683.41, "expected_value": 23364.508863636365, "absolute_deviation": 9318.901136363635, "relative_deviation": 0.3988485780185698, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-01 00:00:00 значение total_sales (32683.41) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}]
2025-05-22 02:46:34,914 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,914 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9815648028904507, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-01 00:00:00", "current_value": 32683.41, "expected_value": 23364.508863636365, "absolute_deviation": 9318.901136363635, "relative_deviation": 0.3988485780185698, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-01 00:00:00 значение total_sales (32683.41) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}]
2025-05-22 02:46:34,915 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 8396, order_id: 289745e1222668d6792ce3ccbb27356f, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.8034, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,915 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:34,915 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-01 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,916 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-01 00:00:00
2025-05-22 02:46:34,919 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
525 2018-06-01          184     32683.41  151.312083             140               184               2018-06-01  22878.174286         1.428585           0.892482                           0.981565                       0.803399    2018-06-01
2025-05-22 02:46:34,920 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-06-01 00:00:00", "current_value": 32683.41, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 28987.404285714285, "deviation_in_std": 7.138442322723072, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (32683.41) отклоняется от базовой линии (3696.01) на 28987.40, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:34,921 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,921 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9815648028904507, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-01 00:00:00", "current_value": 32683.41, "expected_value": 23364.508863636365, "absolute_deviation": 9318.901136363635, "relative_deviation": 0.3988485780185698, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-01 00:00:00 значение total_sales (32683.41) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.8033989187962487, "explanation": {"detector_specific_info": {"date": "2018-06-01 00:00:00", "current_value": 32683.41, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 28987.404285714285, "deviation_in_std": 7.138442322723072, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (32683.41) отклоняется от базовой линии (3696.01) на 28987.40, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:34,922 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 8854, order_id: 4618ea1ec695ec1707fcf8cc21a52b0d, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,922 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:34,923 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-14 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,924 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-14 00:00:00
2025-05-22 02:46:34,927 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
599 2018-08-14          315     44682.42  128.397759             228               315               2018-08-14  37562.228571         1.189557           0.989198                                1.0                       0.978396    2018-08-14
2025-05-22 02:46:34,928 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-14 00:00:00", "current_value": 44682.42, "expected_value": 26189.295057471263, "absolute_deviation": 18493.124942528735, "relative_deviation": 0.7061329792171336, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-14 00:00:00 значение total_sales (44682.42) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}]
2025-05-22 02:46:34,928 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,928 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-14 00:00:00", "current_value": 44682.42, "expected_value": 26189.295057471263, "absolute_deviation": 18493.124942528735, "relative_deviation": 0.7061329792171336, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-14 00:00:00 значение total_sales (44682.42) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}]
2025-05-22 02:46:34,929 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 8854, order_id: 4618ea1ec695ec1707fcf8cc21a52b0d, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9784, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,929 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:34,929 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-14 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,930 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-14 00:00:00
2025-05-22 02:46:34,934 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
599 2018-08-14          315     44682.42  128.397759             228               315               2018-08-14  37562.228571         1.189557           0.989198                                1.0                       0.978396    2018-08-14
2025-05-22 02:46:34,935 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-14 00:00:00", "current_value": 44682.42, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40986.41428571429, "deviation_in_std": 10.093320240405061, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (44682.42) отклоняется от базовой линии (3696.01) на 40986.41, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:34,936 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,936 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-14 00:00:00", "current_value": 44682.42, "expected_value": 26189.295057471263, "absolute_deviation": 18493.124942528735, "relative_deviation": 0.7061329792171336, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-14 00:00:00 значение total_sales (44682.42) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9783962277530719, "explanation": {"detector_specific_info": {"date": "2018-08-14 00:00:00", "current_value": 44682.42, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40986.41428571429, "deviation_in_std": 10.093320240405061, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (44682.42) отклоняется от базовой линии (3696.01) на 40986.41, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:34,936 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 9181, order_id: 5d28e7e8ae4794ffa06b352990f78234, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.8977, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,937 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:34,937 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-12 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,938 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-12 00:00:00
2025-05-22 02:46:34,942 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
597 2018-08-12          197     32665.67  139.002851             160               197               2018-08-12  41160.318571          0.79362           0.934894                           0.897745                       0.972043    2018-08-12
2025-05-22 02:46:34,943 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-12 00:00:00", "current_value": 32665.670000000002, "expected_value": 18683.428202247193, "absolute_deviation": 13982.24179775281, "relative_deviation": 0.7483766708334108, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-12 00:00:00 значение total_sales (32665.67) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}]
2025-05-22 02:46:34,944 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,944 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8977452993668317, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-12 00:00:00", "current_value": 32665.670000000002, "expected_value": 18683.428202247193, "absolute_deviation": 13982.24179775281, "relative_deviation": 0.7483766708334108, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-12 00:00:00 значение total_sales (32665.67) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}]
2025-05-22 02:46:34,945 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 9181, order_id: 5d28e7e8ae4794ffa06b352990f78234, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9720, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,945 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:34,945 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-12 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,947 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-12 00:00:00
2025-05-22 02:46:34,949 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
597 2018-08-12          197     32665.67  139.002851             160               197               2018-08-12  41160.318571          0.79362           0.934894                           0.897745                       0.972043    2018-08-12
2025-05-22 02:46:34,950 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-12 00:00:00", "current_value": 32665.670000000002, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 28969.664285714287, "deviation_in_std": 7.1340736677874, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (32665.67) отклоняется от базовой линии (3696.01) на 28969.66, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:34,950 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,951 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8977452993668317, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-12 00:00:00", "current_value": 32665.670000000002, "expected_value": 18683.428202247193, "absolute_deviation": 13982.24179775281, "relative_deviation": 0.7483766708334108, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-12 00:00:00 значение total_sales (32665.67) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9720429031944142, "explanation": {"detector_specific_info": {"date": "2018-08-12 00:00:00", "current_value": 32665.670000000002, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 28969.664285714287, "deviation_in_std": 7.1340736677874, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (32665.67) отклоняется от базовой линии (3696.01) на 28969.66, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:34,951 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 9350, order_id: 0152de20f6e09fb1133847df8babd490, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,951 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:34,952 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-07 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,952 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-07 00:00:00
2025-05-22 02:46:34,955 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
592 2018-08-07          366      50588.5  114.973864             252               366               2018-08-07  44125.211429         1.146476           0.979335                                1.0                        0.95867    2018-08-07
2025-05-22 02:46:34,956 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-07 00:00:00", "current_value": 50588.5, "expected_value": 26189.295057471263, "absolute_deviation": 24399.204942528737, "relative_deviation": 0.9316480221779834, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-07 00:00:00 значение total_sales (50588.50) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}]
2025-05-22 02:46:34,957 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,957 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-07 00:00:00", "current_value": 50588.5, "expected_value": 26189.295057471263, "absolute_deviation": 24399.204942528737, "relative_deviation": 0.9316480221779834, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-07 00:00:00 значение total_sales (50588.50) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}]
2025-05-22 02:46:34,957 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 9350, order_id: 0152de20f6e09fb1133847df8babd490, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9587, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,957 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:34,958 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-07 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,959 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-07 00:00:00
2025-05-22 02:46:34,961 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
592 2018-08-07          366      50588.5  114.973864             252               366               2018-08-07  44125.211429         1.146476           0.979335                                1.0                        0.95867    2018-08-07
2025-05-22 02:46:34,962 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-07 00:00:00", "current_value": 50588.5, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 46892.49428571429, "deviation_in_std": 11.547752345392325, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (50588.50) отклоняется от базовой линии (3696.01) на 46892.49, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:34,963 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,963 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-07 00:00:00", "current_value": 50588.5, "expected_value": 26189.295057471263, "absolute_deviation": 24399.204942528737, "relative_deviation": 0.9316480221779834, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-07 00:00:00 значение total_sales (50588.50) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.95867015383243, "explanation": {"detector_specific_info": {"date": "2018-08-07 00:00:00", "current_value": 50588.5, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 46892.49428571429, "deviation_in_std": 11.547752345392325, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (50588.50) отклоняется от базовой линии (3696.01) на 46892.49, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:34,964 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 9435, order_id: 4000f82f3395a0f2a5ad6a4e32060a66, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1769, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:34,964 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 9435, order_id: 4000f82f3395a0f2a5ad6a4e32060a66, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9184, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,964 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:34,964 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=36a968b544695394e4e9d7572688598f in aggregated_behavior_data_with_scores
2025-05-22 02:46:34,966 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:34,969 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                        categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
642  36a968b544695394e4e9d7572688598f   56.522384  136.831171    172        3.9     1140.9     13.350814      5.53097  [informatica_acessorios, beleza_saude, telefonia, automotivo, tablets_impressao_imagem, instrumentos_musicais, ferramentas_jardim, cool_stuff, consoles_games, moveis_decoracao]              10          2.420832         292.538462                0.236204                 10             0.05814              0.719612        0.547647                          0.176931                                   0.918363
2025-05-22 02:46:34,970 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}]
2025-05-22 02:46:34,970 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,970 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.918363395536566, "explanation": {"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}}]
2025-05-22 02:46:34,971 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 9435, order_id: 4000f82f3395a0f2a5ad6a4e32060a66, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.9281, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,971 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:34,971 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-04-27 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,973 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-04-27 00:00:00
2025-05-22 02:46:34,975 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
490 2018-04-27          242     41231.39  140.242823             165               242               2018-04-27  35298.295714         1.168084           0.823398                           0.928073                       0.718724    2018-04-27
2025-05-22 02:46:34,976 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-04-27 00:00:00", "current_value": 41231.39, "expected_value": 23364.508863636365, "absolute_deviation": 17866.881136363634, "relative_deviation": 0.7647017637152634, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-04-27 00:00:00 значение total_sales (41231.39) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}]
2025-05-22 02:46:34,977 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,977 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9280726698190791, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-04-27 00:00:00", "current_value": 41231.39, "expected_value": 23364.508863636365, "absolute_deviation": 17866.881136363634, "relative_deviation": 0.7647017637152634, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-04-27 00:00:00 значение total_sales (41231.39) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}]
2025-05-22 02:46:34,977 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 9435, order_id: 4000f82f3395a0f2a5ad6a4e32060a66, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.7187, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,978 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:34,978 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-04-27 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,979 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-04-27 00:00:00
2025-05-22 02:46:34,981 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
490 2018-04-27          242     41231.39  140.242823             165               242               2018-04-27  35298.295714         1.168084           0.823398                           0.928073                       0.718724    2018-04-27
2025-05-22 02:46:34,981 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-04-27 00:00:00", "current_value": 41231.39, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 37535.38428571429, "deviation_in_std": 9.243469099331083, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (41231.39) отклоняется от базовой линии (3696.01) на 37535.38, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:34,982 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,982 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9280726698190791, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-04-27 00:00:00", "current_value": 41231.39, "expected_value": 23364.508863636365, "absolute_deviation": 17866.881136363634, "relative_deviation": 0.7647017637152634, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-04-27 00:00:00 значение total_sales (41231.39) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.718723936134046, "explanation": {"detector_specific_info": {"date": "2018-04-27 00:00:00", "current_value": 41231.39, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 37535.38428571429, "deviation_in_std": 9.243469099331083, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (41231.39) отклоняется от базовой линии (3696.01) на 37535.38, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:34,983 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 9545, order_id: d58096e42e1aaf58b8521e8f8b4c20dc, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,983 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:34,984 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-15 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,985 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-15 00:00:00
2025-05-22 02:46:34,987 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
600 2018-08-15          285      46326.8  141.672171             208               285               2018-08-15  37936.561429         1.221165           0.990972                                1.0                       0.981944    2018-08-15
2025-05-22 02:46:34,988 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-15 00:00:00", "current_value": 46326.8, "expected_value": 25669.474712643678, "absolute_deviation": 20657.325287356325, "relative_deviation": 0.8047428129560211, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-15 00:00:00 значение total_sales (46326.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}]
2025-05-22 02:46:34,988 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,988 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-15 00:00:00", "current_value": 46326.8, "expected_value": 25669.474712643678, "absolute_deviation": 20657.325287356325, "relative_deviation": 0.8047428129560211, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-15 00:00:00 значение total_sales (46326.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}]
2025-05-22 02:46:34,988 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 9545, order_id: d58096e42e1aaf58b8521e8f8b4c20dc, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9819, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,989 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:34,989 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-15 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,990 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-15 00:00:00
2025-05-22 02:46:34,992 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
600 2018-08-15          285      46326.8  141.672171             208               285               2018-08-15  37936.561429         1.221165           0.990972                                1.0                       0.981944    2018-08-15
2025-05-22 02:46:34,993 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-15 00:00:00", "current_value": 46326.8, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 42630.79428571429, "deviation_in_std": 10.498265494244997, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (46326.80) отклоняется от базовой линии (3696.01) на 42630.79, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:34,993 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,993 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-15 00:00:00", "current_value": 46326.8, "expected_value": 25669.474712643678, "absolute_deviation": 20657.325287356325, "relative_deviation": 0.8047428129560211, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-15 00:00:00 значение total_sales (46326.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9819435388597458, "explanation": {"detector_specific_info": {"date": "2018-08-15 00:00:00", "current_value": 46326.8, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 42630.79428571429, "deviation_in_std": 10.498265494244997, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (46326.80) отклоняется от базовой линии (3696.01) на 42630.79, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:34,994 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 9705, order_id: f0a2783007ba2c431132d38c7642d5c9, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.6085, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,994 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:34,994 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-04-17 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:34,995 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-04-17 00:00:00
2025-05-22 02:46:34,998 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
480 2018-04-17          265     38295.62  116.400061             174               265               2018-04-17  34250.411429         1.118107            0.65007                           0.608548                       0.691591    2018-04-17
2025-05-22 02:46:34,998 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-04-17 00:00:00", "current_value": 38295.62, "expected_value": 26189.295057471263, "absolute_deviation": 12106.32494252874, "relative_deviation": 0.46226234482302553, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-04-17 00:00:00 значение total_sales (38295.62) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}]
2025-05-22 02:46:34,999 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:34,999 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.6085481181195501, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-04-17 00:00:00", "current_value": 38295.62, "expected_value": 26189.295057471263, "absolute_deviation": 12106.32494252874, "relative_deviation": 0.46226234482302553, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-04-17 00:00:00 значение total_sales (38295.62) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}]
2025-05-22 02:46:34,999 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 9705, order_id: f0a2783007ba2c431132d38c7642d5c9, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.6916, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:34,999 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:34,999 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-04-17 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,000 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-04-17 00:00:00
2025-05-22 02:46:35,003 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
480 2018-04-17          265     38295.62  116.400061             174               265               2018-04-17  34250.411429         1.118107            0.65007                           0.608548                       0.691591    2018-04-17
2025-05-22 02:46:35,004 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-04-17 00:00:00", "current_value": 38295.62, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 34599.61428571429, "deviation_in_std": 8.520505959505945, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (38295.62) отклоняется от базовой линии (3696.01) на 34599.61, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,004 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,004 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.6085481181195501, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-04-17 00:00:00", "current_value": 38295.62, "expected_value": 26189.295057471263, "absolute_deviation": 12106.32494252874, "relative_deviation": 0.46226234482302553, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-04-17 00:00:00 значение total_sales (38295.62) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.6915914814905058, "explanation": {"detector_specific_info": {"date": "2018-04-17 00:00:00", "current_value": 38295.62, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 34599.61428571429, "deviation_in_std": 8.520505959505945, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (38295.62) отклоняется от базовой линии (3696.01) на 34599.61, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,005 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 9736, order_id: cf57d12f25beeb760bd30983c67f21cd, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,005 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,005 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-26 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,006 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-26 00:00:00
2025-05-22 02:46:35,008 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
580 2018-07-26          247     37938.95  120.059968             176               247               2018-07-26  35024.012857         1.083227           0.961042                                1.0                       0.922085    2018-07-26
2025-05-22 02:46:35,009 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-26 00:00:00", "current_value": 37938.95, "expected_value": 24263.594318181815, "absolute_deviation": 13675.355681818182, "relative_deviation": 0.5636162351911158, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-26 00:00:00 значение total_sales (37938.95) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}]
2025-05-22 02:46:35,009 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,010 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-26 00:00:00", "current_value": 37938.95, "expected_value": 24263.594318181815, "absolute_deviation": 13675.355681818182, "relative_deviation": 0.5636162351911158, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-26 00:00:00 значение total_sales (37938.95) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}]
2025-05-22 02:46:35,010 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 9736, order_id: cf57d12f25beeb760bd30983c67f21cd, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9221, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,010 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,011 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-26 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,012 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-26 00:00:00
2025-05-22 02:46:35,014 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
580 2018-07-26          247     37938.95  120.059968             176               247               2018-07-26  35024.012857         1.083227           0.961042                                1.0                       0.922085    2018-07-26
2025-05-22 02:46:35,015 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-07-26 00:00:00", "current_value": 37938.95, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 34242.944285714286, "deviation_in_std": 8.432672354325213, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (37938.95) отклоняется от базовой линии (3696.01) на 34242.94, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,015 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,015 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-26 00:00:00", "current_value": 37938.95, "expected_value": 24263.594318181815, "absolute_deviation": 13675.355681818182, "relative_deviation": 0.5636162351911158, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-26 00:00:00 значение total_sales (37938.95) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9220845759235781, "explanation": {"detector_specific_info": {"date": "2018-07-26 00:00:00", "current_value": 37938.95, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 34242.944285714286, "deviation_in_std": 8.432672354325213, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (37938.95) отклоняется от базовой линии (3696.01) на 34242.94, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,017 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 9875, order_id: eea28d6b80e09bfb00dc1f0640d2de47, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.7472, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,018 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,019 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-09 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,020 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-09 00:00:00
2025-05-22 02:46:35,022 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
594 2018-08-09          283     42138.17  125.785582             204               283               2018-08-09  44497.781429         0.946972           0.856223                           0.747247                       0.965198    2018-08-09
2025-05-22 02:46:35,023 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-09 00:00:00", "current_value": 42138.17, "expected_value": 24263.594318181815, "absolute_deviation": 17874.575681818184, "relative_deviation": 0.7366829269983282, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-09 00:00:00 значение total_sales (42138.17) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}]
2025-05-22 02:46:35,023 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,023 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7472473831010398, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-09 00:00:00", "current_value": 42138.17, "expected_value": 24263.594318181815, "absolute_deviation": 17874.575681818184, "relative_deviation": 0.7366829269983282, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-09 00:00:00 значение total_sales (42138.17) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}]
2025-05-22 02:46:35,024 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 9875, order_id: eea28d6b80e09bfb00dc1f0640d2de47, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9652, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,024 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,024 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-09 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,025 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-09 00:00:00
2025-05-22 02:46:35,027 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
594 2018-08-09          283     42138.17  125.785582             204               283               2018-08-09  44497.781429         0.946972           0.856223                           0.747247                       0.965198    2018-08-09
2025-05-22 02:46:35,027 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-09 00:00:00", "current_value": 42138.17, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 38442.16428571429, "deviation_in_std": 9.466772871741947, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (42138.17) отклоняется от базовой линии (3696.01) на 38442.16, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,028 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,028 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7472473831010398, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-09 00:00:00", "current_value": 42138.17, "expected_value": 24263.594318181815, "absolute_deviation": 17874.575681818184, "relative_deviation": 0.7366829269983282, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-09 00:00:00 значение total_sales (42138.17) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9651982020506744, "explanation": {"detector_specific_info": {"date": "2018-08-09 00:00:00", "current_value": 42138.17, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 38442.16428571429, "deviation_in_std": 9.466772871741947, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (42138.17) отклоняется от базовой линии (3696.01) на 38442.16, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,028 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 9962, order_id: 31e50461be6957a749166e97af082d0a, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1697, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:35,028 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 9962, order_id: 31e50461be6957a749166e97af082d0a, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9836, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,028 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:35,029 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=4a3ccda38b2129705f3fb522db62ca31 in aggregated_behavior_data_with_scores
2025-05-22 02:46:35,029 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:35,033 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                               categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
882  4a3ccda38b2129705f3fb522db62ca31  233.158916  370.889347     83        9.9     3099.9     18.396747     9.418922  [construcao_ferramentas_seguranca, casa_construcao, ferramentas_jardim, construcao_ferramentas_construcao, eletronicos]               5          1.590715         313.121212                0.078902                  5            0.060241               0.53771        0.576635                          0.169668                                   0.983603
2025-05-22 02:46:35,033 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}]
2025-05-22 02:46:35,033 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,034 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.9836033466098753, "explanation": {"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}}]
2025-05-22 02:46:35,034 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 9962, order_id: 31e50461be6957a749166e97af082d0a, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.6811, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,034 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,034 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-02-09 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,035 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-02-09 00:00:00
2025-05-22 02:46:35,037 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
413 2018-02-09          211     31401.35  130.838958             147               211               2018-02-09  31120.401429         1.009028           0.603944                           0.681083                       0.526804    2018-02-09
2025-05-22 02:46:35,038 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-02-09 00:00:00", "current_value": 31401.35, "expected_value": 23364.508863636365, "absolute_deviation": 8036.841136363633, "relative_deviation": 0.34397646375832314, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-02-09 00:00:00 значение total_sales (31401.35) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}]
2025-05-22 02:46:35,038 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,039 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.6810834816761164, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-02-09 00:00:00", "current_value": 31401.35, "expected_value": 23364.508863636365, "absolute_deviation": 8036.841136363633, "relative_deviation": 0.34397646375832314, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-02-09 00:00:00 значение total_sales (31401.35) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}]
2025-05-22 02:46:35,039 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 9962, order_id: 31e50461be6957a749166e97af082d0a, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.5268, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,039 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,040 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-02-09 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,041 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-02-09 00:00:00
2025-05-22 02:46:35,042 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
413 2018-02-09          211     31401.35  130.838958             147               211               2018-02-09  31120.401429         1.009028           0.603944                           0.681083                       0.526804    2018-02-09
2025-05-22 02:46:35,043 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-02-09 00:00:00", "current_value": 31401.35, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 27705.344285714284, "deviation_in_std": 6.822722043871452, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (31401.35) отклоняется от базовой линии (3696.01) на 27705.34, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,043 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,043 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.6810834816761164, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-02-09 00:00:00", "current_value": 31401.35, "expected_value": 23364.508863636365, "absolute_deviation": 8036.841136363633, "relative_deviation": 0.34397646375832314, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-02-09 00:00:00 значение total_sales (31401.35) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.526804160511267, "explanation": {"detector_specific_info": {"date": "2018-02-09 00:00:00", "current_value": 31401.35, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 27705.344285714284, "deviation_in_std": 6.822722043871452, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (31401.35) отклоняется от базовой линии (3696.01) на 27705.34, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,044 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 11180, order_id: 928c5b1abd62c91a35df8614b271d05e, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1769, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:35,044 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 11180, order_id: 928c5b1abd62c91a35df8614b271d05e, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9184, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,044 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:35,044 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=36a968b544695394e4e9d7572688598f in aggregated_behavior_data_with_scores
2025-05-22 02:46:35,045 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:35,049 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                        categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
642  36a968b544695394e4e9d7572688598f   56.522384  136.831171    172        3.9     1140.9     13.350814      5.53097  [informatica_acessorios, beleza_saude, telefonia, automotivo, tablets_impressao_imagem, instrumentos_musicais, ferramentas_jardim, cool_stuff, consoles_games, moveis_decoracao]              10          2.420832         292.538462                0.236204                 10             0.05814              0.719612        0.547647                          0.176931                                   0.918363
2025-05-22 02:46:35,050 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}]
2025-05-22 02:46:35,050 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,050 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.918363395536566, "explanation": {"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}}]
2025-05-22 02:46:35,050 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 11180, order_id: 928c5b1abd62c91a35df8614b271d05e, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.7785, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,051 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,051 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-08 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,052 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-08 00:00:00
2025-05-22 02:46:35,054 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
593 2018-08-08          315     43706.47  119.743753             215               315               2018-08-08  44012.448571         0.993048           0.870271                           0.778542                       0.961999    2018-08-08
2025-05-22 02:46:35,055 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-08 00:00:00", "current_value": 43706.47, "expected_value": 25669.474712643678, "absolute_deviation": 18036.995287356323, "relative_deviation": 0.7026632016927123, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-08 00:00:00 значение total_sales (43706.47) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}]
2025-05-22 02:46:35,055 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,056 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7785418521924519, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-08 00:00:00", "current_value": 43706.47, "expected_value": 25669.474712643678, "absolute_deviation": 18036.995287356323, "relative_deviation": 0.7026632016927123, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-08 00:00:00 значение total_sales (43706.47) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}]
2025-05-22 02:46:35,056 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 11180, order_id: 928c5b1abd62c91a35df8614b271d05e, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9620, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,056 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,057 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-08 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,057 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-08 00:00:00
2025-05-22 02:46:35,059 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
593 2018-08-08          315     43706.47  119.743753             215               315               2018-08-08  44012.448571         0.993048           0.870271                           0.778542                       0.961999    2018-08-08
2025-05-22 02:46:35,060 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-08 00:00:00", "current_value": 43706.47, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40010.46428571429, "deviation_in_std": 9.852982653907365, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (43706.47) отклоняется от базовой линии (3696.01) на 40010.46, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,060 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,061 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7785418521924519, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-08 00:00:00", "current_value": 43706.47, "expected_value": 25669.474712643678, "absolute_deviation": 18036.995287356323, "relative_deviation": 0.7026632016927123, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-08 00:00:00 значение total_sales (43706.47) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9619994271129765, "explanation": {"detector_specific_info": {"date": "2018-08-08 00:00:00", "current_value": 43706.47, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40010.46428571429, "deviation_in_std": 9.852982653907365, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (43706.47) отклоняется от базовой линии (3696.01) на 40010.46, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,061 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 11889, order_id: 2996234f359b5a3b99263b0f5b841d86, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,061 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,062 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-15 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,062 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-15 00:00:00
2025-05-22 02:46:35,065 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
600 2018-08-15          285      46326.8  141.672171             208               285               2018-08-15  37936.561429         1.221165           0.990972                                1.0                       0.981944    2018-08-15
2025-05-22 02:46:35,066 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-15 00:00:00", "current_value": 46326.8, "expected_value": 25669.474712643678, "absolute_deviation": 20657.325287356325, "relative_deviation": 0.8047428129560211, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-15 00:00:00 значение total_sales (46326.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}]
2025-05-22 02:46:35,067 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,067 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-15 00:00:00", "current_value": 46326.8, "expected_value": 25669.474712643678, "absolute_deviation": 20657.325287356325, "relative_deviation": 0.8047428129560211, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-15 00:00:00 значение total_sales (46326.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}]
2025-05-22 02:46:35,068 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 11889, order_id: 2996234f359b5a3b99263b0f5b841d86, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9819, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,068 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,068 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-15 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,069 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-15 00:00:00
2025-05-22 02:46:35,071 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
600 2018-08-15          285      46326.8  141.672171             208               285               2018-08-15  37936.561429         1.221165           0.990972                                1.0                       0.981944    2018-08-15
2025-05-22 02:46:35,072 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-15 00:00:00", "current_value": 46326.8, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 42630.79428571429, "deviation_in_std": 10.498265494244997, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (46326.80) отклоняется от базовой линии (3696.01) на 42630.79, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,072 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,072 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-15 00:00:00", "current_value": 46326.8, "expected_value": 25669.474712643678, "absolute_deviation": 20657.325287356325, "relative_deviation": 0.8047428129560211, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-15 00:00:00 значение total_sales (46326.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9819435388597458, "explanation": {"detector_specific_info": {"date": "2018-08-15 00:00:00", "current_value": 46326.8, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 42630.79428571429, "deviation_in_std": 10.498265494244997, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (46326.80) отклоняется от базовой линии (3696.01) на 42630.79, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,073 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 12062, order_id: 9371281837c6362f41236d947e32710d, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.9816, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,073 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,073 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-01 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,074 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-01 00:00:00
2025-05-22 02:46:35,076 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
525 2018-06-01          184     32683.41  151.312083             140               184               2018-06-01  22878.174286         1.428585           0.892482                           0.981565                       0.803399    2018-06-01
2025-05-22 02:46:35,077 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-01 00:00:00", "current_value": 32683.41, "expected_value": 23364.508863636365, "absolute_deviation": 9318.901136363635, "relative_deviation": 0.3988485780185698, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-01 00:00:00 значение total_sales (32683.41) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}]
2025-05-22 02:46:35,077 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,077 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9815648028904507, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-01 00:00:00", "current_value": 32683.41, "expected_value": 23364.508863636365, "absolute_deviation": 9318.901136363635, "relative_deviation": 0.3988485780185698, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-01 00:00:00 значение total_sales (32683.41) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}]
2025-05-22 02:46:35,077 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 12062, order_id: 9371281837c6362f41236d947e32710d, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.8034, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,078 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,078 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-01 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,080 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-01 00:00:00
2025-05-22 02:46:35,082 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
525 2018-06-01          184     32683.41  151.312083             140               184               2018-06-01  22878.174286         1.428585           0.892482                           0.981565                       0.803399    2018-06-01
2025-05-22 02:46:35,083 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-06-01 00:00:00", "current_value": 32683.41, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 28987.404285714285, "deviation_in_std": 7.138442322723072, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (32683.41) отклоняется от базовой линии (3696.01) на 28987.40, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,083 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,083 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9815648028904507, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-01 00:00:00", "current_value": 32683.41, "expected_value": 23364.508863636365, "absolute_deviation": 9318.901136363635, "relative_deviation": 0.3988485780185698, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-01 00:00:00 значение total_sales (32683.41) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.8033989187962487, "explanation": {"detector_specific_info": {"date": "2018-06-01 00:00:00", "current_value": 32683.41, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 28987.404285714285, "deviation_in_std": 7.138442322723072, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (32683.41) отклоняется от базовой линии (3696.01) на 28987.40, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,084 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 12785, order_id: 0f924038b00d1f102e4d09bea4fa666a, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,084 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,084 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-10 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,085 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-10 00:00:00
2025-05-22 02:46:35,087 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
503 2018-05-10          279     59975.66  173.340058             188               279               2018-05-10  43773.748571         1.370128           0.878504                                1.0                       0.757007    2018-05-10
2025-05-22 02:46:35,088 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-10 00:00:00", "current_value": 59975.66, "expected_value": 24263.594318181815, "absolute_deviation": 35712.06568181819, "relative_deviation": 1.47183740436418, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-10 00:00:00 значение total_sales (59975.66) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}]
2025-05-22 02:46:35,088 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,088 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-10 00:00:00", "current_value": 59975.66, "expected_value": 24263.594318181815, "absolute_deviation": 35712.06568181819, "relative_deviation": 1.47183740436418, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-10 00:00:00 значение total_sales (59975.66) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}]
2025-05-22 02:46:35,089 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 12785, order_id: 0f924038b00d1f102e4d09bea4fa666a, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.7570, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,089 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,089 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-10 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,090 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-10 00:00:00
2025-05-22 02:46:35,092 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
503 2018-05-10          279     59975.66  173.340058             188               279               2018-05-10  43773.748571         1.370128           0.878504                                1.0                       0.757007    2018-05-10
2025-05-22 02:46:35,092 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-05-10 00:00:00", "current_value": 59975.66, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 56279.65428571429, "deviation_in_std": 13.859435708748775, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (59975.66) отклоняется от базовой линии (3696.01) на 56279.65, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,093 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,093 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-10 00:00:00", "current_value": 59975.66, "expected_value": 24263.594318181815, "absolute_deviation": 35712.06568181819, "relative_deviation": 1.47183740436418, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-10 00:00:00 значение total_sales (59975.66) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.7570070504564511, "explanation": {"detector_specific_info": {"date": "2018-05-10 00:00:00", "current_value": 59975.66, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 56279.65428571429, "deviation_in_std": 13.859435708748775, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (59975.66) отклоняется от базовой линии (3696.01) на 56279.65, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,093 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 12786, order_id: 8ee5cab30019132affead27f19959ff2, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.2899, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:35,094 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 12786, order_id: 8ee5cab30019132affead27f19959ff2, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.7832, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,094 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,095 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-19 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,096 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-19 00:00:00
2025-05-22 02:46:35,098 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
512 2018-05-19          139     25824.17  144.269106             113               139               2018-05-19  39594.712857         0.652213           0.536568                           0.289907                        0.78323    2018-05-19
2025-05-22 02:46:35,099 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-05-19 00:00:00", "current_value": 25824.170000000002, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 22128.164285714287, "deviation_in_std": 5.449284899895606, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (25824.17) отклоняется от базовой линии (3696.01) на 22128.16, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,099 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,099 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.783229799905033, "explanation": {"detector_specific_info": {"date": "2018-05-19 00:00:00", "current_value": 25824.170000000002, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 22128.164285714287, "deviation_in_std": 5.449284899895606, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (25824.17) отклоняется от базовой линии (3696.01) на 22128.16, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,099 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 13136, order_id: 41b77be2144c06162d34e0a18f8f15ce, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1769, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:35,100 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 13136, order_id: 41b77be2144c06162d34e0a18f8f15ce, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9184, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,100 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:35,100 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=36a968b544695394e4e9d7572688598f in aggregated_behavior_data_with_scores
2025-05-22 02:46:35,101 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:35,104 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                        categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
642  36a968b544695394e4e9d7572688598f   56.522384  136.831171    172        3.9     1140.9     13.350814      5.53097  [informatica_acessorios, beleza_saude, telefonia, automotivo, tablets_impressao_imagem, instrumentos_musicais, ferramentas_jardim, cool_stuff, consoles_games, moveis_decoracao]              10          2.420832         292.538462                0.236204                 10             0.05814              0.719612        0.547647                          0.176931                                   0.918363
2025-05-22 02:46:35,104 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}]
2025-05-22 02:46:35,104 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,105 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.918363395536566, "explanation": {"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}}]
2025-05-22 02:46:35,105 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 13136, order_id: 41b77be2144c06162d34e0a18f8f15ce, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,105 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,105 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-25 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,106 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-25 00:00:00
2025-05-22 02:46:35,109 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
579 2018-07-25          268     40753.19  122.750572             201               268               2018-07-25  35288.758571         1.154849           0.959618                                1.0                       0.919235    2018-07-25
2025-05-22 02:46:35,109 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-25 00:00:00", "current_value": 40753.19, "expected_value": 25669.474712643678, "absolute_deviation": 15083.715287356325, "relative_deviation": 0.5876129315543311, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-25 00:00:00 значение total_sales (40753.19) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}]
2025-05-22 02:46:35,110 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,110 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-25 00:00:00", "current_value": 40753.19, "expected_value": 25669.474712643678, "absolute_deviation": 15083.715287356325, "relative_deviation": 0.5876129315543311, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-25 00:00:00 значение total_sales (40753.19) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}]
2025-05-22 02:46:35,110 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 13136, order_id: 41b77be2144c06162d34e0a18f8f15ce, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9192, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,110 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,111 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-25 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,112 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-25 00:00:00
2025-05-22 02:46:35,114 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
579 2018-07-25          268     40753.19  122.750572             201               268               2018-07-25  35288.758571         1.154849           0.959618                                1.0                       0.919235    2018-07-25
2025-05-22 02:46:35,115 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-07-25 00:00:00", "current_value": 40753.19, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 37057.18428571429, "deviation_in_std": 9.125707498979427, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (40753.19) отклоняется от базовой линии (3696.01) на 37057.18, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,115 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,116 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-25 00:00:00", "current_value": 40753.19, "expected_value": 25669.474712643678, "absolute_deviation": 15083.715287356325, "relative_deviation": 0.5876129315543311, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-25 00:00:00 значение total_sales (40753.19) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9192352183494302, "explanation": {"detector_specific_info": {"date": "2018-07-25 00:00:00", "current_value": 40753.19, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 37057.18428571429, "deviation_in_std": 9.125707498979427, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (40753.19) отклоняется от базовой линии (3696.01) на 37057.18, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,116 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 13794, order_id: 426a9742b533fc6fed17d1fd6d143d7e, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,116 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,117 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-03 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,117 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-03 00:00:00
2025-05-22 02:46:35,119 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
588 2018-08-03          314     45036.63  125.10175             216               314               2018-08-03  39138.992857         1.150684           0.972436                                1.0                       0.944872    2018-08-03
2025-05-22 02:46:35,120 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-03 00:00:00", "current_value": 45036.63, "expected_value": 23364.508863636365, "absolute_deviation": 21672.121136363632, "relative_deviation": 0.9275658762120739, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-03 00:00:00 значение total_sales (45036.63) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}]
2025-05-22 02:46:35,120 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,121 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-03 00:00:00", "current_value": 45036.63, "expected_value": 23364.508863636365, "absolute_deviation": 21672.121136363632, "relative_deviation": 0.9275658762120739, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-03 00:00:00 значение total_sales (45036.63) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}]
2025-05-22 02:46:35,121 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 13794, order_id: 426a9742b533fc6fed17d1fd6d143d7e, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9449, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,121 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,121 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-03 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,123 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-03 00:00:00
2025-05-22 02:46:35,125 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
588 2018-08-03          314     45036.63  125.10175             216               314               2018-08-03  39138.992857         1.150684           0.972436                                1.0                       0.944872    2018-08-03
2025-05-22 02:46:35,125 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-03 00:00:00", "current_value": 45036.63, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 41340.624285714286, "deviation_in_std": 10.18054804563417, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (45036.63) отклоняется от базовой линии (3696.01) на 41340.62, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,125 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,126 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-03 00:00:00", "current_value": 45036.63, "expected_value": 23364.508863636365, "absolute_deviation": 21672.121136363632, "relative_deviation": 0.9275658762120739, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-03 00:00:00 значение total_sales (45036.63) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9448723295452219, "explanation": {"detector_specific_info": {"date": "2018-08-03 00:00:00", "current_value": 45036.63, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 41340.624285714286, "deviation_in_std": 10.18054804563417, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (45036.63) отклоняется от базовой линии (3696.01) на 41340.62, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,126 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 13831, order_id: f2e689a11a0a962aa271e7715b516ee2, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,126 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,127 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-06 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,128 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-06 00:00:00
2025-05-22 02:46:35,130 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
591 2018-08-06          372     58342.98  131.10782             246               372               2018-08-06  43511.862857         1.340852           0.977384                                1.0                       0.954768    2018-08-06
2025-05-22 02:46:35,131 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-06 00:00:00", "current_value": 58342.98, "expected_value": 25862.10588888889, "absolute_deviation": 32480.874111111112, "relative_deviation": 1.255925339207038, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-06 00:00:00 значение total_sales (58342.98) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}]
2025-05-22 02:46:35,131 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,131 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-06 00:00:00", "current_value": 58342.98, "expected_value": 25862.10588888889, "absolute_deviation": 32480.874111111112, "relative_deviation": 1.255925339207038, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-06 00:00:00 значение total_sales (58342.98) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}]
2025-05-22 02:46:35,131 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 13831, order_id: f2e689a11a0a962aa271e7715b516ee2, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9548, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,131 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,132 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-06 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,133 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-06 00:00:00
2025-05-22 02:46:35,135 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
591 2018-08-06          372     58342.98  131.10782             246               372               2018-08-06  43511.862857         1.340852           0.977384                                1.0                       0.954768    2018-08-06
2025-05-22 02:46:35,136 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-06 00:00:00", "current_value": 58342.98, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 54646.97428571429, "deviation_in_std": 13.457371698581184, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (58342.98) отклоняется от базовой линии (3696.01) на 54646.97, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,136 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,136 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-06 00:00:00", "current_value": 58342.98, "expected_value": 25862.10588888889, "absolute_deviation": 32480.874111111112, "relative_deviation": 1.255925339207038, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-06 00:00:00 значение total_sales (58342.98) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9547682263974279, "explanation": {"detector_specific_info": {"date": "2018-08-06 00:00:00", "current_value": 58342.98, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 54646.97428571429, "deviation_in_std": 13.457371698581184, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (58342.98) отклоняется от базовой линии (3696.01) на 54646.97, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,137 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 15337, order_id: cdeefca5ad0ec35c4d7c5b48ab52e85c, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1769, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:35,137 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 15337, order_id: cdeefca5ad0ec35c4d7c5b48ab52e85c, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9184, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,137 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:35,137 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=36a968b544695394e4e9d7572688598f in aggregated_behavior_data_with_scores
2025-05-22 02:46:35,138 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:35,140 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                        categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
642  36a968b544695394e4e9d7572688598f   56.522384  136.831171    172        3.9     1140.9     13.350814      5.53097  [informatica_acessorios, beleza_saude, telefonia, automotivo, tablets_impressao_imagem, instrumentos_musicais, ferramentas_jardim, cool_stuff, consoles_games, moveis_decoracao]              10          2.420832         292.538462                0.236204                 10             0.05814              0.719612        0.547647                          0.176931                                   0.918363
2025-05-22 02:46:35,141 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}]
2025-05-22 02:46:35,141 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,142 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.918363395536566, "explanation": {"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}}]
2025-05-22 02:46:35,142 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 15337, order_id: cdeefca5ad0ec35c4d7c5b48ab52e85c, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.8977, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,142 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,143 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-12 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,144 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-12 00:00:00
2025-05-22 02:46:35,145 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
597 2018-08-12          197     32665.67  139.002851             160               197               2018-08-12  41160.318571          0.79362           0.934894                           0.897745                       0.972043    2018-08-12
2025-05-22 02:46:35,146 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-12 00:00:00", "current_value": 32665.670000000002, "expected_value": 18683.428202247193, "absolute_deviation": 13982.24179775281, "relative_deviation": 0.7483766708334108, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-12 00:00:00 значение total_sales (32665.67) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}]
2025-05-22 02:46:35,146 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,146 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8977452993668317, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-12 00:00:00", "current_value": 32665.670000000002, "expected_value": 18683.428202247193, "absolute_deviation": 13982.24179775281, "relative_deviation": 0.7483766708334108, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-12 00:00:00 значение total_sales (32665.67) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}]
2025-05-22 02:46:35,146 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 15337, order_id: cdeefca5ad0ec35c4d7c5b48ab52e85c, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9720, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,147 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,147 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-12 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,148 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-12 00:00:00
2025-05-22 02:46:35,150 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
597 2018-08-12          197     32665.67  139.002851             160               197               2018-08-12  41160.318571          0.79362           0.934894                           0.897745                       0.972043    2018-08-12
2025-05-22 02:46:35,151 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-12 00:00:00", "current_value": 32665.670000000002, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 28969.664285714287, "deviation_in_std": 7.1340736677874, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (32665.67) отклоняется от базовой линии (3696.01) на 28969.66, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,151 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,151 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8977452993668317, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-12 00:00:00", "current_value": 32665.670000000002, "expected_value": 18683.428202247193, "absolute_deviation": 13982.24179775281, "relative_deviation": 0.7483766708334108, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-12 00:00:00 значение total_sales (32665.67) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9720429031944142, "explanation": {"detector_specific_info": {"date": "2018-08-12 00:00:00", "current_value": 32665.670000000002, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 28969.664285714287, "deviation_in_std": 7.1340736677874, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (32665.67) отклоняется от базовой линии (3696.01) на 28969.66, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,152 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 15792, order_id: e4c09ee4522daa0f32bd2e6b2f5ed048, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.9840, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,152 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,152 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-04 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,153 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-04 00:00:00
2025-05-22 02:46:35,155 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
589 2018-08-04          245     35844.56  127.560712             182               245               2018-08-04  40382.502857         0.887626           0.965791                           0.984035                       0.947547    2018-08-04
2025-05-22 02:46:35,155 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-04 00:00:00", "current_value": 35844.56, "expected_value": 18164.355862068966, "absolute_deviation": 17680.204137931032, "relative_deviation": 0.9733460559893046, "threshold": 2.5, "day_of_week": 5, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-04 00:00:00 значение total_sales (35844.56) в пределах нормальных отклонений от сезонного паттерна (18164.36)."}}]
2025-05-22 02:46:35,156 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,157 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9840346395236611, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-04 00:00:00", "current_value": 35844.56, "expected_value": 18164.355862068966, "absolute_deviation": 17680.204137931032, "relative_deviation": 0.9733460559893046, "threshold": 2.5, "day_of_week": 5, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-04 00:00:00 значение total_sales (35844.56) в пределах нормальных отклонений от сезонного паттерна (18164.36)."}}}]
2025-05-22 02:46:35,157 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 15792, order_id: e4c09ee4522daa0f32bd2e6b2f5ed048, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9475, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,157 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,158 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-04 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,158 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-04 00:00:00
2025-05-22 02:46:35,160 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
589 2018-08-04          245     35844.56  127.560712             182               245               2018-08-04  40382.502857         0.887626           0.965791                           0.984035                       0.947547    2018-08-04
2025-05-22 02:46:35,161 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-04 00:00:00", "current_value": 35844.56, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 32148.554285714283, "deviation_in_std": 7.916907573562967, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (35844.56) отклоняется от базовой линии (3696.01) на 32148.55, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,161 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,161 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9840346395236611, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-04 00:00:00", "current_value": 35844.56, "expected_value": 18164.355862068966, "absolute_deviation": 17680.204137931032, "relative_deviation": 0.9733460559893046, "threshold": 2.5, "day_of_week": 5, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-04 00:00:00 значение total_sales (35844.56) в пределах нормальных отклонений от сезонного паттерна (18164.36)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9475474127941269, "explanation": {"detector_specific_info": {"date": "2018-08-04 00:00:00", "current_value": 35844.56, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 32148.554285714283, "deviation_in_std": 7.916907573562967, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (35844.56) отклоняется от базовой линии (3696.01) на 32148.55, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,161 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 16338, order_id: 4ae41a4932898dbf49f39d10745ba16f, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1769, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:35,162 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 16338, order_id: 4ae41a4932898dbf49f39d10745ba16f, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9184, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,162 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:35,162 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=36a968b544695394e4e9d7572688598f in aggregated_behavior_data_with_scores
2025-05-22 02:46:35,164 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:35,166 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                        categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
642  36a968b544695394e4e9d7572688598f   56.522384  136.831171    172        3.9     1140.9     13.350814      5.53097  [informatica_acessorios, beleza_saude, telefonia, automotivo, tablets_impressao_imagem, instrumentos_musicais, ferramentas_jardim, cool_stuff, consoles_games, moveis_decoracao]              10          2.420832         292.538462                0.236204                 10             0.05814              0.719612        0.547647                          0.176931                                   0.918363
2025-05-22 02:46:35,167 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}]
2025-05-22 02:46:35,167 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,167 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.918363395536566, "explanation": {"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}}]
2025-05-22 02:46:35,168 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 16338, order_id: 4ae41a4932898dbf49f39d10745ba16f, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.7297, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,168 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,168 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-17 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,169 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-17 00:00:00
2025-05-22 02:46:35,173 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
602 2018-08-17          255     36361.57  120.802558             203               255               2018-08-17  37849.641429         0.960685           0.858666                           0.729695                       0.987637    2018-08-17
2025-05-22 02:46:35,173 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-17 00:00:00", "current_value": 36361.57, "expected_value": 23364.508863636365, "absolute_deviation": 12997.061136363634, "relative_deviation": 0.5562736718421575, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-17 00:00:00 значение total_sales (36361.57) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}]
2025-05-22 02:46:35,174 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,174 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7296946227452271, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-17 00:00:00", "current_value": 36361.57, "expected_value": 23364.508863636365, "absolute_deviation": 12997.061136363634, "relative_deviation": 0.5562736718421575, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-17 00:00:00 значение total_sales (36361.57) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}]
2025-05-22 02:46:35,174 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 16338, order_id: 4ae41a4932898dbf49f39d10745ba16f, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9876, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,174 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,174 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-17 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,175 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-17 00:00:00
2025-05-22 02:46:35,178 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
602 2018-08-17          255     36361.57  120.802558             203               255               2018-08-17  37849.641429         0.960685           0.858666                           0.729695                       0.987637    2018-08-17
2025-05-22 02:46:35,178 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-17 00:00:00", "current_value": 36361.57, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 32665.564285714285, "deviation_in_std": 8.044226530061943, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (36361.57) отклоняется от базовой линии (3696.01) на 32665.56, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,179 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,179 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7296946227452271, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-17 00:00:00", "current_value": 36361.57, "expected_value": 23364.508863636365, "absolute_deviation": 12997.061136363634, "relative_deviation": 0.5562736718421575, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-17 00:00:00 значение total_sales (36361.57) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9876365632717872, "explanation": {"detector_specific_info": {"date": "2018-08-17 00:00:00", "current_value": 36361.57, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 32665.564285714285, "deviation_in_std": 8.044226530061943, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (36361.57) отклоняется от базовой линии (3696.01) на 32665.56, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,179 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 18924, order_id: a56073f17e070c784c5eb0d85da530f5, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.2171, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:35,180 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 18924, order_id: a56073f17e070c784c5eb0d85da530f5, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.7849, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,180 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:35,180 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=7299e27ed73d2ad986de7f7c77d919fa in aggregated_behavior_data_with_scores
2025-05-22 02:46:35,181 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:35,183 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                             seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                                   categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
1412  7299e27ed73d2ad986de7f7c77d919fa   98.885094  148.935573    371       5.99     1500.0     19.280997    10.805647  [consoles_games, brinquedos, bebes, utilidades_domesticas, esporte_lazer, eletroportateis, alimentos, cool_stuff, automotivo, artes, relogios_presentes, moveis_decoracao, cama_mesa_banho]              13          1.506148         250.417362                0.194984                 13             0.03504              0.791985         0.50099                          0.217125                                   0.784855
2025-05-22 02:46:35,184 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}]
2025-05-22 02:46:35,185 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,185 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.7848545894928308, "explanation": {"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}}]
2025-05-22 02:46:35,185 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 18924, order_id: a56073f17e070c784c5eb0d85da530f5, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,185 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,186 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-14 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,187 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-14 00:00:00
2025-05-22 02:46:35,195 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
599 2018-08-14          315     44682.42  128.397759             228               315               2018-08-14  37562.228571         1.189557           0.989198                                1.0                       0.978396    2018-08-14
2025-05-22 02:46:35,197 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-14 00:00:00", "current_value": 44682.42, "expected_value": 26189.295057471263, "absolute_deviation": 18493.124942528735, "relative_deviation": 0.7061329792171336, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-14 00:00:00 значение total_sales (44682.42) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}]
2025-05-22 02:46:35,198 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,198 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-14 00:00:00", "current_value": 44682.42, "expected_value": 26189.295057471263, "absolute_deviation": 18493.124942528735, "relative_deviation": 0.7061329792171336, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-14 00:00:00 значение total_sales (44682.42) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}]
2025-05-22 02:46:35,199 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 18924, order_id: a56073f17e070c784c5eb0d85da530f5, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9784, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,199 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,200 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-14 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,224 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-14 00:00:00
2025-05-22 02:46:35,229 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
599 2018-08-14          315     44682.42  128.397759             228               315               2018-08-14  37562.228571         1.189557           0.989198                                1.0                       0.978396    2018-08-14
2025-05-22 02:46:35,236 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-14 00:00:00", "current_value": 44682.42, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40986.41428571429, "deviation_in_std": 10.093320240405061, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (44682.42) отклоняется от базовой линии (3696.01) на 40986.41, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,236 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,237 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-14 00:00:00", "current_value": 44682.42, "expected_value": 26189.295057471263, "absolute_deviation": 18493.124942528735, "relative_deviation": 0.7061329792171336, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-14 00:00:00 значение total_sales (44682.42) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9783962277530719, "explanation": {"detector_specific_info": {"date": "2018-08-14 00:00:00", "current_value": 44682.42, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40986.41428571429, "deviation_in_std": 10.093320240405061, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (44682.42) отклоняется от базовой линии (3696.01) на 40986.41, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,237 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 19608, order_id: 1a4868eff22fe0b0291f69c37cd178be, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.8710, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,237 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,238 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-13 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,239 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-13 00:00:00
2025-05-22 02:46:35,241 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
598 2018-08-13          288     39062.43  119.092774             211               288               2018-08-13  38405.954286         1.017093           0.922974                           0.870962                       0.974986    2018-08-13
2025-05-22 02:46:35,242 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-13 00:00:00", "current_value": 39062.43, "expected_value": 25862.10588888889, "absolute_deviation": 13200.32411111111, "relative_deviation": 0.5104118035794738, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-13 00:00:00 значение total_sales (39062.43) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}]
2025-05-22 02:46:35,242 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,242 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8709622454242683, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-13 00:00:00", "current_value": 39062.43, "expected_value": 25862.10588888889, "absolute_deviation": 13200.32411111111, "relative_deviation": 0.5104118035794738, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-13 00:00:00 значение total_sales (39062.43) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}]
2025-05-22 02:46:35,243 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 19608, order_id: 1a4868eff22fe0b0291f69c37cd178be, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9750, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,243 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,243 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-13 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,245 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-13 00:00:00
2025-05-22 02:46:35,248 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
598 2018-08-13          288     39062.43  119.092774             211               288               2018-08-13  38405.954286         1.017093           0.922974                           0.870962                       0.974986    2018-08-13
2025-05-22 02:46:35,248 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-13 00:00:00", "current_value": 39062.43, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 35366.42428571429, "deviation_in_std": 8.709340699710154, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (39062.43) отклоняется от базовой линии (3696.01) на 35366.42, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,249 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,249 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8709622454242683, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-13 00:00:00", "current_value": 39062.43, "expected_value": 25862.10588888889, "absolute_deviation": 13200.32411111111, "relative_deviation": 0.5104118035794738, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-13 00:00:00 значение total_sales (39062.43) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.97498574561089, "explanation": {"detector_specific_info": {"date": "2018-08-13 00:00:00", "current_value": 39062.43, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 35366.42428571429, "deviation_in_std": 8.709340699710154, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (39062.43) отклоняется от базовой линии (3696.01) на 35366.42, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,249 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 20156, order_id: f256f9e290a782032234f9bb030d2fb3, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.2171, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:35,250 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 20156, order_id: f256f9e290a782032234f9bb030d2fb3, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.7849, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,250 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:35,250 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=7299e27ed73d2ad986de7f7c77d919fa in aggregated_behavior_data_with_scores
2025-05-22 02:46:35,251 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:35,254 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                             seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                                   categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
1412  7299e27ed73d2ad986de7f7c77d919fa   98.885094  148.935573    371       5.99     1500.0     19.280997    10.805647  [consoles_games, brinquedos, bebes, utilidades_domesticas, esporte_lazer, eletroportateis, alimentos, cool_stuff, automotivo, artes, relogios_presentes, moveis_decoracao, cama_mesa_banho]              13          1.506148         250.417362                0.194984                 13             0.03504              0.791985         0.50099                          0.217125                                   0.784855
2025-05-22 02:46:35,255 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}]
2025-05-22 02:46:35,255 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,255 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.7848545894928308, "explanation": {"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}}]
2025-05-22 02:46:35,256 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 20156, order_id: f256f9e290a782032234f9bb030d2fb3, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.9816, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,256 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,256 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-01 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,257 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-01 00:00:00
2025-05-22 02:46:35,260 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
525 2018-06-01          184     32683.41  151.312083             140               184               2018-06-01  22878.174286         1.428585           0.892482                           0.981565                       0.803399    2018-06-01
2025-05-22 02:46:35,262 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-01 00:00:00", "current_value": 32683.41, "expected_value": 23364.508863636365, "absolute_deviation": 9318.901136363635, "relative_deviation": 0.3988485780185698, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-01 00:00:00 значение total_sales (32683.41) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}]
2025-05-22 02:46:35,263 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,264 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9815648028904507, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-01 00:00:00", "current_value": 32683.41, "expected_value": 23364.508863636365, "absolute_deviation": 9318.901136363635, "relative_deviation": 0.3988485780185698, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-01 00:00:00 значение total_sales (32683.41) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}]
2025-05-22 02:46:35,265 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 20156, order_id: f256f9e290a782032234f9bb030d2fb3, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.8034, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,265 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,268 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-01 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,269 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-01 00:00:00
2025-05-22 02:46:35,271 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
525 2018-06-01          184     32683.41  151.312083             140               184               2018-06-01  22878.174286         1.428585           0.892482                           0.981565                       0.803399    2018-06-01
2025-05-22 02:46:35,272 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-06-01 00:00:00", "current_value": 32683.41, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 28987.404285714285, "deviation_in_std": 7.138442322723072, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (32683.41) отклоняется от базовой линии (3696.01) на 28987.40, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,272 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,272 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9815648028904507, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-01 00:00:00", "current_value": 32683.41, "expected_value": 23364.508863636365, "absolute_deviation": 9318.901136363635, "relative_deviation": 0.3988485780185698, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-01 00:00:00 значение total_sales (32683.41) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.8033989187962487, "explanation": {"detector_specific_info": {"date": "2018-06-01 00:00:00", "current_value": 32683.41, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 28987.404285714285, "deviation_in_std": 7.138442322723072, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (32683.41) отклоняется от базовой линии (3696.01) на 28987.40, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,272 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 20313, order_id: e7541d63acc69eb0bffae073a401b6ea, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1769, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:35,272 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 20313, order_id: e7541d63acc69eb0bffae073a401b6ea, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9184, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,273 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:35,273 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=36a968b544695394e4e9d7572688598f in aggregated_behavior_data_with_scores
2025-05-22 02:46:35,274 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:35,277 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                        categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
642  36a968b544695394e4e9d7572688598f   56.522384  136.831171    172        3.9     1140.9     13.350814      5.53097  [informatica_acessorios, beleza_saude, telefonia, automotivo, tablets_impressao_imagem, instrumentos_musicais, ferramentas_jardim, cool_stuff, consoles_games, moveis_decoracao]              10          2.420832         292.538462                0.236204                 10             0.05814              0.719612        0.547647                          0.176931                                   0.918363
2025-05-22 02:46:35,278 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}]
2025-05-22 02:46:35,278 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,278 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.918363395536566, "explanation": {"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}}]
2025-05-22 02:46:35,278 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 20313, order_id: e7541d63acc69eb0bffae073a401b6ea, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,278 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,279 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-07 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,279 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-07 00:00:00
2025-05-22 02:46:35,283 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
531 2018-06-07          223     39149.92  143.933529             161               223               2018-06-07  31433.825714         1.245471           0.908572                                1.0                       0.817143    2018-06-07
2025-05-22 02:46:35,284 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-07 00:00:00", "current_value": 39149.92, "expected_value": 24263.594318181815, "absolute_deviation": 14886.325681818184, "relative_deviation": 0.6135251639392595, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-07 00:00:00 значение total_sales (39149.92) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}]
2025-05-22 02:46:35,284 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,284 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-07 00:00:00", "current_value": 39149.92, "expected_value": 24263.594318181815, "absolute_deviation": 14886.325681818184, "relative_deviation": 0.6135251639392595, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-07 00:00:00 значение total_sales (39149.92) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}]
2025-05-22 02:46:35,284 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 20313, order_id: e7541d63acc69eb0bffae073a401b6ea, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.8171, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,285 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,285 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-07 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,286 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-07 00:00:00
2025-05-22 02:46:35,288 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
531 2018-06-07          223     39149.92  143.933529             161               223               2018-06-07  31433.825714         1.245471           0.908572                                1.0                       0.817143    2018-06-07
2025-05-22 02:46:35,289 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-06-07 00:00:00", "current_value": 39149.92, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 35453.91428571429, "deviation_in_std": 8.730885999615563, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (39149.92) отклоняется от базовой линии (3696.01) на 35453.91, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,289 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,289 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-07 00:00:00", "current_value": 39149.92, "expected_value": 24263.594318181815, "absolute_deviation": 14886.325681818184, "relative_deviation": 0.6135251639392595, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-07 00:00:00 значение total_sales (39149.92) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.8171433354173214, "explanation": {"detector_specific_info": {"date": "2018-06-07 00:00:00", "current_value": 39149.92, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 35453.91428571429, "deviation_in_std": 8.730885999615563, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (39149.92) отклоняется от базовой линии (3696.01) на 35453.91, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,290 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 20697, order_id: 028558cddca332b40b4ac4cb77407edf, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,290 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,290 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2017-06-26 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,291 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2017-06-26 00:00:00
2025-05-22 02:46:35,293 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
185 2017-06-26           72     13648.45  156.878736              64                72               2017-06-26      11489.56           1.1879           0.562801                                1.0                       0.125603    2017-06-26
2025-05-22 02:46:35,293 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2017-06-26 00:00:00", "current_value": 13648.45, "expected_value": 25862.10588888889, "absolute_deviation": -12213.65588888889, "relative_deviation": -0.4722606867887054, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2017-06-26 00:00:00 значение total_sales (13648.45) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}]
2025-05-22 02:46:35,293 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,294 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2017-06-26 00:00:00", "current_value": 13648.45, "expected_value": 25862.10588888889, "absolute_deviation": -12213.65588888889, "relative_deviation": -0.4722606867887054, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2017-06-26 00:00:00 значение total_sales (13648.45) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}]
2025-05-22 02:46:35,294 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 20697, order_id: 028558cddca332b40b4ac4cb77407edf, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.1256, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:35,294 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 20779, order_id: cb9628da43a976b479b45230984a05b8, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,295 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,295 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-28 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,296 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-28 00:00:00
2025-05-22 02:46:35,298 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
613 2018-08-28           39      3757.51  79.947021              35                39               2018-08-28  10839.574286         0.346647                1.0                                1.0                            1.0    2018-08-28
2025-05-22 02:46:35,299 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-28 00:00:00", "current_value": 3757.51, "expected_value": 26189.295057471263, "absolute_deviation": -22431.785057471265, "relative_deviation": -0.8565249659544365, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-28 00:00:00 значение total_sales (3757.51) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}]
2025-05-22 02:46:35,299 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,299 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-28 00:00:00", "current_value": 3757.51, "expected_value": 26189.295057471263, "absolute_deviation": -22431.785057471265, "relative_deviation": -0.8565249659544365, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-28 00:00:00 значение total_sales (3757.51) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}]
2025-05-22 02:46:35,299 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 20779, order_id: cb9628da43a976b479b45230984a05b8, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,299 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,300 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-28 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,301 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-28 00:00:00
2025-05-22 02:46:35,303 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
613 2018-08-28           39      3757.51  79.947021              35                39               2018-08-28  10839.574286         0.346647                1.0                                1.0                            1.0    2018-08-28
2025-05-22 02:46:35,304 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-28 00:00:00", "current_value": 3757.51, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 61.50428571428574, "deviation_in_std": 0.015146054191132996, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (3757.51) отклоняется от базовой линии (3696.01) на 61.50, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,304 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,304 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-28 00:00:00", "current_value": 3757.51, "expected_value": 26189.295057471263, "absolute_deviation": -22431.785057471265, "relative_deviation": -0.8565249659544365, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-28 00:00:00 значение total_sales (3757.51) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 1.0, "explanation": {"detector_specific_info": {"date": "2018-08-28 00:00:00", "current_value": 3757.51, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 61.50428571428574, "deviation_in_std": 0.015146054191132996, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (3757.51) отклоняется от базовой линии (3696.01) на 61.50, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,305 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 21734, order_id: cb53f0b6e8f9082a9f5a113765dd1236, level: transaction): Detector Column: 'trans_transaction_vae_price_score', Score: 0.0008, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:35,305 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 21734, order_id: cb53f0b6e8f9082a9f5a113765dd1236, level: transaction): Detector Column: 'trans_category_price_outlier_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,305 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'category_price_outlier_model': CategoryPriceOutlierDetector
2025-05-22 02:46:35,312 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for transaction detector 'category_price_outlier_model':
       order_item_id                          order_id                        product_id                         seller_id  price  freight_value order_purchase_timestamp                       customer_id          product_category_name  product_name_lenght  product_description_lenght  product_photos_qty  product_weight_g  product_length_cm  product_height_cm  product_width_cm product_category_name_english customer_state seller_state payment_type  payment_installments  payment_value  review_score  price_deviation_from_category_mean  freight_to_price_ratio  transaction_level_score  transaction_is_anomaly  trans_transaction_vae_price_score  trans_category_price_outlier_model_score  behavior_level_score  behavior_is_anomaly  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score  time_series_level_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score  time_series_is_anomaly  multilevel_score  is_anomaly detailed_explanations_json
21734              1  cb53f0b6e8f9082a9f5a113765dd1236  8cfc3506cedc0626364457d254429118  dbb9b48c841a0e39e21f98e1a6b2ec3e  89.99           7.49      2018-06-03 22:34:58  035c08a68b237ef4afc82109e61a7380  fashion_roupa_infanto_juvenil                 47.0                       327.0                 3.0             300.0               30.0               20.0              20.0     fashion_childrens_clothes             SP           SP  credit_card                   6.0          97.48           5.0                             1.26335                0.083231                 0.500379                    True                           0.000757                                       1.0              0.114793                False                          0.175094                                   0.054492                 0.903771                                1.0                       0.807541                    True          0.505721        True                       None
2025-05-22 02:46:35,312 - backend.ml_service.multilevel_detector - DEBUG - Explanation from transaction detector 'category_price_outlier_model': [{"detector_specific_info": {"category": "fashion_roupa_infanto_juvenil", "price": 89.99, "explanation": "Категория 'fashion_roupa_infanto_juvenil' не встречалась в обучающих данных, статистики отсутствуют."}}]
2025-05-22 02:46:35,313 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'category_price_outlier_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,313 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for transaction_level: [{"detector_name": "category_price_outlier_model", "detector_type": "CategoryPriceOutlierDetector", "score": 1.0, "explanation": {"detector_specific_info": {"category": "fashion_roupa_infanto_juvenil", "price": 89.99, "explanation": "Категория 'fashion_roupa_infanto_juvenil' не встречалась в обучающих данных, статистики отсутствуют."}}}]
2025-05-22 02:46:35,313 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 21734, order_id: cb53f0b6e8f9082a9f5a113765dd1236, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,313 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,313 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-03 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,314 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-03 00:00:00
2025-05-22 02:46:35,316 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
527 2018-06-03          191      31535.8  137.112174             149               191               2018-06-03  27063.432857         1.165255           0.903771                                1.0                       0.807541    2018-06-03
2025-05-22 02:46:35,317 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-03 00:00:00", "current_value": 31535.8, "expected_value": 18683.428202247193, "absolute_deviation": 12852.371797752807, "relative_deviation": 0.6879022232229821, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-03 00:00:00 значение total_sales (31535.80) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}]
2025-05-22 02:46:35,317 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,318 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-03 00:00:00", "current_value": 31535.8, "expected_value": 18683.428202247193, "absolute_deviation": 12852.371797752807, "relative_deviation": 0.6879022232229821, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-03 00:00:00 значение total_sales (31535.80) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}]
2025-05-22 02:46:35,318 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 21734, order_id: cb53f0b6e8f9082a9f5a113765dd1236, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.8075, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,318 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,319 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-03 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,320 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-03 00:00:00
2025-05-22 02:46:35,322 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
527 2018-06-03          191      31535.8  137.112174             149               191               2018-06-03  27063.432857         1.165255           0.903771                                1.0                       0.807541    2018-06-03
2025-05-22 02:46:35,323 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-06-03 00:00:00", "current_value": 31535.8, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 27839.794285714284, "deviation_in_std": 6.855831720089102, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (31535.80) отклоняется от базовой линии (3696.01) на 27839.79, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,323 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,323 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-03 00:00:00", "current_value": 31535.8, "expected_value": 18683.428202247193, "absolute_deviation": 12852.371797752807, "relative_deviation": 0.6879022232229821, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-03 00:00:00 значение total_sales (31535.80) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.8075414451585549, "explanation": {"detector_specific_info": {"date": "2018-06-03 00:00:00", "current_value": 31535.8, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 27839.794285714284, "deviation_in_std": 6.855831720089102, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (31535.80) отклоняется от базовой линии (3696.01) на 27839.79, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,324 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 23108, order_id: 68101694e5c5dc7330c91e1bbc36214f, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.3645, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,324 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,324 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-03-29 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,326 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-03-29 00:00:00
2025-05-22 02:46:35,328 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
461 2018-03-29          194     29581.19  125.344025             129               194               2018-03-29  31776.792857         0.930905           0.504515                           0.364516                       0.644514    2018-03-29
2025-05-22 02:46:35,328 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-03-29 00:00:00", "current_value": 29581.19, "expected_value": 24263.594318181815, "absolute_deviation": 5317.595681818184, "relative_deviation": 0.21915943747186162, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-03-29 00:00:00 значение total_sales (29581.19) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}]
2025-05-22 02:46:35,329 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,329 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.36451582612502154, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-03-29 00:00:00", "current_value": 29581.19, "expected_value": 24263.594318181815, "absolute_deviation": 5317.595681818184, "relative_deviation": 0.21915943747186162, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-03-29 00:00:00 значение total_sales (29581.19) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}]
2025-05-22 02:46:35,329 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 23108, order_id: 68101694e5c5dc7330c91e1bbc36214f, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.6445, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,329 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,330 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-03-29 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,331 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-03-29 00:00:00
2025-05-22 02:46:35,333 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
461 2018-03-29          194     29581.19  125.344025             129               194               2018-03-29  31776.792857         0.930905           0.504515                           0.364516                       0.644514    2018-03-29
2025-05-22 02:46:35,333 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-03-29 00:00:00", "current_value": 29581.19, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 25885.184285714284, "deviation_in_std": 6.374489182106353, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (29581.19) отклоняется от базовой линии (3696.01) на 25885.18, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,333 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,334 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.36451582612502154, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-03-29 00:00:00", "current_value": 29581.19, "expected_value": 24263.594318181815, "absolute_deviation": 5317.595681818184, "relative_deviation": 0.21915943747186162, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-03-29 00:00:00 значение total_sales (29581.19) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.6445135023121862, "explanation": {"detector_specific_info": {"date": "2018-03-29 00:00:00", "current_value": 29581.19, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 25885.184285714284, "deviation_in_std": 6.374489182106353, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (29581.19) отклоняется от базовой линии (3696.01) на 25885.18, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,334 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 23565, order_id: cd09c24e7f20280427dd7bf69a9d21db, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,334 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,334 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-14 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,335 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-14 00:00:00
2025-05-22 02:46:35,338 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
599 2018-08-14          315     44682.42  128.397759             228               315               2018-08-14  37562.228571         1.189557           0.989198                                1.0                       0.978396    2018-08-14
2025-05-22 02:46:35,339 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-14 00:00:00", "current_value": 44682.42, "expected_value": 26189.295057471263, "absolute_deviation": 18493.124942528735, "relative_deviation": 0.7061329792171336, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-14 00:00:00 значение total_sales (44682.42) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}]
2025-05-22 02:46:35,339 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,339 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-14 00:00:00", "current_value": 44682.42, "expected_value": 26189.295057471263, "absolute_deviation": 18493.124942528735, "relative_deviation": 0.7061329792171336, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-14 00:00:00 значение total_sales (44682.42) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}]
2025-05-22 02:46:35,339 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 23565, order_id: cd09c24e7f20280427dd7bf69a9d21db, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9784, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,340 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,340 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-14 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,341 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-14 00:00:00
2025-05-22 02:46:35,343 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
599 2018-08-14          315     44682.42  128.397759             228               315               2018-08-14  37562.228571         1.189557           0.989198                                1.0                       0.978396    2018-08-14
2025-05-22 02:46:35,343 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-14 00:00:00", "current_value": 44682.42, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40986.41428571429, "deviation_in_std": 10.093320240405061, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (44682.42) отклоняется от базовой линии (3696.01) на 40986.41, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,344 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,344 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-14 00:00:00", "current_value": 44682.42, "expected_value": 26189.295057471263, "absolute_deviation": 18493.124942528735, "relative_deviation": 0.7061329792171336, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-14 00:00:00 значение total_sales (44682.42) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9783962277530719, "explanation": {"detector_specific_info": {"date": "2018-08-14 00:00:00", "current_value": 44682.42, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40986.41428571429, "deviation_in_std": 10.093320240405061, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (44682.42) отклоняется от базовой линии (3696.01) на 40986.41, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,345 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 24126, order_id: cff46468993417e62aaa9555e5b06195, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,345 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,368 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-16 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,375 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-16 00:00:00
2025-05-22 02:46:35,390 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
509 2018-05-16          357     57748.21  137.495738             236               357               2018-05-16  45499.475714         1.269206           0.888337                                1.0                       0.776673    2018-05-16
2025-05-22 02:46:35,398 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-16 00:00:00", "current_value": 57748.21, "expected_value": 25669.474712643678, "absolute_deviation": 32078.73528735632, "relative_deviation": 1.249684134422732, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-16 00:00:00 значение total_sales (57748.21) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}]
2025-05-22 02:46:35,399 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,409 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-16 00:00:00", "current_value": 57748.21, "expected_value": 25669.474712643678, "absolute_deviation": 32078.73528735632, "relative_deviation": 1.249684134422732, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-16 00:00:00 значение total_sales (57748.21) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}]
2025-05-22 02:46:35,413 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 24126, order_id: cff46468993417e62aaa9555e5b06195, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.7767, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,414 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,414 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-16 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,415 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-16 00:00:00
2025-05-22 02:46:35,418 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
509 2018-05-16          357     57748.21  137.495738             236               357               2018-05-16  45499.475714         1.269206           0.888337                                1.0                       0.776673    2018-05-16
2025-05-22 02:46:35,419 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-05-16 00:00:00", "current_value": 57748.21, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 54052.20428571429, "deviation_in_std": 13.31090355336756, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (57748.21) отклоняется от базовой линии (3696.01) на 54052.20, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,419 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,420 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-16 00:00:00", "current_value": 57748.21, "expected_value": 25669.474712643678, "absolute_deviation": 32078.73528735632, "relative_deviation": 1.249684134422732, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-16 00:00:00 значение total_sales (57748.21) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.7766733026415072, "explanation": {"detector_specific_info": {"date": "2018-05-16 00:00:00", "current_value": 57748.21, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 54052.20428571429, "deviation_in_std": 13.31090355336756, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (57748.21) отклоняется от базовой линии (3696.01) на 54052.20, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,420 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 25106, order_id: bc3ac768a8963f4ca68942ea6558fc9f, level: transaction): Detector Column: 'trans_transaction_vae_price_score', Score: 0.0020, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:35,421 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 25106, order_id: bc3ac768a8963f4ca68942ea6558fc9f, level: transaction): Detector Column: 'trans_category_price_outlier_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,421 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'category_price_outlier_model': CategoryPriceOutlierDetector
2025-05-22 02:46:35,427 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for transaction detector 'category_price_outlier_model':
       order_item_id                          order_id                        product_id                         seller_id  price  freight_value order_purchase_timestamp                       customer_id          product_category_name  product_name_lenght  product_description_lenght  product_photos_qty  product_weight_g  product_length_cm  product_height_cm  product_width_cm product_category_name_english customer_state seller_state payment_type  payment_installments  payment_value  review_score  price_deviation_from_category_mean  freight_to_price_ratio  transaction_level_score  transaction_is_anomaly  trans_transaction_vae_price_score  trans_category_price_outlier_model_score  behavior_level_score  behavior_is_anomaly  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score  time_series_level_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score  time_series_is_anomaly  multilevel_score  is_anomaly detailed_explanations_json
25106              1  bc3ac768a8963f4ca68942ea6558fc9f  57bdf3098169cccdb62221bd3e089cbd  d98eec89afa3380e14463da2aabaea72  39.99           6.43      2018-03-21 09:40:36  7968f8e8d5429c6a0611671f5a52ed2b  fashion_roupa_infanto_juvenil                 38.0                       168.0                 1.0             100.0               16.0               16.0              16.0     fashion_childrens_clothes             SC           RS       boleto                   1.0         106.43           5.0                            0.561411                 0.16079                 0.500985                    True                           0.001971                                       1.0                0.1355                False                          0.192405                                   0.078594                 0.810575                           0.995318                       0.625833                    True          0.484217        True                       None
2025-05-22 02:46:35,428 - backend.ml_service.multilevel_detector - DEBUG - Explanation from transaction detector 'category_price_outlier_model': [{"detector_specific_info": {"category": "fashion_roupa_infanto_juvenil", "price": 39.99, "explanation": "Категория 'fashion_roupa_infanto_juvenil' не встречалась в обучающих данных, статистики отсутствуют."}}]
2025-05-22 02:46:35,435 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'category_price_outlier_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,438 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for transaction_level: [{"detector_name": "category_price_outlier_model", "detector_type": "CategoryPriceOutlierDetector", "score": 1.0, "explanation": {"detector_specific_info": {"category": "fashion_roupa_infanto_juvenil", "price": 39.99, "explanation": "Категория 'fashion_roupa_infanto_juvenil' не встречалась в обучающих данных, статистики отсутствуют."}}}]
2025-05-22 02:46:35,443 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 25106, order_id: bc3ac768a8963f4ca68942ea6558fc9f, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.9953, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,443 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,443 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-03-21 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,444 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-03-21 00:00:00
2025-05-22 02:46:35,446 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
453 2018-03-21          285     42125.89  126.885211             188               285               2018-03-21  37613.352857         1.119972           0.810575                           0.995318                       0.625833    2018-03-21
2025-05-22 02:46:35,447 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-03-21 00:00:00", "current_value": 42125.89, "expected_value": 25669.474712643678, "absolute_deviation": 16456.41528735632, "relative_deviation": 0.6410888992305948, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-03-21 00:00:00 значение total_sales (42125.89) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}]
2025-05-22 02:46:35,447 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,447 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.99531778455973, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-03-21 00:00:00", "current_value": 42125.89, "expected_value": 25669.474712643678, "absolute_deviation": 16456.41528735632, "relative_deviation": 0.6410888992305948, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-03-21 00:00:00 значение total_sales (42125.89) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}]
2025-05-22 02:46:35,448 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 25106, order_id: bc3ac768a8963f4ca68942ea6558fc9f, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.6258, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,448 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,448 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-03-21 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,449 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-03-21 00:00:00
2025-05-22 02:46:35,451 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
453 2018-03-21          285     42125.89  126.885211             188               285               2018-03-21  37613.352857         1.119972           0.810575                           0.995318                       0.625833    2018-03-21
2025-05-22 02:46:35,451 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-03-21 00:00:00", "current_value": 42125.89, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 38429.88428571429, "deviation_in_std": 9.463748797186701, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (42125.89) отклоняется от базовой линии (3696.01) на 38429.88, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,452 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,452 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.99531778455973, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-03-21 00:00:00", "current_value": 42125.89, "expected_value": 25669.474712643678, "absolute_deviation": 16456.41528735632, "relative_deviation": 0.6410888992305948, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-03-21 00:00:00 значение total_sales (42125.89) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.625832733657226, "explanation": {"detector_specific_info": {"date": "2018-03-21 00:00:00", "current_value": 42125.89, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 38429.88428571429, "deviation_in_std": 9.463748797186701, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (42125.89) отклоняется от базовой линии (3696.01) на 38429.88, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,452 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 25306, order_id: 4233067932385b2d8b301e18e1b75958, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.2171, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:35,452 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 25306, order_id: 4233067932385b2d8b301e18e1b75958, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.7849, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,452 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:35,453 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=7299e27ed73d2ad986de7f7c77d919fa in aggregated_behavior_data_with_scores
2025-05-22 02:46:35,453 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:35,456 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                             seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                                   categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
1412  7299e27ed73d2ad986de7f7c77d919fa   98.885094  148.935573    371       5.99     1500.0     19.280997    10.805647  [consoles_games, brinquedos, bebes, utilidades_domesticas, esporte_lazer, eletroportateis, alimentos, cool_stuff, automotivo, artes, relogios_presentes, moveis_decoracao, cama_mesa_banho]              13          1.506148         250.417362                0.194984                 13             0.03504              0.791985         0.50099                          0.217125                                   0.784855
2025-05-22 02:46:35,457 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}]
2025-05-22 02:46:35,457 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,457 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.7848545894928308, "explanation": {"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}}]
2025-05-22 02:46:35,458 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 25306, order_id: 4233067932385b2d8b301e18e1b75958, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,458 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,458 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-18 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,459 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-18 00:00:00
2025-05-22 02:46:35,460 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
572 2018-07-18          305     45731.01  125.980744             203               305               2018-07-18  31945.457143         1.431534           0.950417                                1.0                       0.900833    2018-07-18
2025-05-22 02:46:35,461 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-18 00:00:00", "current_value": 45731.01, "expected_value": 25669.474712643678, "absolute_deviation": 20061.535287356324, "relative_deviation": 0.7815327548356443, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-18 00:00:00 значение total_sales (45731.01) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}]
2025-05-22 02:46:35,461 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,462 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-18 00:00:00", "current_value": 45731.01, "expected_value": 25669.474712643678, "absolute_deviation": 20061.535287356324, "relative_deviation": 0.7815327548356443, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-18 00:00:00 значение total_sales (45731.01) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}]
2025-05-22 02:46:35,462 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 25306, order_id: 4233067932385b2d8b301e18e1b75958, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9008, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,462 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,462 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-18 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,463 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-18 00:00:00
2025-05-22 02:46:35,465 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
572 2018-07-18          305     45731.01  125.980744             203               305               2018-07-18  31945.457143         1.431534           0.950417                                1.0                       0.900833    2018-07-18
2025-05-22 02:46:35,466 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-07-18 00:00:00", "current_value": 45731.01, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 42035.00428571429, "deviation_in_std": 10.35154616368558, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (45731.01) отклоняется от базовой линии (3696.01) на 42035.00, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,466 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,466 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-18 00:00:00", "current_value": 45731.01, "expected_value": 25669.474712643678, "absolute_deviation": 20061.535287356324, "relative_deviation": 0.7815327548356443, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-18 00:00:00 значение total_sales (45731.01) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9008333735128977, "explanation": {"detector_specific_info": {"date": "2018-07-18 00:00:00", "current_value": 45731.01, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 42035.00428571429, "deviation_in_std": 10.35154616368558, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (45731.01) отклоняется от базовой линии (3696.01) на 42035.00, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,467 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 25487, order_id: 5e4460100810dd86bd828963e7719858, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.7785, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,467 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,468 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-08 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,469 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-08 00:00:00
2025-05-22 02:46:35,471 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
593 2018-08-08          315     43706.47  119.743753             215               315               2018-08-08  44012.448571         0.993048           0.870271                           0.778542                       0.961999    2018-08-08
2025-05-22 02:46:35,471 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-08 00:00:00", "current_value": 43706.47, "expected_value": 25669.474712643678, "absolute_deviation": 18036.995287356323, "relative_deviation": 0.7026632016927123, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-08 00:00:00 значение total_sales (43706.47) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}]
2025-05-22 02:46:35,471 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,472 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7785418521924519, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-08 00:00:00", "current_value": 43706.47, "expected_value": 25669.474712643678, "absolute_deviation": 18036.995287356323, "relative_deviation": 0.7026632016927123, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-08 00:00:00 значение total_sales (43706.47) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}]
2025-05-22 02:46:35,472 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 25487, order_id: 5e4460100810dd86bd828963e7719858, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9620, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,472 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,472 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-08 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,473 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-08 00:00:00
2025-05-22 02:46:35,475 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
593 2018-08-08          315     43706.47  119.743753             215               315               2018-08-08  44012.448571         0.993048           0.870271                           0.778542                       0.961999    2018-08-08
2025-05-22 02:46:35,476 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-08 00:00:00", "current_value": 43706.47, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40010.46428571429, "deviation_in_std": 9.852982653907365, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (43706.47) отклоняется от базовой линии (3696.01) на 40010.46, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,477 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,477 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7785418521924519, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-08 00:00:00", "current_value": 43706.47, "expected_value": 25669.474712643678, "absolute_deviation": 18036.995287356323, "relative_deviation": 0.7026632016927123, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-08 00:00:00 значение total_sales (43706.47) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9619994271129765, "explanation": {"detector_specific_info": {"date": "2018-08-08 00:00:00", "current_value": 43706.47, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40010.46428571429, "deviation_in_std": 9.852982653907365, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (43706.47) отклоняется от базовой линии (3696.01) на 40010.46, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,477 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 26323, order_id: 0812eb902a67711a1cb742b3cdaa65ae, level: transaction): Detector Column: 'trans_transaction_vae_price_score', Score: 0.9067, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,478 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'transaction_vae_price': TransactionVAEDetector
2025-05-22 02:46:35,485 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for transaction detector 'transaction_vae_price':
       order_item_id                          order_id                        product_id                         seller_id   price  freight_value order_purchase_timestamp                       customer_id  product_category_name  product_name_lenght  product_description_lenght  product_photos_qty  product_weight_g  product_length_cm  product_height_cm  product_width_cm product_category_name_english customer_state seller_state payment_type  payment_installments  payment_value  review_score  price_deviation_from_category_mean  freight_to_price_ratio  transaction_level_score  transaction_is_anomaly  trans_transaction_vae_price_score  trans_category_price_outlier_model_score  behavior_level_score  behavior_is_anomaly  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score  time_series_level_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score  time_series_is_anomaly  multilevel_score  is_anomaly detailed_explanations_json
26323              1  0812eb902a67711a1cb742b3cdaa65ae  489ae2aa008f021502940f251d4cce7f  e3b4998c7a498169dc7bce44e6bb6277  6735.0         194.31      2017-02-12 20:37:36  c6e2731c5b391845f6800c97401a43a9  utilidades_domesticas                 31.0                       875.0                 2.0           30000.0               60.0               61.0              33.0                    housewares             MS           SP  credit_card                   8.0        6929.31           5.0                           74.309637                0.028851                 0.953328                    True                           0.906656                                       1.0              0.398596                False                           0.15721                                   0.639983                 0.189451                           0.367431                        0.01147                   False          0.557745        True                       None
2025-05-22 02:46:35,486 - backend.ml_service.detector - DEBUG - (transaction_vae_price) Метод get_explanation_details не реализован специфично, будет использована реализация get_shap_explanations (если есть).
2025-05-22 02:46:35,488 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) [Detect_Preprocess] Scaler type: <class 'sklearn.preprocessing._data.StandardScaler'>
2025-05-22 02:46:35,488 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) [Detect_Preprocess] Scaler has mean_: True
2025-05-22 02:46:35,488 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) [Detect_Preprocess] Scaler mean_ shape: (4,)
2025-05-22 02:46:35,488 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) [Detect_Preprocess] Scaler params: {'copy': True, 'with_mean': True, 'with_std': True}
2025-05-22 02:46:35,488 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) StandardScaler обучен (mean_ присутствует). Выполняется transform.
2025-05-22 02:46:35,489 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Вычисление SHAP values для 1 экземпляров...
2025-05-22 02:46:35,489 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Используется nsamples=50 для SHAP
2025-05-22 02:46:35,490 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) Запрос SHAP объяснений: explainer=True, background_data_exists=True, model=True
2025-05-22 02:46:35,490 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Создание GradientExplainer с размерами данных: torch.Size([50, 4])
2025-05-22 02:46:35,514 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) SHAP values raw type: <class 'numpy.ndarray'>
2025-05-22 02:46:35,515 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) SHAP values raw (ndarray) shape: (1, 4, 1)
2025-05-22 02:46:35,515 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) SHAP GradientExplainer успешно создан и вычислены SHAP-значения
2025-05-22 02:46:35,515 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) SHAP values_raw уже является ndarray, shape: (1, 4, 1)
2025-05-22 02:46:35,515 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) Начальная форма shap_values_arr: (1, 4, 1), ndim: 3
2025-05-22 02:46:35,516 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) SHAP values после squeeze(-1): (1, 4)
2025-05-22 02:46:35,516 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) SHAP values успешно вычислены для 1 экземпляров.
2025-05-22 02:46:35,517 - backend.ml_service.multilevel_detector - DEBUG - Explanation from transaction detector 'transaction_vae_price': [{"shap_values": {"price": 40.9224590330278, "freight_value": -2.24667528824146, "product_weight_g": 3.063392884529374, "freight_to_price_ratio": -0.48341294402987295}}]
2025-05-22 02:46:35,517 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'transaction_vae_price' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,518 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for transaction_level: [{"detector_name": "transaction_vae_price", "detector_type": "TransactionVAEDetector", "score": 0.9066562737216569, "explanation": {"shap_values": {"price": 40.9224590330278, "freight_value": -2.24667528824146, "product_weight_g": 3.063392884529374, "freight_to_price_ratio": -0.48341294402987295}}}]
2025-05-22 02:46:35,518 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 26323, order_id: 0812eb902a67711a1cb742b3cdaa65ae, level: transaction): Detector Column: 'trans_category_price_outlier_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,518 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'category_price_outlier_model': CategoryPriceOutlierDetector
2025-05-22 02:46:35,524 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for transaction detector 'category_price_outlier_model':
       order_item_id                          order_id                        product_id                         seller_id   price  freight_value order_purchase_timestamp                       customer_id  product_category_name  product_name_lenght  product_description_lenght  product_photos_qty  product_weight_g  product_length_cm  product_height_cm  product_width_cm product_category_name_english customer_state seller_state payment_type  payment_installments  payment_value  review_score  price_deviation_from_category_mean  freight_to_price_ratio  transaction_level_score  transaction_is_anomaly  trans_transaction_vae_price_score  trans_category_price_outlier_model_score  behavior_level_score  behavior_is_anomaly  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score  time_series_level_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score  time_series_is_anomaly  multilevel_score  is_anomaly detailed_explanations_json
26323              1  0812eb902a67711a1cb742b3cdaa65ae  489ae2aa008f021502940f251d4cce7f  e3b4998c7a498169dc7bce44e6bb6277  6735.0         194.31      2017-02-12 20:37:36  c6e2731c5b391845f6800c97401a43a9  utilidades_domesticas                 31.0                       875.0                 2.0           30000.0               60.0               61.0              33.0                    housewares             MS           SP  credit_card                   8.0        6929.31           5.0                           74.309637                0.028851                 0.953328                    True                           0.906656                                       1.0              0.398596                False                           0.15721                                   0.639983                 0.189451                           0.367431                        0.01147                   False          0.557745        True                       None
2025-05-22 02:46:35,525 - backend.ml_service.multilevel_detector - DEBUG - Explanation from transaction detector 'category_price_outlier_model': [{"detector_specific_info": {"category": "utilidades_domesticas", "price": 6735.0, "category_mean_price": 90.63427371273713, "category_std_price": 140.19371115720259, "category_min_price": 3.06, "category_max_price": 6735.0, "category_count": 7380, "z_score": 47.394178179909765, "threshold": 2.8, "explanation": "Цена 6735.00 отличается от средней цены в категории 'utilidades_domesticas' (90.63) на 47.39 стандартных отклонений (порог: 2.8)."}}]
2025-05-22 02:46:35,526 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'category_price_outlier_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,526 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for transaction_level: [{"detector_name": "transaction_vae_price", "detector_type": "TransactionVAEDetector", "score": 0.9066562737216569, "explanation": {"shap_values": {"price": 40.9224590330278, "freight_value": -2.24667528824146, "product_weight_g": 3.063392884529374, "freight_to_price_ratio": -0.48341294402987295}}}, {"detector_name": "category_price_outlier_model", "detector_type": "CategoryPriceOutlierDetector", "score": 1.0, "explanation": {"detector_specific_info": {"category": "utilidades_domesticas", "price": 6735.0, "category_mean_price": 90.63427371273713, "category_std_price": 140.19371115720259, "category_min_price": 3.06, "category_max_price": 6735.0, "category_count": 7380, "z_score": 47.394178179909765, "threshold": 2.8, "explanation": "Цена 6735.00 отличается от средней цены в категории 'utilidades_domesticas' (90.63) на 47.39 стандартных отклонений (порог: 2.8)."}}}]
2025-05-22 02:46:35,527 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 26758, order_id: 05259e30e40e08eddb05428cb38ff248, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1697, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:35,527 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 26758, order_id: 05259e30e40e08eddb05428cb38ff248, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9836, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,527 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:35,528 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=4a3ccda38b2129705f3fb522db62ca31 in aggregated_behavior_data_with_scores
2025-05-22 02:46:35,529 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:35,533 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                               categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
882  4a3ccda38b2129705f3fb522db62ca31  233.158916  370.889347     83        9.9     3099.9     18.396747     9.418922  [construcao_ferramentas_seguranca, casa_construcao, ferramentas_jardim, construcao_ferramentas_construcao, eletronicos]               5          1.590715         313.121212                0.078902                  5            0.060241               0.53771        0.576635                          0.169668                                   0.983603
2025-05-22 02:46:35,534 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}]
2025-05-22 02:46:35,534 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,534 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.9836033466098753, "explanation": {"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}}]
2025-05-22 02:46:35,534 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 26758, order_id: 05259e30e40e08eddb05428cb38ff248, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.7516, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,535 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,535 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-03-18 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,536 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-03-18 00:00:00
2025-05-22 02:46:35,539 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
450 2018-03-18          215      33300.6   133.2024             155               215               2018-03-18  32732.837143         1.017345           0.683862                           0.751568                       0.616155    2018-03-18
2025-05-22 02:46:35,540 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-03-18 00:00:00", "current_value": 33300.6, "expected_value": 18683.428202247193, "absolute_deviation": 14617.171797752806, "relative_deviation": 0.7823602627699071, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-03-18 00:00:00 значение total_sales (33300.60) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}]
2025-05-22 02:46:35,540 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,540 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7515683099706453, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-03-18 00:00:00", "current_value": 33300.6, "expected_value": 18683.428202247193, "absolute_deviation": 14617.171797752806, "relative_deviation": 0.7823602627699071, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-03-18 00:00:00 значение total_sales (33300.60) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}]
2025-05-22 02:46:35,541 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 26758, order_id: 05259e30e40e08eddb05428cb38ff248, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.6162, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,541 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,542 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-03-18 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,543 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-03-18 00:00:00
2025-05-22 02:46:35,546 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
450 2018-03-18          215      33300.6   133.2024             155               215               2018-03-18  32732.837143         1.017345           0.683862                           0.751568                       0.616155    2018-03-18
2025-05-22 02:46:35,546 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-03-18 00:00:00", "current_value": 33300.6, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 29604.594285714284, "deviation_in_std": 7.290431620341304, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (33300.60) отклоняется от базовой линии (3696.01) на 29604.59, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,547 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,547 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7515683099706453, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-03-18 00:00:00", "current_value": 33300.6, "expected_value": 18683.428202247193, "absolute_deviation": 14617.171797752806, "relative_deviation": 0.7823602627699071, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-03-18 00:00:00 значение total_sales (33300.60) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.616155421321266, "explanation": {"detector_specific_info": {"date": "2018-03-18 00:00:00", "current_value": 33300.6, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 29604.594285714284, "deviation_in_std": 7.290431620341304, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (33300.60) отклоняется от базовой линии (3696.01) на 29604.59, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,547 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 26796, order_id: 5eff8994dd7178d8d878ea3d8f8b195a, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.2171, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:35,548 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 26796, order_id: 5eff8994dd7178d8d878ea3d8f8b195a, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.7849, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,548 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:35,548 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=7299e27ed73d2ad986de7f7c77d919fa in aggregated_behavior_data_with_scores
2025-05-22 02:46:35,549 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:35,553 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                             seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                                   categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
1412  7299e27ed73d2ad986de7f7c77d919fa   98.885094  148.935573    371       5.99     1500.0     19.280997    10.805647  [consoles_games, brinquedos, bebes, utilidades_domesticas, esporte_lazer, eletroportateis, alimentos, cool_stuff, automotivo, artes, relogios_presentes, moveis_decoracao, cama_mesa_banho]              13          1.506148         250.417362                0.194984                 13             0.03504              0.791985         0.50099                          0.217125                                   0.784855
2025-05-22 02:46:35,554 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}]
2025-05-22 02:46:35,554 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,554 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.7848545894928308, "explanation": {"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}}]
2025-05-22 02:46:35,555 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 26796, order_id: 5eff8994dd7178d8d878ea3d8f8b195a, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,555 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,555 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-07 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,556 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-07 00:00:00
2025-05-22 02:46:35,559 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
500 2018-05-07          371     55022.97  128.258671             244               371               2018-05-07  39021.418571         1.410071           0.872583                                1.0                       0.745166    2018-05-07
2025-05-22 02:46:35,560 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-07 00:00:00", "current_value": 55022.97, "expected_value": 25862.10588888889, "absolute_deviation": 29160.86411111111, "relative_deviation": 1.1275518024864117, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-07 00:00:00 значение total_sales (55022.97) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}]
2025-05-22 02:46:35,561 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,561 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-07 00:00:00", "current_value": 55022.97, "expected_value": 25862.10588888889, "absolute_deviation": 29160.86411111111, "relative_deviation": 1.1275518024864117, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-07 00:00:00 значение total_sales (55022.97) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}]
2025-05-22 02:46:35,561 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 26796, order_id: 5eff8994dd7178d8d878ea3d8f8b195a, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.7452, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,561 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,562 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-07 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,563 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-07 00:00:00
2025-05-22 02:46:35,565 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
500 2018-05-07          371     55022.97  128.258671             244               371               2018-05-07  39021.418571         1.410071           0.872583                                1.0                       0.745166    2018-05-07
2025-05-22 02:46:35,566 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-05-07 00:00:00", "current_value": 55022.97, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 51326.96428571429, "deviation_in_std": 12.639785561434588, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (55022.97) отклоняется от базовой линии (3696.01) на 51326.96, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,567 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,567 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-07 00:00:00", "current_value": 55022.97, "expected_value": 25862.10588888889, "absolute_deviation": 29160.86411111111, "relative_deviation": 1.1275518024864117, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-07 00:00:00 значение total_sales (55022.97) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.7451657905183864, "explanation": {"detector_specific_info": {"date": "2018-05-07 00:00:00", "current_value": 55022.97, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 51326.96428571429, "deviation_in_std": 12.639785561434588, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (55022.97) отклоняется от базовой линии (3696.01) на 51326.96, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,567 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 27500, order_id: a8c02875c8391d968525088da5fce5a6, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.2171, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:35,568 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 27500, order_id: a8c02875c8391d968525088da5fce5a6, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.7849, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,568 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:35,568 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=7299e27ed73d2ad986de7f7c77d919fa in aggregated_behavior_data_with_scores
2025-05-22 02:46:35,569 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:35,571 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                             seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                                   categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
1412  7299e27ed73d2ad986de7f7c77d919fa   98.885094  148.935573    371       5.99     1500.0     19.280997    10.805647  [consoles_games, brinquedos, bebes, utilidades_domesticas, esporte_lazer, eletroportateis, alimentos, cool_stuff, automotivo, artes, relogios_presentes, moveis_decoracao, cama_mesa_banho]              13          1.506148         250.417362                0.194984                 13             0.03504              0.791985         0.50099                          0.217125                                   0.784855
2025-05-22 02:46:35,572 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}]
2025-05-22 02:46:35,572 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,572 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.7848545894928308, "explanation": {"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}}]
2025-05-22 02:46:35,573 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 27500, order_id: a8c02875c8391d968525088da5fce5a6, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.7256, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,573 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,574 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-25 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,575 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-25 00:00:00
2025-05-22 02:46:35,577 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
549 2018-06-25          240     37211.91   124.0397             180               240               2018-06-25  28935.334286         1.286037           0.791627                             0.7256                       0.857654    2018-06-25
2025-05-22 02:46:35,577 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-25 00:00:00", "current_value": 37211.91, "expected_value": 25862.10588888889, "absolute_deviation": 11349.804111111112, "relative_deviation": 0.4388584657364394, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-25 00:00:00 значение total_sales (37211.91) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}]
2025-05-22 02:46:35,578 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,578 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7255996983562448, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-25 00:00:00", "current_value": 37211.91, "expected_value": 25862.10588888889, "absolute_deviation": 11349.804111111112, "relative_deviation": 0.4388584657364394, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-25 00:00:00 значение total_sales (37211.91) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}]
2025-05-22 02:46:35,578 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 27500, order_id: a8c02875c8391d968525088da5fce5a6, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.8577, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,578 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,579 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-25 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,580 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-25 00:00:00
2025-05-22 02:46:35,582 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
549 2018-06-25          240     37211.91   124.0397             180               240               2018-06-25  28935.334286         1.286037           0.791627                             0.7256                       0.857654    2018-06-25
2025-05-22 02:46:35,583 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-06-25 00:00:00", "current_value": 37211.91, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 33515.90428571429, "deviation_in_std": 8.25363138000554, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (37211.91) отклоняется от базовой линии (3696.01) на 33515.90, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,583 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,583 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7255996983562448, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-25 00:00:00", "current_value": 37211.91, "expected_value": 25862.10588888889, "absolute_deviation": 11349.804111111112, "relative_deviation": 0.4388584657364394, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-25 00:00:00 значение total_sales (37211.91) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.8576535896793531, "explanation": {"detector_specific_info": {"date": "2018-06-25 00:00:00", "current_value": 37211.91, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 33515.90428571429, "deviation_in_std": 8.25363138000554, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (37211.91) отклоняется от базовой линии (3696.01) на 33515.90, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,584 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 28236, order_id: a1e313e06320d5c725c2ba02d0cf5be2, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,584 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,584 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-14 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,585 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-14 00:00:00
2025-05-22 02:46:35,587 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
599 2018-08-14          315     44682.42  128.397759             228               315               2018-08-14  37562.228571         1.189557           0.989198                                1.0                       0.978396    2018-08-14
2025-05-22 02:46:35,588 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-14 00:00:00", "current_value": 44682.42, "expected_value": 26189.295057471263, "absolute_deviation": 18493.124942528735, "relative_deviation": 0.7061329792171336, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-14 00:00:00 значение total_sales (44682.42) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}]
2025-05-22 02:46:35,588 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,589 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-14 00:00:00", "current_value": 44682.42, "expected_value": 26189.295057471263, "absolute_deviation": 18493.124942528735, "relative_deviation": 0.7061329792171336, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-14 00:00:00 значение total_sales (44682.42) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}]
2025-05-22 02:46:35,589 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 28236, order_id: a1e313e06320d5c725c2ba02d0cf5be2, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9784, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,589 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,590 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-14 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,591 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-14 00:00:00
2025-05-22 02:46:35,594 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
599 2018-08-14          315     44682.42  128.397759             228               315               2018-08-14  37562.228571         1.189557           0.989198                                1.0                       0.978396    2018-08-14
2025-05-22 02:46:35,594 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-14 00:00:00", "current_value": 44682.42, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40986.41428571429, "deviation_in_std": 10.093320240405061, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (44682.42) отклоняется от базовой линии (3696.01) на 40986.41, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,595 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,596 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-14 00:00:00", "current_value": 44682.42, "expected_value": 26189.295057471263, "absolute_deviation": 18493.124942528735, "relative_deviation": 0.7061329792171336, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-14 00:00:00 значение total_sales (44682.42) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9783962277530719, "explanation": {"detector_specific_info": {"date": "2018-08-14 00:00:00", "current_value": 44682.42, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40986.41428571429, "deviation_in_std": 10.093320240405061, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (44682.42) отклоняется от базовой линии (3696.01) на 40986.41, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,596 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 29640, order_id: f92b34d1e66d16dfe85adfbf914dee86, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.9268, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,596 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,597 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-23 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,598 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-23 00:00:00
2025-05-22 02:46:35,600 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
577 2018-07-23          305     40827.91  115.659802             227               305               2018-07-23  34498.897143         1.183456           0.919871                           0.926804                       0.912939    2018-07-23
2025-05-22 02:46:35,601 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-23 00:00:00", "current_value": 40827.909999999996, "expected_value": 25862.10588888889, "absolute_deviation": 14965.804111111105, "relative_deviation": 0.5786769327837625, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-23 00:00:00 значение total_sales (40827.91) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}]
2025-05-22 02:46:35,601 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,601 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.926804266551497, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-23 00:00:00", "current_value": 40827.909999999996, "expected_value": 25862.10588888889, "absolute_deviation": 14965.804111111105, "relative_deviation": 0.5786769327837625, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-23 00:00:00 значение total_sales (40827.91) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}]
2025-05-22 02:46:35,602 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 29640, order_id: f92b34d1e66d16dfe85adfbf914dee86, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9129, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,602 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,603 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-23 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,603 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-23 00:00:00
2025-05-22 02:46:35,606 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
577 2018-07-23          305     40827.91  115.659802             227               305               2018-07-23  34498.897143         1.183456           0.919871                           0.926804                       0.912939    2018-07-23
2025-05-22 02:46:35,606 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-07-23 00:00:00", "current_value": 40827.909999999996, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 37131.904285714285, "deviation_in_std": 9.144108056859551, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (40827.91) отклоняется от базовой линии (3696.01) на 37131.90, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,607 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,607 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.926804266551497, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-23 00:00:00", "current_value": 40827.909999999996, "expected_value": 25862.10588888889, "absolute_deviation": 14965.804111111105, "relative_deviation": 0.5786769327837625, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-23 00:00:00 значение total_sales (40827.91) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9129385689972365, "explanation": {"detector_specific_info": {"date": "2018-07-23 00:00:00", "current_value": 40827.909999999996, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 37131.904285714285, "deviation_in_std": 9.144108056859551, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (40827.91) отклоняется от базовой линии (3696.01) на 37131.90, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,608 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 29802, order_id: 2c4ada2e75c2ad41dd93cebb5df5f023, level: transaction): Detector Column: 'trans_transaction_vae_price_score', Score: 0.0028, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:35,608 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 29802, order_id: 2c4ada2e75c2ad41dd93cebb5df5f023, level: transaction): Detector Column: 'trans_category_price_outlier_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,609 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'category_price_outlier_model': CategoryPriceOutlierDetector
2025-05-22 02:46:35,615 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for transaction detector 'category_price_outlier_model':
       order_item_id                          order_id                        product_id                         seller_id   price  freight_value order_purchase_timestamp                       customer_id product_category_name  product_name_lenght  product_description_lenght  product_photos_qty  product_weight_g  product_length_cm  product_height_cm  product_width_cm product_category_name_english customer_state seller_state payment_type  payment_installments  payment_value  review_score  price_deviation_from_category_mean  freight_to_price_ratio  transaction_level_score  transaction_is_anomaly  trans_transaction_vae_price_score  trans_category_price_outlier_model_score  behavior_level_score  behavior_is_anomaly  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score  time_series_level_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score  time_series_is_anomaly  multilevel_score  is_anomaly detailed_explanations_json
29802              1  2c4ada2e75c2ad41dd93cebb5df5f023  6c7a0a349ad11817745e3ad58abd5c79  48162d548f5b1b11b9d29d1e01f75a61  183.29          25.77      2017-01-26 11:09:00  363d3a9b2ec5c5426608688ca033292d    seguros_e_servicos                 55.0                       506.0                 1.0            1225.0               27.0               35.0              15.0         security_and_services             RO           SP  credit_card                   1.0         209.06           4.0                             1.29401                0.140597                 0.501419                    True                           0.002839                                       1.0              0.177747                False                          0.166576                                   0.188917                 0.500771                                1.0                       0.001542                    True          0.404123        True                       None
2025-05-22 02:46:35,616 - backend.ml_service.multilevel_detector - DEBUG - Explanation from transaction detector 'category_price_outlier_model': [{"detector_specific_info": {"category": "seguros_e_servicos", "price": 183.29, "explanation": "Категория 'seguros_e_servicos' не встречалась в обучающих данных, статистики отсутствуют."}}]
2025-05-22 02:46:35,617 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'category_price_outlier_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,617 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for transaction_level: [{"detector_name": "category_price_outlier_model", "detector_type": "CategoryPriceOutlierDetector", "score": 1.0, "explanation": {"detector_specific_info": {"category": "seguros_e_servicos", "price": 183.29, "explanation": "Категория 'seguros_e_servicos' не встречалась в обучающих данных, статистики отсутствуют."}}}]
2025-05-22 02:46:35,617 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 29802, order_id: 2c4ada2e75c2ad41dd93cebb5df5f023, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,617 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,618 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2017-01-26 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,619 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2017-01-26 00:00:00
2025-05-22 02:46:35,622 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
         date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
34 2017-01-26           85     13910.79  125.322432              65                85               2017-01-26       6681.68          2.08193           0.500771                                1.0                       0.001542    2017-01-26
2025-05-22 02:46:35,623 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2017-01-26 00:00:00", "current_value": 13910.79, "expected_value": 24263.594318181815, "absolute_deviation": -10352.804318181814, "relative_deviation": -0.42668057264805104, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2017-01-26 00:00:00 значение total_sales (13910.79) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}]
2025-05-22 02:46:35,624 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,624 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2017-01-26 00:00:00", "current_value": 13910.79, "expected_value": 24263.594318181815, "absolute_deviation": -10352.804318181814, "relative_deviation": -0.42668057264805104, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2017-01-26 00:00:00 значение total_sales (13910.79) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}]
2025-05-22 02:46:35,624 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 29802, order_id: 2c4ada2e75c2ad41dd93cebb5df5f023, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.0015, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:35,625 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 30230, order_id: 6227de9611e75b006686710c6a29df35, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1697, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:35,625 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 30230, order_id: 6227de9611e75b006686710c6a29df35, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9836, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,625 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:35,626 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=4a3ccda38b2129705f3fb522db62ca31 in aggregated_behavior_data_with_scores
2025-05-22 02:46:35,627 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:35,630 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                               categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
882  4a3ccda38b2129705f3fb522db62ca31  233.158916  370.889347     83        9.9     3099.9     18.396747     9.418922  [construcao_ferramentas_seguranca, casa_construcao, ferramentas_jardim, construcao_ferramentas_construcao, eletronicos]               5          1.590715         313.121212                0.078902                  5            0.060241               0.53771        0.576635                          0.169668                                   0.983603
2025-05-22 02:46:35,631 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}]
2025-05-22 02:46:35,632 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,632 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.9836033466098753, "explanation": {"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}}]
2025-05-22 02:46:35,632 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 30230, order_id: 6227de9611e75b006686710c6a29df35, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.8827, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,632 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,632 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-02 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,633 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-02 00:00:00
2025-05-22 02:46:35,636 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
495 2018-05-02          295      41223.8  111.717615             184               295               2018-05-02      33163.88         1.243033           0.806465                           0.882651                       0.730279    2018-05-02
2025-05-22 02:46:35,637 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-02 00:00:00", "current_value": 41223.8, "expected_value": 25669.474712643678, "absolute_deviation": 15554.325287356325, "relative_deviation": 0.6059463803400283, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-02 00:00:00 значение total_sales (41223.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}]
2025-05-22 02:46:35,637 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,637 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8826513294397218, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-02 00:00:00", "current_value": 41223.8, "expected_value": 25669.474712643678, "absolute_deviation": 15554.325287356325, "relative_deviation": 0.6059463803400283, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-02 00:00:00 значение total_sales (41223.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}]
2025-05-22 02:46:35,637 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 30230, order_id: 6227de9611e75b006686710c6a29df35, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.7303, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,638 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,638 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-02 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,639 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-02 00:00:00
2025-05-22 02:46:35,641 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
495 2018-05-02          295      41223.8  111.717615             184               295               2018-05-02      33163.88         1.243033           0.806465                           0.882651                       0.730279    2018-05-02
2025-05-22 02:46:35,642 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-05-02 00:00:00", "current_value": 41223.8, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 37527.79428571429, "deviation_in_std": 9.241599984846205, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (41223.80) отклоняется от базовой линии (3696.01) на 37527.79, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,643 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,643 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8826513294397218, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-02 00:00:00", "current_value": 41223.8, "expected_value": 25669.474712643678, "absolute_deviation": 15554.325287356325, "relative_deviation": 0.6059463803400283, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-02 00:00:00 значение total_sales (41223.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.7302789183859992, "explanation": {"detector_specific_info": {"date": "2018-05-02 00:00:00", "current_value": 41223.8, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 37527.79428571429, "deviation_in_std": 9.241599984846205, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (41223.80) отклоняется от базовой линии (3696.01) на 37527.79, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,644 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 30231, order_id: 6227de9611e75b006686710c6a29df35, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1697, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:35,644 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 30231, order_id: 6227de9611e75b006686710c6a29df35, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9836, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,644 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:35,644 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=4a3ccda38b2129705f3fb522db62ca31 in aggregated_behavior_data_with_scores
2025-05-22 02:46:35,645 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:35,648 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                               categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
882  4a3ccda38b2129705f3fb522db62ca31  233.158916  370.889347     83        9.9     3099.9     18.396747     9.418922  [construcao_ferramentas_seguranca, casa_construcao, ferramentas_jardim, construcao_ferramentas_construcao, eletronicos]               5          1.590715         313.121212                0.078902                  5            0.060241               0.53771        0.576635                          0.169668                                   0.983603
2025-05-22 02:46:35,649 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}]
2025-05-22 02:46:35,649 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,649 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.9836033466098753, "explanation": {"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}}]
2025-05-22 02:46:35,650 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 30231, order_id: 6227de9611e75b006686710c6a29df35, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.8827, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,650 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,651 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-02 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,652 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-02 00:00:00
2025-05-22 02:46:35,654 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
495 2018-05-02          295      41223.8  111.717615             184               295               2018-05-02      33163.88         1.243033           0.806465                           0.882651                       0.730279    2018-05-02
2025-05-22 02:46:35,654 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-02 00:00:00", "current_value": 41223.8, "expected_value": 25669.474712643678, "absolute_deviation": 15554.325287356325, "relative_deviation": 0.6059463803400283, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-02 00:00:00 значение total_sales (41223.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}]
2025-05-22 02:46:35,655 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,656 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8826513294397218, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-02 00:00:00", "current_value": 41223.8, "expected_value": 25669.474712643678, "absolute_deviation": 15554.325287356325, "relative_deviation": 0.6059463803400283, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-02 00:00:00 значение total_sales (41223.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}]
2025-05-22 02:46:35,656 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 30231, order_id: 6227de9611e75b006686710c6a29df35, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.7303, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,656 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,657 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-02 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,658 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-02 00:00:00
2025-05-22 02:46:35,660 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
495 2018-05-02          295      41223.8  111.717615             184               295               2018-05-02      33163.88         1.243033           0.806465                           0.882651                       0.730279    2018-05-02
2025-05-22 02:46:35,660 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-05-02 00:00:00", "current_value": 41223.8, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 37527.79428571429, "deviation_in_std": 9.241599984846205, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (41223.80) отклоняется от базовой линии (3696.01) на 37527.79, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,661 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,661 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8826513294397218, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-02 00:00:00", "current_value": 41223.8, "expected_value": 25669.474712643678, "absolute_deviation": 15554.325287356325, "relative_deviation": 0.6059463803400283, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-02 00:00:00 значение total_sales (41223.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.7302789183859992, "explanation": {"detector_specific_info": {"date": "2018-05-02 00:00:00", "current_value": 41223.8, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 37527.79428571429, "deviation_in_std": 9.241599984846205, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (41223.80) отклоняется от базовой линии (3696.01) на 37527.79, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,661 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 30253, order_id: 800bb72be8df9c5372c6a4235d38de9b, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.2171, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:35,662 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 30253, order_id: 800bb72be8df9c5372c6a4235d38de9b, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.7849, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,662 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:35,662 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=7299e27ed73d2ad986de7f7c77d919fa in aggregated_behavior_data_with_scores
2025-05-22 02:46:35,664 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:35,668 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                             seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                                   categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
1412  7299e27ed73d2ad986de7f7c77d919fa   98.885094  148.935573    371       5.99     1500.0     19.280997    10.805647  [consoles_games, brinquedos, bebes, utilidades_domesticas, esporte_lazer, eletroportateis, alimentos, cool_stuff, automotivo, artes, relogios_presentes, moveis_decoracao, cama_mesa_banho]              13          1.506148         250.417362                0.194984                 13             0.03504              0.791985         0.50099                          0.217125                                   0.784855
2025-05-22 02:46:35,668 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}]
2025-05-22 02:46:35,668 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,669 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.7848545894928308, "explanation": {"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}}]
2025-05-22 02:46:35,669 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 30253, order_id: 800bb72be8df9c5372c6a4235d38de9b, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,669 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,670 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-14 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,671 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-14 00:00:00
2025-05-22 02:46:35,674 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
507 2018-05-14          364     55368.96  130.279906             231               364               2018-05-14      44527.33         1.243483           0.884474                                1.0                       0.768949    2018-05-14
2025-05-22 02:46:35,674 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-14 00:00:00", "current_value": 55368.96, "expected_value": 25862.10588888889, "absolute_deviation": 29506.854111111108, "relative_deviation": 1.140930063386219, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-14 00:00:00 значение total_sales (55368.96) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}]
2025-05-22 02:46:35,675 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,675 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-14 00:00:00", "current_value": 55368.96, "expected_value": 25862.10588888889, "absolute_deviation": 29506.854111111108, "relative_deviation": 1.140930063386219, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-14 00:00:00 значение total_sales (55368.96) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}]
2025-05-22 02:46:35,675 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 30253, order_id: 800bb72be8df9c5372c6a4235d38de9b, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.7689, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,675 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,675 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-14 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,676 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-14 00:00:00
2025-05-22 02:46:35,680 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
507 2018-05-14          364     55368.96  130.279906             231               364               2018-05-14      44527.33         1.243483           0.884474                                1.0                       0.768949    2018-05-14
2025-05-22 02:46:35,680 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-05-14 00:00:00", "current_value": 55368.96, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 51672.95428571429, "deviation_in_std": 12.724989108288767, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (55368.96) отклоняется от базовой линии (3696.01) на 51672.95, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,681 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,681 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-14 00:00:00", "current_value": 55368.96, "expected_value": 25862.10588888889, "absolute_deviation": 29506.854111111108, "relative_deviation": 1.140930063386219, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-14 00:00:00 значение total_sales (55368.96) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.7689488301722409, "explanation": {"detector_specific_info": {"date": "2018-05-14 00:00:00", "current_value": 55368.96, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 51672.95428571429, "deviation_in_std": 12.724989108288767, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (55368.96) отклоняется от базовой линии (3696.01) на 51672.95, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,681 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 32313, order_id: 83eec8a1bf27d833e0d2f468cf456ab1, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,682 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,682 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-07 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,683 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-07 00:00:00
2025-05-22 02:46:35,686 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
500 2018-05-07          371     55022.97  128.258671             244               371               2018-05-07  39021.418571         1.410071           0.872583                                1.0                       0.745166    2018-05-07
2025-05-22 02:46:35,687 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-07 00:00:00", "current_value": 55022.97, "expected_value": 25862.10588888889, "absolute_deviation": 29160.86411111111, "relative_deviation": 1.1275518024864117, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-07 00:00:00 значение total_sales (55022.97) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}]
2025-05-22 02:46:35,687 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,687 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-07 00:00:00", "current_value": 55022.97, "expected_value": 25862.10588888889, "absolute_deviation": 29160.86411111111, "relative_deviation": 1.1275518024864117, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-07 00:00:00 значение total_sales (55022.97) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}]
2025-05-22 02:46:35,687 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 32313, order_id: 83eec8a1bf27d833e0d2f468cf456ab1, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.7452, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,688 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,688 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-07 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,689 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-07 00:00:00
2025-05-22 02:46:35,692 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
500 2018-05-07          371     55022.97  128.258671             244               371               2018-05-07  39021.418571         1.410071           0.872583                                1.0                       0.745166    2018-05-07
2025-05-22 02:46:35,693 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-05-07 00:00:00", "current_value": 55022.97, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 51326.96428571429, "deviation_in_std": 12.639785561434588, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (55022.97) отклоняется от базовой линии (3696.01) на 51326.96, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,693 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,693 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-07 00:00:00", "current_value": 55022.97, "expected_value": 25862.10588888889, "absolute_deviation": 29160.86411111111, "relative_deviation": 1.1275518024864117, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-07 00:00:00 значение total_sales (55022.97) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.7451657905183864, "explanation": {"detector_specific_info": {"date": "2018-05-07 00:00:00", "current_value": 55022.97, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 51326.96428571429, "deviation_in_std": 12.639785561434588, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (55022.97) отклоняется от базовой линии (3696.01) на 51326.96, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,694 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 32533, order_id: e4de4d75a4d1e6b3dc57a3d94922023f, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,694 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,694 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-03 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,695 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-03 00:00:00
2025-05-22 02:46:35,698 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
588 2018-08-03          314     45036.63  125.10175             216               314               2018-08-03  39138.992857         1.150684           0.972436                                1.0                       0.944872    2018-08-03
2025-05-22 02:46:35,699 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-03 00:00:00", "current_value": 45036.63, "expected_value": 23364.508863636365, "absolute_deviation": 21672.121136363632, "relative_deviation": 0.9275658762120739, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-03 00:00:00 значение total_sales (45036.63) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}]
2025-05-22 02:46:35,700 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,700 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-03 00:00:00", "current_value": 45036.63, "expected_value": 23364.508863636365, "absolute_deviation": 21672.121136363632, "relative_deviation": 0.9275658762120739, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-03 00:00:00 значение total_sales (45036.63) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}]
2025-05-22 02:46:35,700 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 32533, order_id: e4de4d75a4d1e6b3dc57a3d94922023f, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9449, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,701 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,701 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-03 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,702 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-03 00:00:00
2025-05-22 02:46:35,704 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
588 2018-08-03          314     45036.63  125.10175             216               314               2018-08-03  39138.992857         1.150684           0.972436                                1.0                       0.944872    2018-08-03
2025-05-22 02:46:35,706 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-03 00:00:00", "current_value": 45036.63, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 41340.624285714286, "deviation_in_std": 10.18054804563417, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (45036.63) отклоняется от базовой линии (3696.01) на 41340.62, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,706 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,706 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-03 00:00:00", "current_value": 45036.63, "expected_value": 23364.508863636365, "absolute_deviation": 21672.121136363632, "relative_deviation": 0.9275658762120739, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-03 00:00:00 значение total_sales (45036.63) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9448723295452219, "explanation": {"detector_specific_info": {"date": "2018-08-03 00:00:00", "current_value": 45036.63, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 41340.624285714286, "deviation_in_std": 10.18054804563417, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (45036.63) отклоняется от базовой линии (3696.01) на 41340.62, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,707 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 33735, order_id: fefacc66af859508bf1a7934eab1e97f, level: transaction): Detector Column: 'trans_transaction_vae_price_score', Score: 0.9890, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,707 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'transaction_vae_price': TransactionVAEDetector
2025-05-22 02:46:35,714 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for transaction detector 'transaction_vae_price':
       order_item_id                          order_id                        product_id                         seller_id   price  freight_value order_purchase_timestamp                       customer_id product_category_name  product_name_lenght  product_description_lenght  product_photos_qty  product_weight_g  product_length_cm  product_height_cm  product_width_cm product_category_name_english customer_state seller_state payment_type  payment_installments  payment_value  review_score  price_deviation_from_category_mean  freight_to_price_ratio  transaction_level_score  transaction_is_anomaly  trans_transaction_vae_price_score  trans_category_price_outlier_model_score  behavior_level_score  behavior_is_anomaly  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score  time_series_level_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score  time_series_is_anomaly  multilevel_score  is_anomaly detailed_explanations_json
33735              1  fefacc66af859508bf1a7934eab1e97f  69c590f7ffc7bf8db97190b6cb6ed62e  80ceebb4ee9b31afb6c6a916a574a1e2  6729.0         193.21      2018-07-25 18:10:17  f48d464a0baaea338cb25f816991ab1f                   pcs                 50.0                      1935.0                 4.0            5660.0               54.0               18.0              47.0                     computers             ES           PR       boleto                   1.0        6922.21           NaN                            6.096825                0.028713                 0.586148                    True                           0.988954                                  0.183342              0.078431                False                          0.156863                                        0.0                 0.959618                                1.0                       0.919235                    True          0.545874        True                       None
2025-05-22 02:46:35,714 - backend.ml_service.detector - DEBUG - (transaction_vae_price) Метод get_explanation_details не реализован специфично, будет использована реализация get_shap_explanations (если есть).
2025-05-22 02:46:35,716 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) [Detect_Preprocess] Scaler type: <class 'sklearn.preprocessing._data.StandardScaler'>
2025-05-22 02:46:35,716 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) [Detect_Preprocess] Scaler has mean_: True
2025-05-22 02:46:35,716 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) [Detect_Preprocess] Scaler mean_ shape: (4,)
2025-05-22 02:46:35,716 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) [Detect_Preprocess] Scaler params: {'copy': True, 'with_mean': True, 'with_std': True}
2025-05-22 02:46:35,717 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) StandardScaler обучен (mean_ присутствует). Выполняется transform.
2025-05-22 02:46:35,717 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Вычисление SHAP values для 1 экземпляров...
2025-05-22 02:46:35,717 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Используется nsamples=50 для SHAP
2025-05-22 02:46:35,718 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) Запрос SHAP объяснений: explainer=True, background_data_exists=True, model=True
2025-05-22 02:46:35,718 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Создание GradientExplainer с размерами данных: torch.Size([50, 4])
2025-05-22 02:46:35,737 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) SHAP values raw type: <class 'numpy.ndarray'>
2025-05-22 02:46:35,738 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) SHAP values raw (ndarray) shape: (1, 4, 1)
2025-05-22 02:46:35,738 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) SHAP GradientExplainer успешно создан и вычислены SHAP-значения
2025-05-22 02:46:35,738 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) SHAP values_raw уже является ndarray, shape: (1, 4, 1)
2025-05-22 02:46:35,738 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) Начальная форма shap_values_arr: (1, 4, 1), ndim: 3
2025-05-22 02:46:35,739 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) SHAP values после squeeze(-1): (1, 4)
2025-05-22 02:46:35,739 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) SHAP values успешно вычислены для 1 экземпляров.
2025-05-22 02:46:35,740 - backend.ml_service.multilevel_detector - DEBUG - Explanation from transaction detector 'transaction_vae_price': [{"shap_values": {"price": 41.04408151561496, "freight_value": 3.4354568313084157, "product_weight_g": -0.8487048251454226, "freight_to_price_ratio": -0.6132873233634383}}]
2025-05-22 02:46:35,740 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'transaction_vae_price' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,740 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for transaction_level: [{"detector_name": "transaction_vae_price", "detector_type": "TransactionVAEDetector", "score": 0.9889542385820496, "explanation": {"shap_values": {"price": 41.04408151561496, "freight_value": 3.4354568313084157, "product_weight_g": -0.8487048251454226, "freight_to_price_ratio": -0.6132873233634383}}}]
2025-05-22 02:46:35,740 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 33735, order_id: fefacc66af859508bf1a7934eab1e97f, level: transaction): Detector Column: 'trans_category_price_outlier_model_score', Score: 0.1833, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:35,740 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 33735, order_id: fefacc66af859508bf1a7934eab1e97f, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,741 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,741 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-25 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,742 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-25 00:00:00
2025-05-22 02:46:35,745 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
579 2018-07-25          268     40753.19  122.750572             201               268               2018-07-25  35288.758571         1.154849           0.959618                                1.0                       0.919235    2018-07-25
2025-05-22 02:46:35,745 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-25 00:00:00", "current_value": 40753.19, "expected_value": 25669.474712643678, "absolute_deviation": 15083.715287356325, "relative_deviation": 0.5876129315543311, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-25 00:00:00 значение total_sales (40753.19) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}]
2025-05-22 02:46:35,746 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,746 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-25 00:00:00", "current_value": 40753.19, "expected_value": 25669.474712643678, "absolute_deviation": 15083.715287356325, "relative_deviation": 0.5876129315543311, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-25 00:00:00 значение total_sales (40753.19) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}]
2025-05-22 02:46:35,747 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 33735, order_id: fefacc66af859508bf1a7934eab1e97f, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9192, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,747 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,747 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-25 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,748 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-25 00:00:00
2025-05-22 02:46:35,751 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
579 2018-07-25          268     40753.19  122.750572             201               268               2018-07-25  35288.758571         1.154849           0.959618                                1.0                       0.919235    2018-07-25
2025-05-22 02:46:35,751 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-07-25 00:00:00", "current_value": 40753.19, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 37057.18428571429, "deviation_in_std": 9.125707498979427, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (40753.19) отклоняется от базовой линии (3696.01) на 37057.18, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,752 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,752 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-25 00:00:00", "current_value": 40753.19, "expected_value": 25669.474712643678, "absolute_deviation": 15083.715287356325, "relative_deviation": 0.5876129315543311, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-25 00:00:00 значение total_sales (40753.19) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9192352183494302, "explanation": {"detector_specific_info": {"date": "2018-07-25 00:00:00", "current_value": 40753.19, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 37057.18428571429, "deviation_in_std": 9.125707498979427, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (40753.19) отклоняется от базовой линии (3696.01) на 37057.18, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,753 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 34240, order_id: 541d81a8afee2348b192cc10df37367c, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1697, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:35,753 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 34240, order_id: 541d81a8afee2348b192cc10df37367c, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9836, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,753 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:35,753 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=4a3ccda38b2129705f3fb522db62ca31 in aggregated_behavior_data_with_scores
2025-05-22 02:46:35,754 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:35,757 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                               categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
882  4a3ccda38b2129705f3fb522db62ca31  233.158916  370.889347     83        9.9     3099.9     18.396747     9.418922  [construcao_ferramentas_seguranca, casa_construcao, ferramentas_jardim, construcao_ferramentas_construcao, eletronicos]               5          1.590715         313.121212                0.078902                  5            0.060241               0.53771        0.576635                          0.169668                                   0.983603
2025-05-22 02:46:35,757 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}]
2025-05-22 02:46:35,758 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,759 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.9836033466098753, "explanation": {"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}}]
2025-05-22 02:46:35,759 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 34240, order_id: 541d81a8afee2348b192cc10df37367c, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,760 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,761 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-07 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,762 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-07 00:00:00
2025-05-22 02:46:35,764 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
500 2018-05-07          371     55022.97  128.258671             244               371               2018-05-07  39021.418571         1.410071           0.872583                                1.0                       0.745166    2018-05-07
2025-05-22 02:46:35,765 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-07 00:00:00", "current_value": 55022.97, "expected_value": 25862.10588888889, "absolute_deviation": 29160.86411111111, "relative_deviation": 1.1275518024864117, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-07 00:00:00 значение total_sales (55022.97) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}]
2025-05-22 02:46:35,765 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,765 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-07 00:00:00", "current_value": 55022.97, "expected_value": 25862.10588888889, "absolute_deviation": 29160.86411111111, "relative_deviation": 1.1275518024864117, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-07 00:00:00 значение total_sales (55022.97) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}]
2025-05-22 02:46:35,765 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 34240, order_id: 541d81a8afee2348b192cc10df37367c, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.7452, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,765 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,766 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-07 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,767 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-07 00:00:00
2025-05-22 02:46:35,770 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
500 2018-05-07          371     55022.97  128.258671             244               371               2018-05-07  39021.418571         1.410071           0.872583                                1.0                       0.745166    2018-05-07
2025-05-22 02:46:35,770 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-05-07 00:00:00", "current_value": 55022.97, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 51326.96428571429, "deviation_in_std": 12.639785561434588, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (55022.97) отклоняется от базовой линии (3696.01) на 51326.96, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,771 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,771 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-07 00:00:00", "current_value": 55022.97, "expected_value": 25862.10588888889, "absolute_deviation": 29160.86411111111, "relative_deviation": 1.1275518024864117, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-07 00:00:00 значение total_sales (55022.97) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.7451657905183864, "explanation": {"detector_specific_info": {"date": "2018-05-07 00:00:00", "current_value": 55022.97, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 51326.96428571429, "deviation_in_std": 12.639785561434588, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (55022.97) отклоняется от базовой линии (3696.01) на 51326.96, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,772 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 34241, order_id: 541d81a8afee2348b192cc10df37367c, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1697, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:35,772 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 34241, order_id: 541d81a8afee2348b192cc10df37367c, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9836, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,772 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:35,773 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=4a3ccda38b2129705f3fb522db62ca31 in aggregated_behavior_data_with_scores
2025-05-22 02:46:35,774 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:35,777 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                               categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
882  4a3ccda38b2129705f3fb522db62ca31  233.158916  370.889347     83        9.9     3099.9     18.396747     9.418922  [construcao_ferramentas_seguranca, casa_construcao, ferramentas_jardim, construcao_ferramentas_construcao, eletronicos]               5          1.590715         313.121212                0.078902                  5            0.060241               0.53771        0.576635                          0.169668                                   0.983603
2025-05-22 02:46:35,778 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}]
2025-05-22 02:46:35,778 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,779 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.9836033466098753, "explanation": {"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}}]
2025-05-22 02:46:35,779 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 34241, order_id: 541d81a8afee2348b192cc10df37367c, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,779 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,779 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-07 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,782 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-07 00:00:00
2025-05-22 02:46:35,784 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
500 2018-05-07          371     55022.97  128.258671             244               371               2018-05-07  39021.418571         1.410071           0.872583                                1.0                       0.745166    2018-05-07
2025-05-22 02:46:35,785 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-07 00:00:00", "current_value": 55022.97, "expected_value": 25862.10588888889, "absolute_deviation": 29160.86411111111, "relative_deviation": 1.1275518024864117, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-07 00:00:00 значение total_sales (55022.97) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}]
2025-05-22 02:46:35,786 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,786 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-07 00:00:00", "current_value": 55022.97, "expected_value": 25862.10588888889, "absolute_deviation": 29160.86411111111, "relative_deviation": 1.1275518024864117, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-07 00:00:00 значение total_sales (55022.97) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}]
2025-05-22 02:46:35,786 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 34241, order_id: 541d81a8afee2348b192cc10df37367c, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.7452, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,786 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,787 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-07 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,788 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-07 00:00:00
2025-05-22 02:46:35,791 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
500 2018-05-07          371     55022.97  128.258671             244               371               2018-05-07  39021.418571         1.410071           0.872583                                1.0                       0.745166    2018-05-07
2025-05-22 02:46:35,792 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-05-07 00:00:00", "current_value": 55022.97, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 51326.96428571429, "deviation_in_std": 12.639785561434588, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (55022.97) отклоняется от базовой линии (3696.01) на 51326.96, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,792 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,792 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-07 00:00:00", "current_value": 55022.97, "expected_value": 25862.10588888889, "absolute_deviation": 29160.86411111111, "relative_deviation": 1.1275518024864117, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-07 00:00:00 значение total_sales (55022.97) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.7451657905183864, "explanation": {"detector_specific_info": {"date": "2018-05-07 00:00:00", "current_value": 55022.97, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 51326.96428571429, "deviation_in_std": 12.639785561434588, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (55022.97) отклоняется от базовой линии (3696.01) на 51326.96, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,793 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 34242, order_id: 541d81a8afee2348b192cc10df37367c, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1697, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:35,793 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 34242, order_id: 541d81a8afee2348b192cc10df37367c, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9836, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,793 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:35,794 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=4a3ccda38b2129705f3fb522db62ca31 in aggregated_behavior_data_with_scores
2025-05-22 02:46:35,795 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:35,798 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                               categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
882  4a3ccda38b2129705f3fb522db62ca31  233.158916  370.889347     83        9.9     3099.9     18.396747     9.418922  [construcao_ferramentas_seguranca, casa_construcao, ferramentas_jardim, construcao_ferramentas_construcao, eletronicos]               5          1.590715         313.121212                0.078902                  5            0.060241               0.53771        0.576635                          0.169668                                   0.983603
2025-05-22 02:46:35,798 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}]
2025-05-22 02:46:35,799 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,799 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.9836033466098753, "explanation": {"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}}]
2025-05-22 02:46:35,799 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 34242, order_id: 541d81a8afee2348b192cc10df37367c, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,800 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,800 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-07 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,801 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-07 00:00:00
2025-05-22 02:46:35,803 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
500 2018-05-07          371     55022.97  128.258671             244               371               2018-05-07  39021.418571         1.410071           0.872583                                1.0                       0.745166    2018-05-07
2025-05-22 02:46:35,804 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-07 00:00:00", "current_value": 55022.97, "expected_value": 25862.10588888889, "absolute_deviation": 29160.86411111111, "relative_deviation": 1.1275518024864117, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-07 00:00:00 значение total_sales (55022.97) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}]
2025-05-22 02:46:35,805 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,805 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-07 00:00:00", "current_value": 55022.97, "expected_value": 25862.10588888889, "absolute_deviation": 29160.86411111111, "relative_deviation": 1.1275518024864117, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-07 00:00:00 значение total_sales (55022.97) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}]
2025-05-22 02:46:35,805 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 34242, order_id: 541d81a8afee2348b192cc10df37367c, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.7452, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,805 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,806 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-07 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,807 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-07 00:00:00
2025-05-22 02:46:35,809 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
500 2018-05-07          371     55022.97  128.258671             244               371               2018-05-07  39021.418571         1.410071           0.872583                                1.0                       0.745166    2018-05-07
2025-05-22 02:46:35,810 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-05-07 00:00:00", "current_value": 55022.97, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 51326.96428571429, "deviation_in_std": 12.639785561434588, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (55022.97) отклоняется от базовой линии (3696.01) на 51326.96, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,810 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,810 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-07 00:00:00", "current_value": 55022.97, "expected_value": 25862.10588888889, "absolute_deviation": 29160.86411111111, "relative_deviation": 1.1275518024864117, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-07 00:00:00 значение total_sales (55022.97) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.7451657905183864, "explanation": {"detector_specific_info": {"date": "2018-05-07 00:00:00", "current_value": 55022.97, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 51326.96428571429, "deviation_in_std": 12.639785561434588, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (55022.97) отклоняется от базовой линии (3696.01) на 51326.96, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,811 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 34243, order_id: 541d81a8afee2348b192cc10df37367c, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1697, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:35,811 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 34243, order_id: 541d81a8afee2348b192cc10df37367c, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9836, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,811 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:35,812 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=4a3ccda38b2129705f3fb522db62ca31 in aggregated_behavior_data_with_scores
2025-05-22 02:46:35,813 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:35,816 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                               categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
882  4a3ccda38b2129705f3fb522db62ca31  233.158916  370.889347     83        9.9     3099.9     18.396747     9.418922  [construcao_ferramentas_seguranca, casa_construcao, ferramentas_jardim, construcao_ferramentas_construcao, eletronicos]               5          1.590715         313.121212                0.078902                  5            0.060241               0.53771        0.576635                          0.169668                                   0.983603
2025-05-22 02:46:35,816 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}]
2025-05-22 02:46:35,817 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,817 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.9836033466098753, "explanation": {"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}}]
2025-05-22 02:46:35,817 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 34243, order_id: 541d81a8afee2348b192cc10df37367c, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,818 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,818 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-07 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,819 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-07 00:00:00
2025-05-22 02:46:35,823 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
500 2018-05-07          371     55022.97  128.258671             244               371               2018-05-07  39021.418571         1.410071           0.872583                                1.0                       0.745166    2018-05-07
2025-05-22 02:46:35,824 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-07 00:00:00", "current_value": 55022.97, "expected_value": 25862.10588888889, "absolute_deviation": 29160.86411111111, "relative_deviation": 1.1275518024864117, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-07 00:00:00 значение total_sales (55022.97) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}]
2025-05-22 02:46:35,825 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,825 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-07 00:00:00", "current_value": 55022.97, "expected_value": 25862.10588888889, "absolute_deviation": 29160.86411111111, "relative_deviation": 1.1275518024864117, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-07 00:00:00 значение total_sales (55022.97) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}]
2025-05-22 02:46:35,825 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 34243, order_id: 541d81a8afee2348b192cc10df37367c, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.7452, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,825 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,826 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-07 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,827 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-07 00:00:00
2025-05-22 02:46:35,829 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
500 2018-05-07          371     55022.97  128.258671             244               371               2018-05-07  39021.418571         1.410071           0.872583                                1.0                       0.745166    2018-05-07
2025-05-22 02:46:35,830 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-05-07 00:00:00", "current_value": 55022.97, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 51326.96428571429, "deviation_in_std": 12.639785561434588, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (55022.97) отклоняется от базовой линии (3696.01) на 51326.96, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,831 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,831 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-07 00:00:00", "current_value": 55022.97, "expected_value": 25862.10588888889, "absolute_deviation": 29160.86411111111, "relative_deviation": 1.1275518024864117, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-07 00:00:00 значение total_sales (55022.97) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.7451657905183864, "explanation": {"detector_specific_info": {"date": "2018-05-07 00:00:00", "current_value": 55022.97, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 51326.96428571429, "deviation_in_std": 12.639785561434588, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (55022.97) отклоняется от базовой линии (3696.01) на 51326.96, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,832 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 34275, order_id: 78d5c205c38367a8894d4721fdbb6962, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,832 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,832 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-27 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,833 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-27 00:00:00
2025-05-22 02:46:35,835 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
612 2018-08-27           66      5418.66  74.228219              60                66               2018-08-27  14118.354286         0.383803           0.999997                                1.0                       0.999995    2018-08-27
2025-05-22 02:46:35,837 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-27 00:00:00", "current_value": 5418.66, "expected_value": 25862.10588888889, "absolute_deviation": -20443.44588888889, "relative_deviation": -0.790478779134223, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-27 00:00:00 значение total_sales (5418.66) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}]
2025-05-22 02:46:35,837 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,837 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-27 00:00:00", "current_value": 5418.66, "expected_value": 25862.10588888889, "absolute_deviation": -20443.44588888889, "relative_deviation": -0.790478779134223, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-27 00:00:00 значение total_sales (5418.66) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}]
2025-05-22 02:46:35,838 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 34275, order_id: 78d5c205c38367a8894d4721fdbb6962, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,838 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,838 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-27 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,839 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-27 00:00:00
2025-05-22 02:46:35,841 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
612 2018-08-27           66      5418.66  74.228219              60                66               2018-08-27  14118.354286         0.383803           0.999997                                1.0                       0.999995    2018-08-27
2025-05-22 02:46:35,842 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-27 00:00:00", "current_value": 5418.66, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 1722.6542857142854, "deviation_in_std": 0.4242210906280919, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (5418.66) отклоняется от базовой линии (3696.01) на 1722.65, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,842 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,842 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-27 00:00:00", "current_value": 5418.66, "expected_value": 25862.10588888889, "absolute_deviation": -20443.44588888889, "relative_deviation": -0.790478779134223, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-27 00:00:00 значение total_sales (5418.66) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.99999488222447, "explanation": {"detector_specific_info": {"date": "2018-08-27 00:00:00", "current_value": 5418.66, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 1722.6542857142854, "deviation_in_std": 0.4242210906280919, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (5418.66) отклоняется от базовой линии (3696.01) на 1722.65, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,843 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 35286, order_id: 46bda15a7762d32270b8141ad9c27c2c, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,843 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,844 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-11 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,845 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-11 00:00:00
2025-05-22 02:46:35,848 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
535 2018-06-11          294      50947.4  145.981089             194               294               2018-06-11  33767.525714         1.508769           0.913597                                1.0                       0.827194    2018-06-11
2025-05-22 02:46:35,848 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-11 00:00:00", "current_value": 50947.4, "expected_value": 25862.10588888889, "absolute_deviation": 25085.29411111111, "relative_deviation": 0.969963320809404, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-11 00:00:00 значение total_sales (50947.40) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}]
2025-05-22 02:46:35,848 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,849 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-11 00:00:00", "current_value": 50947.4, "expected_value": 25862.10588888889, "absolute_deviation": 25085.29411111111, "relative_deviation": 0.969963320809404, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-11 00:00:00 значение total_sales (50947.40) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}]
2025-05-22 02:46:35,849 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 35286, order_id: 46bda15a7762d32270b8141ad9c27c2c, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.8272, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,849 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,849 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-11 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,852 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-11 00:00:00
2025-05-22 02:46:35,854 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
535 2018-06-11          294      50947.4  145.981089             194               294               2018-06-11  33767.525714         1.508769           0.913597                                1.0                       0.827194    2018-06-11
2025-05-22 02:46:35,854 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-06-11 00:00:00", "current_value": 50947.4, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 47251.39428571429, "deviation_in_std": 11.636135110691802, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (50947.40) отклоняется от базовой линии (3696.01) на 47251.39, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,855 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,855 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-11 00:00:00", "current_value": 50947.4, "expected_value": 25862.10588888889, "absolute_deviation": 25085.29411111111, "relative_deviation": 0.969963320809404, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-11 00:00:00 значение total_sales (50947.40) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.8271941215028522, "explanation": {"detector_specific_info": {"date": "2018-06-11 00:00:00", "current_value": 50947.4, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 47251.39428571429, "deviation_in_std": 11.636135110691802, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (50947.40) отклоняется от базовой линии (3696.01) на 47251.39, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,855 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 36087, order_id: a5faf579cc2b53168cc080836b834078, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,856 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,856 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-28 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,857 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-28 00:00:00
2025-05-22 02:46:35,860 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
613 2018-08-28           39      3757.51  79.947021              35                39               2018-08-28  10839.574286         0.346647                1.0                                1.0                            1.0    2018-08-28
2025-05-22 02:46:35,860 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-28 00:00:00", "current_value": 3757.51, "expected_value": 26189.295057471263, "absolute_deviation": -22431.785057471265, "relative_deviation": -0.8565249659544365, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-28 00:00:00 значение total_sales (3757.51) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}]
2025-05-22 02:46:35,861 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,861 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-28 00:00:00", "current_value": 3757.51, "expected_value": 26189.295057471263, "absolute_deviation": -22431.785057471265, "relative_deviation": -0.8565249659544365, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-28 00:00:00 значение total_sales (3757.51) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}]
2025-05-22 02:46:35,861 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 36087, order_id: a5faf579cc2b53168cc080836b834078, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,862 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,862 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-28 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,863 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-28 00:00:00
2025-05-22 02:46:35,866 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
613 2018-08-28           39      3757.51  79.947021              35                39               2018-08-28  10839.574286         0.346647                1.0                                1.0                            1.0    2018-08-28
2025-05-22 02:46:35,867 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-28 00:00:00", "current_value": 3757.51, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 61.50428571428574, "deviation_in_std": 0.015146054191132996, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (3757.51) отклоняется от базовой линии (3696.01) на 61.50, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,867 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,868 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-28 00:00:00", "current_value": 3757.51, "expected_value": 26189.295057471263, "absolute_deviation": -22431.785057471265, "relative_deviation": -0.8565249659544365, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-28 00:00:00 значение total_sales (3757.51) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 1.0, "explanation": {"detector_specific_info": {"date": "2018-08-28 00:00:00", "current_value": 3757.51, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 61.50428571428574, "deviation_in_std": 0.015146054191132996, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (3757.51) отклоняется от базовой линии (3696.01) на 61.50, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,868 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 36505, order_id: 283bf5d2f306422175c079231da015f7, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,868 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,868 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-03 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,869 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-03 00:00:00
2025-05-22 02:46:35,872 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
588 2018-08-03          314     45036.63  125.10175             216               314               2018-08-03  39138.992857         1.150684           0.972436                                1.0                       0.944872    2018-08-03
2025-05-22 02:46:35,873 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-03 00:00:00", "current_value": 45036.63, "expected_value": 23364.508863636365, "absolute_deviation": 21672.121136363632, "relative_deviation": 0.9275658762120739, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-03 00:00:00 значение total_sales (45036.63) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}]
2025-05-22 02:46:35,873 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,873 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-03 00:00:00", "current_value": 45036.63, "expected_value": 23364.508863636365, "absolute_deviation": 21672.121136363632, "relative_deviation": 0.9275658762120739, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-03 00:00:00 значение total_sales (45036.63) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}]
2025-05-22 02:46:35,873 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 36505, order_id: 283bf5d2f306422175c079231da015f7, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9449, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,874 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,874 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-03 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,875 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-03 00:00:00
2025-05-22 02:46:35,876 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
588 2018-08-03          314     45036.63  125.10175             216               314               2018-08-03  39138.992857         1.150684           0.972436                                1.0                       0.944872    2018-08-03
2025-05-22 02:46:35,877 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-03 00:00:00", "current_value": 45036.63, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 41340.624285714286, "deviation_in_std": 10.18054804563417, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (45036.63) отклоняется от базовой линии (3696.01) на 41340.62, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,877 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,878 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-03 00:00:00", "current_value": 45036.63, "expected_value": 23364.508863636365, "absolute_deviation": 21672.121136363632, "relative_deviation": 0.9275658762120739, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-03 00:00:00 значение total_sales (45036.63) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9448723295452219, "explanation": {"detector_specific_info": {"date": "2018-08-03 00:00:00", "current_value": 45036.63, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 41340.624285714286, "deviation_in_std": 10.18054804563417, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (45036.63) отклоняется от базовой линии (3696.01) на 41340.62, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,878 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 37597, order_id: a8e5aabb9432e7bedd2907661abb81d9, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.8479, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,879 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,879 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-16 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,880 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-16 00:00:00
2025-05-22 02:46:35,883 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
601 2018-08-16          318     39447.94  105.758552             214               318               2018-08-16  37552.242857         1.050482           0.916391                           0.847864                       0.984918    2018-08-16
2025-05-22 02:46:35,883 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-16 00:00:00", "current_value": 39447.94, "expected_value": 24263.594318181815, "absolute_deviation": 15184.345681818188, "relative_deviation": 0.6258077629677424, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-16 00:00:00 значение total_sales (39447.94) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}]
2025-05-22 02:46:35,884 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,884 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8478639396580963, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-16 00:00:00", "current_value": 39447.94, "expected_value": 24263.594318181815, "absolute_deviation": 15184.345681818188, "relative_deviation": 0.6258077629677424, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-16 00:00:00 значение total_sales (39447.94) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}]
2025-05-22 02:46:35,885 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 37597, order_id: a8e5aabb9432e7bedd2907661abb81d9, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9849, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,885 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,886 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-16 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,887 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-16 00:00:00
2025-05-22 02:46:35,889 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
601 2018-08-16          318     39447.94  105.758552             214               318               2018-08-16  37552.242857         1.050482           0.916391                           0.847864                       0.984918    2018-08-16
2025-05-22 02:46:35,889 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-16 00:00:00", "current_value": 39447.94, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 35751.93428571429, "deviation_in_std": 8.80427644741314, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (39447.94) отклоняется от базовой линии (3696.01) на 35751.93, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,890 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,890 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8478639396580963, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-16 00:00:00", "current_value": 39447.94, "expected_value": 24263.594318181815, "absolute_deviation": 15184.345681818188, "relative_deviation": 0.6258077629677424, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-16 00:00:00 значение total_sales (39447.94) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.984918459587866, "explanation": {"detector_specific_info": {"date": "2018-08-16 00:00:00", "current_value": 39447.94, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 35751.93428571429, "deviation_in_std": 8.80427644741314, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (39447.94) отклоняется от базовой линии (3696.01) на 35751.93, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,890 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 38307, order_id: 0436c197b0ba8265af9fa94b7f444866, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.2171, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:35,890 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 38307, order_id: 0436c197b0ba8265af9fa94b7f444866, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.7849, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,890 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:35,891 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=7299e27ed73d2ad986de7f7c77d919fa in aggregated_behavior_data_with_scores
2025-05-22 02:46:35,892 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:35,895 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                             seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                                   categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
1412  7299e27ed73d2ad986de7f7c77d919fa   98.885094  148.935573    371       5.99     1500.0     19.280997    10.805647  [consoles_games, brinquedos, bebes, utilidades_domesticas, esporte_lazer, eletroportateis, alimentos, cool_stuff, automotivo, artes, relogios_presentes, moveis_decoracao, cama_mesa_banho]              13          1.506148         250.417362                0.194984                 13             0.03504              0.791985         0.50099                          0.217125                                   0.784855
2025-05-22 02:46:35,896 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}]
2025-05-22 02:46:35,896 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,896 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.7848545894928308, "explanation": {"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}}]
2025-05-22 02:46:35,897 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 38307, order_id: 0436c197b0ba8265af9fa94b7f444866, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,897 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,897 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-07 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,899 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-07 00:00:00
2025-05-22 02:46:35,901 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
592 2018-08-07          366      50588.5  114.973864             252               366               2018-08-07  44125.211429         1.146476           0.979335                                1.0                        0.95867    2018-08-07
2025-05-22 02:46:35,902 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-07 00:00:00", "current_value": 50588.5, "expected_value": 26189.295057471263, "absolute_deviation": 24399.204942528737, "relative_deviation": 0.9316480221779834, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-07 00:00:00 значение total_sales (50588.50) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}]
2025-05-22 02:46:35,902 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,903 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-07 00:00:00", "current_value": 50588.5, "expected_value": 26189.295057471263, "absolute_deviation": 24399.204942528737, "relative_deviation": 0.9316480221779834, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-07 00:00:00 значение total_sales (50588.50) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}]
2025-05-22 02:46:35,903 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 38307, order_id: 0436c197b0ba8265af9fa94b7f444866, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9587, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,903 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,903 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-07 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,904 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-07 00:00:00
2025-05-22 02:46:35,907 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
592 2018-08-07          366      50588.5  114.973864             252               366               2018-08-07  44125.211429         1.146476           0.979335                                1.0                        0.95867    2018-08-07
2025-05-22 02:46:35,908 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-07 00:00:00", "current_value": 50588.5, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 46892.49428571429, "deviation_in_std": 11.547752345392325, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (50588.50) отклоняется от базовой линии (3696.01) на 46892.49, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,908 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,908 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-07 00:00:00", "current_value": 50588.5, "expected_value": 26189.295057471263, "absolute_deviation": 24399.204942528737, "relative_deviation": 0.9316480221779834, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-07 00:00:00 значение total_sales (50588.50) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.95867015383243, "explanation": {"detector_specific_info": {"date": "2018-08-07 00:00:00", "current_value": 50588.5, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 46892.49428571429, "deviation_in_std": 11.547752345392325, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (50588.50) отклоняется от базовой линии (3696.01) на 46892.49, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,909 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 39504, order_id: da36f0ed6b7669628846afd6d75a9a7c, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,909 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,909 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-03-04 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,910 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-03-04 00:00:00
2025-05-22 02:46:35,913 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
436 2018-03-04          235     33414.96   130.0193             149               235               2018-03-04      38243.36         0.873745           0.790902                                1.0                       0.581803    2018-03-04
2025-05-22 02:46:35,914 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-03-04 00:00:00", "current_value": 33414.96, "expected_value": 18683.428202247193, "absolute_deviation": 14731.531797752807, "relative_deviation": 0.7884811951149809, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-03-04 00:00:00 значение total_sales (33414.96) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}]
2025-05-22 02:46:35,914 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,915 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-03-04 00:00:00", "current_value": 33414.96, "expected_value": 18683.428202247193, "absolute_deviation": 14731.531797752807, "relative_deviation": 0.7884811951149809, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-03-04 00:00:00 значение total_sales (33414.96) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}]
2025-05-22 02:46:35,915 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 39504, order_id: da36f0ed6b7669628846afd6d75a9a7c, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.5818, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,915 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,916 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-03-04 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,917 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-03-04 00:00:00
2025-05-22 02:46:35,919 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
436 2018-03-04          235     33414.96   130.0193             149               235               2018-03-04      38243.36         0.873745           0.790902                                1.0                       0.581803    2018-03-04
2025-05-22 02:46:35,920 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-03-04 00:00:00", "current_value": 33414.96, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 29718.954285714284, "deviation_in_std": 7.318593930287384, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (33414.96) отклоняется от базовой линии (3696.01) на 29718.95, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,921 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,921 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-03-04 00:00:00", "current_value": 33414.96, "expected_value": 18683.428202247193, "absolute_deviation": 14731.531797752807, "relative_deviation": 0.7884811951149809, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-03-04 00:00:00 значение total_sales (33414.96) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.5818032964995707, "explanation": {"detector_specific_info": {"date": "2018-03-04 00:00:00", "current_value": 33414.96, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 29718.954285714284, "deviation_in_std": 7.318593930287384, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (33414.96) отклоняется от базовой линии (3696.01) на 29718.95, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,922 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 40324, order_id: d3f66901a6743e15f9311547cc623b91, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.9953, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,922 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,922 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-03-21 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,923 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-03-21 00:00:00
2025-05-22 02:46:35,925 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
453 2018-03-21          285     42125.89  126.885211             188               285               2018-03-21  37613.352857         1.119972           0.810575                           0.995318                       0.625833    2018-03-21
2025-05-22 02:46:35,926 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-03-21 00:00:00", "current_value": 42125.89, "expected_value": 25669.474712643678, "absolute_deviation": 16456.41528735632, "relative_deviation": 0.6410888992305948, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-03-21 00:00:00 значение total_sales (42125.89) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}]
2025-05-22 02:46:35,926 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,926 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.99531778455973, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-03-21 00:00:00", "current_value": 42125.89, "expected_value": 25669.474712643678, "absolute_deviation": 16456.41528735632, "relative_deviation": 0.6410888992305948, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-03-21 00:00:00 значение total_sales (42125.89) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}]
2025-05-22 02:46:35,927 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 40324, order_id: d3f66901a6743e15f9311547cc623b91, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.6258, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,927 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,927 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-03-21 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,929 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-03-21 00:00:00
2025-05-22 02:46:35,931 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
453 2018-03-21          285     42125.89  126.885211             188               285               2018-03-21  37613.352857         1.119972           0.810575                           0.995318                       0.625833    2018-03-21
2025-05-22 02:46:35,932 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-03-21 00:00:00", "current_value": 42125.89, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 38429.88428571429, "deviation_in_std": 9.463748797186701, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (42125.89) отклоняется от базовой линии (3696.01) на 38429.88, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,932 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,933 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.99531778455973, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-03-21 00:00:00", "current_value": 42125.89, "expected_value": 25669.474712643678, "absolute_deviation": 16456.41528735632, "relative_deviation": 0.6410888992305948, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-03-21 00:00:00 значение total_sales (42125.89) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.625832733657226, "explanation": {"detector_specific_info": {"date": "2018-03-21 00:00:00", "current_value": 42125.89, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 38429.88428571429, "deviation_in_std": 9.463748797186701, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (42125.89) отклоняется от базовой линии (3696.01) на 38429.88, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,933 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 41057, order_id: 0b39d78b430d574a6eafefe82c11b4a3, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1697, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:35,934 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 41057, order_id: 0b39d78b430d574a6eafefe82c11b4a3, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9836, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,934 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:35,934 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=4a3ccda38b2129705f3fb522db62ca31 in aggregated_behavior_data_with_scores
2025-05-22 02:46:35,936 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:35,938 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                               categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
882  4a3ccda38b2129705f3fb522db62ca31  233.158916  370.889347     83        9.9     3099.9     18.396747     9.418922  [construcao_ferramentas_seguranca, casa_construcao, ferramentas_jardim, construcao_ferramentas_construcao, eletronicos]               5          1.590715         313.121212                0.078902                  5            0.060241               0.53771        0.576635                          0.169668                                   0.983603
2025-05-22 02:46:35,938 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}]
2025-05-22 02:46:35,939 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,939 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.9836033466098753, "explanation": {"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}}]
2025-05-22 02:46:35,939 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 41057, order_id: 0b39d78b430d574a6eafefe82c11b4a3, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,939 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,940 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-03-01 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,941 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-03-01 00:00:00
2025-05-22 02:46:35,943 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
433 2018-03-01          275     41005.54  124.259212             172               275               2018-03-01  37233.151429         1.101318           0.787467                                1.0                       0.574933    2018-03-01
2025-05-22 02:46:35,944 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-03-01 00:00:00", "current_value": 41005.54, "expected_value": 24263.594318181815, "absolute_deviation": 16741.945681818186, "relative_deviation": 0.6900027037326735, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-03-01 00:00:00 значение total_sales (41005.54) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}]
2025-05-22 02:46:35,945 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,945 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-03-01 00:00:00", "current_value": 41005.54, "expected_value": 24263.594318181815, "absolute_deviation": 16741.945681818186, "relative_deviation": 0.6900027037326735, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-03-01 00:00:00 значение total_sales (41005.54) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}]
2025-05-22 02:46:35,945 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 41057, order_id: 0b39d78b430d574a6eafefe82c11b4a3, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.5749, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,945 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,946 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-03-01 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,947 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-03-01 00:00:00
2025-05-22 02:46:35,949 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
433 2018-03-01          275     41005.54  124.259212             172               275               2018-03-01  37233.151429         1.101318           0.787467                                1.0                       0.574933    2018-03-01
2025-05-22 02:46:35,949 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-03-01 00:00:00", "current_value": 41005.54, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 37309.53428571429, "deviation_in_std": 9.187851246049147, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (41005.54) отклоняется от базовой линии (3696.01) на 37309.53, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,950 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,950 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-03-01 00:00:00", "current_value": 41005.54, "expected_value": 24263.594318181815, "absolute_deviation": 16741.945681818186, "relative_deviation": 0.6900027037326735, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-03-01 00:00:00 значение total_sales (41005.54) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.5749330365526751, "explanation": {"detector_specific_info": {"date": "2018-03-01 00:00:00", "current_value": 41005.54, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 37309.53428571429, "deviation_in_std": 9.187851246049147, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (41005.54) отклоняется от базовой линии (3696.01) на 37309.53, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,950 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 41315, order_id: 0d556f5bfd6f6a807960f7e971e8dfd9, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1769, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:35,951 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 41315, order_id: 0d556f5bfd6f6a807960f7e971e8dfd9, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9184, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,951 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:35,951 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=36a968b544695394e4e9d7572688598f in aggregated_behavior_data_with_scores
2025-05-22 02:46:35,952 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:35,955 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                        categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
642  36a968b544695394e4e9d7572688598f   56.522384  136.831171    172        3.9     1140.9     13.350814      5.53097  [informatica_acessorios, beleza_saude, telefonia, automotivo, tablets_impressao_imagem, instrumentos_musicais, ferramentas_jardim, cool_stuff, consoles_games, moveis_decoracao]              10          2.420832         292.538462                0.236204                 10             0.05814              0.719612        0.547647                          0.176931                                   0.918363
2025-05-22 02:46:35,956 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}]
2025-05-22 02:46:35,956 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,957 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.918363395536566, "explanation": {"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}}]
2025-05-22 02:46:35,957 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 41315, order_id: 0d556f5bfd6f6a807960f7e971e8dfd9, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.7518, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,957 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,957 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-18 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,958 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-18 00:00:00
2025-05-22 02:46:35,960 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
542 2018-06-18          246     35911.86  120.915354             159               246               2018-06-18  30750.262857         1.167855           0.797394                           0.751835                       0.842952    2018-06-18
2025-05-22 02:46:35,961 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-18 00:00:00", "current_value": 35911.86, "expected_value": 25862.10588888889, "absolute_deviation": 10049.75411111111, "relative_deviation": 0.3885899375050032, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-18 00:00:00 значение total_sales (35911.86) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}]
2025-05-22 02:46:35,961 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,961 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7518345795661219, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-18 00:00:00", "current_value": 35911.86, "expected_value": 25862.10588888889, "absolute_deviation": 10049.75411111111, "relative_deviation": 0.3885899375050032, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-18 00:00:00 значение total_sales (35911.86) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}]
2025-05-22 02:46:35,962 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 41315, order_id: 0d556f5bfd6f6a807960f7e971e8dfd9, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.8430, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,962 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,962 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-18 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,963 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-18 00:00:00
2025-05-22 02:46:35,965 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
542 2018-06-18          246     35911.86  120.915354             159               246               2018-06-18  30750.262857         1.167855           0.797394                           0.751835                       0.842952    2018-06-18
2025-05-22 02:46:35,966 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-06-18 00:00:00", "current_value": 35911.86, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 32215.854285714286, "deviation_in_std": 7.933480881182513, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (35911.86) отклоняется от базовой линии (3696.01) на 32215.85, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,966 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,967 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7518345795661219, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-18 00:00:00", "current_value": 35911.86, "expected_value": 25862.10588888889, "absolute_deviation": 10049.75411111111, "relative_deviation": 0.3885899375050032, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-18 00:00:00 значение total_sales (35911.86) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.8429524267180292, "explanation": {"detector_specific_info": {"date": "2018-06-18 00:00:00", "current_value": 35911.86, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 32215.854285714286, "deviation_in_std": 7.933480881182513, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (35911.86) отклоняется от базовой линии (3696.01) на 32215.85, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,967 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 41887, order_id: 728935946b7371d6bf3c484ce0ad4ff1, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.2171, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:35,968 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 41887, order_id: 728935946b7371d6bf3c484ce0ad4ff1, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.7849, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,968 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:35,968 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=7299e27ed73d2ad986de7f7c77d919fa in aggregated_behavior_data_with_scores
2025-05-22 02:46:35,969 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:35,973 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                             seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                                   categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
1412  7299e27ed73d2ad986de7f7c77d919fa   98.885094  148.935573    371       5.99     1500.0     19.280997    10.805647  [consoles_games, brinquedos, bebes, utilidades_domesticas, esporte_lazer, eletroportateis, alimentos, cool_stuff, automotivo, artes, relogios_presentes, moveis_decoracao, cama_mesa_banho]              13          1.506148         250.417362                0.194984                 13             0.03504              0.791985         0.50099                          0.217125                                   0.784855
2025-05-22 02:46:35,974 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}]
2025-05-22 02:46:35,974 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,975 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.7848545894928308, "explanation": {"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}}]
2025-05-22 02:46:35,975 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 41887, order_id: 728935946b7371d6bf3c484ce0ad4ff1, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,975 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,976 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-07 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,977 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-07 00:00:00
2025-05-22 02:46:35,979 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
500 2018-05-07          371     55022.97  128.258671             244               371               2018-05-07  39021.418571         1.410071           0.872583                                1.0                       0.745166    2018-05-07
2025-05-22 02:46:35,979 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-07 00:00:00", "current_value": 55022.97, "expected_value": 25862.10588888889, "absolute_deviation": 29160.86411111111, "relative_deviation": 1.1275518024864117, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-07 00:00:00 значение total_sales (55022.97) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}]
2025-05-22 02:46:35,979 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,980 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-07 00:00:00", "current_value": 55022.97, "expected_value": 25862.10588888889, "absolute_deviation": 29160.86411111111, "relative_deviation": 1.1275518024864117, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-07 00:00:00 значение total_sales (55022.97) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}]
2025-05-22 02:46:35,980 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 41887, order_id: 728935946b7371d6bf3c484ce0ad4ff1, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.7452, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,980 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,980 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-07 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,981 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-07 00:00:00
2025-05-22 02:46:35,983 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
500 2018-05-07          371     55022.97  128.258671             244               371               2018-05-07  39021.418571         1.410071           0.872583                                1.0                       0.745166    2018-05-07
2025-05-22 02:46:35,984 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-05-07 00:00:00", "current_value": 55022.97, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 51326.96428571429, "deviation_in_std": 12.639785561434588, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (55022.97) отклоняется от базовой линии (3696.01) на 51326.96, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:35,984 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,984 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-07 00:00:00", "current_value": 55022.97, "expected_value": 25862.10588888889, "absolute_deviation": 29160.86411111111, "relative_deviation": 1.1275518024864117, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-07 00:00:00 значение total_sales (55022.97) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.7451657905183864, "explanation": {"detector_specific_info": {"date": "2018-05-07 00:00:00", "current_value": 55022.97, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 51326.96428571429, "deviation_in_std": 12.639785561434588, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (55022.97) отклоняется от базовой линии (3696.01) на 51326.96, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:35,985 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 41935, order_id: b17b0e273b31b9bdc4c86d55ce1f2b87, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.2171, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:35,985 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 41935, order_id: b17b0e273b31b9bdc4c86d55ce1f2b87, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.7849, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,985 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:35,985 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=7299e27ed73d2ad986de7f7c77d919fa in aggregated_behavior_data_with_scores
2025-05-22 02:46:35,986 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:35,989 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                             seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                                   categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
1412  7299e27ed73d2ad986de7f7c77d919fa   98.885094  148.935573    371       5.99     1500.0     19.280997    10.805647  [consoles_games, brinquedos, bebes, utilidades_domesticas, esporte_lazer, eletroportateis, alimentos, cool_stuff, automotivo, artes, relogios_presentes, moveis_decoracao, cama_mesa_banho]              13          1.506148         250.417362                0.194984                 13             0.03504              0.791985         0.50099                          0.217125                                   0.784855
2025-05-22 02:46:35,989 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}]
2025-05-22 02:46:35,990 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,990 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.7848545894928308, "explanation": {"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}}]
2025-05-22 02:46:35,990 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 41935, order_id: b17b0e273b31b9bdc4c86d55ce1f2b87, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,991 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:35,991 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-25 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,992 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-25 00:00:00
2025-05-22 02:46:35,994 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
579 2018-07-25          268     40753.19  122.750572             201               268               2018-07-25  35288.758571         1.154849           0.959618                                1.0                       0.919235    2018-07-25
2025-05-22 02:46:35,994 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-25 00:00:00", "current_value": 40753.19, "expected_value": 25669.474712643678, "absolute_deviation": 15083.715287356325, "relative_deviation": 0.5876129315543311, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-25 00:00:00 значение total_sales (40753.19) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}]
2025-05-22 02:46:35,994 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:35,995 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-25 00:00:00", "current_value": 40753.19, "expected_value": 25669.474712643678, "absolute_deviation": 15083.715287356325, "relative_deviation": 0.5876129315543311, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-25 00:00:00 значение total_sales (40753.19) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}]
2025-05-22 02:46:35,995 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 41935, order_id: b17b0e273b31b9bdc4c86d55ce1f2b87, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9192, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:35,995 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:35,995 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-25 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:35,996 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-25 00:00:00
2025-05-22 02:46:35,999 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
579 2018-07-25          268     40753.19  122.750572             201               268               2018-07-25  35288.758571         1.154849           0.959618                                1.0                       0.919235    2018-07-25
2025-05-22 02:46:36,000 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-07-25 00:00:00", "current_value": 40753.19, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 37057.18428571429, "deviation_in_std": 9.125707498979427, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (40753.19) отклоняется от базовой линии (3696.01) на 37057.18, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,000 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,000 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-25 00:00:00", "current_value": 40753.19, "expected_value": 25669.474712643678, "absolute_deviation": 15083.715287356325, "relative_deviation": 0.5876129315543311, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-25 00:00:00 значение total_sales (40753.19) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9192352183494302, "explanation": {"detector_specific_info": {"date": "2018-07-25 00:00:00", "current_value": 40753.19, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 37057.18428571429, "deviation_in_std": 9.125707498979427, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (40753.19) отклоняется от базовой линии (3696.01) на 37057.18, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,001 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 42780, order_id: a03ac1d748cc1533566bf2c8199159d4, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1769, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:36,001 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 42780, order_id: a03ac1d748cc1533566bf2c8199159d4, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9184, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,001 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:36,001 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=36a968b544695394e4e9d7572688598f in aggregated_behavior_data_with_scores
2025-05-22 02:46:36,002 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:36,006 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                        categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
642  36a968b544695394e4e9d7572688598f   56.522384  136.831171    172        3.9     1140.9     13.350814      5.53097  [informatica_acessorios, beleza_saude, telefonia, automotivo, tablets_impressao_imagem, instrumentos_musicais, ferramentas_jardim, cool_stuff, consoles_games, moveis_decoracao]              10          2.420832         292.538462                0.236204                 10             0.05814              0.719612        0.547647                          0.176931                                   0.918363
2025-05-22 02:46:36,006 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}]
2025-05-22 02:46:36,006 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,007 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.918363395536566, "explanation": {"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}}]
2025-05-22 02:46:36,007 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 42780, order_id: a03ac1d748cc1533566bf2c8199159d4, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.7472, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,007 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,007 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-09 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,008 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-09 00:00:00
2025-05-22 02:46:36,010 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
594 2018-08-09          283     42138.17  125.785582             204               283               2018-08-09  44497.781429         0.946972           0.856223                           0.747247                       0.965198    2018-08-09
2025-05-22 02:46:36,011 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-09 00:00:00", "current_value": 42138.17, "expected_value": 24263.594318181815, "absolute_deviation": 17874.575681818184, "relative_deviation": 0.7366829269983282, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-09 00:00:00 значение total_sales (42138.17) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}]
2025-05-22 02:46:36,011 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,011 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7472473831010398, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-09 00:00:00", "current_value": 42138.17, "expected_value": 24263.594318181815, "absolute_deviation": 17874.575681818184, "relative_deviation": 0.7366829269983282, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-09 00:00:00 значение total_sales (42138.17) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}]
2025-05-22 02:46:36,012 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 42780, order_id: a03ac1d748cc1533566bf2c8199159d4, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9652, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,012 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,012 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-09 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,013 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-09 00:00:00
2025-05-22 02:46:36,015 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
594 2018-08-09          283     42138.17  125.785582             204               283               2018-08-09  44497.781429         0.946972           0.856223                           0.747247                       0.965198    2018-08-09
2025-05-22 02:46:36,015 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-09 00:00:00", "current_value": 42138.17, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 38442.16428571429, "deviation_in_std": 9.466772871741947, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (42138.17) отклоняется от базовой линии (3696.01) на 38442.16, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,015 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,016 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7472473831010398, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-09 00:00:00", "current_value": 42138.17, "expected_value": 24263.594318181815, "absolute_deviation": 17874.575681818184, "relative_deviation": 0.7366829269983282, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-09 00:00:00 значение total_sales (42138.17) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9651982020506744, "explanation": {"detector_specific_info": {"date": "2018-08-09 00:00:00", "current_value": 42138.17, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 38442.16428571429, "deviation_in_std": 9.466772871741947, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (42138.17) отклоняется от базовой линии (3696.01) на 38442.16, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,016 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 42860, order_id: 90674f59a21207f91a7387785c66f340, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,016 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,017 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-14 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,018 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-14 00:00:00
2025-05-22 02:46:36,020 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
599 2018-08-14          315     44682.42  128.397759             228               315               2018-08-14  37562.228571         1.189557           0.989198                                1.0                       0.978396    2018-08-14
2025-05-22 02:46:36,021 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-14 00:00:00", "current_value": 44682.42, "expected_value": 26189.295057471263, "absolute_deviation": 18493.124942528735, "relative_deviation": 0.7061329792171336, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-14 00:00:00 значение total_sales (44682.42) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}]
2025-05-22 02:46:36,021 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,021 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-14 00:00:00", "current_value": 44682.42, "expected_value": 26189.295057471263, "absolute_deviation": 18493.124942528735, "relative_deviation": 0.7061329792171336, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-14 00:00:00 значение total_sales (44682.42) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}]
2025-05-22 02:46:36,022 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 42860, order_id: 90674f59a21207f91a7387785c66f340, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9784, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,022 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,022 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-14 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,023 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-14 00:00:00
2025-05-22 02:46:36,025 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
599 2018-08-14          315     44682.42  128.397759             228               315               2018-08-14  37562.228571         1.189557           0.989198                                1.0                       0.978396    2018-08-14
2025-05-22 02:46:36,025 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-14 00:00:00", "current_value": 44682.42, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40986.41428571429, "deviation_in_std": 10.093320240405061, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (44682.42) отклоняется от базовой линии (3696.01) на 40986.41, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,026 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,026 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-14 00:00:00", "current_value": 44682.42, "expected_value": 26189.295057471263, "absolute_deviation": 18493.124942528735, "relative_deviation": 0.7061329792171336, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-14 00:00:00 значение total_sales (44682.42) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9783962277530719, "explanation": {"detector_specific_info": {"date": "2018-08-14 00:00:00", "current_value": 44682.42, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40986.41428571429, "deviation_in_std": 10.093320240405061, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (44682.42) отклоняется от базовой линии (3696.01) на 40986.41, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,026 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 42864, order_id: 5daed524d7545b33fafd99b7a9bc03e3, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1697, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:36,027 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 42864, order_id: 5daed524d7545b33fafd99b7a9bc03e3, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9836, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,027 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:36,027 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=4a3ccda38b2129705f3fb522db62ca31 in aggregated_behavior_data_with_scores
2025-05-22 02:46:36,028 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:36,030 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                               categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
882  4a3ccda38b2129705f3fb522db62ca31  233.158916  370.889347     83        9.9     3099.9     18.396747     9.418922  [construcao_ferramentas_seguranca, casa_construcao, ferramentas_jardim, construcao_ferramentas_construcao, eletronicos]               5          1.590715         313.121212                0.078902                  5            0.060241               0.53771        0.576635                          0.169668                                   0.983603
2025-05-22 02:46:36,031 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}]
2025-05-22 02:46:36,031 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,031 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.9836033466098753, "explanation": {"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}}]
2025-05-22 02:46:36,032 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 42864, order_id: 5daed524d7545b33fafd99b7a9bc03e3, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,032 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,033 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-02-20 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,034 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-02-20 00:00:00
2025-05-22 02:46:36,037 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
424 2018-02-20          288     38878.97  118.895933             196               288               2018-02-20  32397.554286         1.200059           0.775049                                1.0                       0.550098    2018-02-20
2025-05-22 02:46:36,040 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-02-20 00:00:00", "current_value": 38878.97, "expected_value": 26189.295057471263, "absolute_deviation": 12689.674942528738, "relative_deviation": 0.4845367129845153, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-02-20 00:00:00 значение total_sales (38878.97) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}]
2025-05-22 02:46:36,040 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,041 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-02-20 00:00:00", "current_value": 38878.97, "expected_value": 26189.295057471263, "absolute_deviation": 12689.674942528738, "relative_deviation": 0.4845367129845153, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-02-20 00:00:00 значение total_sales (38878.97) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}]
2025-05-22 02:46:36,041 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 42864, order_id: 5daed524d7545b33fafd99b7a9bc03e3, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.5501, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,041 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,042 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-02-20 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,042 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-02-20 00:00:00
2025-05-22 02:46:36,046 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
424 2018-02-20          288     38878.97  118.895933             196               288               2018-02-20  32397.554286         1.200059           0.775049                                1.0                       0.550098    2018-02-20
2025-05-22 02:46:36,047 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-02-20 00:00:00", "current_value": 38878.97, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 35182.96428571429, "deviation_in_std": 8.664161813887246, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (38878.97) отклоняется от базовой линии (3696.01) на 35182.96, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,047 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,048 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-02-20 00:00:00", "current_value": 38878.97, "expected_value": 26189.295057471263, "absolute_deviation": 12689.674942528738, "relative_deviation": 0.4845367129845153, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-02-20 00:00:00 значение total_sales (38878.97) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.5500979588691446, "explanation": {"detector_specific_info": {"date": "2018-02-20 00:00:00", "current_value": 38878.97, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 35182.96428571429, "deviation_in_std": 8.664161813887246, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (38878.97) отклоняется от базовой линии (3696.01) на 35182.96, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,048 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 44633, order_id: 53c71d3953507c6239ff73917ed358c9, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.9649, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,048 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,049 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-24 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,050 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-24 00:00:00
2025-05-22 02:46:36,052 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
578 2018-07-24          270     42310.55  136.485645             193               270               2018-07-24  35999.875714         1.175297           0.940544                           0.964937                       0.916152    2018-07-24
2025-05-22 02:46:36,053 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-24 00:00:00", "current_value": 42310.55, "expected_value": 26189.295057471263, "absolute_deviation": 16121.25494252874, "relative_deviation": 0.6155665857806157, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-24 00:00:00 значение total_sales (42310.55) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}]
2025-05-22 02:46:36,053 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,053 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9649365873203745, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-24 00:00:00", "current_value": 42310.55, "expected_value": 26189.295057471263, "absolute_deviation": 16121.25494252874, "relative_deviation": 0.6155665857806157, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-24 00:00:00 значение total_sales (42310.55) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}]
2025-05-22 02:46:36,054 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 44633, order_id: 53c71d3953507c6239ff73917ed358c9, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9162, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,054 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,054 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-24 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,055 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-24 00:00:00
2025-05-22 02:46:36,056 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
578 2018-07-24          270     42310.55  136.485645             193               270               2018-07-24  35999.875714         1.175297           0.940544                           0.964937                       0.916152    2018-07-24
2025-05-22 02:46:36,057 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-07-24 00:00:00", "current_value": 42310.55, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 38614.54428571429, "deviation_in_std": 9.509223195181132, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (42310.55) отклоняется от базовой линии (3696.01) на 38614.54, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,057 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,057 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9649365873203745, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-24 00:00:00", "current_value": 42310.55, "expected_value": 26189.295057471263, "absolute_deviation": 16121.25494252874, "relative_deviation": 0.6155665857806157, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-24 00:00:00 значение total_sales (42310.55) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9161516876857093, "explanation": {"detector_specific_info": {"date": "2018-07-24 00:00:00", "current_value": 42310.55, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 38614.54428571429, "deviation_in_std": 9.509223195181132, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (42310.55) отклоняется от базовой линии (3696.01) на 38614.54, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,057 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 44780, order_id: 846115786f1191946815c3b270d72d9c, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1697, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:36,058 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 44780, order_id: 846115786f1191946815c3b270d72d9c, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9836, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,058 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:36,058 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=4a3ccda38b2129705f3fb522db62ca31 in aggregated_behavior_data_with_scores
2025-05-22 02:46:36,059 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:36,062 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                               categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
882  4a3ccda38b2129705f3fb522db62ca31  233.158916  370.889347     83        9.9     3099.9     18.396747     9.418922  [construcao_ferramentas_seguranca, casa_construcao, ferramentas_jardim, construcao_ferramentas_construcao, eletronicos]               5          1.590715         313.121212                0.078902                  5            0.060241               0.53771        0.576635                          0.169668                                   0.983603
2025-05-22 02:46:36,063 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}]
2025-05-22 02:46:36,063 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,063 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.9836033466098753, "explanation": {"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}}]
2025-05-22 02:46:36,063 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 44780, order_id: 846115786f1191946815c3b270d72d9c, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.5244, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,063 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,064 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-19 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,065 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-19 00:00:00
2025-05-22 02:46:36,068 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
604 2018-08-19          204     26690.75  113.57766             161               204               2018-08-19  36784.137143         0.725605           0.757877                           0.524438                       0.991316    2018-08-19
2025-05-22 02:46:36,068 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-19 00:00:00", "current_value": 26690.75, "expected_value": 18683.428202247193, "absolute_deviation": 8007.3217977528075, "relative_deviation": 0.4285788299167552, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-19 00:00:00 значение total_sales (26690.75) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}]
2025-05-22 02:46:36,069 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,069 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.5244375762358573, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-19 00:00:00", "current_value": 26690.75, "expected_value": 18683.428202247193, "absolute_deviation": 8007.3217977528075, "relative_deviation": 0.4285788299167552, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-19 00:00:00 значение total_sales (26690.75) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}]
2025-05-22 02:46:36,069 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 44780, order_id: 846115786f1191946815c3b270d72d9c, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9913, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,069 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,069 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-19 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,070 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-19 00:00:00
2025-05-22 02:46:36,072 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
604 2018-08-19          204     26690.75  113.57766             161               204               2018-08-19  36784.137143         0.725605           0.757877                           0.524438                       0.991316    2018-08-19
2025-05-22 02:46:36,073 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-19 00:00:00", "current_value": 26690.75, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 22994.744285714285, "deviation_in_std": 5.6626890145604705, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (26690.75) отклоняется от базовой линии (3696.01) на 22994.74, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,073 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,074 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.5244375762358573, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-19 00:00:00", "current_value": 26690.75, "expected_value": 18683.428202247193, "absolute_deviation": 8007.3217977528075, "relative_deviation": 0.4285788299167552, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-19 00:00:00 значение total_sales (26690.75) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9913157618538867, "explanation": {"detector_specific_info": {"date": "2018-08-19 00:00:00", "current_value": 26690.75, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 22994.744285714285, "deviation_in_std": 5.6626890145604705, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (26690.75) отклоняется от базовой линии (3696.01) на 22994.74, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,074 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 45720, order_id: 10feb46f47b85fa9eee572eb5521dd54, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1769, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:36,074 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 45720, order_id: 10feb46f47b85fa9eee572eb5521dd54, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9184, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,075 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:36,075 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=36a968b544695394e4e9d7572688598f in aggregated_behavior_data_with_scores
2025-05-22 02:46:36,076 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:36,078 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                        categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
642  36a968b544695394e4e9d7572688598f   56.522384  136.831171    172        3.9     1140.9     13.350814      5.53097  [informatica_acessorios, beleza_saude, telefonia, automotivo, tablets_impressao_imagem, instrumentos_musicais, ferramentas_jardim, cool_stuff, consoles_games, moveis_decoracao]              10          2.420832         292.538462                0.236204                 10             0.05814              0.719612        0.547647                          0.176931                                   0.918363
2025-05-22 02:46:36,078 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}]
2025-05-22 02:46:36,079 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,079 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.918363395536566, "explanation": {"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}}]
2025-05-22 02:46:36,079 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 45720, order_id: 10feb46f47b85fa9eee572eb5521dd54, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,079 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,080 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-10 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,082 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-10 00:00:00
2025-05-22 02:46:36,084 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
503 2018-05-10          279     59975.66  173.340058             188               279               2018-05-10  43773.748571         1.370128           0.878504                                1.0                       0.757007    2018-05-10
2025-05-22 02:46:36,084 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-10 00:00:00", "current_value": 59975.66, "expected_value": 24263.594318181815, "absolute_deviation": 35712.06568181819, "relative_deviation": 1.47183740436418, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-10 00:00:00 значение total_sales (59975.66) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}]
2025-05-22 02:46:36,084 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,085 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-10 00:00:00", "current_value": 59975.66, "expected_value": 24263.594318181815, "absolute_deviation": 35712.06568181819, "relative_deviation": 1.47183740436418, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-10 00:00:00 значение total_sales (59975.66) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}]
2025-05-22 02:46:36,085 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 45720, order_id: 10feb46f47b85fa9eee572eb5521dd54, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.7570, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,085 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,085 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-10 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,087 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-10 00:00:00
2025-05-22 02:46:36,089 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
503 2018-05-10          279     59975.66  173.340058             188               279               2018-05-10  43773.748571         1.370128           0.878504                                1.0                       0.757007    2018-05-10
2025-05-22 02:46:36,089 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-05-10 00:00:00", "current_value": 59975.66, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 56279.65428571429, "deviation_in_std": 13.859435708748775, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (59975.66) отклоняется от базовой линии (3696.01) на 56279.65, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,090 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,090 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-10 00:00:00", "current_value": 59975.66, "expected_value": 24263.594318181815, "absolute_deviation": 35712.06568181819, "relative_deviation": 1.47183740436418, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-10 00:00:00 значение total_sales (59975.66) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.7570070504564511, "explanation": {"detector_specific_info": {"date": "2018-05-10 00:00:00", "current_value": 59975.66, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 56279.65428571429, "deviation_in_std": 13.859435708748775, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (59975.66) отклоняется от базовой линии (3696.01) на 56279.65, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,090 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 46487, order_id: ebb30219be9942791cb365838ca0dcc5, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1697, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:36,091 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 46487, order_id: ebb30219be9942791cb365838ca0dcc5, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9836, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,091 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:36,091 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=4a3ccda38b2129705f3fb522db62ca31 in aggregated_behavior_data_with_scores
2025-05-22 02:46:36,092 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:36,095 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                               categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
882  4a3ccda38b2129705f3fb522db62ca31  233.158916  370.889347     83        9.9     3099.9     18.396747     9.418922  [construcao_ferramentas_seguranca, casa_construcao, ferramentas_jardim, construcao_ferramentas_construcao, eletronicos]               5          1.590715         313.121212                0.078902                  5            0.060241               0.53771        0.576635                          0.169668                                   0.983603
2025-05-22 02:46:36,096 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}]
2025-05-22 02:46:36,096 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,096 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.9836033466098753, "explanation": {"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}}]
2025-05-22 02:46:36,097 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 46487, order_id: ebb30219be9942791cb365838ca0dcc5, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.8463, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,097 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,097 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-08 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,098 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-08 00:00:00
2025-05-22 02:46:36,100 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
501 2018-05-08          327     48373.71  125.973203             216               327               2018-05-08  40997.807143          1.17991           0.797591                           0.846298                       0.748883    2018-05-08
2025-05-22 02:46:36,101 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-08 00:00:00", "current_value": 48373.71, "expected_value": 26189.295057471263, "absolute_deviation": 22184.414942528736, "relative_deviation": 0.8470794992322629, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-08 00:00:00 значение total_sales (48373.71) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}]
2025-05-22 02:46:36,101 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,101 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8462982708976428, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-08 00:00:00", "current_value": 48373.71, "expected_value": 26189.295057471263, "absolute_deviation": 22184.414942528736, "relative_deviation": 0.8470794992322629, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-08 00:00:00 значение total_sales (48373.71) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}]
2025-05-22 02:46:36,102 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 46487, order_id: ebb30219be9942791cb365838ca0dcc5, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.7489, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,102 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,102 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-08 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,103 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-08 00:00:00
2025-05-22 02:46:36,105 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
501 2018-05-08          327     48373.71  125.973203             216               327               2018-05-08  40997.807143          1.17991           0.797591                           0.846298                       0.748883    2018-05-08
2025-05-22 02:46:36,105 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-05-08 00:00:00", "current_value": 48373.71, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 44677.70428571429, "deviation_in_std": 11.002337843420673, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (48373.71) отклоняется от базовой линии (3696.01) на 44677.70, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,106 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,106 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8462982708976428, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-08 00:00:00", "current_value": 48373.71, "expected_value": 26189.295057471263, "absolute_deviation": 22184.414942528736, "relative_deviation": 0.8470794992322629, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-08 00:00:00 значение total_sales (48373.71) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.7488834251364803, "explanation": {"detector_specific_info": {"date": "2018-05-08 00:00:00", "current_value": 48373.71, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 44677.70428571429, "deviation_in_std": 11.002337843420673, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (48373.71) отклоняется от базовой линии (3696.01) на 44677.70, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,106 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 46969, order_id: 57e15c1ad29a85e248eeefad05d29453, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,107 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,107 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-31 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,108 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-31 00:00:00
2025-05-22 02:46:36,110 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
585 2018-07-31          320     46295.06  119.935389             220               320               2018-07-31  36263.578571         1.276627           0.967561                                1.0                       0.935121    2018-07-31
2025-05-22 02:46:36,110 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-31 00:00:00", "current_value": 46295.06, "expected_value": 26189.295057471263, "absolute_deviation": 20105.764942528735, "relative_deviation": 0.7677092834460612, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-31 00:00:00 значение total_sales (46295.06) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}]
2025-05-22 02:46:36,111 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,111 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-31 00:00:00", "current_value": 46295.06, "expected_value": 26189.295057471263, "absolute_deviation": 20105.764942528735, "relative_deviation": 0.7677092834460612, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-31 00:00:00 значение total_sales (46295.06) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}]
2025-05-22 02:46:36,111 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 46969, order_id: 57e15c1ad29a85e248eeefad05d29453, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9351, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,111 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,112 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-31 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,113 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-31 00:00:00
2025-05-22 02:46:36,115 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
585 2018-07-31          320     46295.06  119.935389             220               320               2018-07-31  36263.578571         1.276627           0.967561                                1.0                       0.935121    2018-07-31
2025-05-22 02:46:36,116 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-07-31 00:00:00", "current_value": 46295.06, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 42599.05428571429, "deviation_in_std": 10.490449197308228, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (46295.06) отклоняется от базовой линии (3696.01) на 42599.05, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,116 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,116 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-31 00:00:00", "current_value": 46295.06, "expected_value": 26189.295057471263, "absolute_deviation": 20105.764942528735, "relative_deviation": 0.7677092834460612, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-31 00:00:00 значение total_sales (46295.06) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9351213363620864, "explanation": {"detector_specific_info": {"date": "2018-07-31 00:00:00", "current_value": 46295.06, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 42599.05428571429, "deviation_in_std": 10.490449197308228, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (46295.06) отклоняется от базовой линии (3696.01) на 42599.05, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,117 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 48076, order_id: d8aa886bfa7d140c2ec1c7f9a310e007, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1697, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:36,117 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 48076, order_id: d8aa886bfa7d140c2ec1c7f9a310e007, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9836, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,117 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:36,117 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=4a3ccda38b2129705f3fb522db62ca31 in aggregated_behavior_data_with_scores
2025-05-22 02:46:36,118 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:36,121 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                               categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
882  4a3ccda38b2129705f3fb522db62ca31  233.158916  370.889347     83        9.9     3099.9     18.396747     9.418922  [construcao_ferramentas_seguranca, casa_construcao, ferramentas_jardim, construcao_ferramentas_construcao, eletronicos]               5          1.590715         313.121212                0.078902                  5            0.060241               0.53771        0.576635                          0.169668                                   0.983603
2025-05-22 02:46:36,122 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}]
2025-05-22 02:46:36,122 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,122 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.9836033466098753, "explanation": {"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}}]
2025-05-22 02:46:36,122 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 48076, order_id: d8aa886bfa7d140c2ec1c7f9a310e007, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,123 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,123 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-03 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,124 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-03 00:00:00
2025-05-22 02:46:36,125 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
527 2018-06-03          191      31535.8  137.112174             149               191               2018-06-03  27063.432857         1.165255           0.903771                                1.0                       0.807541    2018-06-03
2025-05-22 02:46:36,126 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-03 00:00:00", "current_value": 31535.8, "expected_value": 18683.428202247193, "absolute_deviation": 12852.371797752807, "relative_deviation": 0.6879022232229821, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-03 00:00:00 значение total_sales (31535.80) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}]
2025-05-22 02:46:36,126 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,126 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-03 00:00:00", "current_value": 31535.8, "expected_value": 18683.428202247193, "absolute_deviation": 12852.371797752807, "relative_deviation": 0.6879022232229821, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-03 00:00:00 значение total_sales (31535.80) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}]
2025-05-22 02:46:36,127 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 48076, order_id: d8aa886bfa7d140c2ec1c7f9a310e007, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.8075, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,127 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,128 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-03 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,129 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-03 00:00:00
2025-05-22 02:46:36,131 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
527 2018-06-03          191      31535.8  137.112174             149               191               2018-06-03  27063.432857         1.165255           0.903771                                1.0                       0.807541    2018-06-03
2025-05-22 02:46:36,132 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-06-03 00:00:00", "current_value": 31535.8, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 27839.794285714284, "deviation_in_std": 6.855831720089102, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (31535.80) отклоняется от базовой линии (3696.01) на 27839.79, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,132 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,132 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-03 00:00:00", "current_value": 31535.8, "expected_value": 18683.428202247193, "absolute_deviation": 12852.371797752807, "relative_deviation": 0.6879022232229821, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-03 00:00:00 значение total_sales (31535.80) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.8075414451585549, "explanation": {"detector_specific_info": {"date": "2018-06-03 00:00:00", "current_value": 31535.8, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 27839.794285714284, "deviation_in_std": 6.855831720089102, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (31535.80) отклоняется от базовой линии (3696.01) на 27839.79, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,132 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 48148, order_id: 3f64a17e87d0fed4d084e352409882ba, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.9249, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,133 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,133 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-26 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,134 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-26 00:00:00
2025-05-22 02:46:36,135 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
611 2018-08-26           73      8295.61  97.595412              68                73               2018-08-26  18350.445714         0.452066           0.962357                           0.924862                       0.999852    2018-08-26
2025-05-22 02:46:36,136 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-26 00:00:00", "current_value": 8295.61, "expected_value": 18683.428202247193, "absolute_deviation": -10387.818202247192, "relative_deviation": -0.5559910145932304, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-26 00:00:00 значение total_sales (8295.61) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}]
2025-05-22 02:46:36,137 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,137 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9248618418135228, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-26 00:00:00", "current_value": 8295.61, "expected_value": 18683.428202247193, "absolute_deviation": -10387.818202247192, "relative_deviation": -0.5559910145932304, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-26 00:00:00 значение total_sales (8295.61) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}]
2025-05-22 02:46:36,137 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 48148, order_id: 3f64a17e87d0fed4d084e352409882ba, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9999, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,138 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,138 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-26 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,139 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-26 00:00:00
2025-05-22 02:46:36,141 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
611 2018-08-26           73      8295.61  97.595412              68                73               2018-08-26  18350.445714         0.452066           0.962357                           0.924862                       0.999852    2018-08-26
2025-05-22 02:46:36,141 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-26 00:00:00", "current_value": 8295.61, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 4599.604285714286, "deviation_in_std": 1.132699208845778, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (8295.61) отклоняется от базовой линии (3696.01) на 4599.60, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,141 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,142 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9248618418135228, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-26 00:00:00", "current_value": 8295.61, "expected_value": 18683.428202247193, "absolute_deviation": -10387.818202247192, "relative_deviation": -0.5559910145932304, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-26 00:00:00 значение total_sales (8295.61) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.99985154005168, "explanation": {"detector_specific_info": {"date": "2018-08-26 00:00:00", "current_value": 8295.61, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 4599.604285714286, "deviation_in_std": 1.132699208845778, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (8295.61) отклоняется от базовой линии (3696.01) на 4599.60, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,143 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 48153, order_id: a9424f275ec54b45085e8b3fdf21361d, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1769, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:36,143 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 48153, order_id: a9424f275ec54b45085e8b3fdf21361d, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9184, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,143 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:36,144 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=36a968b544695394e4e9d7572688598f in aggregated_behavior_data_with_scores
2025-05-22 02:46:36,145 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:36,147 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                        categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
642  36a968b544695394e4e9d7572688598f   56.522384  136.831171    172        3.9     1140.9     13.350814      5.53097  [informatica_acessorios, beleza_saude, telefonia, automotivo, tablets_impressao_imagem, instrumentos_musicais, ferramentas_jardim, cool_stuff, consoles_games, moveis_decoracao]              10          2.420832         292.538462                0.236204                 10             0.05814              0.719612        0.547647                          0.176931                                   0.918363
2025-05-22 02:46:36,147 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}]
2025-05-22 02:46:36,147 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,148 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.918363395536566, "explanation": {"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}}]
2025-05-22 02:46:36,148 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 48153, order_id: a9424f275ec54b45085e8b3fdf21361d, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.7785, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,148 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,148 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-08 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,149 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-08 00:00:00
2025-05-22 02:46:36,151 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
593 2018-08-08          315     43706.47  119.743753             215               315               2018-08-08  44012.448571         0.993048           0.870271                           0.778542                       0.961999    2018-08-08
2025-05-22 02:46:36,152 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-08 00:00:00", "current_value": 43706.47, "expected_value": 25669.474712643678, "absolute_deviation": 18036.995287356323, "relative_deviation": 0.7026632016927123, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-08 00:00:00 значение total_sales (43706.47) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}]
2025-05-22 02:46:36,152 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,152 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7785418521924519, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-08 00:00:00", "current_value": 43706.47, "expected_value": 25669.474712643678, "absolute_deviation": 18036.995287356323, "relative_deviation": 0.7026632016927123, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-08 00:00:00 значение total_sales (43706.47) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}]
2025-05-22 02:46:36,152 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 48153, order_id: a9424f275ec54b45085e8b3fdf21361d, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9620, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,153 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,153 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-08 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,154 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-08 00:00:00
2025-05-22 02:46:36,155 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
593 2018-08-08          315     43706.47  119.743753             215               315               2018-08-08  44012.448571         0.993048           0.870271                           0.778542                       0.961999    2018-08-08
2025-05-22 02:46:36,156 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-08 00:00:00", "current_value": 43706.47, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40010.46428571429, "deviation_in_std": 9.852982653907365, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (43706.47) отклоняется от базовой линии (3696.01) на 40010.46, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,156 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,157 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7785418521924519, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-08 00:00:00", "current_value": 43706.47, "expected_value": 25669.474712643678, "absolute_deviation": 18036.995287356323, "relative_deviation": 0.7026632016927123, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-08 00:00:00 значение total_sales (43706.47) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9619994271129765, "explanation": {"detector_specific_info": {"date": "2018-08-08 00:00:00", "current_value": 43706.47, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40010.46428571429, "deviation_in_std": 9.852982653907365, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (43706.47) отклоняется от базовой линии (3696.01) на 40010.46, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,157 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 49219, order_id: 39a19ca7924c05b31bae58f41df9ebb5, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1697, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:36,158 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 49219, order_id: 39a19ca7924c05b31bae58f41df9ebb5, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9836, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,158 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:36,158 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=4a3ccda38b2129705f3fb522db62ca31 in aggregated_behavior_data_with_scores
2025-05-22 02:46:36,159 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:36,161 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                               categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
882  4a3ccda38b2129705f3fb522db62ca31  233.158916  370.889347     83        9.9     3099.9     18.396747     9.418922  [construcao_ferramentas_seguranca, casa_construcao, ferramentas_jardim, construcao_ferramentas_construcao, eletronicos]               5          1.590715         313.121212                0.078902                  5            0.060241               0.53771        0.576635                          0.169668                                   0.983603
2025-05-22 02:46:36,162 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}]
2025-05-22 02:46:36,162 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,162 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.9836033466098753, "explanation": {"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}}]
2025-05-22 02:46:36,163 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 49219, order_id: 39a19ca7924c05b31bae58f41df9ebb5, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,163 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,163 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-18 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,164 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-18 00:00:00
2025-05-22 02:46:36,166 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
572 2018-07-18          305     45731.01  125.980744             203               305               2018-07-18  31945.457143         1.431534           0.950417                                1.0                       0.900833    2018-07-18
2025-05-22 02:46:36,167 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-18 00:00:00", "current_value": 45731.01, "expected_value": 25669.474712643678, "absolute_deviation": 20061.535287356324, "relative_deviation": 0.7815327548356443, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-18 00:00:00 значение total_sales (45731.01) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}]
2025-05-22 02:46:36,167 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,167 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-18 00:00:00", "current_value": 45731.01, "expected_value": 25669.474712643678, "absolute_deviation": 20061.535287356324, "relative_deviation": 0.7815327548356443, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-18 00:00:00 значение total_sales (45731.01) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}]
2025-05-22 02:46:36,167 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 49219, order_id: 39a19ca7924c05b31bae58f41df9ebb5, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9008, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,167 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,167 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-18 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,168 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-18 00:00:00
2025-05-22 02:46:36,170 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
572 2018-07-18          305     45731.01  125.980744             203               305               2018-07-18  31945.457143         1.431534           0.950417                                1.0                       0.900833    2018-07-18
2025-05-22 02:46:36,171 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-07-18 00:00:00", "current_value": 45731.01, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 42035.00428571429, "deviation_in_std": 10.35154616368558, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (45731.01) отклоняется от базовой линии (3696.01) на 42035.00, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,171 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,172 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-18 00:00:00", "current_value": 45731.01, "expected_value": 25669.474712643678, "absolute_deviation": 20061.535287356324, "relative_deviation": 0.7815327548356443, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-18 00:00:00 значение total_sales (45731.01) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9008333735128977, "explanation": {"detector_specific_info": {"date": "2018-07-18 00:00:00", "current_value": 45731.01, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 42035.00428571429, "deviation_in_std": 10.35154616368558, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (45731.01) отклоняется от базовой линии (3696.01) на 42035.00, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,172 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 49657, order_id: b904f1d4eae5c3b0b494496e96606528, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.2171, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:36,172 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 49657, order_id: b904f1d4eae5c3b0b494496e96606528, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.7849, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,172 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:36,172 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=7299e27ed73d2ad986de7f7c77d919fa in aggregated_behavior_data_with_scores
2025-05-22 02:46:36,173 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:36,176 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                             seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                                   categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
1412  7299e27ed73d2ad986de7f7c77d919fa   98.885094  148.935573    371       5.99     1500.0     19.280997    10.805647  [consoles_games, brinquedos, bebes, utilidades_domesticas, esporte_lazer, eletroportateis, alimentos, cool_stuff, automotivo, artes, relogios_presentes, moveis_decoracao, cama_mesa_banho]              13          1.506148         250.417362                0.194984                 13             0.03504              0.791985         0.50099                          0.217125                                   0.784855
2025-05-22 02:46:36,176 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}]
2025-05-22 02:46:36,177 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,177 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.7848545894928308, "explanation": {"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}}]
2025-05-22 02:46:36,177 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 49657, order_id: b904f1d4eae5c3b0b494496e96606528, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.7472, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,178 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,178 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-09 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,179 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-09 00:00:00
2025-05-22 02:46:36,181 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
594 2018-08-09          283     42138.17  125.785582             204               283               2018-08-09  44497.781429         0.946972           0.856223                           0.747247                       0.965198    2018-08-09
2025-05-22 02:46:36,182 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-09 00:00:00", "current_value": 42138.17, "expected_value": 24263.594318181815, "absolute_deviation": 17874.575681818184, "relative_deviation": 0.7366829269983282, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-09 00:00:00 значение total_sales (42138.17) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}]
2025-05-22 02:46:36,182 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,182 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7472473831010398, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-09 00:00:00", "current_value": 42138.17, "expected_value": 24263.594318181815, "absolute_deviation": 17874.575681818184, "relative_deviation": 0.7366829269983282, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-09 00:00:00 значение total_sales (42138.17) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}]
2025-05-22 02:46:36,182 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 49657, order_id: b904f1d4eae5c3b0b494496e96606528, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9652, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,182 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,183 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-09 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,184 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-09 00:00:00
2025-05-22 02:46:36,186 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
594 2018-08-09          283     42138.17  125.785582             204               283               2018-08-09  44497.781429         0.946972           0.856223                           0.747247                       0.965198    2018-08-09
2025-05-22 02:46:36,186 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-09 00:00:00", "current_value": 42138.17, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 38442.16428571429, "deviation_in_std": 9.466772871741947, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (42138.17) отклоняется от базовой линии (3696.01) на 38442.16, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,187 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,187 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7472473831010398, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-09 00:00:00", "current_value": 42138.17, "expected_value": 24263.594318181815, "absolute_deviation": 17874.575681818184, "relative_deviation": 0.7366829269983282, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-09 00:00:00 значение total_sales (42138.17) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9651982020506744, "explanation": {"detector_specific_info": {"date": "2018-08-09 00:00:00", "current_value": 42138.17, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 38442.16428571429, "deviation_in_std": 9.466772871741947, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (42138.17) отклоняется от базовой линии (3696.01) на 38442.16, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,187 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 50394, order_id: 4034b68eda61d53e7c3b417c10e8b252, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1697, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:36,187 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 50394, order_id: 4034b68eda61d53e7c3b417c10e8b252, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9836, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,187 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:36,188 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=4a3ccda38b2129705f3fb522db62ca31 in aggregated_behavior_data_with_scores
2025-05-22 02:46:36,189 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:36,192 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                               categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
882  4a3ccda38b2129705f3fb522db62ca31  233.158916  370.889347     83        9.9     3099.9     18.396747     9.418922  [construcao_ferramentas_seguranca, casa_construcao, ferramentas_jardim, construcao_ferramentas_construcao, eletronicos]               5          1.590715         313.121212                0.078902                  5            0.060241               0.53771        0.576635                          0.169668                                   0.983603
2025-05-22 02:46:36,193 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}]
2025-05-22 02:46:36,193 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,193 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.9836033466098753, "explanation": {"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}}]
2025-05-22 02:46:36,193 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 50394, order_id: 4034b68eda61d53e7c3b417c10e8b252, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.8710, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,194 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,194 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-13 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,195 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-13 00:00:00
2025-05-22 02:46:36,197 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
598 2018-08-13          288     39062.43  119.092774             211               288               2018-08-13  38405.954286         1.017093           0.922974                           0.870962                       0.974986    2018-08-13
2025-05-22 02:46:36,198 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-13 00:00:00", "current_value": 39062.43, "expected_value": 25862.10588888889, "absolute_deviation": 13200.32411111111, "relative_deviation": 0.5104118035794738, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-13 00:00:00 значение total_sales (39062.43) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}]
2025-05-22 02:46:36,198 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,198 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8709622454242683, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-13 00:00:00", "current_value": 39062.43, "expected_value": 25862.10588888889, "absolute_deviation": 13200.32411111111, "relative_deviation": 0.5104118035794738, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-13 00:00:00 значение total_sales (39062.43) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}]
2025-05-22 02:46:36,198 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 50394, order_id: 4034b68eda61d53e7c3b417c10e8b252, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9750, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,199 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,199 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-13 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,200 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-13 00:00:00
2025-05-22 02:46:36,202 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
598 2018-08-13          288     39062.43  119.092774             211               288               2018-08-13  38405.954286         1.017093           0.922974                           0.870962                       0.974986    2018-08-13
2025-05-22 02:46:36,202 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-13 00:00:00", "current_value": 39062.43, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 35366.42428571429, "deviation_in_std": 8.709340699710154, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (39062.43) отклоняется от базовой линии (3696.01) на 35366.42, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,202 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,202 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8709622454242683, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-13 00:00:00", "current_value": 39062.43, "expected_value": 25862.10588888889, "absolute_deviation": 13200.32411111111, "relative_deviation": 0.5104118035794738, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-13 00:00:00 значение total_sales (39062.43) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.97498574561089, "explanation": {"detector_specific_info": {"date": "2018-08-13 00:00:00", "current_value": 39062.43, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 35366.42428571429, "deviation_in_std": 8.709340699710154, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (39062.43) отклоняется от базовой линии (3696.01) на 35366.42, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,203 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 50687, order_id: 0b055b1ac16d0401f76e361ff96926eb, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,203 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,203 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-03 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,205 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-03 00:00:00
2025-05-22 02:46:36,208 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
496 2018-05-03          304     44364.54  119.259516             196               304               2018-05-03      34705.88           1.2783           0.866831                                1.0                       0.733663    2018-05-03
2025-05-22 02:46:36,209 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-03 00:00:00", "current_value": 44364.54, "expected_value": 24263.594318181815, "absolute_deviation": 20100.945681818186, "relative_deviation": 0.8284405607109757, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-03 00:00:00 значение total_sales (44364.54) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}]
2025-05-22 02:46:36,209 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,209 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-03 00:00:00", "current_value": 44364.54, "expected_value": 24263.594318181815, "absolute_deviation": 20100.945681818186, "relative_deviation": 0.8284405607109757, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-03 00:00:00 значение total_sales (44364.54) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}]
2025-05-22 02:46:36,209 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 50687, order_id: 0b055b1ac16d0401f76e361ff96926eb, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.7337, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,209 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,210 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-03 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,210 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-03 00:00:00
2025-05-22 02:46:36,212 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
496 2018-05-03          304     44364.54  119.259516             196               304               2018-05-03      34705.88           1.2783           0.866831                                1.0                       0.733663    2018-05-03
2025-05-22 02:46:36,213 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-05-03 00:00:00", "current_value": 44364.54, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40668.53428571429, "deviation_in_std": 10.015039066168791, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (44364.54) отклоняется от базовой линии (3696.01) на 40668.53, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,213 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,213 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-03 00:00:00", "current_value": 44364.54, "expected_value": 24263.594318181815, "absolute_deviation": 20100.945681818186, "relative_deviation": 0.8284405607109757, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-03 00:00:00 значение total_sales (44364.54) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.7336629497131427, "explanation": {"detector_specific_info": {"date": "2018-05-03 00:00:00", "current_value": 44364.54, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40668.53428571429, "deviation_in_std": 10.015039066168791, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (44364.54) отклоняется от базовой линии (3696.01) на 40668.53, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,214 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 54192, order_id: bbc45552d5a935c8786792578b3828b2, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.7472, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,214 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,214 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-09 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,215 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-09 00:00:00
2025-05-22 02:46:36,217 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
594 2018-08-09          283     42138.17  125.785582             204               283               2018-08-09  44497.781429         0.946972           0.856223                           0.747247                       0.965198    2018-08-09
2025-05-22 02:46:36,218 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-09 00:00:00", "current_value": 42138.17, "expected_value": 24263.594318181815, "absolute_deviation": 17874.575681818184, "relative_deviation": 0.7366829269983282, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-09 00:00:00 значение total_sales (42138.17) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}]
2025-05-22 02:46:36,219 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,219 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7472473831010398, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-09 00:00:00", "current_value": 42138.17, "expected_value": 24263.594318181815, "absolute_deviation": 17874.575681818184, "relative_deviation": 0.7366829269983282, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-09 00:00:00 значение total_sales (42138.17) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}]
2025-05-22 02:46:36,220 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 54192, order_id: bbc45552d5a935c8786792578b3828b2, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9652, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,220 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,220 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-09 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,221 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-09 00:00:00
2025-05-22 02:46:36,223 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
594 2018-08-09          283     42138.17  125.785582             204               283               2018-08-09  44497.781429         0.946972           0.856223                           0.747247                       0.965198    2018-08-09
2025-05-22 02:46:36,224 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-09 00:00:00", "current_value": 42138.17, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 38442.16428571429, "deviation_in_std": 9.466772871741947, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (42138.17) отклоняется от базовой линии (3696.01) на 38442.16, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,224 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,224 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7472473831010398, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-09 00:00:00", "current_value": 42138.17, "expected_value": 24263.594318181815, "absolute_deviation": 17874.575681818184, "relative_deviation": 0.7366829269983282, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-09 00:00:00 значение total_sales (42138.17) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9651982020506744, "explanation": {"detector_specific_info": {"date": "2018-08-09 00:00:00", "current_value": 42138.17, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 38442.16428571429, "deviation_in_std": 9.466772871741947, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (42138.17) отклоняется от базовой линии (3696.01) на 38442.16, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,225 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 56707, order_id: 2e7a373242af9032c112f07cf0235ee8, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,225 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,225 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-04-09 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,227 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-04-09 00:00:00
2025-05-22 02:46:36,229 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
472 2018-04-09          253     50822.63  171.698074             182               253               2018-04-09  35234.435714         1.442414            0.83588                                1.0                       0.671759    2018-04-09
2025-05-22 02:46:36,229 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-04-09 00:00:00", "current_value": 50822.63, "expected_value": 25862.10588888889, "absolute_deviation": 24960.524111111106, "relative_deviation": 0.9651388876972649, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-04-09 00:00:00 значение total_sales (50822.63) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}]
2025-05-22 02:46:36,230 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,230 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-04-09 00:00:00", "current_value": 50822.63, "expected_value": 25862.10588888889, "absolute_deviation": 24960.524111111106, "relative_deviation": 0.9651388876972649, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-04-09 00:00:00 значение total_sales (50822.63) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}]
2025-05-22 02:46:36,230 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 56707, order_id: 2e7a373242af9032c112f07cf0235ee8, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.6718, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,230 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,231 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-04-09 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,232 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-04-09 00:00:00
2025-05-22 02:46:36,234 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
472 2018-04-09          253     50822.63  171.698074             182               253               2018-04-09  35234.435714         1.442414            0.83588                                1.0                       0.671759    2018-04-09
2025-05-22 02:46:36,236 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-04-09 00:00:00", "current_value": 50822.63, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 47126.624285714286, "deviation_in_std": 11.605409232657765, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (50822.63) отклоняется от базовой линии (3696.01) на 47126.62, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,236 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,236 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-04-09 00:00:00", "current_value": 50822.63, "expected_value": 25862.10588888889, "absolute_deviation": 24960.524111111106, "relative_deviation": 0.9651388876972649, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-04-09 00:00:00 значение total_sales (50822.63) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.6717592636239356, "explanation": {"detector_specific_info": {"date": "2018-04-09 00:00:00", "current_value": 50822.63, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 47126.624285714286, "deviation_in_std": 11.605409232657765, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (50822.63) отклоняется от базовой линии (3696.01) на 47126.62, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,237 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 56992, order_id: c14d2e12b876b00738f6c4ae6329e1dc, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1769, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:36,237 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 56992, order_id: c14d2e12b876b00738f6c4ae6329e1dc, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9184, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,237 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:36,238 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=36a968b544695394e4e9d7572688598f in aggregated_behavior_data_with_scores
2025-05-22 02:46:36,239 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:36,242 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                        categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
642  36a968b544695394e4e9d7572688598f   56.522384  136.831171    172        3.9     1140.9     13.350814      5.53097  [informatica_acessorios, beleza_saude, telefonia, automotivo, tablets_impressao_imagem, instrumentos_musicais, ferramentas_jardim, cool_stuff, consoles_games, moveis_decoracao]              10          2.420832         292.538462                0.236204                 10             0.05814              0.719612        0.547647                          0.176931                                   0.918363
2025-05-22 02:46:36,242 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}]
2025-05-22 02:46:36,243 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,243 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.918363395536566, "explanation": {"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}}]
2025-05-22 02:46:36,243 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 56992, order_id: c14d2e12b876b00738f6c4ae6329e1dc, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,243 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,243 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-27 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,244 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-27 00:00:00
2025-05-22 02:46:36,246 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
612 2018-08-27           66      5418.66  74.228219              60                66               2018-08-27  14118.354286         0.383803           0.999997                                1.0                       0.999995    2018-08-27
2025-05-22 02:46:36,247 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-27 00:00:00", "current_value": 5418.66, "expected_value": 25862.10588888889, "absolute_deviation": -20443.44588888889, "relative_deviation": -0.790478779134223, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-27 00:00:00 значение total_sales (5418.66) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}]
2025-05-22 02:46:36,247 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,248 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-27 00:00:00", "current_value": 5418.66, "expected_value": 25862.10588888889, "absolute_deviation": -20443.44588888889, "relative_deviation": -0.790478779134223, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-27 00:00:00 значение total_sales (5418.66) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}]
2025-05-22 02:46:36,248 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 56992, order_id: c14d2e12b876b00738f6c4ae6329e1dc, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,248 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,248 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-27 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,249 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-27 00:00:00
2025-05-22 02:46:36,252 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
612 2018-08-27           66      5418.66  74.228219              60                66               2018-08-27  14118.354286         0.383803           0.999997                                1.0                       0.999995    2018-08-27
2025-05-22 02:46:36,267 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-27 00:00:00", "current_value": 5418.66, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 1722.6542857142854, "deviation_in_std": 0.4242210906280919, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (5418.66) отклоняется от базовой линии (3696.01) на 1722.65, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,270 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,271 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-27 00:00:00", "current_value": 5418.66, "expected_value": 25862.10588888889, "absolute_deviation": -20443.44588888889, "relative_deviation": -0.790478779134223, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-27 00:00:00 значение total_sales (5418.66) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.99999488222447, "explanation": {"detector_specific_info": {"date": "2018-08-27 00:00:00", "current_value": 5418.66, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 1722.6542857142854, "deviation_in_std": 0.4242210906280919, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (5418.66) отклоняется от базовой линии (3696.01) на 1722.65, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,272 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 57486, order_id: 4ea741e30080ceba74e43520b2a0a55a, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1697, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:36,272 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 57486, order_id: 4ea741e30080ceba74e43520b2a0a55a, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9836, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,272 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:36,272 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=4a3ccda38b2129705f3fb522db62ca31 in aggregated_behavior_data_with_scores
2025-05-22 02:46:36,276 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:36,283 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                               categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
882  4a3ccda38b2129705f3fb522db62ca31  233.158916  370.889347     83        9.9     3099.9     18.396747     9.418922  [construcao_ferramentas_seguranca, casa_construcao, ferramentas_jardim, construcao_ferramentas_construcao, eletronicos]               5          1.590715         313.121212                0.078902                  5            0.060241               0.53771        0.576635                          0.169668                                   0.983603
2025-05-22 02:46:36,285 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}]
2025-05-22 02:46:36,285 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,286 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.9836033466098753, "explanation": {"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}}]
2025-05-22 02:46:36,287 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 57486, order_id: 4ea741e30080ceba74e43520b2a0a55a, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.8575, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,289 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,290 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-15 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,291 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-15 00:00:00
2025-05-22 02:46:36,298 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
569 2018-07-15          152     31510.17  181.092931             113               152               2018-07-15  24678.191429         1.276843            0.87507                           0.857486                       0.892653    2018-07-15
2025-05-22 02:46:36,304 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-15 00:00:00", "current_value": 31510.17, "expected_value": 18683.428202247193, "absolute_deviation": 12826.741797752806, "relative_deviation": 0.6865304193054913, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-15 00:00:00 значение total_sales (31510.17) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}]
2025-05-22 02:46:36,304 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,305 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8574862818094048, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-15 00:00:00", "current_value": 31510.17, "expected_value": 18683.428202247193, "absolute_deviation": 12826.741797752806, "relative_deviation": 0.6865304193054913, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-15 00:00:00 значение total_sales (31510.17) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}]
2025-05-22 02:46:36,305 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 57486, order_id: 4ea741e30080ceba74e43520b2a0a55a, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.8927, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,305 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,306 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-15 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,307 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-15 00:00:00
2025-05-22 02:46:36,310 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
569 2018-07-15          152     31510.17  181.092931             113               152               2018-07-15  24678.191429         1.276843            0.87507                           0.857486                       0.892653    2018-07-15
2025-05-22 02:46:36,310 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-07-15 00:00:00", "current_value": 31510.17, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 27814.164285714283, "deviation_in_std": 6.849520072625671, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (31510.17) отклоняется от базовой линии (3696.01) на 27814.16, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,311 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,312 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8574862818094048, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-15 00:00:00", "current_value": 31510.17, "expected_value": 18683.428202247193, "absolute_deviation": 12826.741797752806, "relative_deviation": 0.6865304193054913, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-15 00:00:00 значение total_sales (31510.17) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.8926533197637373, "explanation": {"detector_specific_info": {"date": "2018-07-15 00:00:00", "current_value": 31510.17, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 27814.164285714283, "deviation_in_std": 6.849520072625671, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (31510.17) отклоняется от базовой линии (3696.01) на 27814.16, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,313 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 57579, order_id: 3dd5626c63f493f8b8f8788c2be24baa, level: transaction): Detector Column: 'trans_transaction_vae_price_score', Score: 0.9969, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,313 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'transaction_vae_price': TransactionVAEDetector
2025-05-22 02:46:36,319 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for transaction detector 'transaction_vae_price':
       order_item_id                          order_id                        product_id                         seller_id   price  freight_value order_purchase_timestamp                       customer_id product_category_name  product_name_lenght  product_description_lenght  product_photos_qty  product_weight_g  product_length_cm  product_height_cm  product_width_cm product_category_name_english customer_state seller_state payment_type  payment_installments  payment_value  review_score  price_deviation_from_category_mean  freight_to_price_ratio  transaction_level_score  transaction_is_anomaly  trans_transaction_vae_price_score  trans_category_price_outlier_model_score  behavior_level_score  behavior_is_anomaly  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score  time_series_level_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score  time_series_is_anomaly  multilevel_score  is_anomaly detailed_explanations_json
57579              1  3dd5626c63f493f8b8f8788c2be24baa  3a1855685a49813f60e6193864f7215e  c510bc1718f0f2961eaa42a23330681a  2699.0         306.06      2018-04-27 19:50:43  a8f345f82667eb421151dc7626147636                 bebes                 54.0                      2583.0                10.0           11450.0               57.0               78.0              44.0                          baby             SC           SP  credit_card                  10.0        3005.06           5.0                           19.887203                0.113398                 0.618731                    True                           0.996905                                  0.240557              0.379093                False                          0.147594                                   0.610592                 0.823398                           0.928073                       0.718724                    True           0.60824        True                       None
2025-05-22 02:46:36,320 - backend.ml_service.detector - DEBUG - (transaction_vae_price) Метод get_explanation_details не реализован специфично, будет использована реализация get_shap_explanations (если есть).
2025-05-22 02:46:36,322 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) [Detect_Preprocess] Scaler type: <class 'sklearn.preprocessing._data.StandardScaler'>
2025-05-22 02:46:36,322 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) [Detect_Preprocess] Scaler has mean_: True
2025-05-22 02:46:36,322 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) [Detect_Preprocess] Scaler mean_ shape: (4,)
2025-05-22 02:46:36,322 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) [Detect_Preprocess] Scaler params: {'copy': True, 'with_mean': True, 'with_std': True}
2025-05-22 02:46:36,323 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) StandardScaler обучен (mean_ присутствует). Выполняется transform.
2025-05-22 02:46:36,323 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Вычисление SHAP values для 1 экземпляров...
2025-05-22 02:46:36,323 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Используется nsamples=50 для SHAP
2025-05-22 02:46:36,324 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) Запрос SHAP объяснений: explainer=True, background_data_exists=True, model=True
2025-05-22 02:46:36,324 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Создание GradientExplainer с размерами данных: torch.Size([50, 4])
2025-05-22 02:46:36,350 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) SHAP values raw type: <class 'numpy.ndarray'>
2025-05-22 02:46:36,351 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) SHAP values raw (ndarray) shape: (1, 4, 1)
2025-05-22 02:46:36,351 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) SHAP GradientExplainer успешно создан и вычислены SHAP-значения
2025-05-22 02:46:36,351 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) SHAP values_raw уже является ndarray, shape: (1, 4, 1)
2025-05-22 02:46:36,352 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) Начальная форма shap_values_arr: (1, 4, 1), ndim: 3
2025-05-22 02:46:36,352 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) SHAP values после squeeze(-1): (1, 4)
2025-05-22 02:46:36,352 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) SHAP values успешно вычислены для 1 экземпляров.
2025-05-22 02:46:36,352 - backend.ml_service.multilevel_detector - DEBUG - Explanation from transaction detector 'transaction_vae_price': [{"shap_values": {"price": 87.79726440035982, "freight_value": -39.737356158702944, "product_weight_g": -6.477956263873523, "freight_to_price_ratio": 3.4286252435066187}}]
2025-05-22 02:46:36,353 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'transaction_vae_price' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,353 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for transaction_level: [{"detector_name": "transaction_vae_price", "detector_type": "TransactionVAEDetector", "score": 0.9969047105032527, "explanation": {"shap_values": {"price": 87.79726440035982, "freight_value": -39.737356158702944, "product_weight_g": -6.477956263873523, "freight_to_price_ratio": 3.4286252435066187}}}]
2025-05-22 02:46:36,353 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 57579, order_id: 3dd5626c63f493f8b8f8788c2be24baa, level: transaction): Detector Column: 'trans_category_price_outlier_model_score', Score: 0.2406, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:36,353 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 57579, order_id: 3dd5626c63f493f8b8f8788c2be24baa, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.9281, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,353 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,354 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-04-27 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,355 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-04-27 00:00:00
2025-05-22 02:46:36,357 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
490 2018-04-27          242     41231.39  140.242823             165               242               2018-04-27  35298.295714         1.168084           0.823398                           0.928073                       0.718724    2018-04-27
2025-05-22 02:46:36,358 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-04-27 00:00:00", "current_value": 41231.39, "expected_value": 23364.508863636365, "absolute_deviation": 17866.881136363634, "relative_deviation": 0.7647017637152634, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-04-27 00:00:00 значение total_sales (41231.39) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}]
2025-05-22 02:46:36,358 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,359 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9280726698190791, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-04-27 00:00:00", "current_value": 41231.39, "expected_value": 23364.508863636365, "absolute_deviation": 17866.881136363634, "relative_deviation": 0.7647017637152634, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-04-27 00:00:00 значение total_sales (41231.39) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}]
2025-05-22 02:46:36,359 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 57579, order_id: 3dd5626c63f493f8b8f8788c2be24baa, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.7187, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,359 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,360 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-04-27 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,361 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-04-27 00:00:00
2025-05-22 02:46:36,364 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
490 2018-04-27          242     41231.39  140.242823             165               242               2018-04-27  35298.295714         1.168084           0.823398                           0.928073                       0.718724    2018-04-27
2025-05-22 02:46:36,364 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-04-27 00:00:00", "current_value": 41231.39, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 37535.38428571429, "deviation_in_std": 9.243469099331083, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (41231.39) отклоняется от базовой линии (3696.01) на 37535.38, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,365 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,365 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9280726698190791, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-04-27 00:00:00", "current_value": 41231.39, "expected_value": 23364.508863636365, "absolute_deviation": 17866.881136363634, "relative_deviation": 0.7647017637152634, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-04-27 00:00:00 значение total_sales (41231.39) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.718723936134046, "explanation": {"detector_specific_info": {"date": "2018-04-27 00:00:00", "current_value": 41231.39, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 37535.38428571429, "deviation_in_std": 9.243469099331083, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (41231.39) отклоняется от базовой линии (3696.01) на 37535.38, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,365 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 58362, order_id: fa6d52aa0f15a0a03c1f945a1d0f996f, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.2171, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:36,366 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 58362, order_id: fa6d52aa0f15a0a03c1f945a1d0f996f, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.7849, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,366 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:36,366 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=7299e27ed73d2ad986de7f7c77d919fa in aggregated_behavior_data_with_scores
2025-05-22 02:46:36,367 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:36,371 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                             seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                                   categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
1412  7299e27ed73d2ad986de7f7c77d919fa   98.885094  148.935573    371       5.99     1500.0     19.280997    10.805647  [consoles_games, brinquedos, bebes, utilidades_domesticas, esporte_lazer, eletroportateis, alimentos, cool_stuff, automotivo, artes, relogios_presentes, moveis_decoracao, cama_mesa_banho]              13          1.506148         250.417362                0.194984                 13             0.03504              0.791985         0.50099                          0.217125                                   0.784855
2025-05-22 02:46:36,373 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}]
2025-05-22 02:46:36,373 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,373 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.7848545894928308, "explanation": {"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}}]
2025-05-22 02:46:36,374 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 58362, order_id: fa6d52aa0f15a0a03c1f945a1d0f996f, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.7472, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,374 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,374 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-09 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,375 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-09 00:00:00
2025-05-22 02:46:36,377 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
594 2018-08-09          283     42138.17  125.785582             204               283               2018-08-09  44497.781429         0.946972           0.856223                           0.747247                       0.965198    2018-08-09
2025-05-22 02:46:36,378 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-09 00:00:00", "current_value": 42138.17, "expected_value": 24263.594318181815, "absolute_deviation": 17874.575681818184, "relative_deviation": 0.7366829269983282, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-09 00:00:00 значение total_sales (42138.17) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}]
2025-05-22 02:46:36,378 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,378 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7472473831010398, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-09 00:00:00", "current_value": 42138.17, "expected_value": 24263.594318181815, "absolute_deviation": 17874.575681818184, "relative_deviation": 0.7366829269983282, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-09 00:00:00 значение total_sales (42138.17) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}]
2025-05-22 02:46:36,379 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 58362, order_id: fa6d52aa0f15a0a03c1f945a1d0f996f, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9652, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,379 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,379 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-09 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,380 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-09 00:00:00
2025-05-22 02:46:36,382 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
594 2018-08-09          283     42138.17  125.785582             204               283               2018-08-09  44497.781429         0.946972           0.856223                           0.747247                       0.965198    2018-08-09
2025-05-22 02:46:36,383 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-09 00:00:00", "current_value": 42138.17, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 38442.16428571429, "deviation_in_std": 9.466772871741947, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (42138.17) отклоняется от базовой линии (3696.01) на 38442.16, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,383 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,383 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7472473831010398, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-09 00:00:00", "current_value": 42138.17, "expected_value": 24263.594318181815, "absolute_deviation": 17874.575681818184, "relative_deviation": 0.7366829269983282, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-09 00:00:00 значение total_sales (42138.17) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9651982020506744, "explanation": {"detector_specific_info": {"date": "2018-08-09 00:00:00", "current_value": 42138.17, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 38442.16428571429, "deviation_in_std": 9.466772871741947, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (42138.17) отклоняется от базовой линии (3696.01) на 38442.16, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,384 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 58740, order_id: a3f586050d25a10efc72e242c88e0c03, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.2171, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:36,385 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 58740, order_id: a3f586050d25a10efc72e242c88e0c03, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.7849, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,385 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:36,386 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=7299e27ed73d2ad986de7f7c77d919fa in aggregated_behavior_data_with_scores
2025-05-22 02:46:36,387 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:36,391 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                             seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                                   categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
1412  7299e27ed73d2ad986de7f7c77d919fa   98.885094  148.935573    371       5.99     1500.0     19.280997    10.805647  [consoles_games, brinquedos, bebes, utilidades_domesticas, esporte_lazer, eletroportateis, alimentos, cool_stuff, automotivo, artes, relogios_presentes, moveis_decoracao, cama_mesa_banho]              13          1.506148         250.417362                0.194984                 13             0.03504              0.791985         0.50099                          0.217125                                   0.784855
2025-05-22 02:46:36,391 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}]
2025-05-22 02:46:36,392 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,392 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.7848545894928308, "explanation": {"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}}]
2025-05-22 02:46:36,392 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 58740, order_id: a3f586050d25a10efc72e242c88e0c03, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,393 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,393 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-01 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,394 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-01 00:00:00
2025-05-22 02:46:36,396 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
586 2018-08-01          310     44495.81  120.912527             212               310               2018-08-01  36798.238571         1.209183           0.969258                                1.0                       0.938516    2018-08-01
2025-05-22 02:46:36,397 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-01 00:00:00", "current_value": 44495.81, "expected_value": 25669.474712643678, "absolute_deviation": 18826.33528735632, "relative_deviation": 0.7334133439856982, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-01 00:00:00 значение total_sales (44495.81) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}]
2025-05-22 02:46:36,397 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,397 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-01 00:00:00", "current_value": 44495.81, "expected_value": 25669.474712643678, "absolute_deviation": 18826.33528735632, "relative_deviation": 0.7334133439856982, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-01 00:00:00 значение total_sales (44495.81) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}]
2025-05-22 02:46:36,397 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 58740, order_id: a3f586050d25a10efc72e242c88e0c03, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9385, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,397 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,398 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-01 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,399 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-01 00:00:00
2025-05-22 02:46:36,401 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
586 2018-08-01          310     44495.81  120.912527             212               310               2018-08-01  36798.238571         1.209183           0.969258                                1.0                       0.938516    2018-08-01
2025-05-22 02:46:36,402 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-01 00:00:00", "current_value": 44495.81, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40799.80428571429, "deviation_in_std": 10.047365635131905, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (44495.81) отклоняется от базовой линии (3696.01) на 40799.80, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,402 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,402 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-01 00:00:00", "current_value": 44495.81, "expected_value": 25669.474712643678, "absolute_deviation": 18826.33528735632, "relative_deviation": 0.7334133439856982, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-01 00:00:00 значение total_sales (44495.81) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9385162906742874, "explanation": {"detector_specific_info": {"date": "2018-08-01 00:00:00", "current_value": 44495.81, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40799.80428571429, "deviation_in_std": 10.047365635131905, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (44495.81) отклоняется от базовой линии (3696.01) на 40799.80, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,403 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 62381, order_id: be5b64307f608c4be032a92527e44f66, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,403 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,403 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-03-15 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,404 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-03-15 00:00:00
2025-05-22 02:46:36,407 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
447 2018-03-15          286      46096.4  135.180059             174               286               2018-03-15  32494.021429         1.418612           0.804803                                1.0                       0.609605    2018-03-15
2025-05-22 02:46:36,408 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-03-15 00:00:00", "current_value": 46096.4, "expected_value": 24263.594318181815, "absolute_deviation": 21832.805681818187, "relative_deviation": 0.8998174547230158, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-03-15 00:00:00 значение total_sales (46096.40) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}]
2025-05-22 02:46:36,408 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,409 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-03-15 00:00:00", "current_value": 46096.4, "expected_value": 24263.594318181815, "absolute_deviation": 21832.805681818187, "relative_deviation": 0.8998174547230158, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-03-15 00:00:00 значение total_sales (46096.40) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}]
2025-05-22 02:46:36,409 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 62381, order_id: be5b64307f608c4be032a92527e44f66, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.6096, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,409 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,409 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-03-15 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,410 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-03-15 00:00:00
2025-05-22 02:46:36,413 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
447 2018-03-15          286      46096.4  135.180059             174               286               2018-03-15  32494.021429         1.418612           0.804803                                1.0                       0.609605    2018-03-15
2025-05-22 02:46:36,415 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-03-15 00:00:00", "current_value": 46096.4, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 42400.39428571429, "deviation_in_std": 10.441527157312704, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (46096.40) отклоняется от базовой линии (3696.01) на 42400.39, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,415 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,416 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-03-15 00:00:00", "current_value": 46096.4, "expected_value": 24263.594318181815, "absolute_deviation": 21832.805681818187, "relative_deviation": 0.8998174547230158, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-03-15 00:00:00 значение total_sales (46096.40) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.609605020859105, "explanation": {"detector_specific_info": {"date": "2018-03-15 00:00:00", "current_value": 46096.4, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 42400.39428571429, "deviation_in_std": 10.441527157312704, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (46096.40) отклоняется от базовой линии (3696.01) на 42400.39, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,416 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 62506, order_id: 2a7cb435d5ffc8aaeae3c4f08a181dce, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1697, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:36,416 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 62506, order_id: 2a7cb435d5ffc8aaeae3c4f08a181dce, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9836, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,416 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:36,417 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=4a3ccda38b2129705f3fb522db62ca31 in aggregated_behavior_data_with_scores
2025-05-22 02:46:36,418 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:36,422 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                               categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
882  4a3ccda38b2129705f3fb522db62ca31  233.158916  370.889347     83        9.9     3099.9     18.396747     9.418922  [construcao_ferramentas_seguranca, casa_construcao, ferramentas_jardim, construcao_ferramentas_construcao, eletronicos]               5          1.590715         313.121212                0.078902                  5            0.060241               0.53771        0.576635                          0.169668                                   0.983603
2025-05-22 02:46:36,423 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}]
2025-05-22 02:46:36,423 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,423 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.9836033466098753, "explanation": {"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}}]
2025-05-22 02:46:36,423 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 62506, order_id: 2a7cb435d5ffc8aaeae3c4f08a181dce, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,424 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,424 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-03 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,425 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-03 00:00:00
2025-05-22 02:46:36,429 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
527 2018-06-03          191      31535.8  137.112174             149               191               2018-06-03  27063.432857         1.165255           0.903771                                1.0                       0.807541    2018-06-03
2025-05-22 02:46:36,430 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-03 00:00:00", "current_value": 31535.8, "expected_value": 18683.428202247193, "absolute_deviation": 12852.371797752807, "relative_deviation": 0.6879022232229821, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-03 00:00:00 значение total_sales (31535.80) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}]
2025-05-22 02:46:36,430 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,431 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-03 00:00:00", "current_value": 31535.8, "expected_value": 18683.428202247193, "absolute_deviation": 12852.371797752807, "relative_deviation": 0.6879022232229821, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-03 00:00:00 значение total_sales (31535.80) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}]
2025-05-22 02:46:36,431 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 62506, order_id: 2a7cb435d5ffc8aaeae3c4f08a181dce, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.8075, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,431 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,431 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-03 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,432 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-03 00:00:00
2025-05-22 02:46:36,435 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
527 2018-06-03          191      31535.8  137.112174             149               191               2018-06-03  27063.432857         1.165255           0.903771                                1.0                       0.807541    2018-06-03
2025-05-22 02:46:36,436 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-06-03 00:00:00", "current_value": 31535.8, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 27839.794285714284, "deviation_in_std": 6.855831720089102, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (31535.80) отклоняется от базовой линии (3696.01) на 27839.79, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,436 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,436 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-03 00:00:00", "current_value": 31535.8, "expected_value": 18683.428202247193, "absolute_deviation": 12852.371797752807, "relative_deviation": 0.6879022232229821, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-03 00:00:00 значение total_sales (31535.80) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.8075414451585549, "explanation": {"detector_specific_info": {"date": "2018-06-03 00:00:00", "current_value": 31535.8, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 27839.794285714284, "deviation_in_std": 6.855831720089102, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (31535.80) отклоняется от базовой линии (3696.01) на 27839.79, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,437 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 62534, order_id: c5bdd8ef3c0ec420232e668302179113, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.9281, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,437 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,437 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-04-27 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,438 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-04-27 00:00:00
2025-05-22 02:46:36,440 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
490 2018-04-27          242     41231.39  140.242823             165               242               2018-04-27  35298.295714         1.168084           0.823398                           0.928073                       0.718724    2018-04-27
2025-05-22 02:46:36,442 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-04-27 00:00:00", "current_value": 41231.39, "expected_value": 23364.508863636365, "absolute_deviation": 17866.881136363634, "relative_deviation": 0.7647017637152634, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-04-27 00:00:00 значение total_sales (41231.39) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}]
2025-05-22 02:46:36,442 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,442 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9280726698190791, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-04-27 00:00:00", "current_value": 41231.39, "expected_value": 23364.508863636365, "absolute_deviation": 17866.881136363634, "relative_deviation": 0.7647017637152634, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-04-27 00:00:00 значение total_sales (41231.39) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}]
2025-05-22 02:46:36,442 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 62534, order_id: c5bdd8ef3c0ec420232e668302179113, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.7187, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,443 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,443 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-04-27 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,444 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-04-27 00:00:00
2025-05-22 02:46:36,446 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
490 2018-04-27          242     41231.39  140.242823             165               242               2018-04-27  35298.295714         1.168084           0.823398                           0.928073                       0.718724    2018-04-27
2025-05-22 02:46:36,447 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-04-27 00:00:00", "current_value": 41231.39, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 37535.38428571429, "deviation_in_std": 9.243469099331083, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (41231.39) отклоняется от базовой линии (3696.01) на 37535.38, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,448 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,448 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9280726698190791, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-04-27 00:00:00", "current_value": 41231.39, "expected_value": 23364.508863636365, "absolute_deviation": 17866.881136363634, "relative_deviation": 0.7647017637152634, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-04-27 00:00:00 значение total_sales (41231.39) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.718723936134046, "explanation": {"detector_specific_info": {"date": "2018-04-27 00:00:00", "current_value": 41231.39, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 37535.38428571429, "deviation_in_std": 9.243469099331083, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (41231.39) отклоняется от базовой линии (3696.01) на 37535.38, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,449 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 62630, order_id: 90e3ed5bc7c3104c5d7012e809f4b399, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.7472, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,449 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,450 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-09 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,450 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-09 00:00:00
2025-05-22 02:46:36,453 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
594 2018-08-09          283     42138.17  125.785582             204               283               2018-08-09  44497.781429         0.946972           0.856223                           0.747247                       0.965198    2018-08-09
2025-05-22 02:46:36,453 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-09 00:00:00", "current_value": 42138.17, "expected_value": 24263.594318181815, "absolute_deviation": 17874.575681818184, "relative_deviation": 0.7366829269983282, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-09 00:00:00 значение total_sales (42138.17) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}]
2025-05-22 02:46:36,453 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,454 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7472473831010398, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-09 00:00:00", "current_value": 42138.17, "expected_value": 24263.594318181815, "absolute_deviation": 17874.575681818184, "relative_deviation": 0.7366829269983282, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-09 00:00:00 значение total_sales (42138.17) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}]
2025-05-22 02:46:36,454 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 62630, order_id: 90e3ed5bc7c3104c5d7012e809f4b399, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9652, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,454 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,455 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-09 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,456 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-09 00:00:00
2025-05-22 02:46:36,458 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
594 2018-08-09          283     42138.17  125.785582             204               283               2018-08-09  44497.781429         0.946972           0.856223                           0.747247                       0.965198    2018-08-09
2025-05-22 02:46:36,459 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-09 00:00:00", "current_value": 42138.17, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 38442.16428571429, "deviation_in_std": 9.466772871741947, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (42138.17) отклоняется от базовой линии (3696.01) на 38442.16, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,459 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,459 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7472473831010398, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-09 00:00:00", "current_value": 42138.17, "expected_value": 24263.594318181815, "absolute_deviation": 17874.575681818184, "relative_deviation": 0.7366829269983282, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-09 00:00:00 значение total_sales (42138.17) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9651982020506744, "explanation": {"detector_specific_info": {"date": "2018-08-09 00:00:00", "current_value": 42138.17, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 38442.16428571429, "deviation_in_std": 9.466772871741947, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (42138.17) отклоняется от базовой линии (3696.01) на 38442.16, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,460 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 63167, order_id: 7d3641e32d8be63b62c24a62992e6e56, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.2171, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:36,460 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 63167, order_id: 7d3641e32d8be63b62c24a62992e6e56, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.7849, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,460 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:36,460 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=7299e27ed73d2ad986de7f7c77d919fa in aggregated_behavior_data_with_scores
2025-05-22 02:46:36,461 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:36,465 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                             seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                                   categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
1412  7299e27ed73d2ad986de7f7c77d919fa   98.885094  148.935573    371       5.99     1500.0     19.280997    10.805647  [consoles_games, brinquedos, bebes, utilidades_domesticas, esporte_lazer, eletroportateis, alimentos, cool_stuff, automotivo, artes, relogios_presentes, moveis_decoracao, cama_mesa_banho]              13          1.506148         250.417362                0.194984                 13             0.03504              0.791985         0.50099                          0.217125                                   0.784855
2025-05-22 02:46:36,466 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}]
2025-05-22 02:46:36,466 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,466 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.7848545894928308, "explanation": {"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}}]
2025-05-22 02:46:36,467 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 63167, order_id: 7d3641e32d8be63b62c24a62992e6e56, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,467 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,468 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-03 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,469 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-03 00:00:00
2025-05-22 02:46:36,471 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
588 2018-08-03          314     45036.63  125.10175             216               314               2018-08-03  39138.992857         1.150684           0.972436                                1.0                       0.944872    2018-08-03
2025-05-22 02:46:36,472 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-03 00:00:00", "current_value": 45036.63, "expected_value": 23364.508863636365, "absolute_deviation": 21672.121136363632, "relative_deviation": 0.9275658762120739, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-03 00:00:00 значение total_sales (45036.63) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}]
2025-05-22 02:46:36,472 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,472 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-03 00:00:00", "current_value": 45036.63, "expected_value": 23364.508863636365, "absolute_deviation": 21672.121136363632, "relative_deviation": 0.9275658762120739, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-03 00:00:00 значение total_sales (45036.63) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}]
2025-05-22 02:46:36,473 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 63167, order_id: 7d3641e32d8be63b62c24a62992e6e56, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9449, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,473 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,473 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-03 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,474 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-03 00:00:00
2025-05-22 02:46:36,476 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
588 2018-08-03          314     45036.63  125.10175             216               314               2018-08-03  39138.992857         1.150684           0.972436                                1.0                       0.944872    2018-08-03
2025-05-22 02:46:36,477 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-03 00:00:00", "current_value": 45036.63, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 41340.624285714286, "deviation_in_std": 10.18054804563417, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (45036.63) отклоняется от базовой линии (3696.01) на 41340.62, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,477 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,477 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-03 00:00:00", "current_value": 45036.63, "expected_value": 23364.508863636365, "absolute_deviation": 21672.121136363632, "relative_deviation": 0.9275658762120739, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-03 00:00:00 значение total_sales (45036.63) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9448723295452219, "explanation": {"detector_specific_info": {"date": "2018-08-03 00:00:00", "current_value": 45036.63, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 41340.624285714286, "deviation_in_std": 10.18054804563417, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (45036.63) отклоняется от базовой линии (3696.01) на 41340.62, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,478 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 63491, order_id: 1206cfbf9d0e7ea298926c2603a06821, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1769, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:36,478 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 63491, order_id: 1206cfbf9d0e7ea298926c2603a06821, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9184, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,478 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:36,479 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=36a968b544695394e4e9d7572688598f in aggregated_behavior_data_with_scores
2025-05-22 02:46:36,479 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:36,483 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                        categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
642  36a968b544695394e4e9d7572688598f   56.522384  136.831171    172        3.9     1140.9     13.350814      5.53097  [informatica_acessorios, beleza_saude, telefonia, automotivo, tablets_impressao_imagem, instrumentos_musicais, ferramentas_jardim, cool_stuff, consoles_games, moveis_decoracao]              10          2.420832         292.538462                0.236204                 10             0.05814              0.719612        0.547647                          0.176931                                   0.918363
2025-05-22 02:46:36,484 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}]
2025-05-22 02:46:36,484 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,484 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.918363395536566, "explanation": {"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}}]
2025-05-22 02:46:36,484 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 63491, order_id: 1206cfbf9d0e7ea298926c2603a06821, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.7297, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,485 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,485 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-17 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,486 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-17 00:00:00
2025-05-22 02:46:36,488 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
602 2018-08-17          255     36361.57  120.802558             203               255               2018-08-17  37849.641429         0.960685           0.858666                           0.729695                       0.987637    2018-08-17
2025-05-22 02:46:36,488 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-17 00:00:00", "current_value": 36361.57, "expected_value": 23364.508863636365, "absolute_deviation": 12997.061136363634, "relative_deviation": 0.5562736718421575, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-17 00:00:00 значение total_sales (36361.57) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}]
2025-05-22 02:46:36,488 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,489 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7296946227452271, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-17 00:00:00", "current_value": 36361.57, "expected_value": 23364.508863636365, "absolute_deviation": 12997.061136363634, "relative_deviation": 0.5562736718421575, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-17 00:00:00 значение total_sales (36361.57) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}]
2025-05-22 02:46:36,489 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 63491, order_id: 1206cfbf9d0e7ea298926c2603a06821, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9876, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,489 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,490 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-17 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,491 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-17 00:00:00
2025-05-22 02:46:36,494 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
602 2018-08-17          255     36361.57  120.802558             203               255               2018-08-17  37849.641429         0.960685           0.858666                           0.729695                       0.987637    2018-08-17
2025-05-22 02:46:36,494 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-17 00:00:00", "current_value": 36361.57, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 32665.564285714285, "deviation_in_std": 8.044226530061943, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (36361.57) отклоняется от базовой линии (3696.01) на 32665.56, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,495 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,495 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7296946227452271, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-17 00:00:00", "current_value": 36361.57, "expected_value": 23364.508863636365, "absolute_deviation": 12997.061136363634, "relative_deviation": 0.5562736718421575, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-17 00:00:00 значение total_sales (36361.57) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9876365632717872, "explanation": {"detector_specific_info": {"date": "2018-08-17 00:00:00", "current_value": 36361.57, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 32665.564285714285, "deviation_in_std": 8.044226530061943, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (36361.57) отклоняется от базовой линии (3696.01) на 32665.56, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,496 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 63956, order_id: 72074174b87a13299e5d0aad2dae6137, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.2171, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:36,496 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 63956, order_id: 72074174b87a13299e5d0aad2dae6137, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.7849, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,496 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:36,496 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=7299e27ed73d2ad986de7f7c77d919fa in aggregated_behavior_data_with_scores
2025-05-22 02:46:36,498 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:36,501 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                             seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                                   categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
1412  7299e27ed73d2ad986de7f7c77d919fa   98.885094  148.935573    371       5.99     1500.0     19.280997    10.805647  [consoles_games, brinquedos, bebes, utilidades_domesticas, esporte_lazer, eletroportateis, alimentos, cool_stuff, automotivo, artes, relogios_presentes, moveis_decoracao, cama_mesa_banho]              13          1.506148         250.417362                0.194984                 13             0.03504              0.791985         0.50099                          0.217125                                   0.784855
2025-05-22 02:46:36,502 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}]
2025-05-22 02:46:36,502 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,503 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.7848545894928308, "explanation": {"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}}]
2025-05-22 02:46:36,503 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 63956, order_id: 72074174b87a13299e5d0aad2dae6137, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.8479, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,503 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,504 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-16 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,505 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-16 00:00:00
2025-05-22 02:46:36,508 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
601 2018-08-16          318     39447.94  105.758552             214               318               2018-08-16  37552.242857         1.050482           0.916391                           0.847864                       0.984918    2018-08-16
2025-05-22 02:46:36,508 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-16 00:00:00", "current_value": 39447.94, "expected_value": 24263.594318181815, "absolute_deviation": 15184.345681818188, "relative_deviation": 0.6258077629677424, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-16 00:00:00 значение total_sales (39447.94) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}]
2025-05-22 02:46:36,509 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,509 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8478639396580963, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-16 00:00:00", "current_value": 39447.94, "expected_value": 24263.594318181815, "absolute_deviation": 15184.345681818188, "relative_deviation": 0.6258077629677424, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-16 00:00:00 значение total_sales (39447.94) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}]
2025-05-22 02:46:36,509 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 63956, order_id: 72074174b87a13299e5d0aad2dae6137, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9849, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,509 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,510 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-16 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,511 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-16 00:00:00
2025-05-22 02:46:36,513 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
601 2018-08-16          318     39447.94  105.758552             214               318               2018-08-16  37552.242857         1.050482           0.916391                           0.847864                       0.984918    2018-08-16
2025-05-22 02:46:36,514 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-16 00:00:00", "current_value": 39447.94, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 35751.93428571429, "deviation_in_std": 8.80427644741314, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (39447.94) отклоняется от базовой линии (3696.01) на 35751.93, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,514 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,514 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8478639396580963, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-16 00:00:00", "current_value": 39447.94, "expected_value": 24263.594318181815, "absolute_deviation": 15184.345681818188, "relative_deviation": 0.6258077629677424, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-16 00:00:00 значение total_sales (39447.94) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.984918459587866, "explanation": {"detector_specific_info": {"date": "2018-08-16 00:00:00", "current_value": 39447.94, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 35751.93428571429, "deviation_in_std": 8.80427644741314, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (39447.94) отклоняется от базовой линии (3696.01) на 35751.93, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,515 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 65060, order_id: 0d5fb8614978748bcfbef448c8a74a17, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,515 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,515 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-06 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,516 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-06 00:00:00
2025-05-22 02:46:36,519 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
591 2018-08-06          372     58342.98  131.10782             246               372               2018-08-06  43511.862857         1.340852           0.977384                                1.0                       0.954768    2018-08-06
2025-05-22 02:46:36,520 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-06 00:00:00", "current_value": 58342.98, "expected_value": 25862.10588888889, "absolute_deviation": 32480.874111111112, "relative_deviation": 1.255925339207038, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-06 00:00:00 значение total_sales (58342.98) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}]
2025-05-22 02:46:36,520 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,521 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-06 00:00:00", "current_value": 58342.98, "expected_value": 25862.10588888889, "absolute_deviation": 32480.874111111112, "relative_deviation": 1.255925339207038, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-06 00:00:00 значение total_sales (58342.98) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}]
2025-05-22 02:46:36,521 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 65060, order_id: 0d5fb8614978748bcfbef448c8a74a17, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9548, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,521 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,522 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-06 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,522 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-06 00:00:00
2025-05-22 02:46:36,525 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
591 2018-08-06          372     58342.98  131.10782             246               372               2018-08-06  43511.862857         1.340852           0.977384                                1.0                       0.954768    2018-08-06
2025-05-22 02:46:36,526 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-06 00:00:00", "current_value": 58342.98, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 54646.97428571429, "deviation_in_std": 13.457371698581184, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (58342.98) отклоняется от базовой линии (3696.01) на 54646.97, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,526 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,526 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-06 00:00:00", "current_value": 58342.98, "expected_value": 25862.10588888889, "absolute_deviation": 32480.874111111112, "relative_deviation": 1.255925339207038, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-06 00:00:00 значение total_sales (58342.98) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9547682263974279, "explanation": {"detector_specific_info": {"date": "2018-08-06 00:00:00", "current_value": 58342.98, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 54646.97428571429, "deviation_in_std": 13.457371698581184, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (58342.98) отклоняется от базовой линии (3696.01) на 54646.97, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,527 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 65381, order_id: 5864382447def49f38f45e63da084b3b, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1697, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:36,527 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 65381, order_id: 5864382447def49f38f45e63da084b3b, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9836, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,527 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:36,527 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=4a3ccda38b2129705f3fb522db62ca31 in aggregated_behavior_data_with_scores
2025-05-22 02:46:36,528 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:36,532 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                               categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
882  4a3ccda38b2129705f3fb522db62ca31  233.158916  370.889347     83        9.9     3099.9     18.396747     9.418922  [construcao_ferramentas_seguranca, casa_construcao, ferramentas_jardim, construcao_ferramentas_construcao, eletronicos]               5          1.590715         313.121212                0.078902                  5            0.060241               0.53771        0.576635                          0.169668                                   0.983603
2025-05-22 02:46:36,533 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}]
2025-05-22 02:46:36,533 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,533 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.9836033466098753, "explanation": {"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}}]
2025-05-22 02:46:36,534 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 65381, order_id: 5864382447def49f38f45e63da084b3b, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.8463, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,534 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,534 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-08 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,535 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-08 00:00:00
2025-05-22 02:46:36,537 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
501 2018-05-08          327     48373.71  125.973203             216               327               2018-05-08  40997.807143          1.17991           0.797591                           0.846298                       0.748883    2018-05-08
2025-05-22 02:46:36,537 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-08 00:00:00", "current_value": 48373.71, "expected_value": 26189.295057471263, "absolute_deviation": 22184.414942528736, "relative_deviation": 0.8470794992322629, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-08 00:00:00 значение total_sales (48373.71) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}]
2025-05-22 02:46:36,538 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,538 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8462982708976428, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-08 00:00:00", "current_value": 48373.71, "expected_value": 26189.295057471263, "absolute_deviation": 22184.414942528736, "relative_deviation": 0.8470794992322629, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-08 00:00:00 значение total_sales (48373.71) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}]
2025-05-22 02:46:36,538 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 65381, order_id: 5864382447def49f38f45e63da084b3b, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.7489, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,539 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,540 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-08 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,541 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-08 00:00:00
2025-05-22 02:46:36,543 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
501 2018-05-08          327     48373.71  125.973203             216               327               2018-05-08  40997.807143          1.17991           0.797591                           0.846298                       0.748883    2018-05-08
2025-05-22 02:46:36,543 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-05-08 00:00:00", "current_value": 48373.71, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 44677.70428571429, "deviation_in_std": 11.002337843420673, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (48373.71) отклоняется от базовой линии (3696.01) на 44677.70, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,544 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,544 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8462982708976428, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-08 00:00:00", "current_value": 48373.71, "expected_value": 26189.295057471263, "absolute_deviation": 22184.414942528736, "relative_deviation": 0.8470794992322629, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-08 00:00:00 значение total_sales (48373.71) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.7488834251364803, "explanation": {"detector_specific_info": {"date": "2018-05-08 00:00:00", "current_value": 48373.71, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 44677.70428571429, "deviation_in_std": 11.002337843420673, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (48373.71) отклоняется от базовой линии (3696.01) на 44677.70, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,545 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 67277, order_id: 80db40134db34fa301d8a9c17b307a00, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.9840, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,546 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,546 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-04 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,547 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-04 00:00:00
2025-05-22 02:46:36,550 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
589 2018-08-04          245     35844.56  127.560712             182               245               2018-08-04  40382.502857         0.887626           0.965791                           0.984035                       0.947547    2018-08-04
2025-05-22 02:46:36,550 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-04 00:00:00", "current_value": 35844.56, "expected_value": 18164.355862068966, "absolute_deviation": 17680.204137931032, "relative_deviation": 0.9733460559893046, "threshold": 2.5, "day_of_week": 5, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-04 00:00:00 значение total_sales (35844.56) в пределах нормальных отклонений от сезонного паттерна (18164.36)."}}]
2025-05-22 02:46:36,550 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,551 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9840346395236611, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-04 00:00:00", "current_value": 35844.56, "expected_value": 18164.355862068966, "absolute_deviation": 17680.204137931032, "relative_deviation": 0.9733460559893046, "threshold": 2.5, "day_of_week": 5, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-04 00:00:00 значение total_sales (35844.56) в пределах нормальных отклонений от сезонного паттерна (18164.36)."}}}]
2025-05-22 02:46:36,551 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 67277, order_id: 80db40134db34fa301d8a9c17b307a00, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9475, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,551 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,552 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-04 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,553 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-04 00:00:00
2025-05-22 02:46:36,555 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
589 2018-08-04          245     35844.56  127.560712             182               245               2018-08-04  40382.502857         0.887626           0.965791                           0.984035                       0.947547    2018-08-04
2025-05-22 02:46:36,555 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-04 00:00:00", "current_value": 35844.56, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 32148.554285714283, "deviation_in_std": 7.916907573562967, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (35844.56) отклоняется от базовой линии (3696.01) на 32148.55, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,555 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,556 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9840346395236611, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-04 00:00:00", "current_value": 35844.56, "expected_value": 18164.355862068966, "absolute_deviation": 17680.204137931032, "relative_deviation": 0.9733460559893046, "threshold": 2.5, "day_of_week": 5, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-04 00:00:00 значение total_sales (35844.56) в пределах нормальных отклонений от сезонного паттерна (18164.36)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9475474127941269, "explanation": {"detector_specific_info": {"date": "2018-08-04 00:00:00", "current_value": 35844.56, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 32148.554285714283, "deviation_in_std": 7.916907573562967, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (35844.56) отклоняется от базовой линии (3696.01) на 32148.55, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,556 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 67321, order_id: 7229fca9b269915fc63b44434d20828a, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,556 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,557 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-15 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,557 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-15 00:00:00
2025-05-22 02:46:36,560 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
600 2018-08-15          285      46326.8  141.672171             208               285               2018-08-15  37936.561429         1.221165           0.990972                                1.0                       0.981944    2018-08-15
2025-05-22 02:46:36,561 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-15 00:00:00", "current_value": 46326.8, "expected_value": 25669.474712643678, "absolute_deviation": 20657.325287356325, "relative_deviation": 0.8047428129560211, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-15 00:00:00 значение total_sales (46326.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}]
2025-05-22 02:46:36,561 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,561 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-15 00:00:00", "current_value": 46326.8, "expected_value": 25669.474712643678, "absolute_deviation": 20657.325287356325, "relative_deviation": 0.8047428129560211, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-15 00:00:00 значение total_sales (46326.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}]
2025-05-22 02:46:36,561 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 67321, order_id: 7229fca9b269915fc63b44434d20828a, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9819, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,561 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,562 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-15 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,563 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-15 00:00:00
2025-05-22 02:46:36,565 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
600 2018-08-15          285      46326.8  141.672171             208               285               2018-08-15  37936.561429         1.221165           0.990972                                1.0                       0.981944    2018-08-15
2025-05-22 02:46:36,566 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-15 00:00:00", "current_value": 46326.8, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 42630.79428571429, "deviation_in_std": 10.498265494244997, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (46326.80) отклоняется от базовой линии (3696.01) на 42630.79, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,566 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,567 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-15 00:00:00", "current_value": 46326.8, "expected_value": 25669.474712643678, "absolute_deviation": 20657.325287356325, "relative_deviation": 0.8047428129560211, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-15 00:00:00 значение total_sales (46326.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9819435388597458, "explanation": {"detector_specific_info": {"date": "2018-08-15 00:00:00", "current_value": 46326.8, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 42630.79428571429, "deviation_in_std": 10.498265494244997, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (46326.80) отклоняется от базовой линии (3696.01) на 42630.79, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,567 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 67925, order_id: 777e839a3f71170e58385675ce610501, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.2171, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:36,567 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 67925, order_id: 777e839a3f71170e58385675ce610501, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.7849, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,568 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:36,568 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=7299e27ed73d2ad986de7f7c77d919fa in aggregated_behavior_data_with_scores
2025-05-22 02:46:36,569 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:36,571 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                             seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                                   categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
1412  7299e27ed73d2ad986de7f7c77d919fa   98.885094  148.935573    371       5.99     1500.0     19.280997    10.805647  [consoles_games, brinquedos, bebes, utilidades_domesticas, esporte_lazer, eletroportateis, alimentos, cool_stuff, automotivo, artes, relogios_presentes, moveis_decoracao, cama_mesa_banho]              13          1.506148         250.417362                0.194984                 13             0.03504              0.791985         0.50099                          0.217125                                   0.784855
2025-05-22 02:46:36,571 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}]
2025-05-22 02:46:36,572 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,572 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.7848545894928308, "explanation": {"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}}]
2025-05-22 02:46:36,572 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 67925, order_id: 777e839a3f71170e58385675ce610501, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.9542, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,572 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,573 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-05 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,574 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-05 00:00:00
2025-05-22 02:46:36,577 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
590 2018-08-05          276     35827.16  113.377089             197               276               2018-08-05      40917.04         0.875605           0.952224                           0.954227                       0.950221    2018-08-05
2025-05-22 02:46:36,578 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-05 00:00:00", "current_value": 35827.16, "expected_value": 18683.428202247193, "absolute_deviation": 17143.73179775281, "relative_deviation": 0.9175902629952467, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-05 00:00:00 значение total_sales (35827.16) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}]
2025-05-22 02:46:36,579 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,579 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9542273144533602, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-05 00:00:00", "current_value": 35827.16, "expected_value": 18683.428202247193, "absolute_deviation": 17143.73179775281, "relative_deviation": 0.9175902629952467, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-05 00:00:00 значение total_sales (35827.16) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}]
2025-05-22 02:46:36,579 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 67925, order_id: 777e839a3f71170e58385675ce610501, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9502, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,579 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,580 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-05 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,581 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-05 00:00:00
2025-05-22 02:46:36,583 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
590 2018-08-05          276     35827.16  113.377089             197               276               2018-08-05      40917.04         0.875605           0.952224                           0.954227                       0.950221    2018-08-05
2025-05-22 02:46:36,583 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-05 00:00:00", "current_value": 35827.16, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 32131.15428571429, "deviation_in_std": 7.912622647075895, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (35827.16) отклоняется от базовой линии (3696.01) на 32131.15, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,584 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,584 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9542273144533602, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-05 00:00:00", "current_value": 35827.16, "expected_value": 18683.428202247193, "absolute_deviation": 17143.73179775281, "relative_deviation": 0.9175902629952467, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-05 00:00:00 значение total_sales (35827.16) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.950221048187924, "explanation": {"detector_specific_info": {"date": "2018-08-05 00:00:00", "current_value": 35827.16, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 32131.15428571429, "deviation_in_std": 7.912622647075895, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (35827.16) отклоняется от базовой линии (3696.01) на 32131.15, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,584 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 68796, order_id: 6a09c972c5374c18c043270ddf09b641, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,584 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,585 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-14 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,585 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-14 00:00:00
2025-05-22 02:46:36,588 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
599 2018-08-14          315     44682.42  128.397759             228               315               2018-08-14  37562.228571         1.189557           0.989198                                1.0                       0.978396    2018-08-14
2025-05-22 02:46:36,588 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-14 00:00:00", "current_value": 44682.42, "expected_value": 26189.295057471263, "absolute_deviation": 18493.124942528735, "relative_deviation": 0.7061329792171336, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-14 00:00:00 значение total_sales (44682.42) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}]
2025-05-22 02:46:36,588 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,589 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-14 00:00:00", "current_value": 44682.42, "expected_value": 26189.295057471263, "absolute_deviation": 18493.124942528735, "relative_deviation": 0.7061329792171336, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-14 00:00:00 значение total_sales (44682.42) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}]
2025-05-22 02:46:36,589 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 68796, order_id: 6a09c972c5374c18c043270ddf09b641, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9784, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,589 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,589 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-14 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,590 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-14 00:00:00
2025-05-22 02:46:36,592 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
599 2018-08-14          315     44682.42  128.397759             228               315               2018-08-14  37562.228571         1.189557           0.989198                                1.0                       0.978396    2018-08-14
2025-05-22 02:46:36,593 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-14 00:00:00", "current_value": 44682.42, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40986.41428571429, "deviation_in_std": 10.093320240405061, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (44682.42) отклоняется от базовой линии (3696.01) на 40986.41, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,593 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,593 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-14 00:00:00", "current_value": 44682.42, "expected_value": 26189.295057471263, "absolute_deviation": 18493.124942528735, "relative_deviation": 0.7061329792171336, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-14 00:00:00 значение total_sales (44682.42) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9783962277530719, "explanation": {"detector_specific_info": {"date": "2018-08-14 00:00:00", "current_value": 44682.42, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40986.41428571429, "deviation_in_std": 10.093320240405061, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (44682.42) отклоняется от базовой линии (3696.01) на 40986.41, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,594 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 70797, order_id: d289934bddf878e1cac62c95c8ee5402, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.2171, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:36,594 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 70797, order_id: d289934bddf878e1cac62c95c8ee5402, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.7849, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,594 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:36,594 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=7299e27ed73d2ad986de7f7c77d919fa in aggregated_behavior_data_with_scores
2025-05-22 02:46:36,595 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:36,598 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                             seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                                   categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
1412  7299e27ed73d2ad986de7f7c77d919fa   98.885094  148.935573    371       5.99     1500.0     19.280997    10.805647  [consoles_games, brinquedos, bebes, utilidades_domesticas, esporte_lazer, eletroportateis, alimentos, cool_stuff, automotivo, artes, relogios_presentes, moveis_decoracao, cama_mesa_banho]              13          1.506148         250.417362                0.194984                 13             0.03504              0.791985         0.50099                          0.217125                                   0.784855
2025-05-22 02:46:36,598 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}]
2025-05-22 02:46:36,598 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,598 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.7848545894928308, "explanation": {"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}}]
2025-05-22 02:46:36,599 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 70797, order_id: d289934bddf878e1cac62c95c8ee5402, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,599 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,599 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-15 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,601 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-15 00:00:00
2025-05-22 02:46:36,603 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
600 2018-08-15          285      46326.8  141.672171             208               285               2018-08-15  37936.561429         1.221165           0.990972                                1.0                       0.981944    2018-08-15
2025-05-22 02:46:36,603 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-15 00:00:00", "current_value": 46326.8, "expected_value": 25669.474712643678, "absolute_deviation": 20657.325287356325, "relative_deviation": 0.8047428129560211, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-15 00:00:00 значение total_sales (46326.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}]
2025-05-22 02:46:36,603 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,604 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-15 00:00:00", "current_value": 46326.8, "expected_value": 25669.474712643678, "absolute_deviation": 20657.325287356325, "relative_deviation": 0.8047428129560211, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-15 00:00:00 значение total_sales (46326.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}]
2025-05-22 02:46:36,604 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 70797, order_id: d289934bddf878e1cac62c95c8ee5402, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9819, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,604 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,604 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-15 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,605 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-15 00:00:00
2025-05-22 02:46:36,607 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
600 2018-08-15          285      46326.8  141.672171             208               285               2018-08-15  37936.561429         1.221165           0.990972                                1.0                       0.981944    2018-08-15
2025-05-22 02:46:36,608 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-15 00:00:00", "current_value": 46326.8, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 42630.79428571429, "deviation_in_std": 10.498265494244997, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (46326.80) отклоняется от базовой линии (3696.01) на 42630.79, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,608 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,608 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-15 00:00:00", "current_value": 46326.8, "expected_value": 25669.474712643678, "absolute_deviation": 20657.325287356325, "relative_deviation": 0.8047428129560211, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-15 00:00:00 значение total_sales (46326.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9819435388597458, "explanation": {"detector_specific_info": {"date": "2018-08-15 00:00:00", "current_value": 46326.8, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 42630.79428571429, "deviation_in_std": 10.498265494244997, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (46326.80) отклоняется от базовой линии (3696.01) на 42630.79, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,609 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 70798, order_id: d289934bddf878e1cac62c95c8ee5402, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.2171, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:36,609 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 70798, order_id: d289934bddf878e1cac62c95c8ee5402, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.7849, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,610 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:36,610 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=7299e27ed73d2ad986de7f7c77d919fa in aggregated_behavior_data_with_scores
2025-05-22 02:46:36,611 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:36,613 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                             seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                                   categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
1412  7299e27ed73d2ad986de7f7c77d919fa   98.885094  148.935573    371       5.99     1500.0     19.280997    10.805647  [consoles_games, brinquedos, bebes, utilidades_domesticas, esporte_lazer, eletroportateis, alimentos, cool_stuff, automotivo, artes, relogios_presentes, moveis_decoracao, cama_mesa_banho]              13          1.506148         250.417362                0.194984                 13             0.03504              0.791985         0.50099                          0.217125                                   0.784855
2025-05-22 02:46:36,613 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}]
2025-05-22 02:46:36,614 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,614 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.7848545894928308, "explanation": {"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}}]
2025-05-22 02:46:36,614 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 70798, order_id: d289934bddf878e1cac62c95c8ee5402, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,614 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,615 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-15 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,616 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-15 00:00:00
2025-05-22 02:46:36,618 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
600 2018-08-15          285      46326.8  141.672171             208               285               2018-08-15  37936.561429         1.221165           0.990972                                1.0                       0.981944    2018-08-15
2025-05-22 02:46:36,618 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-15 00:00:00", "current_value": 46326.8, "expected_value": 25669.474712643678, "absolute_deviation": 20657.325287356325, "relative_deviation": 0.8047428129560211, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-15 00:00:00 значение total_sales (46326.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}]
2025-05-22 02:46:36,618 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,619 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-15 00:00:00", "current_value": 46326.8, "expected_value": 25669.474712643678, "absolute_deviation": 20657.325287356325, "relative_deviation": 0.8047428129560211, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-15 00:00:00 значение total_sales (46326.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}]
2025-05-22 02:46:36,619 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 70798, order_id: d289934bddf878e1cac62c95c8ee5402, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9819, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,619 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,619 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-15 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,622 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-15 00:00:00
2025-05-22 02:46:36,624 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
600 2018-08-15          285      46326.8  141.672171             208               285               2018-08-15  37936.561429         1.221165           0.990972                                1.0                       0.981944    2018-08-15
2025-05-22 02:46:36,625 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-15 00:00:00", "current_value": 46326.8, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 42630.79428571429, "deviation_in_std": 10.498265494244997, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (46326.80) отклоняется от базовой линии (3696.01) на 42630.79, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,625 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,625 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-15 00:00:00", "current_value": 46326.8, "expected_value": 25669.474712643678, "absolute_deviation": 20657.325287356325, "relative_deviation": 0.8047428129560211, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-15 00:00:00 значение total_sales (46326.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9819435388597458, "explanation": {"detector_specific_info": {"date": "2018-08-15 00:00:00", "current_value": 46326.8, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 42630.79428571429, "deviation_in_std": 10.498265494244997, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (46326.80) отклоняется от базовой линии (3696.01) на 42630.79, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,626 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 71266, order_id: 9057b899f36887819dff05586e5d11e1, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.2171, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:36,626 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 71266, order_id: 9057b899f36887819dff05586e5d11e1, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.7849, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,626 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:36,626 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=7299e27ed73d2ad986de7f7c77d919fa in aggregated_behavior_data_with_scores
2025-05-22 02:46:36,627 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:36,631 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                             seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                                   categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
1412  7299e27ed73d2ad986de7f7c77d919fa   98.885094  148.935573    371       5.99     1500.0     19.280997    10.805647  [consoles_games, brinquedos, bebes, utilidades_domesticas, esporte_lazer, eletroportateis, alimentos, cool_stuff, automotivo, artes, relogios_presentes, moveis_decoracao, cama_mesa_banho]              13          1.506148         250.417362                0.194984                 13             0.03504              0.791985         0.50099                          0.217125                                   0.784855
2025-05-22 02:46:36,631 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}]
2025-05-22 02:46:36,632 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,632 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.7848545894928308, "explanation": {"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}}]
2025-05-22 02:46:36,632 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 71266, order_id: 9057b899f36887819dff05586e5d11e1, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,632 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,633 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-07 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,633 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-07 00:00:00
2025-05-22 02:46:36,635 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
592 2018-08-07          366      50588.5  114.973864             252               366               2018-08-07  44125.211429         1.146476           0.979335                                1.0                        0.95867    2018-08-07
2025-05-22 02:46:36,636 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-07 00:00:00", "current_value": 50588.5, "expected_value": 26189.295057471263, "absolute_deviation": 24399.204942528737, "relative_deviation": 0.9316480221779834, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-07 00:00:00 значение total_sales (50588.50) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}]
2025-05-22 02:46:36,637 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,637 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-07 00:00:00", "current_value": 50588.5, "expected_value": 26189.295057471263, "absolute_deviation": 24399.204942528737, "relative_deviation": 0.9316480221779834, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-07 00:00:00 значение total_sales (50588.50) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}]
2025-05-22 02:46:36,637 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 71266, order_id: 9057b899f36887819dff05586e5d11e1, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9587, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,637 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,638 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-07 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,639 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-07 00:00:00
2025-05-22 02:46:36,641 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
592 2018-08-07          366      50588.5  114.973864             252               366               2018-08-07  44125.211429         1.146476           0.979335                                1.0                        0.95867    2018-08-07
2025-05-22 02:46:36,642 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-07 00:00:00", "current_value": 50588.5, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 46892.49428571429, "deviation_in_std": 11.547752345392325, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (50588.50) отклоняется от базовой линии (3696.01) на 46892.49, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,642 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,642 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-07 00:00:00", "current_value": 50588.5, "expected_value": 26189.295057471263, "absolute_deviation": 24399.204942528737, "relative_deviation": 0.9316480221779834, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-07 00:00:00 значение total_sales (50588.50) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.95867015383243, "explanation": {"detector_specific_info": {"date": "2018-08-07 00:00:00", "current_value": 50588.5, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 46892.49428571429, "deviation_in_std": 11.547752345392325, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (50588.50) отклоняется от базовой линии (3696.01) на 46892.49, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,643 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 72676, order_id: c11770b0aaeeaf11800205df9b333d78, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1769, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:36,643 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 72676, order_id: c11770b0aaeeaf11800205df9b333d78, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9184, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,643 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:36,644 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=36a968b544695394e4e9d7572688598f in aggregated_behavior_data_with_scores
2025-05-22 02:46:36,644 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:36,647 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                        categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
642  36a968b544695394e4e9d7572688598f   56.522384  136.831171    172        3.9     1140.9     13.350814      5.53097  [informatica_acessorios, beleza_saude, telefonia, automotivo, tablets_impressao_imagem, instrumentos_musicais, ferramentas_jardim, cool_stuff, consoles_games, moveis_decoracao]              10          2.420832         292.538462                0.236204                 10             0.05814              0.719612        0.547647                          0.176931                                   0.918363
2025-05-22 02:46:36,647 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}]
2025-05-22 02:46:36,648 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,648 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.918363395536566, "explanation": {"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}}]
2025-05-22 02:46:36,649 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 72676, order_id: c11770b0aaeeaf11800205df9b333d78, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.9268, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,649 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,649 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-23 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,651 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-23 00:00:00
2025-05-22 02:46:36,653 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
577 2018-07-23          305     40827.91  115.659802             227               305               2018-07-23  34498.897143         1.183456           0.919871                           0.926804                       0.912939    2018-07-23
2025-05-22 02:46:36,654 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-23 00:00:00", "current_value": 40827.909999999996, "expected_value": 25862.10588888889, "absolute_deviation": 14965.804111111105, "relative_deviation": 0.5786769327837625, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-23 00:00:00 значение total_sales (40827.91) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}]
2025-05-22 02:46:36,654 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,654 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.926804266551497, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-23 00:00:00", "current_value": 40827.909999999996, "expected_value": 25862.10588888889, "absolute_deviation": 14965.804111111105, "relative_deviation": 0.5786769327837625, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-23 00:00:00 значение total_sales (40827.91) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}]
2025-05-22 02:46:36,654 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 72676, order_id: c11770b0aaeeaf11800205df9b333d78, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9129, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,655 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,655 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-23 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,656 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-23 00:00:00
2025-05-22 02:46:36,658 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
577 2018-07-23          305     40827.91  115.659802             227               305               2018-07-23  34498.897143         1.183456           0.919871                           0.926804                       0.912939    2018-07-23
2025-05-22 02:46:36,658 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-07-23 00:00:00", "current_value": 40827.909999999996, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 37131.904285714285, "deviation_in_std": 9.144108056859551, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (40827.91) отклоняется от базовой линии (3696.01) на 37131.90, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,659 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,659 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.926804266551497, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-23 00:00:00", "current_value": 40827.909999999996, "expected_value": 25862.10588888889, "absolute_deviation": 14965.804111111105, "relative_deviation": 0.5786769327837625, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-23 00:00:00 значение total_sales (40827.91) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9129385689972365, "explanation": {"detector_specific_info": {"date": "2018-07-23 00:00:00", "current_value": 40827.909999999996, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 37131.904285714285, "deviation_in_std": 9.144108056859551, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (40827.91) отклоняется от базовой линии (3696.01) на 37131.90, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,659 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 74219, order_id: e5f2a41dc1488b94c17771d3d627bec9, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,660 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,660 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-14 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,661 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-14 00:00:00
2025-05-22 02:46:36,664 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
599 2018-08-14          315     44682.42  128.397759             228               315               2018-08-14  37562.228571         1.189557           0.989198                                1.0                       0.978396    2018-08-14
2025-05-22 02:46:36,665 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-14 00:00:00", "current_value": 44682.42, "expected_value": 26189.295057471263, "absolute_deviation": 18493.124942528735, "relative_deviation": 0.7061329792171336, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-14 00:00:00 значение total_sales (44682.42) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}]
2025-05-22 02:46:36,665 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,665 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-14 00:00:00", "current_value": 44682.42, "expected_value": 26189.295057471263, "absolute_deviation": 18493.124942528735, "relative_deviation": 0.7061329792171336, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-14 00:00:00 значение total_sales (44682.42) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}]
2025-05-22 02:46:36,665 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 74219, order_id: e5f2a41dc1488b94c17771d3d627bec9, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9784, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,666 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,666 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-14 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,667 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-14 00:00:00
2025-05-22 02:46:36,668 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
599 2018-08-14          315     44682.42  128.397759             228               315               2018-08-14  37562.228571         1.189557           0.989198                                1.0                       0.978396    2018-08-14
2025-05-22 02:46:36,669 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-14 00:00:00", "current_value": 44682.42, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40986.41428571429, "deviation_in_std": 10.093320240405061, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (44682.42) отклоняется от базовой линии (3696.01) на 40986.41, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,669 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,670 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-14 00:00:00", "current_value": 44682.42, "expected_value": 26189.295057471263, "absolute_deviation": 18493.124942528735, "relative_deviation": 0.7061329792171336, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-14 00:00:00 значение total_sales (44682.42) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9783962277530719, "explanation": {"detector_specific_info": {"date": "2018-08-14 00:00:00", "current_value": 44682.42, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40986.41428571429, "deviation_in_std": 10.093320240405061, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (44682.42) отклоняется от базовой линии (3696.01) на 40986.41, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,670 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 74778, order_id: 94fca82966c05ba707f4e7dc0c50aa3c, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,671 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,671 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-15 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,672 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-15 00:00:00
2025-05-22 02:46:36,674 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
600 2018-08-15          285      46326.8  141.672171             208               285               2018-08-15  37936.561429         1.221165           0.990972                                1.0                       0.981944    2018-08-15
2025-05-22 02:46:36,675 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-15 00:00:00", "current_value": 46326.8, "expected_value": 25669.474712643678, "absolute_deviation": 20657.325287356325, "relative_deviation": 0.8047428129560211, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-15 00:00:00 значение total_sales (46326.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}]
2025-05-22 02:46:36,675 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,675 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-15 00:00:00", "current_value": 46326.8, "expected_value": 25669.474712643678, "absolute_deviation": 20657.325287356325, "relative_deviation": 0.8047428129560211, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-15 00:00:00 значение total_sales (46326.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}]
2025-05-22 02:46:36,675 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 74778, order_id: 94fca82966c05ba707f4e7dc0c50aa3c, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9819, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,675 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,676 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-15 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,676 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-15 00:00:00
2025-05-22 02:46:36,679 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
600 2018-08-15          285      46326.8  141.672171             208               285               2018-08-15  37936.561429         1.221165           0.990972                                1.0                       0.981944    2018-08-15
2025-05-22 02:46:36,680 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-15 00:00:00", "current_value": 46326.8, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 42630.79428571429, "deviation_in_std": 10.498265494244997, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (46326.80) отклоняется от базовой линии (3696.01) на 42630.79, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,681 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,681 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-15 00:00:00", "current_value": 46326.8, "expected_value": 25669.474712643678, "absolute_deviation": 20657.325287356325, "relative_deviation": 0.8047428129560211, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-15 00:00:00 значение total_sales (46326.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9819435388597458, "explanation": {"detector_specific_info": {"date": "2018-08-15 00:00:00", "current_value": 46326.8, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 42630.79428571429, "deviation_in_std": 10.498265494244997, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (46326.80) отклоняется от базовой линии (3696.01) на 42630.79, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,682 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 75482, order_id: 4160b6447ad70e6d73f7221dd970bbe9, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,682 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,682 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-15 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,684 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-15 00:00:00
2025-05-22 02:46:36,686 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
600 2018-08-15          285      46326.8  141.672171             208               285               2018-08-15  37936.561429         1.221165           0.990972                                1.0                       0.981944    2018-08-15
2025-05-22 02:46:36,686 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-15 00:00:00", "current_value": 46326.8, "expected_value": 25669.474712643678, "absolute_deviation": 20657.325287356325, "relative_deviation": 0.8047428129560211, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-15 00:00:00 значение total_sales (46326.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}]
2025-05-22 02:46:36,687 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,687 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-15 00:00:00", "current_value": 46326.8, "expected_value": 25669.474712643678, "absolute_deviation": 20657.325287356325, "relative_deviation": 0.8047428129560211, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-15 00:00:00 значение total_sales (46326.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}]
2025-05-22 02:46:36,687 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 75482, order_id: 4160b6447ad70e6d73f7221dd970bbe9, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9819, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,687 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,688 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-15 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,689 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-15 00:00:00
2025-05-22 02:46:36,691 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
600 2018-08-15          285      46326.8  141.672171             208               285               2018-08-15  37936.561429         1.221165           0.990972                                1.0                       0.981944    2018-08-15
2025-05-22 02:46:36,692 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-15 00:00:00", "current_value": 46326.8, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 42630.79428571429, "deviation_in_std": 10.498265494244997, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (46326.80) отклоняется от базовой линии (3696.01) на 42630.79, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,692 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,692 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-15 00:00:00", "current_value": 46326.8, "expected_value": 25669.474712643678, "absolute_deviation": 20657.325287356325, "relative_deviation": 0.8047428129560211, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-15 00:00:00 значение total_sales (46326.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9819435388597458, "explanation": {"detector_specific_info": {"date": "2018-08-15 00:00:00", "current_value": 46326.8, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 42630.79428571429, "deviation_in_std": 10.498265494244997, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (46326.80) отклоняется от базовой линии (3696.01) на 42630.79, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,693 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 76731, order_id: db0bd04c3beff2d041d364ce8d96b2f0, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.8977, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,693 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,693 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-12 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,694 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-12 00:00:00
2025-05-22 02:46:36,696 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
597 2018-08-12          197     32665.67  139.002851             160               197               2018-08-12  41160.318571          0.79362           0.934894                           0.897745                       0.972043    2018-08-12
2025-05-22 02:46:36,696 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-12 00:00:00", "current_value": 32665.670000000002, "expected_value": 18683.428202247193, "absolute_deviation": 13982.24179775281, "relative_deviation": 0.7483766708334108, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-12 00:00:00 значение total_sales (32665.67) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}]
2025-05-22 02:46:36,696 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,696 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8977452993668317, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-12 00:00:00", "current_value": 32665.670000000002, "expected_value": 18683.428202247193, "absolute_deviation": 13982.24179775281, "relative_deviation": 0.7483766708334108, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-12 00:00:00 значение total_sales (32665.67) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}]
2025-05-22 02:46:36,697 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 76731, order_id: db0bd04c3beff2d041d364ce8d96b2f0, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9720, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,697 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,697 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-12 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,698 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-12 00:00:00
2025-05-22 02:46:36,700 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
597 2018-08-12          197     32665.67  139.002851             160               197               2018-08-12  41160.318571          0.79362           0.934894                           0.897745                       0.972043    2018-08-12
2025-05-22 02:46:36,701 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-12 00:00:00", "current_value": 32665.670000000002, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 28969.664285714287, "deviation_in_std": 7.1340736677874, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (32665.67) отклоняется от базовой линии (3696.01) на 28969.66, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,701 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,701 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8977452993668317, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-12 00:00:00", "current_value": 32665.670000000002, "expected_value": 18683.428202247193, "absolute_deviation": 13982.24179775281, "relative_deviation": 0.7483766708334108, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-12 00:00:00 значение total_sales (32665.67) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9720429031944142, "explanation": {"detector_specific_info": {"date": "2018-08-12 00:00:00", "current_value": 32665.670000000002, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 28969.664285714287, "deviation_in_std": 7.1340736677874, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (32665.67) отклоняется от базовой линии (3696.01) на 28969.66, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,702 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 76732, order_id: db0bd04c3beff2d041d364ce8d96b2f0, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.8977, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,702 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,702 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-12 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,703 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-12 00:00:00
2025-05-22 02:46:36,705 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
597 2018-08-12          197     32665.67  139.002851             160               197               2018-08-12  41160.318571          0.79362           0.934894                           0.897745                       0.972043    2018-08-12
2025-05-22 02:46:36,705 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-12 00:00:00", "current_value": 32665.670000000002, "expected_value": 18683.428202247193, "absolute_deviation": 13982.24179775281, "relative_deviation": 0.7483766708334108, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-12 00:00:00 значение total_sales (32665.67) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}]
2025-05-22 02:46:36,706 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,706 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8977452993668317, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-12 00:00:00", "current_value": 32665.670000000002, "expected_value": 18683.428202247193, "absolute_deviation": 13982.24179775281, "relative_deviation": 0.7483766708334108, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-12 00:00:00 значение total_sales (32665.67) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}]
2025-05-22 02:46:36,706 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 76732, order_id: db0bd04c3beff2d041d364ce8d96b2f0, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9720, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,706 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,707 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-12 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,707 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-12 00:00:00
2025-05-22 02:46:36,709 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
597 2018-08-12          197     32665.67  139.002851             160               197               2018-08-12  41160.318571          0.79362           0.934894                           0.897745                       0.972043    2018-08-12
2025-05-22 02:46:36,710 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-12 00:00:00", "current_value": 32665.670000000002, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 28969.664285714287, "deviation_in_std": 7.1340736677874, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (32665.67) отклоняется от базовой линии (3696.01) на 28969.66, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,710 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,710 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8977452993668317, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-12 00:00:00", "current_value": 32665.670000000002, "expected_value": 18683.428202247193, "absolute_deviation": 13982.24179775281, "relative_deviation": 0.7483766708334108, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-12 00:00:00 значение total_sales (32665.67) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9720429031944142, "explanation": {"detector_specific_info": {"date": "2018-08-12 00:00:00", "current_value": 32665.670000000002, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 28969.664285714287, "deviation_in_std": 7.1340736677874, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (32665.67) отклоняется от базовой линии (3696.01) на 28969.66, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,711 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 76805, order_id: fb9bb6436441ba78b79012524ca465c1, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,711 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,711 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-07 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,712 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-07 00:00:00
2025-05-22 02:46:36,714 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
592 2018-08-07          366      50588.5  114.973864             252               366               2018-08-07  44125.211429         1.146476           0.979335                                1.0                        0.95867    2018-08-07
2025-05-22 02:46:36,715 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-07 00:00:00", "current_value": 50588.5, "expected_value": 26189.295057471263, "absolute_deviation": 24399.204942528737, "relative_deviation": 0.9316480221779834, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-07 00:00:00 значение total_sales (50588.50) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}]
2025-05-22 02:46:36,715 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,715 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-07 00:00:00", "current_value": 50588.5, "expected_value": 26189.295057471263, "absolute_deviation": 24399.204942528737, "relative_deviation": 0.9316480221779834, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-07 00:00:00 значение total_sales (50588.50) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}]
2025-05-22 02:46:36,716 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 76805, order_id: fb9bb6436441ba78b79012524ca465c1, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9587, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,716 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,716 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-07 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,717 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-07 00:00:00
2025-05-22 02:46:36,719 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
592 2018-08-07          366      50588.5  114.973864             252               366               2018-08-07  44125.211429         1.146476           0.979335                                1.0                        0.95867    2018-08-07
2025-05-22 02:46:36,720 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-07 00:00:00", "current_value": 50588.5, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 46892.49428571429, "deviation_in_std": 11.547752345392325, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (50588.50) отклоняется от базовой линии (3696.01) на 46892.49, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,720 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,720 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-07 00:00:00", "current_value": 50588.5, "expected_value": 26189.295057471263, "absolute_deviation": 24399.204942528737, "relative_deviation": 0.9316480221779834, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-07 00:00:00 значение total_sales (50588.50) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.95867015383243, "explanation": {"detector_specific_info": {"date": "2018-08-07 00:00:00", "current_value": 50588.5, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 46892.49428571429, "deviation_in_std": 11.547752345392325, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (50588.50) отклоняется от базовой линии (3696.01) на 46892.49, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,721 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 76916, order_id: 86df5fa6306829eeeab1906b3f7ad102, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.2171, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:36,721 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 76916, order_id: 86df5fa6306829eeeab1906b3f7ad102, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.7849, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,721 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:36,721 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=7299e27ed73d2ad986de7f7c77d919fa in aggregated_behavior_data_with_scores
2025-05-22 02:46:36,722 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:36,724 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                             seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                                   categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
1412  7299e27ed73d2ad986de7f7c77d919fa   98.885094  148.935573    371       5.99     1500.0     19.280997    10.805647  [consoles_games, brinquedos, bebes, utilidades_domesticas, esporte_lazer, eletroportateis, alimentos, cool_stuff, automotivo, artes, relogios_presentes, moveis_decoracao, cama_mesa_banho]              13          1.506148         250.417362                0.194984                 13             0.03504              0.791985         0.50099                          0.217125                                   0.784855
2025-05-22 02:46:36,725 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}]
2025-05-22 02:46:36,725 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,726 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.7848545894928308, "explanation": {"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}}]
2025-05-22 02:46:36,726 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 76916, order_id: 86df5fa6306829eeeab1906b3f7ad102, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.8307, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,726 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,727 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-29 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,728 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-29 00:00:00
2025-05-22 02:46:36,730 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
583 2018-07-29          188      32085.4  145.842727             150               188               2018-07-29  35787.032857         0.896565           0.879612                           0.830683                       0.928541    2018-07-29
2025-05-22 02:46:36,730 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-29 00:00:00", "current_value": 32085.4, "expected_value": 18683.428202247193, "absolute_deviation": 13401.971797752809, "relative_deviation": 0.7173186661825187, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-29 00:00:00 значение total_sales (32085.40) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}]
2025-05-22 02:46:36,730 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,731 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8306826658975347, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-29 00:00:00", "current_value": 32085.4, "expected_value": 18683.428202247193, "absolute_deviation": 13401.971797752809, "relative_deviation": 0.7173186661825187, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-29 00:00:00 значение total_sales (32085.40) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}]
2025-05-22 02:46:36,731 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 76916, order_id: 86df5fa6306829eeeab1906b3f7ad102, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9285, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,731 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,732 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-29 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,733 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-29 00:00:00
2025-05-22 02:46:36,735 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
583 2018-07-29          188      32085.4  145.842727             150               188               2018-07-29  35787.032857         0.896565           0.879612                           0.830683                       0.928541    2018-07-29
2025-05-22 02:46:36,736 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-07-29 00:00:00", "current_value": 32085.4, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 28389.394285714287, "deviation_in_std": 6.991176294646339, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (32085.40) отклоняется от базовой линии (3696.01) на 28389.39, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,736 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,736 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8306826658975347, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-29 00:00:00", "current_value": 32085.4, "expected_value": 18683.428202247193, "absolute_deviation": 13401.971797752809, "relative_deviation": 0.7173186661825187, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-29 00:00:00 значение total_sales (32085.40) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.928540895759355, "explanation": {"detector_specific_info": {"date": "2018-07-29 00:00:00", "current_value": 32085.4, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 28389.394285714287, "deviation_in_std": 6.991176294646339, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (32085.40) отклоняется от базовой линии (3696.01) на 28389.39, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,737 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 76917, order_id: 86df5fa6306829eeeab1906b3f7ad102, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.2171, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:36,737 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 76917, order_id: 86df5fa6306829eeeab1906b3f7ad102, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.7849, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,737 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:36,737 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=7299e27ed73d2ad986de7f7c77d919fa in aggregated_behavior_data_with_scores
2025-05-22 02:46:36,738 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:36,741 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                             seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                                   categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
1412  7299e27ed73d2ad986de7f7c77d919fa   98.885094  148.935573    371       5.99     1500.0     19.280997    10.805647  [consoles_games, brinquedos, bebes, utilidades_domesticas, esporte_lazer, eletroportateis, alimentos, cool_stuff, automotivo, artes, relogios_presentes, moveis_decoracao, cama_mesa_banho]              13          1.506148         250.417362                0.194984                 13             0.03504              0.791985         0.50099                          0.217125                                   0.784855
2025-05-22 02:46:36,742 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}]
2025-05-22 02:46:36,742 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,742 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.7848545894928308, "explanation": {"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}}]
2025-05-22 02:46:36,743 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 76917, order_id: 86df5fa6306829eeeab1906b3f7ad102, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.8307, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,743 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,743 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-29 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,744 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-29 00:00:00
2025-05-22 02:46:36,746 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
583 2018-07-29          188      32085.4  145.842727             150               188               2018-07-29  35787.032857         0.896565           0.879612                           0.830683                       0.928541    2018-07-29
2025-05-22 02:46:36,747 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-29 00:00:00", "current_value": 32085.4, "expected_value": 18683.428202247193, "absolute_deviation": 13401.971797752809, "relative_deviation": 0.7173186661825187, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-29 00:00:00 значение total_sales (32085.40) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}]
2025-05-22 02:46:36,747 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,748 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8306826658975347, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-29 00:00:00", "current_value": 32085.4, "expected_value": 18683.428202247193, "absolute_deviation": 13401.971797752809, "relative_deviation": 0.7173186661825187, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-29 00:00:00 значение total_sales (32085.40) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}]
2025-05-22 02:46:36,748 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 76917, order_id: 86df5fa6306829eeeab1906b3f7ad102, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9285, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,748 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,748 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-29 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,749 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-29 00:00:00
2025-05-22 02:46:36,751 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
583 2018-07-29          188      32085.4  145.842727             150               188               2018-07-29  35787.032857         0.896565           0.879612                           0.830683                       0.928541    2018-07-29
2025-05-22 02:46:36,751 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-07-29 00:00:00", "current_value": 32085.4, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 28389.394285714287, "deviation_in_std": 6.991176294646339, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (32085.40) отклоняется от базовой линии (3696.01) на 28389.39, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,751 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,752 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8306826658975347, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-29 00:00:00", "current_value": 32085.4, "expected_value": 18683.428202247193, "absolute_deviation": 13401.971797752809, "relative_deviation": 0.7173186661825187, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-29 00:00:00 значение total_sales (32085.40) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.928540895759355, "explanation": {"detector_specific_info": {"date": "2018-07-29 00:00:00", "current_value": 32085.4, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 28389.394285714287, "deviation_in_std": 6.991176294646339, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (32085.40) отклоняется от базовой линии (3696.01) на 28389.39, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,752 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 77412, order_id: fa363ceded15b46744459dd87ba1e281, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.7472, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,752 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,753 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-09 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,754 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-09 00:00:00
2025-05-22 02:46:36,756 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
594 2018-08-09          283     42138.17  125.785582             204               283               2018-08-09  44497.781429         0.946972           0.856223                           0.747247                       0.965198    2018-08-09
2025-05-22 02:46:36,757 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-09 00:00:00", "current_value": 42138.17, "expected_value": 24263.594318181815, "absolute_deviation": 17874.575681818184, "relative_deviation": 0.7366829269983282, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-09 00:00:00 значение total_sales (42138.17) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}]
2025-05-22 02:46:36,763 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,781 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7472473831010398, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-09 00:00:00", "current_value": 42138.17, "expected_value": 24263.594318181815, "absolute_deviation": 17874.575681818184, "relative_deviation": 0.7366829269983282, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-09 00:00:00 значение total_sales (42138.17) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}]
2025-05-22 02:46:36,806 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 77412, order_id: fa363ceded15b46744459dd87ba1e281, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9652, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,814 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,825 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-09 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,828 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-09 00:00:00
2025-05-22 02:46:36,831 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
594 2018-08-09          283     42138.17  125.785582             204               283               2018-08-09  44497.781429         0.946972           0.856223                           0.747247                       0.965198    2018-08-09
2025-05-22 02:46:36,831 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-09 00:00:00", "current_value": 42138.17, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 38442.16428571429, "deviation_in_std": 9.466772871741947, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (42138.17) отклоняется от базовой линии (3696.01) на 38442.16, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,832 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,832 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7472473831010398, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-09 00:00:00", "current_value": 42138.17, "expected_value": 24263.594318181815, "absolute_deviation": 17874.575681818184, "relative_deviation": 0.7366829269983282, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-09 00:00:00 значение total_sales (42138.17) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9651982020506744, "explanation": {"detector_specific_info": {"date": "2018-08-09 00:00:00", "current_value": 42138.17, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 38442.16428571429, "deviation_in_std": 9.466772871741947, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (42138.17) отклоняется от базовой линии (3696.01) на 38442.16, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,832 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 79208, order_id: 8101f323f454f972d5f4773094d2c5e4, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.9542, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,833 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,833 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-05 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,834 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-05 00:00:00
2025-05-22 02:46:36,835 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
590 2018-08-05          276     35827.16  113.377089             197               276               2018-08-05      40917.04         0.875605           0.952224                           0.954227                       0.950221    2018-08-05
2025-05-22 02:46:36,836 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-05 00:00:00", "current_value": 35827.16, "expected_value": 18683.428202247193, "absolute_deviation": 17143.73179775281, "relative_deviation": 0.9175902629952467, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-05 00:00:00 значение total_sales (35827.16) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}]
2025-05-22 02:46:36,837 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,837 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9542273144533602, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-05 00:00:00", "current_value": 35827.16, "expected_value": 18683.428202247193, "absolute_deviation": 17143.73179775281, "relative_deviation": 0.9175902629952467, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-05 00:00:00 значение total_sales (35827.16) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}]
2025-05-22 02:46:36,837 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 79208, order_id: 8101f323f454f972d5f4773094d2c5e4, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9502, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,837 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,838 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-05 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,839 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-05 00:00:00
2025-05-22 02:46:36,847 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
590 2018-08-05          276     35827.16  113.377089             197               276               2018-08-05      40917.04         0.875605           0.952224                           0.954227                       0.950221    2018-08-05
2025-05-22 02:46:36,852 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-05 00:00:00", "current_value": 35827.16, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 32131.15428571429, "deviation_in_std": 7.912622647075895, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (35827.16) отклоняется от базовой линии (3696.01) на 32131.15, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,852 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,853 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9542273144533602, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-05 00:00:00", "current_value": 35827.16, "expected_value": 18683.428202247193, "absolute_deviation": 17143.73179775281, "relative_deviation": 0.9175902629952467, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-05 00:00:00 значение total_sales (35827.16) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.950221048187924, "explanation": {"detector_specific_info": {"date": "2018-08-05 00:00:00", "current_value": 35827.16, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 32131.15428571429, "deviation_in_std": 7.912622647075895, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (35827.16) отклоняется от базовой линии (3696.01) на 32131.15, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,853 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 79333, order_id: 4f4895a14aa8c28dd6c67b1ca830225b, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1697, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:36,854 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 79333, order_id: 4f4895a14aa8c28dd6c67b1ca830225b, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9836, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,854 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:36,854 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=4a3ccda38b2129705f3fb522db62ca31 in aggregated_behavior_data_with_scores
2025-05-22 02:46:36,855 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:36,859 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                               categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
882  4a3ccda38b2129705f3fb522db62ca31  233.158916  370.889347     83        9.9     3099.9     18.396747     9.418922  [construcao_ferramentas_seguranca, casa_construcao, ferramentas_jardim, construcao_ferramentas_construcao, eletronicos]               5          1.590715         313.121212                0.078902                  5            0.060241               0.53771        0.576635                          0.169668                                   0.983603
2025-05-22 02:46:36,859 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}]
2025-05-22 02:46:36,859 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,860 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.9836033466098753, "explanation": {"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}}]
2025-05-22 02:46:36,860 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 79333, order_id: 4f4895a14aa8c28dd6c67b1ca830225b, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.8346, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,860 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,860 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-04-16 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,861 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-04-16 00:00:00
2025-05-22 02:46:36,863 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
479 2018-04-16          280     42078.09  123.035351             202               280               2018-04-16  32801.657143         1.282804           0.761666                            0.83462                       0.688712    2018-04-16
2025-05-22 02:46:36,863 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-04-16 00:00:00", "current_value": 42078.090000000004, "expected_value": 25862.10588888889, "absolute_deviation": 16215.984111111113, "relative_deviation": 0.6270171571015788, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-04-16 00:00:00 значение total_sales (42078.09) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}]
2025-05-22 02:46:36,864 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,864 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8346203725534336, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-04-16 00:00:00", "current_value": 42078.090000000004, "expected_value": 25862.10588888889, "absolute_deviation": 16215.984111111113, "relative_deviation": 0.6270171571015788, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-04-16 00:00:00 значение total_sales (42078.09) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}]
2025-05-22 02:46:36,864 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 79333, order_id: 4f4895a14aa8c28dd6c67b1ca830225b, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.6887, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,864 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,865 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-04-16 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,865 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-04-16 00:00:00
2025-05-22 02:46:36,868 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
479 2018-04-16          280     42078.09  123.035351             202               280               2018-04-16  32801.657143         1.282804           0.761666                            0.83462                       0.688712    2018-04-16
2025-05-22 02:46:36,868 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-04-16 00:00:00", "current_value": 42078.090000000004, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 38382.08428571429, "deviation_in_std": 9.451977562354395, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (42078.09) отклоняется от базовой линии (3696.01) на 38382.08, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,868 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,869 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8346203725534336, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-04-16 00:00:00", "current_value": 42078.090000000004, "expected_value": 25862.10588888889, "absolute_deviation": 16215.984111111113, "relative_deviation": 0.6270171571015788, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-04-16 00:00:00 значение total_sales (42078.09) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.6887124453829501, "explanation": {"detector_specific_info": {"date": "2018-04-16 00:00:00", "current_value": 42078.090000000004, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 38382.08428571429, "deviation_in_std": 9.451977562354395, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (42078.09) отклоняется от базовой линии (3696.01) на 38382.08, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,869 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 80570, order_id: 41b7766bb1df487d17fb9725b78ff509, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,869 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,869 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-14 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,871 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-14 00:00:00
2025-05-22 02:46:36,873 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
507 2018-05-14          364     55368.96  130.279906             231               364               2018-05-14      44527.33         1.243483           0.884474                                1.0                       0.768949    2018-05-14
2025-05-22 02:46:36,873 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-14 00:00:00", "current_value": 55368.96, "expected_value": 25862.10588888889, "absolute_deviation": 29506.854111111108, "relative_deviation": 1.140930063386219, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-14 00:00:00 значение total_sales (55368.96) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}]
2025-05-22 02:46:36,874 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,874 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-14 00:00:00", "current_value": 55368.96, "expected_value": 25862.10588888889, "absolute_deviation": 29506.854111111108, "relative_deviation": 1.140930063386219, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-14 00:00:00 значение total_sales (55368.96) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}]
2025-05-22 02:46:36,874 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 80570, order_id: 41b7766bb1df487d17fb9725b78ff509, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.7689, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,874 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,875 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-14 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,875 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-14 00:00:00
2025-05-22 02:46:36,877 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
507 2018-05-14          364     55368.96  130.279906             231               364               2018-05-14      44527.33         1.243483           0.884474                                1.0                       0.768949    2018-05-14
2025-05-22 02:46:36,878 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-05-14 00:00:00", "current_value": 55368.96, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 51672.95428571429, "deviation_in_std": 12.724989108288767, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (55368.96) отклоняется от базовой линии (3696.01) на 51672.95, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,878 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,878 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-14 00:00:00", "current_value": 55368.96, "expected_value": 25862.10588888889, "absolute_deviation": 29506.854111111108, "relative_deviation": 1.140930063386219, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-14 00:00:00 значение total_sales (55368.96) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.7689488301722409, "explanation": {"detector_specific_info": {"date": "2018-05-14 00:00:00", "current_value": 55368.96, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 51672.95428571429, "deviation_in_std": 12.724989108288767, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (55368.96) отклоняется от базовой линии (3696.01) на 51672.95, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,879 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 81289, order_id: 5ce5414216f07cdd464573ba59e7f187, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.2171, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:36,879 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 81289, order_id: 5ce5414216f07cdd464573ba59e7f187, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.7849, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,879 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:36,880 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=7299e27ed73d2ad986de7f7c77d919fa in aggregated_behavior_data_with_scores
2025-05-22 02:46:36,880 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:36,883 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                             seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                                   categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
1412  7299e27ed73d2ad986de7f7c77d919fa   98.885094  148.935573    371       5.99     1500.0     19.280997    10.805647  [consoles_games, brinquedos, bebes, utilidades_domesticas, esporte_lazer, eletroportateis, alimentos, cool_stuff, automotivo, artes, relogios_presentes, moveis_decoracao, cama_mesa_banho]              13          1.506148         250.417362                0.194984                 13             0.03504              0.791985         0.50099                          0.217125                                   0.784855
2025-05-22 02:46:36,884 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}]
2025-05-22 02:46:36,884 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,884 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.7848545894928308, "explanation": {"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}}]
2025-05-22 02:46:36,884 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 81289, order_id: 5ce5414216f07cdd464573ba59e7f187, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,885 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,885 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-01 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,886 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-01 00:00:00
2025-05-22 02:46:36,889 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
586 2018-08-01          310     44495.81  120.912527             212               310               2018-08-01  36798.238571         1.209183           0.969258                                1.0                       0.938516    2018-08-01
2025-05-22 02:46:36,890 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-01 00:00:00", "current_value": 44495.81, "expected_value": 25669.474712643678, "absolute_deviation": 18826.33528735632, "relative_deviation": 0.7334133439856982, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-01 00:00:00 значение total_sales (44495.81) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}]
2025-05-22 02:46:36,890 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,891 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-01 00:00:00", "current_value": 44495.81, "expected_value": 25669.474712643678, "absolute_deviation": 18826.33528735632, "relative_deviation": 0.7334133439856982, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-01 00:00:00 значение total_sales (44495.81) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}]
2025-05-22 02:46:36,891 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 81289, order_id: 5ce5414216f07cdd464573ba59e7f187, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9385, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,892 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,892 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-01 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,894 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-01 00:00:00
2025-05-22 02:46:36,895 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
586 2018-08-01          310     44495.81  120.912527             212               310               2018-08-01  36798.238571         1.209183           0.969258                                1.0                       0.938516    2018-08-01
2025-05-22 02:46:36,896 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-01 00:00:00", "current_value": 44495.81, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40799.80428571429, "deviation_in_std": 10.047365635131905, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (44495.81) отклоняется от базовой линии (3696.01) на 40799.80, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,896 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,897 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-01 00:00:00", "current_value": 44495.81, "expected_value": 25669.474712643678, "absolute_deviation": 18826.33528735632, "relative_deviation": 0.7334133439856982, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-01 00:00:00 значение total_sales (44495.81) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9385162906742874, "explanation": {"detector_specific_info": {"date": "2018-08-01 00:00:00", "current_value": 44495.81, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40799.80428571429, "deviation_in_std": 10.047365635131905, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (44495.81) отклоняется от базовой линии (3696.01) на 40799.80, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,897 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 82006, order_id: 2c810e97c1d3956172e1830863e6a133, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,897 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,898 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-15 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,899 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-15 00:00:00
2025-05-22 02:46:36,902 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
600 2018-08-15          285      46326.8  141.672171             208               285               2018-08-15  37936.561429         1.221165           0.990972                                1.0                       0.981944    2018-08-15
2025-05-22 02:46:36,903 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-15 00:00:00", "current_value": 46326.8, "expected_value": 25669.474712643678, "absolute_deviation": 20657.325287356325, "relative_deviation": 0.8047428129560211, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-15 00:00:00 значение total_sales (46326.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}]
2025-05-22 02:46:36,903 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,903 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-15 00:00:00", "current_value": 46326.8, "expected_value": 25669.474712643678, "absolute_deviation": 20657.325287356325, "relative_deviation": 0.8047428129560211, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-15 00:00:00 значение total_sales (46326.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}]
2025-05-22 02:46:36,904 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 82006, order_id: 2c810e97c1d3956172e1830863e6a133, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9819, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,904 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,904 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-15 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,906 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-15 00:00:00
2025-05-22 02:46:36,908 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
600 2018-08-15          285      46326.8  141.672171             208               285               2018-08-15  37936.561429         1.221165           0.990972                                1.0                       0.981944    2018-08-15
2025-05-22 02:46:36,909 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-15 00:00:00", "current_value": 46326.8, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 42630.79428571429, "deviation_in_std": 10.498265494244997, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (46326.80) отклоняется от базовой линии (3696.01) на 42630.79, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,909 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,910 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-15 00:00:00", "current_value": 46326.8, "expected_value": 25669.474712643678, "absolute_deviation": 20657.325287356325, "relative_deviation": 0.8047428129560211, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-15 00:00:00 значение total_sales (46326.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9819435388597458, "explanation": {"detector_specific_info": {"date": "2018-08-15 00:00:00", "current_value": 46326.8, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 42630.79428571429, "deviation_in_std": 10.498265494244997, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (46326.80) отклоняется от базовой линии (3696.01) на 42630.79, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,910 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 82696, order_id: fc5940447e1729d88293fb999ad3c2da, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1769, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:36,910 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 82696, order_id: fc5940447e1729d88293fb999ad3c2da, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9184, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,910 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:36,910 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=36a968b544695394e4e9d7572688598f in aggregated_behavior_data_with_scores
2025-05-22 02:46:36,912 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:36,917 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                        categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
642  36a968b544695394e4e9d7572688598f   56.522384  136.831171    172        3.9     1140.9     13.350814      5.53097  [informatica_acessorios, beleza_saude, telefonia, automotivo, tablets_impressao_imagem, instrumentos_musicais, ferramentas_jardim, cool_stuff, consoles_games, moveis_decoracao]              10          2.420832         292.538462                0.236204                 10             0.05814              0.719612        0.547647                          0.176931                                   0.918363
2025-05-22 02:46:36,917 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}]
2025-05-22 02:46:36,918 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,918 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.918363395536566, "explanation": {"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}}]
2025-05-22 02:46:36,918 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 82696, order_id: fc5940447e1729d88293fb999ad3c2da, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.9542, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,918 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,919 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-05 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,920 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-05 00:00:00
2025-05-22 02:46:36,922 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
590 2018-08-05          276     35827.16  113.377089             197               276               2018-08-05      40917.04         0.875605           0.952224                           0.954227                       0.950221    2018-08-05
2025-05-22 02:46:36,922 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-05 00:00:00", "current_value": 35827.16, "expected_value": 18683.428202247193, "absolute_deviation": 17143.73179775281, "relative_deviation": 0.9175902629952467, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-05 00:00:00 значение total_sales (35827.16) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}]
2025-05-22 02:46:36,923 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,923 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9542273144533602, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-05 00:00:00", "current_value": 35827.16, "expected_value": 18683.428202247193, "absolute_deviation": 17143.73179775281, "relative_deviation": 0.9175902629952467, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-05 00:00:00 значение total_sales (35827.16) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}]
2025-05-22 02:46:36,923 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 82696, order_id: fc5940447e1729d88293fb999ad3c2da, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9502, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,923 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,923 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-05 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,924 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-05 00:00:00
2025-05-22 02:46:36,926 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
590 2018-08-05          276     35827.16  113.377089             197               276               2018-08-05      40917.04         0.875605           0.952224                           0.954227                       0.950221    2018-08-05
2025-05-22 02:46:36,926 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-05 00:00:00", "current_value": 35827.16, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 32131.15428571429, "deviation_in_std": 7.912622647075895, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (35827.16) отклоняется от базовой линии (3696.01) на 32131.15, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,927 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,927 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9542273144533602, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-05 00:00:00", "current_value": 35827.16, "expected_value": 18683.428202247193, "absolute_deviation": 17143.73179775281, "relative_deviation": 0.9175902629952467, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-05 00:00:00 значение total_sales (35827.16) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.950221048187924, "explanation": {"detector_specific_info": {"date": "2018-08-05 00:00:00", "current_value": 35827.16, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 32131.15428571429, "deviation_in_std": 7.912622647075895, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (35827.16) отклоняется от базовой линии (3696.01) на 32131.15, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,928 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 82846, order_id: a53e05ecd2ed1f46a2b8e1f5828be7c6, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.9481, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,928 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,928 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-01-26 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,929 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-01-26 00:00:00
2025-05-22 02:46:36,931 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
399 2018-01-26          228     34533.35  125.575818             151               228               2018-01-26       31895.5         1.082703           0.722093                           0.948138                       0.496047    2018-01-26
2025-05-22 02:46:36,932 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-01-26 00:00:00", "current_value": 34533.35, "expected_value": 23364.508863636365, "absolute_deviation": 11168.841136363633, "relative_deviation": 0.47802593247514796, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-01-26 00:00:00 значение total_sales (34533.35) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}]
2025-05-22 02:46:36,932 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,932 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9481383115297547, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-01-26 00:00:00", "current_value": 34533.35, "expected_value": 23364.508863636365, "absolute_deviation": 11168.841136363633, "relative_deviation": 0.47802593247514796, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-01-26 00:00:00 значение total_sales (34533.35) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}]
2025-05-22 02:46:36,933 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 82846, order_id: a53e05ecd2ed1f46a2b8e1f5828be7c6, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.4960, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,933 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,933 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-01-26 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,934 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-01-26 00:00:00
2025-05-22 02:46:36,936 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
399 2018-01-26          228     34533.35  125.575818             151               228               2018-01-26       31895.5         1.082703           0.722093                           0.948138                       0.496047    2018-01-26
2025-05-22 02:46:36,937 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-01-26 00:00:00", "current_value": 34533.35, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 30837.344285714284, "deviation_in_std": 7.594008811544785, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (34533.35) отклоняется от базовой линии (3696.01) на 30837.34, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,937 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,937 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9481383115297547, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-01-26 00:00:00", "current_value": 34533.35, "expected_value": 23364.508863636365, "absolute_deviation": 11168.841136363633, "relative_deviation": 0.47802593247514796, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-01-26 00:00:00 значение total_sales (34533.35) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.496047165599019, "explanation": {"detector_specific_info": {"date": "2018-01-26 00:00:00", "current_value": 34533.35, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 30837.344285714284, "deviation_in_std": 7.594008811544785, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (34533.35) отклоняется от базовой линии (3696.01) на 30837.34, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,938 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 84398, order_id: 3ee6513ae7ea23bdfab5b9ab60bffcb5, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.9338, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,938 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,938 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-04-24 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,939 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-04-24 00:00:00
2025-05-22 02:46:36,941 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
487 2018-04-24          271     43844.05  135.740093             190               271               2018-04-24  35267.472857         1.243187           0.821868                           0.933756                       0.709981    2018-04-24
2025-05-22 02:46:36,941 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-04-24 00:00:00", "current_value": 43844.05, "expected_value": 26189.295057471263, "absolute_deviation": 17654.75494252874, "relative_deviation": 0.6741210446400391, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-04-24 00:00:00 значение total_sales (43844.05) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}]
2025-05-22 02:46:36,942 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,942 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9337559343903657, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-04-24 00:00:00", "current_value": 43844.05, "expected_value": 26189.295057471263, "absolute_deviation": 17654.75494252874, "relative_deviation": 0.6741210446400391, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-04-24 00:00:00 значение total_sales (43844.05) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}]
2025-05-22 02:46:36,942 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 84398, order_id: 3ee6513ae7ea23bdfab5b9ab60bffcb5, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.7100, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,943 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,943 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-04-24 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,944 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-04-24 00:00:00
2025-05-22 02:46:36,946 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
487 2018-04-24          271     43844.05  135.740093             190               271               2018-04-24  35267.472857         1.243187           0.821868                           0.933756                       0.709981    2018-04-24
2025-05-22 02:46:36,946 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-04-24 00:00:00", "current_value": 43844.05, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40148.04428571429, "deviation_in_std": 9.886863124372402, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (43844.05) отклоняется от базовой линии (3696.01) на 40148.04, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,947 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,947 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9337559343903657, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-04-24 00:00:00", "current_value": 43844.05, "expected_value": 26189.295057471263, "absolute_deviation": 17654.75494252874, "relative_deviation": 0.6741210446400391, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-04-24 00:00:00 значение total_sales (43844.05) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.7099809280275517, "explanation": {"detector_specific_info": {"date": "2018-04-24 00:00:00", "current_value": 43844.05, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40148.04428571429, "deviation_in_std": 9.886863124372402, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (43844.05) отклоняется от базовой линии (3696.01) на 40148.04, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,948 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 85263, order_id: 33fc608633261bfde6d48fc0a431f14f, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.9816, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,948 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,948 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-01 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,949 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-01 00:00:00
2025-05-22 02:46:36,951 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
525 2018-06-01          184     32683.41  151.312083             140               184               2018-06-01  22878.174286         1.428585           0.892482                           0.981565                       0.803399    2018-06-01
2025-05-22 02:46:36,952 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-01 00:00:00", "current_value": 32683.41, "expected_value": 23364.508863636365, "absolute_deviation": 9318.901136363635, "relative_deviation": 0.3988485780185698, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-01 00:00:00 значение total_sales (32683.41) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}]
2025-05-22 02:46:36,952 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,952 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9815648028904507, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-01 00:00:00", "current_value": 32683.41, "expected_value": 23364.508863636365, "absolute_deviation": 9318.901136363635, "relative_deviation": 0.3988485780185698, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-01 00:00:00 значение total_sales (32683.41) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}]
2025-05-22 02:46:36,952 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 85263, order_id: 33fc608633261bfde6d48fc0a431f14f, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.8034, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,953 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,953 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-01 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,954 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-01 00:00:00
2025-05-22 02:46:36,956 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
525 2018-06-01          184     32683.41  151.312083             140               184               2018-06-01  22878.174286         1.428585           0.892482                           0.981565                       0.803399    2018-06-01
2025-05-22 02:46:36,956 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-06-01 00:00:00", "current_value": 32683.41, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 28987.404285714285, "deviation_in_std": 7.138442322723072, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (32683.41) отклоняется от базовой линии (3696.01) на 28987.40, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,957 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,957 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9815648028904507, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-01 00:00:00", "current_value": 32683.41, "expected_value": 23364.508863636365, "absolute_deviation": 9318.901136363635, "relative_deviation": 0.3988485780185698, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-01 00:00:00 значение total_sales (32683.41) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.8033989187962487, "explanation": {"detector_specific_info": {"date": "2018-06-01 00:00:00", "current_value": 32683.41, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 28987.404285714285, "deviation_in_std": 7.138442322723072, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (32683.41) отклоняется от базовой линии (3696.01) на 28987.40, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,957 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 85498, order_id: 77338308426749365f169773fa614a56, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,958 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,958 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-15 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,959 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-15 00:00:00
2025-05-22 02:46:36,961 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
600 2018-08-15          285      46326.8  141.672171             208               285               2018-08-15  37936.561429         1.221165           0.990972                                1.0                       0.981944    2018-08-15
2025-05-22 02:46:36,961 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-15 00:00:00", "current_value": 46326.8, "expected_value": 25669.474712643678, "absolute_deviation": 20657.325287356325, "relative_deviation": 0.8047428129560211, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-15 00:00:00 значение total_sales (46326.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}]
2025-05-22 02:46:36,962 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,962 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-15 00:00:00", "current_value": 46326.8, "expected_value": 25669.474712643678, "absolute_deviation": 20657.325287356325, "relative_deviation": 0.8047428129560211, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-15 00:00:00 значение total_sales (46326.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}]
2025-05-22 02:46:36,962 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 85498, order_id: 77338308426749365f169773fa614a56, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9819, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,962 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,963 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-15 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,964 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-15 00:00:00
2025-05-22 02:46:36,966 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
600 2018-08-15          285      46326.8  141.672171             208               285               2018-08-15  37936.561429         1.221165           0.990972                                1.0                       0.981944    2018-08-15
2025-05-22 02:46:36,967 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-15 00:00:00", "current_value": 46326.8, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 42630.79428571429, "deviation_in_std": 10.498265494244997, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (46326.80) отклоняется от базовой линии (3696.01) на 42630.79, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,967 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,967 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-15 00:00:00", "current_value": 46326.8, "expected_value": 25669.474712643678, "absolute_deviation": 20657.325287356325, "relative_deviation": 0.8047428129560211, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-15 00:00:00 значение total_sales (46326.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9819435388597458, "explanation": {"detector_specific_info": {"date": "2018-08-15 00:00:00", "current_value": 46326.8, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 42630.79428571429, "deviation_in_std": 10.498265494244997, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (46326.80) отклоняется от базовой линии (3696.01) на 42630.79, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,968 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 85706, order_id: 143d00a4f2dde4e0364ee1821577adb3, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,968 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,968 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-03 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,969 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-03 00:00:00
2025-05-22 02:46:36,971 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
588 2018-08-03          314     45036.63  125.10175             216               314               2018-08-03  39138.992857         1.150684           0.972436                                1.0                       0.944872    2018-08-03
2025-05-22 02:46:36,972 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-03 00:00:00", "current_value": 45036.63, "expected_value": 23364.508863636365, "absolute_deviation": 21672.121136363632, "relative_deviation": 0.9275658762120739, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-03 00:00:00 значение total_sales (45036.63) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}]
2025-05-22 02:46:36,972 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,972 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-03 00:00:00", "current_value": 45036.63, "expected_value": 23364.508863636365, "absolute_deviation": 21672.121136363632, "relative_deviation": 0.9275658762120739, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-03 00:00:00 значение total_sales (45036.63) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}]
2025-05-22 02:46:36,973 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 85706, order_id: 143d00a4f2dde4e0364ee1821577adb3, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9449, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,973 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,973 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-03 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,974 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-03 00:00:00
2025-05-22 02:46:36,977 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
588 2018-08-03          314     45036.63  125.10175             216               314               2018-08-03  39138.992857         1.150684           0.972436                                1.0                       0.944872    2018-08-03
2025-05-22 02:46:36,977 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-03 00:00:00", "current_value": 45036.63, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 41340.624285714286, "deviation_in_std": 10.18054804563417, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (45036.63) отклоняется от базовой линии (3696.01) на 41340.62, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,977 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,978 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-03 00:00:00", "current_value": 45036.63, "expected_value": 23364.508863636365, "absolute_deviation": 21672.121136363632, "relative_deviation": 0.9275658762120739, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-03 00:00:00 значение total_sales (45036.63) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9448723295452219, "explanation": {"detector_specific_info": {"date": "2018-08-03 00:00:00", "current_value": 45036.63, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 41340.624285714286, "deviation_in_std": 10.18054804563417, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (45036.63) отклоняется от базовой линии (3696.01) на 41340.62, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,978 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 86183, order_id: 95a79263ff4f759875074b9c5024edba, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.2171, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:36,978 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 86183, order_id: 95a79263ff4f759875074b9c5024edba, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.7849, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,978 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:36,978 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=7299e27ed73d2ad986de7f7c77d919fa in aggregated_behavior_data_with_scores
2025-05-22 02:46:36,979 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:36,982 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                             seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                                   categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
1412  7299e27ed73d2ad986de7f7c77d919fa   98.885094  148.935573    371       5.99     1500.0     19.280997    10.805647  [consoles_games, brinquedos, bebes, utilidades_domesticas, esporte_lazer, eletroportateis, alimentos, cool_stuff, automotivo, artes, relogios_presentes, moveis_decoracao, cama_mesa_banho]              13          1.506148         250.417362                0.194984                 13             0.03504              0.791985         0.50099                          0.217125                                   0.784855
2025-05-22 02:46:36,983 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}]
2025-05-22 02:46:36,984 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,984 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.7848545894928308, "explanation": {"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}}]
2025-05-22 02:46:36,984 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 86183, order_id: 95a79263ff4f759875074b9c5024edba, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.9542, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,984 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:36,985 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-05 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,985 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-05 00:00:00
2025-05-22 02:46:36,987 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
590 2018-08-05          276     35827.16  113.377089             197               276               2018-08-05      40917.04         0.875605           0.952224                           0.954227                       0.950221    2018-08-05
2025-05-22 02:46:36,987 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-05 00:00:00", "current_value": 35827.16, "expected_value": 18683.428202247193, "absolute_deviation": 17143.73179775281, "relative_deviation": 0.9175902629952467, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-05 00:00:00 значение total_sales (35827.16) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}]
2025-05-22 02:46:36,988 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,988 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9542273144533602, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-05 00:00:00", "current_value": 35827.16, "expected_value": 18683.428202247193, "absolute_deviation": 17143.73179775281, "relative_deviation": 0.9175902629952467, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-05 00:00:00 значение total_sales (35827.16) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}]
2025-05-22 02:46:36,988 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 86183, order_id: 95a79263ff4f759875074b9c5024edba, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9502, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,988 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:36,989 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-05 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:36,991 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-05 00:00:00
2025-05-22 02:46:36,994 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
590 2018-08-05          276     35827.16  113.377089             197               276               2018-08-05      40917.04         0.875605           0.952224                           0.954227                       0.950221    2018-08-05
2025-05-22 02:46:36,994 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-05 00:00:00", "current_value": 35827.16, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 32131.15428571429, "deviation_in_std": 7.912622647075895, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (35827.16) отклоняется от базовой линии (3696.01) на 32131.15, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:36,995 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:36,995 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9542273144533602, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-05 00:00:00", "current_value": 35827.16, "expected_value": 18683.428202247193, "absolute_deviation": 17143.73179775281, "relative_deviation": 0.9175902629952467, "threshold": 2.5, "day_of_week": 6, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-05 00:00:00 значение total_sales (35827.16) в пределах нормальных отклонений от сезонного паттерна (18683.43)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.950221048187924, "explanation": {"detector_specific_info": {"date": "2018-08-05 00:00:00", "current_value": 35827.16, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 32131.15428571429, "deviation_in_std": 7.912622647075895, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (35827.16) отклоняется от базовой линии (3696.01) на 32131.15, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:36,995 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 86500, order_id: 4d5c40dd2064b768317b735200761708, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1769, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:36,996 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 86500, order_id: 4d5c40dd2064b768317b735200761708, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9184, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:36,996 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:36,996 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=36a968b544695394e4e9d7572688598f in aggregated_behavior_data_with_scores
2025-05-22 02:46:36,997 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:36,999 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                        categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
642  36a968b544695394e4e9d7572688598f   56.522384  136.831171    172        3.9     1140.9     13.350814      5.53097  [informatica_acessorios, beleza_saude, telefonia, automotivo, tablets_impressao_imagem, instrumentos_musicais, ferramentas_jardim, cool_stuff, consoles_games, moveis_decoracao]              10          2.420832         292.538462                0.236204                 10             0.05814              0.719612        0.547647                          0.176931                                   0.918363
2025-05-22 02:46:37,000 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}]
2025-05-22 02:46:37,000 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,000 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.918363395536566, "explanation": {"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}}]
2025-05-22 02:46:37,001 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 86500, order_id: 4d5c40dd2064b768317b735200761708, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.8463, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,001 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:37,001 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-08 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,002 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-08 00:00:00
2025-05-22 02:46:37,004 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
501 2018-05-08          327     48373.71  125.973203             216               327               2018-05-08  40997.807143          1.17991           0.797591                           0.846298                       0.748883    2018-05-08
2025-05-22 02:46:37,005 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-08 00:00:00", "current_value": 48373.71, "expected_value": 26189.295057471263, "absolute_deviation": 22184.414942528736, "relative_deviation": 0.8470794992322629, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-08 00:00:00 значение total_sales (48373.71) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}]
2025-05-22 02:46:37,006 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,006 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8462982708976428, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-08 00:00:00", "current_value": 48373.71, "expected_value": 26189.295057471263, "absolute_deviation": 22184.414942528736, "relative_deviation": 0.8470794992322629, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-08 00:00:00 значение total_sales (48373.71) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}]
2025-05-22 02:46:37,006 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 86500, order_id: 4d5c40dd2064b768317b735200761708, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.7489, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,007 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:37,007 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-08 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,008 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-08 00:00:00
2025-05-22 02:46:37,010 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
501 2018-05-08          327     48373.71  125.973203             216               327               2018-05-08  40997.807143          1.17991           0.797591                           0.846298                       0.748883    2018-05-08
2025-05-22 02:46:37,011 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-05-08 00:00:00", "current_value": 48373.71, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 44677.70428571429, "deviation_in_std": 11.002337843420673, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (48373.71) отклоняется от базовой линии (3696.01) на 44677.70, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:37,011 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,012 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8462982708976428, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-08 00:00:00", "current_value": 48373.71, "expected_value": 26189.295057471263, "absolute_deviation": 22184.414942528736, "relative_deviation": 0.8470794992322629, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-08 00:00:00 значение total_sales (48373.71) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.7488834251364803, "explanation": {"detector_specific_info": {"date": "2018-05-08 00:00:00", "current_value": 48373.71, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 44677.70428571429, "deviation_in_std": 11.002337843420673, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (48373.71) отклоняется от базовой линии (3696.01) на 44677.70, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:37,012 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 87247, order_id: 21a2a72aad2ad28f19974dd4455722db, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1769, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:37,012 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 87247, order_id: 21a2a72aad2ad28f19974dd4455722db, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9184, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,012 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:37,012 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=36a968b544695394e4e9d7572688598f in aggregated_behavior_data_with_scores
2025-05-22 02:46:37,013 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:37,016 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                        categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
642  36a968b544695394e4e9d7572688598f   56.522384  136.831171    172        3.9     1140.9     13.350814      5.53097  [informatica_acessorios, beleza_saude, telefonia, automotivo, tablets_impressao_imagem, instrumentos_musicais, ferramentas_jardim, cool_stuff, consoles_games, moveis_decoracao]              10          2.420832         292.538462                0.236204                 10             0.05814              0.719612        0.547647                          0.176931                                   0.918363
2025-05-22 02:46:37,016 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}]
2025-05-22 02:46:37,016 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,017 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.918363395536566, "explanation": {"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}}]
2025-05-22 02:46:37,017 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 87247, order_id: 21a2a72aad2ad28f19974dd4455722db, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,017 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:37,018 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-04-19 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,019 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-04-19 00:00:00
2025-05-22 02:46:37,021 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
482 2018-04-19          292      44893.8  120.682258             191               292               2018-04-19  35601.492857         1.261009           0.849098                                1.0                       0.698197    2018-04-19
2025-05-22 02:46:37,022 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-04-19 00:00:00", "current_value": 44893.8, "expected_value": 24263.594318181815, "absolute_deviation": 20630.205681818188, "relative_deviation": 0.8502534872320643, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-04-19 00:00:00 значение total_sales (44893.80) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}]
2025-05-22 02:46:37,022 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,022 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-04-19 00:00:00", "current_value": 44893.8, "expected_value": 24263.594318181815, "absolute_deviation": 20630.205681818188, "relative_deviation": 0.8502534872320643, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-04-19 00:00:00 значение total_sales (44893.80) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}]
2025-05-22 02:46:37,022 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 87247, order_id: 21a2a72aad2ad28f19974dd4455722db, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.6982, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,023 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:37,023 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-04-19 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,024 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-04-19 00:00:00
2025-05-22 02:46:37,026 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
482 2018-04-19          292      44893.8  120.682258             191               292               2018-04-19  35601.492857         1.261009           0.849098                                1.0                       0.698197    2018-04-19
2025-05-22 02:46:37,027 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-04-19 00:00:00", "current_value": 44893.8, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 41197.79428571429, "deviation_in_std": 10.145374709418723, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (44893.80) отклоняется от базовой линии (3696.01) на 41197.79, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:37,027 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,027 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-04-19 00:00:00", "current_value": 44893.8, "expected_value": 24263.594318181815, "absolute_deviation": 20630.205681818188, "relative_deviation": 0.8502534872320643, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-04-19 00:00:00 значение total_sales (44893.80) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.6981969408630799, "explanation": {"detector_specific_info": {"date": "2018-04-19 00:00:00", "current_value": 44893.8, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 41197.79428571429, "deviation_in_std": 10.145374709418723, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (44893.80) отклоняется от базовой линии (3696.01) на 41197.79, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:37,028 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 87594, order_id: 9de73f3e6157169ad6c32b9f313c7dcb, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.8164, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,028 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:37,028 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-05 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,029 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-05 00:00:00
2025-05-22 02:46:37,032 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
529 2018-06-05          197     34830.15  141.585976             150               197               2018-06-05       28474.0         1.223226           0.814356                           0.816442                       0.812269    2018-06-05
2025-05-22 02:46:37,032 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-05 00:00:00", "current_value": 34830.15, "expected_value": 26189.295057471263, "absolute_deviation": 8640.854942528738, "relative_deviation": 0.3299384318503709, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-05 00:00:00 значение total_sales (34830.15) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}]
2025-05-22 02:46:37,033 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,033 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.816442063316561, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-05 00:00:00", "current_value": 34830.15, "expected_value": 26189.295057471263, "absolute_deviation": 8640.854942528738, "relative_deviation": 0.3299384318503709, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-05 00:00:00 значение total_sales (34830.15) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}]
2025-05-22 02:46:37,033 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 87594, order_id: 9de73f3e6157169ad6c32b9f313c7dcb, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.8123, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,033 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:37,034 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-05 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,034 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-05 00:00:00
2025-05-22 02:46:37,036 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
529 2018-06-05          197     34830.15  141.585976             150               197               2018-06-05       28474.0         1.223226           0.814356                           0.816442                       0.812269    2018-06-05
2025-05-22 02:46:37,037 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-06-05 00:00:00", "current_value": 34830.15, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 31134.144285714287, "deviation_in_std": 7.667098821967979, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (34830.15) отклоняется от базовой линии (3696.01) на 31134.14, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:37,037 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,037 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.816442063316561, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-05 00:00:00", "current_value": 34830.15, "expected_value": 26189.295057471263, "absolute_deviation": 8640.854942528738, "relative_deviation": 0.3299384318503709, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-05 00:00:00 значение total_sales (34830.15) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.8122690239748033, "explanation": {"detector_specific_info": {"date": "2018-06-05 00:00:00", "current_value": 34830.15, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 31134.144285714287, "deviation_in_std": 7.667098821967979, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (34830.15) отклоняется от базовой линии (3696.01) на 31134.14, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:37,038 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 87595, order_id: 9de73f3e6157169ad6c32b9f313c7dcb, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.8164, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,038 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:37,038 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-05 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,040 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-05 00:00:00
2025-05-22 02:46:37,042 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
529 2018-06-05          197     34830.15  141.585976             150               197               2018-06-05       28474.0         1.223226           0.814356                           0.816442                       0.812269    2018-06-05
2025-05-22 02:46:37,043 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-05 00:00:00", "current_value": 34830.15, "expected_value": 26189.295057471263, "absolute_deviation": 8640.854942528738, "relative_deviation": 0.3299384318503709, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-05 00:00:00 значение total_sales (34830.15) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}]
2025-05-22 02:46:37,043 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,043 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.816442063316561, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-05 00:00:00", "current_value": 34830.15, "expected_value": 26189.295057471263, "absolute_deviation": 8640.854942528738, "relative_deviation": 0.3299384318503709, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-05 00:00:00 значение total_sales (34830.15) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}]
2025-05-22 02:46:37,044 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 87595, order_id: 9de73f3e6157169ad6c32b9f313c7dcb, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.8123, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,044 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:37,044 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-05 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,045 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-05 00:00:00
2025-05-22 02:46:37,047 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
529 2018-06-05          197     34830.15  141.585976             150               197               2018-06-05       28474.0         1.223226           0.814356                           0.816442                       0.812269    2018-06-05
2025-05-22 02:46:37,048 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-06-05 00:00:00", "current_value": 34830.15, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 31134.144285714287, "deviation_in_std": 7.667098821967979, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (34830.15) отклоняется от базовой линии (3696.01) на 31134.14, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:37,048 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,048 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.816442063316561, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-05 00:00:00", "current_value": 34830.15, "expected_value": 26189.295057471263, "absolute_deviation": 8640.854942528738, "relative_deviation": 0.3299384318503709, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-05 00:00:00 значение total_sales (34830.15) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.8122690239748033, "explanation": {"detector_specific_info": {"date": "2018-06-05 00:00:00", "current_value": 34830.15, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 31134.144285714287, "deviation_in_std": 7.667098821967979, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (34830.15) отклоняется от базовой линии (3696.01) на 31134.14, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:37,048 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 89052, order_id: 19ba784efbf17691a04ac155893e93b8, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.2171, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:37,049 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 89052, order_id: 19ba784efbf17691a04ac155893e93b8, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.7849, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,049 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:37,049 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=7299e27ed73d2ad986de7f7c77d919fa in aggregated_behavior_data_with_scores
2025-05-22 02:46:37,050 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:37,054 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                             seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                                   categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
1412  7299e27ed73d2ad986de7f7c77d919fa   98.885094  148.935573    371       5.99     1500.0     19.280997    10.805647  [consoles_games, brinquedos, bebes, utilidades_domesticas, esporte_lazer, eletroportateis, alimentos, cool_stuff, automotivo, artes, relogios_presentes, moveis_decoracao, cama_mesa_banho]              13          1.506148         250.417362                0.194984                 13             0.03504              0.791985         0.50099                          0.217125                                   0.784855
2025-05-22 02:46:37,054 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}]
2025-05-22 02:46:37,055 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,055 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.7848545894928308, "explanation": {"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}}]
2025-05-22 02:46:37,055 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 89052, order_id: 19ba784efbf17691a04ac155893e93b8, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,055 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:37,056 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-07 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,056 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-07 00:00:00
2025-05-22 02:46:37,059 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
592 2018-08-07          366      50588.5  114.973864             252               366               2018-08-07  44125.211429         1.146476           0.979335                                1.0                        0.95867    2018-08-07
2025-05-22 02:46:37,060 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-07 00:00:00", "current_value": 50588.5, "expected_value": 26189.295057471263, "absolute_deviation": 24399.204942528737, "relative_deviation": 0.9316480221779834, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-07 00:00:00 значение total_sales (50588.50) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}]
2025-05-22 02:46:37,060 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,060 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-07 00:00:00", "current_value": 50588.5, "expected_value": 26189.295057471263, "absolute_deviation": 24399.204942528737, "relative_deviation": 0.9316480221779834, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-07 00:00:00 значение total_sales (50588.50) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}]
2025-05-22 02:46:37,061 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 89052, order_id: 19ba784efbf17691a04ac155893e93b8, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9587, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,061 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:37,061 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-07 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,062 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-07 00:00:00
2025-05-22 02:46:37,064 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
592 2018-08-07          366      50588.5  114.973864             252               366               2018-08-07  44125.211429         1.146476           0.979335                                1.0                        0.95867    2018-08-07
2025-05-22 02:46:37,064 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-07 00:00:00", "current_value": 50588.5, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 46892.49428571429, "deviation_in_std": 11.547752345392325, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (50588.50) отклоняется от базовой линии (3696.01) на 46892.49, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:37,064 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,064 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-07 00:00:00", "current_value": 50588.5, "expected_value": 26189.295057471263, "absolute_deviation": 24399.204942528737, "relative_deviation": 0.9316480221779834, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-07 00:00:00 значение total_sales (50588.50) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.95867015383243, "explanation": {"detector_specific_info": {"date": "2018-08-07 00:00:00", "current_value": 50588.5, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 46892.49428571429, "deviation_in_std": 11.547752345392325, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (50588.50) отклоняется от базовой линии (3696.01) на 46892.49, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:37,065 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 89117, order_id: 076d1555fb53a89b0ef4d529e527a0f6, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.8843, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,065 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:37,065 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-30 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,066 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-30 00:00:00
2025-05-22 02:46:37,069 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
584 2018-07-30          284     40179.22  123.249141             214               284               2018-07-30  35694.362857         1.125646           0.907915                           0.884254                       0.931577    2018-07-30
2025-05-22 02:46:37,070 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-30 00:00:00", "current_value": 40179.22, "expected_value": 25862.10588888889, "absolute_deviation": 14317.11411111111, "relative_deviation": 0.5535942885943467, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-30 00:00:00 значение total_sales (40179.22) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}]
2025-05-22 02:46:37,070 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,070 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8842535725733309, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-30 00:00:00", "current_value": 40179.22, "expected_value": 25862.10588888889, "absolute_deviation": 14317.11411111111, "relative_deviation": 0.5535942885943467, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-30 00:00:00 значение total_sales (40179.22) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}]
2025-05-22 02:46:37,070 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 89117, order_id: 076d1555fb53a89b0ef4d529e527a0f6, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9316, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,071 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:37,071 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-30 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,072 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-30 00:00:00
2025-05-22 02:46:37,074 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
584 2018-07-30          284     40179.22  123.249141             214               284               2018-07-30  35694.362857         1.125646           0.907915                           0.884254                       0.931577    2018-07-30
2025-05-22 02:46:37,074 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-07-30 00:00:00", "current_value": 40179.22, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 36483.21428571429, "deviation_in_std": 8.984361564738858, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (40179.22) отклоняется от базовой линии (3696.01) на 36483.21, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:37,075 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,075 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8842535725733309, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-30 00:00:00", "current_value": 40179.22, "expected_value": 25862.10588888889, "absolute_deviation": 14317.11411111111, "relative_deviation": 0.5535942885943467, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-30 00:00:00 значение total_sales (40179.22) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9315766663428331, "explanation": {"detector_specific_info": {"date": "2018-07-30 00:00:00", "current_value": 40179.22, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 36483.21428571429, "deviation_in_std": 8.984361564738858, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (40179.22) отклоняется от базовой линии (3696.01) на 36483.21, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:37,075 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 89332, order_id: b8d8e7c7fe850dd45f9e3762c8b4b940, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1697, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:37,075 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 89332, order_id: b8d8e7c7fe850dd45f9e3762c8b4b940, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9836, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,075 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:37,076 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=4a3ccda38b2129705f3fb522db62ca31 in aggregated_behavior_data_with_scores
2025-05-22 02:46:37,077 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:37,079 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                               categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
882  4a3ccda38b2129705f3fb522db62ca31  233.158916  370.889347     83        9.9     3099.9     18.396747     9.418922  [construcao_ferramentas_seguranca, casa_construcao, ferramentas_jardim, construcao_ferramentas_construcao, eletronicos]               5          1.590715         313.121212                0.078902                  5            0.060241               0.53771        0.576635                          0.169668                                   0.983603
2025-05-22 02:46:37,080 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}]
2025-05-22 02:46:37,080 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,080 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.9836033466098753, "explanation": {"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}}]
2025-05-22 02:46:37,080 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 89332, order_id: b8d8e7c7fe850dd45f9e3762c8b4b940, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.6946, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,081 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:37,081 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-26 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,082 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-26 00:00:00
2025-05-22 02:46:37,085 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
550 2018-06-26          242     38077.63  119.740975             172               242               2018-06-26  29233.182857         1.302548           0.777536                           0.694557                       0.860514    2018-06-26
2025-05-22 02:46:37,085 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-26 00:00:00", "current_value": 38077.63, "expected_value": 26189.295057471263, "absolute_deviation": 11888.334942528734, "relative_deviation": 0.45393871490012627, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-26 00:00:00 значение total_sales (38077.63) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}]
2025-05-22 02:46:37,085 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,086 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.6945570987029159, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-26 00:00:00", "current_value": 38077.63, "expected_value": 26189.295057471263, "absolute_deviation": 11888.334942528734, "relative_deviation": 0.45393871490012627, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-26 00:00:00 значение total_sales (38077.63) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}]
2025-05-22 02:46:37,086 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 89332, order_id: b8d8e7c7fe850dd45f9e3762c8b4b940, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.8605, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,086 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:37,087 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-26 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,088 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-26 00:00:00
2025-05-22 02:46:37,090 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
550 2018-06-26          242     38077.63  119.740975             172               242               2018-06-26  29233.182857         1.302548           0.777536                           0.694557                       0.860514    2018-06-26
2025-05-22 02:46:37,090 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-06-26 00:00:00", "current_value": 38077.63, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 34381.624285714286, "deviation_in_std": 8.466823710947478, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (38077.63) отклоняется от базовой линии (3696.01) на 34381.62, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:37,090 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,091 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.6945570987029159, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-26 00:00:00", "current_value": 38077.63, "expected_value": 26189.295057471263, "absolute_deviation": 11888.334942528734, "relative_deviation": 0.45393871490012627, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-26 00:00:00 значение total_sales (38077.63) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.8605144868251302, "explanation": {"detector_specific_info": {"date": "2018-06-26 00:00:00", "current_value": 38077.63, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 34381.624285714286, "deviation_in_std": 8.466823710947478, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (38077.63) отклоняется от базовой линии (3696.01) на 34381.62, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:37,091 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 89558, order_id: 38285c101a3b9fd08110335d8405a232, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1769, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:37,091 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 89558, order_id: 38285c101a3b9fd08110335d8405a232, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9184, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,091 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:37,091 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=36a968b544695394e4e9d7572688598f in aggregated_behavior_data_with_scores
2025-05-22 02:46:37,092 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:37,097 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                        categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
642  36a968b544695394e4e9d7572688598f   56.522384  136.831171    172        3.9     1140.9     13.350814      5.53097  [informatica_acessorios, beleza_saude, telefonia, automotivo, tablets_impressao_imagem, instrumentos_musicais, ferramentas_jardim, cool_stuff, consoles_games, moveis_decoracao]              10          2.420832         292.538462                0.236204                 10             0.05814              0.719612        0.547647                          0.176931                                   0.918363
2025-05-22 02:46:37,097 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}]
2025-05-22 02:46:37,098 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,098 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.918363395536566, "explanation": {"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}}]
2025-05-22 02:46:37,099 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 89558, order_id: 38285c101a3b9fd08110335d8405a232, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,099 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:37,099 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-15 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,101 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-15 00:00:00
2025-05-22 02:46:37,103 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
600 2018-08-15          285      46326.8  141.672171             208               285               2018-08-15  37936.561429         1.221165           0.990972                                1.0                       0.981944    2018-08-15
2025-05-22 02:46:37,104 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-15 00:00:00", "current_value": 46326.8, "expected_value": 25669.474712643678, "absolute_deviation": 20657.325287356325, "relative_deviation": 0.8047428129560211, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-15 00:00:00 значение total_sales (46326.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}]
2025-05-22 02:46:37,104 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,104 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-15 00:00:00", "current_value": 46326.8, "expected_value": 25669.474712643678, "absolute_deviation": 20657.325287356325, "relative_deviation": 0.8047428129560211, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-15 00:00:00 значение total_sales (46326.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}]
2025-05-22 02:46:37,104 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 89558, order_id: 38285c101a3b9fd08110335d8405a232, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9819, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,105 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:37,105 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-15 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,106 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-15 00:00:00
2025-05-22 02:46:37,108 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
600 2018-08-15          285      46326.8  141.672171             208               285               2018-08-15  37936.561429         1.221165           0.990972                                1.0                       0.981944    2018-08-15
2025-05-22 02:46:37,108 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-15 00:00:00", "current_value": 46326.8, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 42630.79428571429, "deviation_in_std": 10.498265494244997, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (46326.80) отклоняется от базовой линии (3696.01) на 42630.79, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:37,109 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,109 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-15 00:00:00", "current_value": 46326.8, "expected_value": 25669.474712643678, "absolute_deviation": 20657.325287356325, "relative_deviation": 0.8047428129560211, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-15 00:00:00 значение total_sales (46326.80) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9819435388597458, "explanation": {"detector_specific_info": {"date": "2018-08-15 00:00:00", "current_value": 46326.8, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 42630.79428571429, "deviation_in_std": 10.498265494244997, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (46326.80) отклоняется от базовой линии (3696.01) на 42630.79, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:37,109 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 91260, order_id: 0606be58306f48924f5b44a39cfab9ec, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,110 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:37,110 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-07 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,111 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-07 00:00:00
2025-05-22 02:46:37,115 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
531 2018-06-07          223     39149.92  143.933529             161               223               2018-06-07  31433.825714         1.245471           0.908572                                1.0                       0.817143    2018-06-07
2025-05-22 02:46:37,116 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-07 00:00:00", "current_value": 39149.92, "expected_value": 24263.594318181815, "absolute_deviation": 14886.325681818184, "relative_deviation": 0.6135251639392595, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-07 00:00:00 значение total_sales (39149.92) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}]
2025-05-22 02:46:37,117 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,117 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-07 00:00:00", "current_value": 39149.92, "expected_value": 24263.594318181815, "absolute_deviation": 14886.325681818184, "relative_deviation": 0.6135251639392595, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-07 00:00:00 значение total_sales (39149.92) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}]
2025-05-22 02:46:37,118 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 91260, order_id: 0606be58306f48924f5b44a39cfab9ec, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.8171, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,118 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:37,118 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-07 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,119 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-07 00:00:00
2025-05-22 02:46:37,122 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
531 2018-06-07          223     39149.92  143.933529             161               223               2018-06-07  31433.825714         1.245471           0.908572                                1.0                       0.817143    2018-06-07
2025-05-22 02:46:37,123 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-06-07 00:00:00", "current_value": 39149.92, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 35453.91428571429, "deviation_in_std": 8.730885999615563, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (39149.92) отклоняется от базовой линии (3696.01) на 35453.91, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:37,123 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,124 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-07 00:00:00", "current_value": 39149.92, "expected_value": 24263.594318181815, "absolute_deviation": 14886.325681818184, "relative_deviation": 0.6135251639392595, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-07 00:00:00 значение total_sales (39149.92) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.8171433354173214, "explanation": {"detector_specific_info": {"date": "2018-06-07 00:00:00", "current_value": 39149.92, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 35453.91428571429, "deviation_in_std": 8.730885999615563, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (39149.92) отклоняется от базовой линии (3696.01) на 35453.91, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:37,124 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 91607, order_id: 2096a9ff3dcd9dc1e2e90ea7296730a0, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.7297, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,124 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:37,125 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-17 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,126 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-17 00:00:00
2025-05-22 02:46:37,129 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
602 2018-08-17          255     36361.57  120.802558             203               255               2018-08-17  37849.641429         0.960685           0.858666                           0.729695                       0.987637    2018-08-17
2025-05-22 02:46:37,130 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-17 00:00:00", "current_value": 36361.57, "expected_value": 23364.508863636365, "absolute_deviation": 12997.061136363634, "relative_deviation": 0.5562736718421575, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-17 00:00:00 значение total_sales (36361.57) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}]
2025-05-22 02:46:37,130 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,131 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7296946227452271, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-17 00:00:00", "current_value": 36361.57, "expected_value": 23364.508863636365, "absolute_deviation": 12997.061136363634, "relative_deviation": 0.5562736718421575, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-17 00:00:00 значение total_sales (36361.57) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}]
2025-05-22 02:46:37,131 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 91607, order_id: 2096a9ff3dcd9dc1e2e90ea7296730a0, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9876, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,131 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:37,131 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-17 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,132 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-17 00:00:00
2025-05-22 02:46:37,134 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
602 2018-08-17          255     36361.57  120.802558             203               255               2018-08-17  37849.641429         0.960685           0.858666                           0.729695                       0.987637    2018-08-17
2025-05-22 02:46:37,134 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-17 00:00:00", "current_value": 36361.57, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 32665.564285714285, "deviation_in_std": 8.044226530061943, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (36361.57) отклоняется от базовой линии (3696.01) на 32665.56, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:37,134 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,135 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7296946227452271, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-17 00:00:00", "current_value": 36361.57, "expected_value": 23364.508863636365, "absolute_deviation": 12997.061136363634, "relative_deviation": 0.5562736718421575, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-17 00:00:00 значение total_sales (36361.57) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9876365632717872, "explanation": {"detector_specific_info": {"date": "2018-08-17 00:00:00", "current_value": 36361.57, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 32665.564285714285, "deviation_in_std": 8.044226530061943, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (36361.57) отклоняется от базовой линии (3696.01) на 32665.56, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:37,135 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 92439, order_id: 9bcd315f2d8687500366d9b2fb0e8add, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.2171, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:37,135 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 92439, order_id: 9bcd315f2d8687500366d9b2fb0e8add, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.7849, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,136 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:37,136 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=7299e27ed73d2ad986de7f7c77d919fa in aggregated_behavior_data_with_scores
2025-05-22 02:46:37,137 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:37,139 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                             seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                                   categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
1412  7299e27ed73d2ad986de7f7c77d919fa   98.885094  148.935573    371       5.99     1500.0     19.280997    10.805647  [consoles_games, brinquedos, bebes, utilidades_domesticas, esporte_lazer, eletroportateis, alimentos, cool_stuff, automotivo, artes, relogios_presentes, moveis_decoracao, cama_mesa_banho]              13          1.506148         250.417362                0.194984                 13             0.03504              0.791985         0.50099                          0.217125                                   0.784855
2025-05-22 02:46:37,140 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}]
2025-05-22 02:46:37,140 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,140 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.7848545894928308, "explanation": {"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}}]
2025-05-22 02:46:37,140 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 92439, order_id: 9bcd315f2d8687500366d9b2fb0e8add, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.7472, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,141 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:37,141 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-09 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,142 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-09 00:00:00
2025-05-22 02:46:37,145 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
594 2018-08-09          283     42138.17  125.785582             204               283               2018-08-09  44497.781429         0.946972           0.856223                           0.747247                       0.965198    2018-08-09
2025-05-22 02:46:37,146 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-09 00:00:00", "current_value": 42138.17, "expected_value": 24263.594318181815, "absolute_deviation": 17874.575681818184, "relative_deviation": 0.7366829269983282, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-09 00:00:00 значение total_sales (42138.17) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}]
2025-05-22 02:46:37,146 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,146 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7472473831010398, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-09 00:00:00", "current_value": 42138.17, "expected_value": 24263.594318181815, "absolute_deviation": 17874.575681818184, "relative_deviation": 0.7366829269983282, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-09 00:00:00 значение total_sales (42138.17) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}]
2025-05-22 02:46:37,146 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 92439, order_id: 9bcd315f2d8687500366d9b2fb0e8add, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9652, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,146 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:37,147 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-09 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,147 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-09 00:00:00
2025-05-22 02:46:37,149 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
594 2018-08-09          283     42138.17  125.785582             204               283               2018-08-09  44497.781429         0.946972           0.856223                           0.747247                       0.965198    2018-08-09
2025-05-22 02:46:37,150 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-09 00:00:00", "current_value": 42138.17, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 38442.16428571429, "deviation_in_std": 9.466772871741947, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (42138.17) отклоняется от базовой линии (3696.01) на 38442.16, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:37,150 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,151 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7472473831010398, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-09 00:00:00", "current_value": 42138.17, "expected_value": 24263.594318181815, "absolute_deviation": 17874.575681818184, "relative_deviation": 0.7366829269983282, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-09 00:00:00 значение total_sales (42138.17) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9651982020506744, "explanation": {"detector_specific_info": {"date": "2018-08-09 00:00:00", "current_value": 42138.17, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 38442.16428571429, "deviation_in_std": 9.466772871741947, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (42138.17) отклоняется от базовой линии (3696.01) на 38442.16, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:37,151 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 96771, order_id: c87cf593c8c9e0e59f1039a2bb8e5d44, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,151 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:37,152 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-07 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,152 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-07 00:00:00
2025-05-22 02:46:37,154 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
592 2018-08-07          366      50588.5  114.973864             252               366               2018-08-07  44125.211429         1.146476           0.979335                                1.0                        0.95867    2018-08-07
2025-05-22 02:46:37,155 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-07 00:00:00", "current_value": 50588.5, "expected_value": 26189.295057471263, "absolute_deviation": 24399.204942528737, "relative_deviation": 0.9316480221779834, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-07 00:00:00 значение total_sales (50588.50) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}]
2025-05-22 02:46:37,155 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,155 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-07 00:00:00", "current_value": 50588.5, "expected_value": 26189.295057471263, "absolute_deviation": 24399.204942528737, "relative_deviation": 0.9316480221779834, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-07 00:00:00 значение total_sales (50588.50) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}]
2025-05-22 02:46:37,156 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 96771, order_id: c87cf593c8c9e0e59f1039a2bb8e5d44, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9587, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,156 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:37,156 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-07 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,158 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-07 00:00:00
2025-05-22 02:46:37,160 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
592 2018-08-07          366      50588.5  114.973864             252               366               2018-08-07  44125.211429         1.146476           0.979335                                1.0                        0.95867    2018-08-07
2025-05-22 02:46:37,160 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-07 00:00:00", "current_value": 50588.5, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 46892.49428571429, "deviation_in_std": 11.547752345392325, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (50588.50) отклоняется от базовой линии (3696.01) на 46892.49, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:37,160 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,161 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-07 00:00:00", "current_value": 50588.5, "expected_value": 26189.295057471263, "absolute_deviation": 24399.204942528737, "relative_deviation": 0.9316480221779834, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-07 00:00:00 значение total_sales (50588.50) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.95867015383243, "explanation": {"detector_specific_info": {"date": "2018-08-07 00:00:00", "current_value": 50588.5, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 46892.49428571429, "deviation_in_std": 11.547752345392325, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (50588.50) отклоняется от базовой линии (3696.01) на 46892.49, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:37,161 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 97933, order_id: fbf3da6fe82010412982890b0c57e532, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.2171, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:37,161 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 97933, order_id: fbf3da6fe82010412982890b0c57e532, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.7849, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,161 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:37,161 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=7299e27ed73d2ad986de7f7c77d919fa in aggregated_behavior_data_with_scores
2025-05-22 02:46:37,162 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:37,165 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                             seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                                   categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
1412  7299e27ed73d2ad986de7f7c77d919fa   98.885094  148.935573    371       5.99     1500.0     19.280997    10.805647  [consoles_games, brinquedos, bebes, utilidades_domesticas, esporte_lazer, eletroportateis, alimentos, cool_stuff, automotivo, artes, relogios_presentes, moveis_decoracao, cama_mesa_banho]              13          1.506148         250.417362                0.194984                 13             0.03504              0.791985         0.50099                          0.217125                                   0.784855
2025-05-22 02:46:37,166 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}]
2025-05-22 02:46:37,166 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,166 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.7848545894928308, "explanation": {"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}}]
2025-05-22 02:46:37,166 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 97933, order_id: fbf3da6fe82010412982890b0c57e532, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,166 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:37,167 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-16 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,167 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-16 00:00:00
2025-05-22 02:46:37,170 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
509 2018-05-16          357     57748.21  137.495738             236               357               2018-05-16  45499.475714         1.269206           0.888337                                1.0                       0.776673    2018-05-16
2025-05-22 02:46:37,170 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-16 00:00:00", "current_value": 57748.21, "expected_value": 25669.474712643678, "absolute_deviation": 32078.73528735632, "relative_deviation": 1.249684134422732, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-16 00:00:00 значение total_sales (57748.21) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}]
2025-05-22 02:46:37,171 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,171 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-16 00:00:00", "current_value": 57748.21, "expected_value": 25669.474712643678, "absolute_deviation": 32078.73528735632, "relative_deviation": 1.249684134422732, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-16 00:00:00 значение total_sales (57748.21) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}]
2025-05-22 02:46:37,171 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 97933, order_id: fbf3da6fe82010412982890b0c57e532, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.7767, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,171 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:37,172 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-05-16 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,173 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-05-16 00:00:00
2025-05-22 02:46:37,174 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
509 2018-05-16          357     57748.21  137.495738             236               357               2018-05-16  45499.475714         1.269206           0.888337                                1.0                       0.776673    2018-05-16
2025-05-22 02:46:37,175 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-05-16 00:00:00", "current_value": 57748.21, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 54052.20428571429, "deviation_in_std": 13.31090355336756, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (57748.21) отклоняется от базовой линии (3696.01) на 54052.20, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:37,175 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,175 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-05-16 00:00:00", "current_value": 57748.21, "expected_value": 25669.474712643678, "absolute_deviation": 32078.73528735632, "relative_deviation": 1.249684134422732, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-05-16 00:00:00 значение total_sales (57748.21) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.7766733026415072, "explanation": {"detector_specific_info": {"date": "2018-05-16 00:00:00", "current_value": 57748.21, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 54052.20428571429, "deviation_in_std": 13.31090355336756, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (57748.21) отклоняется от базовой линии (3696.01) на 54052.20, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:37,176 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 98929, order_id: 6e864b3f0ec71031117ad4cf46b7f2a1, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.9338, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,176 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:37,176 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-04-24 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,177 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-04-24 00:00:00
2025-05-22 02:46:37,180 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
487 2018-04-24          271     43844.05  135.740093             190               271               2018-04-24  35267.472857         1.243187           0.821868                           0.933756                       0.709981    2018-04-24
2025-05-22 02:46:37,181 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-04-24 00:00:00", "current_value": 43844.05, "expected_value": 26189.295057471263, "absolute_deviation": 17654.75494252874, "relative_deviation": 0.6741210446400391, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-04-24 00:00:00 значение total_sales (43844.05) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}]
2025-05-22 02:46:37,181 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,181 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9337559343903657, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-04-24 00:00:00", "current_value": 43844.05, "expected_value": 26189.295057471263, "absolute_deviation": 17654.75494252874, "relative_deviation": 0.6741210446400391, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-04-24 00:00:00 значение total_sales (43844.05) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}]
2025-05-22 02:46:37,182 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 98929, order_id: 6e864b3f0ec71031117ad4cf46b7f2a1, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.7100, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,182 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:37,182 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-04-24 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,183 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-04-24 00:00:00
2025-05-22 02:46:37,185 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
487 2018-04-24          271     43844.05  135.740093             190               271               2018-04-24  35267.472857         1.243187           0.821868                           0.933756                       0.709981    2018-04-24
2025-05-22 02:46:37,186 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-04-24 00:00:00", "current_value": 43844.05, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40148.04428571429, "deviation_in_std": 9.886863124372402, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (43844.05) отклоняется от базовой линии (3696.01) на 40148.04, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:37,186 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,186 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9337559343903657, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-04-24 00:00:00", "current_value": 43844.05, "expected_value": 26189.295057471263, "absolute_deviation": 17654.75494252874, "relative_deviation": 0.6741210446400391, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-04-24 00:00:00 значение total_sales (43844.05) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.7099809280275517, "explanation": {"detector_specific_info": {"date": "2018-04-24 00:00:00", "current_value": 43844.05, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40148.04428571429, "deviation_in_std": 9.886863124372402, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (43844.05) отклоняется от базовой линии (3696.01) на 40148.04, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:37,187 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 99156, order_id: 2b7c67fca0696d8eae5f3deb33637a2f, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1769, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:37,187 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 99156, order_id: 2b7c67fca0696d8eae5f3deb33637a2f, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9184, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,187 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:37,187 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=36a968b544695394e4e9d7572688598f in aggregated_behavior_data_with_scores
2025-05-22 02:46:37,188 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:37,191 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                        categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
642  36a968b544695394e4e9d7572688598f   56.522384  136.831171    172        3.9     1140.9     13.350814      5.53097  [informatica_acessorios, beleza_saude, telefonia, automotivo, tablets_impressao_imagem, instrumentos_musicais, ferramentas_jardim, cool_stuff, consoles_games, moveis_decoracao]              10          2.420832         292.538462                0.236204                 10             0.05814              0.719612        0.547647                          0.176931                                   0.918363
2025-05-22 02:46:37,192 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}]
2025-05-22 02:46:37,192 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,192 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.918363395536566, "explanation": {"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}}]
2025-05-22 02:46:37,193 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 99156, order_id: 2b7c67fca0696d8eae5f3deb33637a2f, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,193 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:37,193 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-11 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,194 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-11 00:00:00
2025-05-22 02:46:37,195 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
535 2018-06-11          294      50947.4  145.981089             194               294               2018-06-11  33767.525714         1.508769           0.913597                                1.0                       0.827194    2018-06-11
2025-05-22 02:46:37,196 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-11 00:00:00", "current_value": 50947.4, "expected_value": 25862.10588888889, "absolute_deviation": 25085.29411111111, "relative_deviation": 0.969963320809404, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-11 00:00:00 значение total_sales (50947.40) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}]
2025-05-22 02:46:37,196 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,196 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-11 00:00:00", "current_value": 50947.4, "expected_value": 25862.10588888889, "absolute_deviation": 25085.29411111111, "relative_deviation": 0.969963320809404, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-11 00:00:00 значение total_sales (50947.40) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}]
2025-05-22 02:46:37,197 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 99156, order_id: 2b7c67fca0696d8eae5f3deb33637a2f, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.8272, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,197 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:37,197 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-11 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,198 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-11 00:00:00
2025-05-22 02:46:37,200 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
535 2018-06-11          294      50947.4  145.981089             194               294               2018-06-11  33767.525714         1.508769           0.913597                                1.0                       0.827194    2018-06-11
2025-05-22 02:46:37,201 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-06-11 00:00:00", "current_value": 50947.4, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 47251.39428571429, "deviation_in_std": 11.636135110691802, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (50947.40) отклоняется от базовой линии (3696.01) на 47251.39, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:37,201 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,201 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-11 00:00:00", "current_value": 50947.4, "expected_value": 25862.10588888889, "absolute_deviation": 25085.29411111111, "relative_deviation": 0.969963320809404, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-11 00:00:00 значение total_sales (50947.40) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.8271941215028522, "explanation": {"detector_specific_info": {"date": "2018-06-11 00:00:00", "current_value": 50947.4, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 47251.39428571429, "deviation_in_std": 11.636135110691802, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (50947.40) отклоняется от базовой линии (3696.01) на 47251.39, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:37,202 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 100743, order_id: ea153a1ffcb167446901237714816a03, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1769, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:37,202 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 100743, order_id: ea153a1ffcb167446901237714816a03, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9184, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,202 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:37,202 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=36a968b544695394e4e9d7572688598f in aggregated_behavior_data_with_scores
2025-05-22 02:46:37,203 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:37,206 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                        categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
642  36a968b544695394e4e9d7572688598f   56.522384  136.831171    172        3.9     1140.9     13.350814      5.53097  [informatica_acessorios, beleza_saude, telefonia, automotivo, tablets_impressao_imagem, instrumentos_musicais, ferramentas_jardim, cool_stuff, consoles_games, moveis_decoracao]              10          2.420832         292.538462                0.236204                 10             0.05814              0.719612        0.547647                          0.176931                                   0.918363
2025-05-22 02:46:37,206 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}]
2025-05-22 02:46:37,206 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,207 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.918363395536566, "explanation": {"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}}]
2025-05-22 02:46:37,207 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 100743, order_id: ea153a1ffcb167446901237714816a03, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.9268, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,207 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:37,208 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-23 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,208 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-23 00:00:00
2025-05-22 02:46:37,210 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
577 2018-07-23          305     40827.91  115.659802             227               305               2018-07-23  34498.897143         1.183456           0.919871                           0.926804                       0.912939    2018-07-23
2025-05-22 02:46:37,211 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-23 00:00:00", "current_value": 40827.909999999996, "expected_value": 25862.10588888889, "absolute_deviation": 14965.804111111105, "relative_deviation": 0.5786769327837625, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-23 00:00:00 значение total_sales (40827.91) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}]
2025-05-22 02:46:37,211 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,212 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.926804266551497, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-23 00:00:00", "current_value": 40827.909999999996, "expected_value": 25862.10588888889, "absolute_deviation": 14965.804111111105, "relative_deviation": 0.5786769327837625, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-23 00:00:00 значение total_sales (40827.91) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}]
2025-05-22 02:46:37,212 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 100743, order_id: ea153a1ffcb167446901237714816a03, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9129, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,213 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:37,213 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-23 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,214 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-23 00:00:00
2025-05-22 02:46:37,216 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
577 2018-07-23          305     40827.91  115.659802             227               305               2018-07-23  34498.897143         1.183456           0.919871                           0.926804                       0.912939    2018-07-23
2025-05-22 02:46:37,216 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-07-23 00:00:00", "current_value": 40827.909999999996, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 37131.904285714285, "deviation_in_std": 9.144108056859551, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (40827.91) отклоняется от базовой линии (3696.01) на 37131.90, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:37,217 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,217 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.926804266551497, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-23 00:00:00", "current_value": 40827.909999999996, "expected_value": 25862.10588888889, "absolute_deviation": 14965.804111111105, "relative_deviation": 0.5786769327837625, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-23 00:00:00 значение total_sales (40827.91) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9129385689972365, "explanation": {"detector_specific_info": {"date": "2018-07-23 00:00:00", "current_value": 40827.909999999996, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 37131.904285714285, "deviation_in_std": 9.144108056859551, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (40827.91) отклоняется от базовой линии (3696.01) на 37131.90, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:37,217 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 101985, order_id: b99217b1fcf2fdeace7b8d869b76cb91, level: transaction): Detector Column: 'trans_transaction_vae_price_score', Score: 0.0022, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:37,217 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 101985, order_id: b99217b1fcf2fdeace7b8d869b76cb91, level: transaction): Detector Column: 'trans_category_price_outlier_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,218 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'category_price_outlier_model': CategoryPriceOutlierDetector
2025-05-22 02:46:37,226 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for transaction detector 'category_price_outlier_model':
        order_item_id                          order_id                        product_id                         seller_id  price  freight_value order_purchase_timestamp                       customer_id          product_category_name  product_name_lenght  product_description_lenght  product_photos_qty  product_weight_g  product_length_cm  product_height_cm  product_width_cm product_category_name_english customer_state seller_state payment_type  payment_installments  payment_value  review_score  price_deviation_from_category_mean  freight_to_price_ratio  transaction_level_score  transaction_is_anomaly  trans_transaction_vae_price_score  trans_category_price_outlier_model_score  behavior_level_score  behavior_is_anomaly  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score  time_series_level_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score  time_series_is_anomaly  multilevel_score  is_anomaly detailed_explanations_json
101985              1  b99217b1fcf2fdeace7b8d869b76cb91  57bdf3098169cccdb62221bd3e089cbd  d98eec89afa3380e14463da2aabaea72  39.99          10.15      2018-03-07 17:42:06  8325d6e7af2f2bfb58cf040729b232dd  fashion_roupa_infanto_juvenil                 38.0                       168.0                 1.0             100.0               16.0               16.0              16.0     fashion_childrens_clothes             SP           RS  credit_card                   3.0         110.44           5.0                            0.561411                0.253813                 0.501083                    True                           0.002166                                       1.0                0.1355                False                          0.192405                                   0.078594                 0.785942                           0.981184                       0.590701                    True          0.476866        True                       None
2025-05-22 02:46:37,227 - backend.ml_service.multilevel_detector - DEBUG - Explanation from transaction detector 'category_price_outlier_model': [{"detector_specific_info": {"category": "fashion_roupa_infanto_juvenil", "price": 39.99, "explanation": "Категория 'fashion_roupa_infanto_juvenil' не встречалась в обучающих данных, статистики отсутствуют."}}]
2025-05-22 02:46:37,227 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'category_price_outlier_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,227 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for transaction_level: [{"detector_name": "category_price_outlier_model", "detector_type": "CategoryPriceOutlierDetector", "score": 1.0, "explanation": {"detector_specific_info": {"category": "fashion_roupa_infanto_juvenil", "price": 39.99, "explanation": "Категория 'fashion_roupa_infanto_juvenil' не встречалась в обучающих данных, статистики отсутствуют."}}}]
2025-05-22 02:46:37,228 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 101985, order_id: b99217b1fcf2fdeace7b8d869b76cb91, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.9812, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,228 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:37,228 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-03-07 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,229 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-03-07 00:00:00
2025-05-22 02:46:37,231 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
439 2018-03-07          258     37443.59  124.397309             156               258               2018-03-07  36096.731429         1.037312           0.785942                           0.981184                       0.590701    2018-03-07
2025-05-22 02:46:37,232 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-03-07 00:00:00", "current_value": 37443.590000000004, "expected_value": 25669.474712643678, "absolute_deviation": 11774.115287356326, "relative_deviation": 0.45868158266428816, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-03-07 00:00:00 значение total_sales (37443.59) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}]
2025-05-22 02:46:37,232 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,232 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9811839092449968, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-03-07 00:00:00", "current_value": 37443.590000000004, "expected_value": 25669.474712643678, "absolute_deviation": 11774.115287356326, "relative_deviation": 0.45868158266428816, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-03-07 00:00:00 значение total_sales (37443.59) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}]
2025-05-22 02:46:37,232 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 101985, order_id: b99217b1fcf2fdeace7b8d869b76cb91, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.5907, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,233 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:37,233 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-03-07 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,234 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-03-07 00:00:00
2025-05-22 02:46:37,236 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
439 2018-03-07          258     37443.59  124.397309             156               258               2018-03-07  36096.731429         1.037312           0.785942                           0.981184                       0.590701    2018-03-07
2025-05-22 02:46:37,236 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-03-07 00:00:00", "current_value": 37443.590000000004, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 33747.58428571429, "deviation_in_std": 8.310684929920788, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (37443.59) отклоняется от базовой линии (3696.01) на 33747.58, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:37,236 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,237 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9811839092449968, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-03-07 00:00:00", "current_value": 37443.590000000004, "expected_value": 25669.474712643678, "absolute_deviation": 11774.115287356326, "relative_deviation": 0.45868158266428816, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-03-07 00:00:00 значение total_sales (37443.59) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.5907009729761068, "explanation": {"detector_specific_info": {"date": "2018-03-07 00:00:00", "current_value": 37443.590000000004, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 33747.58428571429, "deviation_in_std": 8.310684929920788, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (37443.59) отклоняется от базовой линии (3696.01) на 33747.58, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:37,237 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 103314, order_id: e1df35a4d8a73d8ad53be0f5993e6af4, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1697, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:37,237 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 103314, order_id: e1df35a4d8a73d8ad53be0f5993e6af4, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9836, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,237 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:37,237 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=4a3ccda38b2129705f3fb522db62ca31 in aggregated_behavior_data_with_scores
2025-05-22 02:46:37,238 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:37,242 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                               categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
882  4a3ccda38b2129705f3fb522db62ca31  233.158916  370.889347     83        9.9     3099.9     18.396747     9.418922  [construcao_ferramentas_seguranca, casa_construcao, ferramentas_jardim, construcao_ferramentas_construcao, eletronicos]               5          1.590715         313.121212                0.078902                  5            0.060241               0.53771        0.576635                          0.169668                                   0.983603
2025-05-22 02:46:37,243 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}]
2025-05-22 02:46:37,243 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,243 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.9836033466098753, "explanation": {"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}}]
2025-05-22 02:46:37,243 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 103314, order_id: e1df35a4d8a73d8ad53be0f5993e6af4, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.9366, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,243 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:37,244 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-04-04 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,244 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-04-04 00:00:00
2025-05-22 02:46:37,247 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
467 2018-04-04          257     38795.63  129.751271             188               257               2018-04-04  32339.088571         1.199651           0.797799                           0.936555                       0.659043    2018-04-04
2025-05-22 02:46:37,247 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-04-04 00:00:00", "current_value": 38795.63, "expected_value": 25669.474712643678, "absolute_deviation": 13126.15528735632, "relative_deviation": 0.5113527033294117, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-04-04 00:00:00 значение total_sales (38795.63) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}]
2025-05-22 02:46:37,248 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,248 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9365551752273211, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-04-04 00:00:00", "current_value": 38795.63, "expected_value": 25669.474712643678, "absolute_deviation": 13126.15528735632, "relative_deviation": 0.5113527033294117, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-04-04 00:00:00 значение total_sales (38795.63) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}]
2025-05-22 02:46:37,248 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 103314, order_id: e1df35a4d8a73d8ad53be0f5993e6af4, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.6590, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,248 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:37,249 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-04-04 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,249 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-04-04 00:00:00
2025-05-22 02:46:37,252 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
467 2018-04-04          257     38795.63  129.751271             188               257               2018-04-04  32339.088571         1.199651           0.797799                           0.936555                       0.659043    2018-04-04
2025-05-22 02:46:37,252 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-04-04 00:00:00", "current_value": 38795.63, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 35099.624285714286, "deviation_in_std": 8.643638493575018, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (38795.63) отклоняется от базовой линии (3696.01) на 35099.62, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:37,253 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,253 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9365551752273211, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-04-04 00:00:00", "current_value": 38795.63, "expected_value": 25669.474712643678, "absolute_deviation": 13126.15528735632, "relative_deviation": 0.5113527033294117, "threshold": 2.5, "day_of_week": 2, "anomaly_factors": [], "explanation_text": "Для даты 2018-04-04 00:00:00 значение total_sales (38795.63) в пределах нормальных отклонений от сезонного паттерна (25669.47)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.6590433437168123, "explanation": {"detector_specific_info": {"date": "2018-04-04 00:00:00", "current_value": 38795.63, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 35099.624285714286, "deviation_in_std": 8.643638493575018, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (38795.63) отклоняется от базовой линии (3696.01) на 35099.62, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:37,254 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 103447, order_id: abb71d0110c4be1a1a0c52f929cab4a3, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,254 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:37,254 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-04-05 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,255 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-04-05 00:00:00
2025-05-22 02:46:37,257 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
468 2018-04-05          266     41611.08  132.098667             194               266               2018-04-05  34057.644286         1.221784           0.831099                                1.0                       0.662198    2018-04-05
2025-05-22 02:46:37,257 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-04-05 00:00:00", "current_value": 41611.08, "expected_value": 24263.594318181815, "absolute_deviation": 17347.485681818187, "relative_deviation": 0.7149594348772526, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-04-05 00:00:00 значение total_sales (41611.08) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}]
2025-05-22 02:46:37,258 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,258 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-04-05 00:00:00", "current_value": 41611.08, "expected_value": 24263.594318181815, "absolute_deviation": 17347.485681818187, "relative_deviation": 0.7149594348772526, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-04-05 00:00:00 значение total_sales (41611.08) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}]
2025-05-22 02:46:37,258 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 103447, order_id: abb71d0110c4be1a1a0c52f929cab4a3, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.6622, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,258 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:37,258 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-04-05 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,259 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-04-05 00:00:00
2025-05-22 02:46:37,263 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
468 2018-04-05          266     41611.08  132.098667             194               266               2018-04-05  34057.644286         1.221784           0.831099                                1.0                       0.662198    2018-04-05
2025-05-22 02:46:37,275 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-04-05 00:00:00", "current_value": 41611.08, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 37915.07428571429, "deviation_in_std": 9.336971613002184, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (41611.08) отклоняется от базовой линии (3696.01) на 37915.07, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:37,277 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,291 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-04-05 00:00:00", "current_value": 41611.08, "expected_value": 24263.594318181815, "absolute_deviation": 17347.485681818187, "relative_deviation": 0.7149594348772526, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-04-05 00:00:00 значение total_sales (41611.08) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.6621982594620522, "explanation": {"detector_specific_info": {"date": "2018-04-05 00:00:00", "current_value": 41611.08, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 37915.07428571429, "deviation_in_std": 9.336971613002184, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (41611.08) отклоняется от базовой линии (3696.01) на 37915.07, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:37,292 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 103762, order_id: 1d1e5f659ad884a3f1a760dd28e5606a, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.2171, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:37,292 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 103762, order_id: 1d1e5f659ad884a3f1a760dd28e5606a, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.7849, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,293 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:37,293 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=7299e27ed73d2ad986de7f7c77d919fa in aggregated_behavior_data_with_scores
2025-05-22 02:46:37,296 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:37,306 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                             seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                                   categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
1412  7299e27ed73d2ad986de7f7c77d919fa   98.885094  148.935573    371       5.99     1500.0     19.280997    10.805647  [consoles_games, brinquedos, bebes, utilidades_domesticas, esporte_lazer, eletroportateis, alimentos, cool_stuff, automotivo, artes, relogios_presentes, moveis_decoracao, cama_mesa_banho]              13          1.506148         250.417362                0.194984                 13             0.03504              0.791985         0.50099                          0.217125                                   0.784855
2025-05-22 02:46:37,309 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}]
2025-05-22 02:46:37,311 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,311 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.7848545894928308, "explanation": {"detector_specific_info": {"seller_id": "7299e27ed73d2ad986de7f7c77d919fa", "anomaly_factors": [{"factor": "price_volatility", "value": 1.506147853249106, "threshold": 0.5, "description": "Высокая волатильность цен (1.51 > 0.50)"}, {"factor": "price_range_ratio", "value": 250.41736227045075, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 250.42 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.51 > 0.50)\n- Широкий диапазон цен (max/min = 250.42 > 5.00)", "raw_metrics": {"mean_price": 98.88509433962265, "std_price": 148.93557255795798, "price_volatility": 1.506147853249106, "price_range_ratio": 250.41736227045075, "freight_to_price_ratio": 0.19498385912806307, "transaction_count": 371}}}}]
2025-05-22 02:46:37,312 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 103762, order_id: 1d1e5f659ad884a3f1a760dd28e5606a, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.9519, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,318 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:37,320 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-19 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,321 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-19 00:00:00
2025-05-22 02:46:37,324 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
573 2018-07-19          253     39792.17  132.640567             187               253               2018-07-19  33204.071429         1.198412           0.927888                           0.951939                       0.903837    2018-07-19
2025-05-22 02:46:37,324 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-19 00:00:00", "current_value": 39792.17, "expected_value": 24263.594318181815, "absolute_deviation": 15528.575681818184, "relative_deviation": 0.6399948613623957, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-19 00:00:00 значение total_sales (39792.17) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}]
2025-05-22 02:46:37,325 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,325 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9519393357564666, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-19 00:00:00", "current_value": 39792.17, "expected_value": 24263.594318181815, "absolute_deviation": 15528.575681818184, "relative_deviation": 0.6399948613623957, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-19 00:00:00 значение total_sales (39792.17) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}]
2025-05-22 02:46:37,325 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 103762, order_id: 1d1e5f659ad884a3f1a760dd28e5606a, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9038, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,325 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:37,325 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-19 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,326 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-19 00:00:00
2025-05-22 02:46:37,328 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
573 2018-07-19          253     39792.17  132.640567             187               253               2018-07-19  33204.071429         1.198412           0.927888                           0.951939                       0.903837    2018-07-19
2025-05-22 02:46:37,328 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-07-19 00:00:00", "current_value": 39792.17, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 36096.16428571429, "deviation_in_std": 8.889046576415753, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (39792.17) отклоняется от базовой линии (3696.01) на 36096.16, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:37,328 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,329 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.9519393357564666, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-07-19 00:00:00", "current_value": 39792.17, "expected_value": 24263.594318181815, "absolute_deviation": 15528.575681818184, "relative_deviation": 0.6399948613623957, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-07-19 00:00:00 значение total_sales (39792.17) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9038369376412337, "explanation": {"detector_specific_info": {"date": "2018-07-19 00:00:00", "current_value": 39792.17, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 36096.16428571429, "deviation_in_std": 8.889046576415753, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (39792.17) отклоняется от базовой линии (3696.01) на 36096.16, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:37,331 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 109924, order_id: d8c3814df9c4a328159b280e60a59486, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.7297, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,331 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:37,332 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-17 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,332 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-17 00:00:00
2025-05-22 02:46:37,335 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
602 2018-08-17          255     36361.57  120.802558             203               255               2018-08-17  37849.641429         0.960685           0.858666                           0.729695                       0.987637    2018-08-17
2025-05-22 02:46:37,335 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-17 00:00:00", "current_value": 36361.57, "expected_value": 23364.508863636365, "absolute_deviation": 12997.061136363634, "relative_deviation": 0.5562736718421575, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-17 00:00:00 значение total_sales (36361.57) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}]
2025-05-22 02:46:37,336 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,336 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7296946227452271, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-17 00:00:00", "current_value": 36361.57, "expected_value": 23364.508863636365, "absolute_deviation": 12997.061136363634, "relative_deviation": 0.5562736718421575, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-17 00:00:00 значение total_sales (36361.57) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}]
2025-05-22 02:46:37,336 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 109924, order_id: d8c3814df9c4a328159b280e60a59486, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9876, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,337 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:37,337 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-17 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,338 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-17 00:00:00
2025-05-22 02:46:37,341 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
602 2018-08-17          255     36361.57  120.802558             203               255               2018-08-17  37849.641429         0.960685           0.858666                           0.729695                       0.987637    2018-08-17
2025-05-22 02:46:37,346 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-17 00:00:00", "current_value": 36361.57, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 32665.564285714285, "deviation_in_std": 8.044226530061943, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (36361.57) отклоняется от базовой линии (3696.01) на 32665.56, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:37,346 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,347 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7296946227452271, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-17 00:00:00", "current_value": 36361.57, "expected_value": 23364.508863636365, "absolute_deviation": 12997.061136363634, "relative_deviation": 0.5562736718421575, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-17 00:00:00 значение total_sales (36361.57) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9876365632717872, "explanation": {"detector_specific_info": {"date": "2018-08-17 00:00:00", "current_value": 36361.57, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 32665.564285714285, "deviation_in_std": 8.044226530061943, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (36361.57) отклоняется от базовой линии (3696.01) на 32665.56, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:37,347 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 111889, order_id: 23a868333bc15837fc68d57a8287bf06, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,347 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:37,348 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-03 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,348 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-03 00:00:00
2025-05-22 02:46:37,350 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
588 2018-08-03          314     45036.63  125.10175             216               314               2018-08-03  39138.992857         1.150684           0.972436                                1.0                       0.944872    2018-08-03
2025-05-22 02:46:37,352 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-03 00:00:00", "current_value": 45036.63, "expected_value": 23364.508863636365, "absolute_deviation": 21672.121136363632, "relative_deviation": 0.9275658762120739, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-03 00:00:00 значение total_sales (45036.63) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}]
2025-05-22 02:46:37,352 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,352 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-03 00:00:00", "current_value": 45036.63, "expected_value": 23364.508863636365, "absolute_deviation": 21672.121136363632, "relative_deviation": 0.9275658762120739, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-03 00:00:00 значение total_sales (45036.63) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}]
2025-05-22 02:46:37,352 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 111889, order_id: 23a868333bc15837fc68d57a8287bf06, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9449, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,352 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:37,353 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-03 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,354 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-03 00:00:00
2025-05-22 02:46:37,355 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
588 2018-08-03          314     45036.63  125.10175             216               314               2018-08-03  39138.992857         1.150684           0.972436                                1.0                       0.944872    2018-08-03
2025-05-22 02:46:37,356 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-03 00:00:00", "current_value": 45036.63, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 41340.624285714286, "deviation_in_std": 10.18054804563417, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (45036.63) отклоняется от базовой линии (3696.01) на 41340.62, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:37,356 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,357 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-03 00:00:00", "current_value": 45036.63, "expected_value": 23364.508863636365, "absolute_deviation": 21672.121136363632, "relative_deviation": 0.9275658762120739, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-03 00:00:00 значение total_sales (45036.63) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9448723295452219, "explanation": {"detector_specific_info": {"date": "2018-08-03 00:00:00", "current_value": 45036.63, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 41340.624285714286, "deviation_in_std": 10.18054804563417, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (45036.63) отклоняется от базовой линии (3696.01) на 41340.62, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:37,357 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 114381, order_id: cad8ab3b1083311bd57b8ea9aa7c1c85, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1697, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:37,358 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 114381, order_id: cad8ab3b1083311bd57b8ea9aa7c1c85, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9836, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,358 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:37,358 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=4a3ccda38b2129705f3fb522db62ca31 in aggregated_behavior_data_with_scores
2025-05-22 02:46:37,359 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:37,362 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                               categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
882  4a3ccda38b2129705f3fb522db62ca31  233.158916  370.889347     83        9.9     3099.9     18.396747     9.418922  [construcao_ferramentas_seguranca, casa_construcao, ferramentas_jardim, construcao_ferramentas_construcao, eletronicos]               5          1.590715         313.121212                0.078902                  5            0.060241               0.53771        0.576635                          0.169668                                   0.983603
2025-05-22 02:46:37,363 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}]
2025-05-22 02:46:37,363 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,363 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.9836033466098753, "explanation": {"detector_specific_info": {"seller_id": "4a3ccda38b2129705f3fb522db62ca31", "anomaly_factors": [{"factor": "price_volatility", "value": 1.5907148406460292, "threshold": 0.5, "description": "Высокая волатильность цен (1.59 > 0.50)"}, {"factor": "price_range_ratio", "value": 313.1212121212121, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 313.12 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (1.59 > 0.50)\n- Широкий диапазон цен (max/min = 313.12 > 5.00)", "raw_metrics": {"mean_price": 233.1589156626506, "std_price": 370.8893473735142, "price_volatility": 1.5907148406460292, "price_range_ratio": 313.1212121212121, "freight_to_price_ratio": 0.07890218109681643, "transaction_count": 83}}}}]
2025-05-22 02:46:37,363 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 114381, order_id: cad8ab3b1083311bd57b8ea9aa7c1c85, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,364 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:37,364 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-03 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,365 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-03 00:00:00
2025-05-22 02:46:37,368 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
588 2018-08-03          314     45036.63  125.10175             216               314               2018-08-03  39138.992857         1.150684           0.972436                                1.0                       0.944872    2018-08-03
2025-05-22 02:46:37,368 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-03 00:00:00", "current_value": 45036.63, "expected_value": 23364.508863636365, "absolute_deviation": 21672.121136363632, "relative_deviation": 0.9275658762120739, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-03 00:00:00 значение total_sales (45036.63) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}]
2025-05-22 02:46:37,368 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,369 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-03 00:00:00", "current_value": 45036.63, "expected_value": 23364.508863636365, "absolute_deviation": 21672.121136363632, "relative_deviation": 0.9275658762120739, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-03 00:00:00 значение total_sales (45036.63) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}]
2025-05-22 02:46:37,369 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 114381, order_id: cad8ab3b1083311bd57b8ea9aa7c1c85, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9449, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,369 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:37,369 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-03 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,370 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-03 00:00:00
2025-05-22 02:46:37,372 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales  avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
588 2018-08-03          314     45036.63  125.10175             216               314               2018-08-03  39138.992857         1.150684           0.972436                                1.0                       0.944872    2018-08-03
2025-05-22 02:46:37,373 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-03 00:00:00", "current_value": 45036.63, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 41340.624285714286, "deviation_in_std": 10.18054804563417, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (45036.63) отклоняется от базовой линии (3696.01) на 41340.62, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:37,373 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,374 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-03 00:00:00", "current_value": 45036.63, "expected_value": 23364.508863636365, "absolute_deviation": 21672.121136363632, "relative_deviation": 0.9275658762120739, "threshold": 2.5, "day_of_week": 4, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-03 00:00:00 значение total_sales (45036.63) в пределах нормальных отклонений от сезонного паттерна (23364.51)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9448723295452219, "explanation": {"detector_specific_info": {"date": "2018-08-03 00:00:00", "current_value": 45036.63, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 41340.624285714286, "deviation_in_std": 10.18054804563417, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (45036.63) отклоняется от базовой линии (3696.01) на 41340.62, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:37,374 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 116292, order_id: 10fd0add9c8dd2fc964bbd79ce10343b, level: behavior): Detector Column: 'behav_graph_graph_analysis_score', Score: 0.1769, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:37,374 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 116292, order_id: 10fd0add9c8dd2fc964bbd79ce10343b, level: behavior): Detector Column: 'behav_seller_pricing_behavior_model_score', Score: 0.9184, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,374 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seller_pricing_behavior_model': SellerPricingBehaviorDetector
2025-05-22 02:46:37,375 - backend.ml_service.multilevel_detector - DEBUG -     Looking for seller_id=36a968b544695394e4e9d7572688598f in aggregated_behavior_data_with_scores
2025-05-22 02:46:37,376 - backend.ml_service.multilevel_detector - DEBUG -     Found matching seller_id row in aggregated data
2025-05-22 02:46:37,379 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for behavior detector 'seller_pricing_behavior_model':
                            seller_id  mean_price   std_price  count  min_price  max_price  mean_freight  std_freight                                                                                                                                                                        categories  category_count  price_volatility  price_range_ratio  freight_to_price_ratio  unique_categories  category_diversity  normalized_diversity  behavior_score  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score
642  36a968b544695394e4e9d7572688598f   56.522384  136.831171    172        3.9     1140.9     13.350814      5.53097  [informatica_acessorios, beleza_saude, telefonia, automotivo, tablets_impressao_imagem, instrumentos_musicais, ferramentas_jardim, cool_stuff, consoles_games, moveis_decoracao]              10          2.420832         292.538462                0.236204                 10             0.05814              0.719612        0.547647                          0.176931                                   0.918363
2025-05-22 02:46:37,380 - backend.ml_service.multilevel_detector - DEBUG - Explanation from behavior detector 'seller_pricing_behavior_model': [{"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}]
2025-05-22 02:46:37,380 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seller_pricing_behavior_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,381 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for behavior_level: [{"detector_name": "seller_pricing_behavior_model", "detector_type": "SellerPricingBehaviorDetector", "score": 0.918363395536566, "explanation": {"detector_specific_info": {"seller_id": "36a968b544695394e4e9d7572688598f", "anomaly_factors": [{"factor": "price_volatility", "value": 2.4208315641876976, "threshold": 0.5, "description": "Высокая волатильность цен (2.42 > 0.50)"}, {"factor": "price_range_ratio", "value": 292.53846153846155, "threshold": 5.0, "description": "Широкий диапазон цен (max/min = 292.54 > 5.00)"}], "text_explanation": "Выявлены следующие аномалии в ценовом поведении продавца:\n- Высокая волатильность цен (2.42 > 0.50)\n- Широкий диапазон цен (max/min = 292.54 > 5.00)", "raw_metrics": {"mean_price": 56.522383720930236, "std_price": 136.8311705947568, "price_volatility": 2.4208315641876976, "price_range_ratio": 292.53846153846155, "freight_to_price_ratio": 0.23620401466799015, "transaction_count": 172}}}}]
2025-05-22 02:46:37,381 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 116292, order_id: 10fd0add9c8dd2fc964bbd79ce10343b, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.7518, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,381 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:37,382 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-18 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,382 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-18 00:00:00
2025-05-22 02:46:37,385 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
542 2018-06-18          246     35911.86  120.915354             159               246               2018-06-18  30750.262857         1.167855           0.797394                           0.751835                       0.842952    2018-06-18
2025-05-22 02:46:37,385 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-18 00:00:00", "current_value": 35911.86, "expected_value": 25862.10588888889, "absolute_deviation": 10049.75411111111, "relative_deviation": 0.3885899375050032, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-18 00:00:00 значение total_sales (35911.86) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}]
2025-05-22 02:46:37,386 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,386 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7518345795661219, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-18 00:00:00", "current_value": 35911.86, "expected_value": 25862.10588888889, "absolute_deviation": 10049.75411111111, "relative_deviation": 0.3885899375050032, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-18 00:00:00 значение total_sales (35911.86) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}]
2025-05-22 02:46:37,387 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 116292, order_id: 10fd0add9c8dd2fc964bbd79ce10343b, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.8430, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,387 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:37,387 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-06-18 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,388 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-06-18 00:00:00
2025-05-22 02:46:37,391 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
542 2018-06-18          246     35911.86  120.915354             159               246               2018-06-18  30750.262857         1.167855           0.797394                           0.751835                       0.842952    2018-06-18
2025-05-22 02:46:37,392 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-06-18 00:00:00", "current_value": 35911.86, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 32215.854285714286, "deviation_in_std": 7.933480881182513, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (35911.86) отклоняется от базовой линии (3696.01) на 32215.85, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:37,393 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,393 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.7518345795661219, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-06-18 00:00:00", "current_value": 35911.86, "expected_value": 25862.10588888889, "absolute_deviation": 10049.75411111111, "relative_deviation": 0.3885899375050032, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-06-18 00:00:00 значение total_sales (35911.86) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.8429524267180292, "explanation": {"detector_specific_info": {"date": "2018-06-18 00:00:00", "current_value": 35911.86, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 32215.854285714286, "deviation_in_std": 7.933480881182513, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (35911.86) отклоняется от базовой линии (3696.01) на 32215.85, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:37,394 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 116453, order_id: a5d11ae16578088b0fcd76de30368bdb, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,394 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:37,395 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-03-15 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,396 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-03-15 00:00:00
2025-05-22 02:46:37,397 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
447 2018-03-15          286      46096.4  135.180059             174               286               2018-03-15  32494.021429         1.418612           0.804803                                1.0                       0.609605    2018-03-15
2025-05-22 02:46:37,398 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-03-15 00:00:00", "current_value": 46096.4, "expected_value": 24263.594318181815, "absolute_deviation": 21832.805681818187, "relative_deviation": 0.8998174547230158, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-03-15 00:00:00 значение total_sales (46096.40) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}]
2025-05-22 02:46:37,399 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,399 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-03-15 00:00:00", "current_value": 46096.4, "expected_value": 24263.594318181815, "absolute_deviation": 21832.805681818187, "relative_deviation": 0.8998174547230158, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-03-15 00:00:00 значение total_sales (46096.40) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}]
2025-05-22 02:46:37,399 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 116453, order_id: a5d11ae16578088b0fcd76de30368bdb, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.6096, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,400 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:37,400 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-03-15 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,401 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-03-15 00:00:00
2025-05-22 02:46:37,403 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
447 2018-03-15          286      46096.4  135.180059             174               286               2018-03-15  32494.021429         1.418612           0.804803                                1.0                       0.609605    2018-03-15
2025-05-22 02:46:37,403 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-03-15 00:00:00", "current_value": 46096.4, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 42400.39428571429, "deviation_in_std": 10.441527157312704, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (46096.40) отклоняется от базовой линии (3696.01) на 42400.39, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:37,403 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,403 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-03-15 00:00:00", "current_value": 46096.4, "expected_value": 24263.594318181815, "absolute_deviation": 21832.805681818187, "relative_deviation": 0.8998174547230158, "threshold": 2.5, "day_of_week": 3, "anomaly_factors": [], "explanation_text": "Для даты 2018-03-15 00:00:00 значение total_sales (46096.40) в пределах нормальных отклонений от сезонного паттерна (24263.59)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.609605020859105, "explanation": {"detector_specific_info": {"date": "2018-03-15 00:00:00", "current_value": 46096.4, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 42400.39428571429, "deviation_in_std": 10.441527157312704, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (46096.40) отклоняется от базовой линии (3696.01) на 42400.39, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:37,404 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 116989, order_id: 3fde74c28a3d5d618c00f26d51baafa0, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.8710, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,404 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:37,404 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-13 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,405 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-13 00:00:00
2025-05-22 02:46:37,408 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
598 2018-08-13          288     39062.43  119.092774             211               288               2018-08-13  38405.954286         1.017093           0.922974                           0.870962                       0.974986    2018-08-13
2025-05-22 02:46:37,408 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-13 00:00:00", "current_value": 39062.43, "expected_value": 25862.10588888889, "absolute_deviation": 13200.32411111111, "relative_deviation": 0.5104118035794738, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-13 00:00:00 значение total_sales (39062.43) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}]
2025-05-22 02:46:37,409 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,409 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8709622454242683, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-13 00:00:00", "current_value": 39062.43, "expected_value": 25862.10588888889, "absolute_deviation": 13200.32411111111, "relative_deviation": 0.5104118035794738, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-13 00:00:00 значение total_sales (39062.43) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}]
2025-05-22 02:46:37,409 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 116989, order_id: 3fde74c28a3d5d618c00f26d51baafa0, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9750, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,409 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:37,409 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-13 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,410 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-13 00:00:00
2025-05-22 02:46:37,412 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
598 2018-08-13          288     39062.43  119.092774             211               288               2018-08-13  38405.954286         1.017093           0.922974                           0.870962                       0.974986    2018-08-13
2025-05-22 02:46:37,413 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-13 00:00:00", "current_value": 39062.43, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 35366.42428571429, "deviation_in_std": 8.709340699710154, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (39062.43) отклоняется от базовой линии (3696.01) на 35366.42, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:37,413 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,413 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 0.8709622454242683, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-13 00:00:00", "current_value": 39062.43, "expected_value": 25862.10588888889, "absolute_deviation": 13200.32411111111, "relative_deviation": 0.5104118035794738, "threshold": 2.5, "day_of_week": 0, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-13 00:00:00 значение total_sales (39062.43) в пределах нормальных отклонений от сезонного паттерна (25862.11)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.97498574561089, "explanation": {"detector_specific_info": {"date": "2018-08-13 00:00:00", "current_value": 39062.43, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 35366.42428571429, "deviation_in_std": 8.709340699710154, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (39062.43) отклоняется от базовой линии (3696.01) на 35366.42, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:37,414 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 117243, order_id: 3adb141ba4bd69dd7fe8d3fb733c6b74, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 1.0000, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,414 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'seasonal_deviation_model': SeasonalDeviationDetector
2025-05-22 02:46:37,414 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-14 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,415 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-14 00:00:00
2025-05-22 02:46:37,417 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'seasonal_deviation_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
599 2018-08-14          315     44682.42  128.397759             228               315               2018-08-14  37562.228571         1.189557           0.989198                                1.0                       0.978396    2018-08-14
2025-05-22 02:46:37,417 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'seasonal_deviation_model': [{"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-14 00:00:00", "current_value": 44682.42, "expected_value": 26189.295057471263, "absolute_deviation": 18493.124942528735, "relative_deviation": 0.7061329792171336, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-14 00:00:00 значение total_sales (44682.42) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}]
2025-05-22 02:46:37,418 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'seasonal_deviation_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,418 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-14 00:00:00", "current_value": 44682.42, "expected_value": 26189.295057471263, "absolute_deviation": 18493.124942528735, "relative_deviation": 0.7061329792171336, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-14 00:00:00 значение total_sales (44682.42) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}]
2025-05-22 02:46:37,418 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 117243, order_id: 3adb141ba4bd69dd7fe8d3fb733c6b74, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.9784, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,418 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:37,419 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-08-14 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,420 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-08-14 00:00:00
2025-05-22 02:46:37,423 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
599 2018-08-14          315     44682.42  128.397759             228               315               2018-08-14  37562.228571         1.189557           0.989198                                1.0                       0.978396    2018-08-14
2025-05-22 02:46:37,424 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-08-14 00:00:00", "current_value": 44682.42, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40986.41428571429, "deviation_in_std": 10.093320240405061, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (44682.42) отклоняется от базовой линии (3696.01) на 40986.41, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:37,424 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,424 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "seasonal_deviation_model", "detector_type": "SeasonalDeviationDetector", "score": 1.0, "explanation": {"detector_specific_info": {"metric_name": "total_sales", "date": "2018-08-14 00:00:00", "current_value": 44682.42, "expected_value": 26189.295057471263, "absolute_deviation": 18493.124942528735, "relative_deviation": 0.7061329792171336, "threshold": 2.5, "day_of_week": 1, "anomaly_factors": [], "explanation_text": "Для даты 2018-08-14 00:00:00 значение total_sales (44682.42) в пределах нормальных отклонений от сезонного паттерна (26189.30)."}}}, {"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.9783962277530719, "explanation": {"detector_specific_info": {"date": "2018-08-14 00:00:00", "current_value": 44682.42, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 40986.41428571429, "deviation_in_std": 10.093320240405061, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (44682.42) отклоняется от базовой линии (3696.01) на 40986.41, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:37,424 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 117400, order_id: 43bdbd9dc0931d72befdf4765af6c442, level: transaction): Detector Column: 'trans_transaction_vae_price_score', Score: 0.9679, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,425 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'transaction_vae_price': TransactionVAEDetector
2025-05-22 02:46:37,432 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for transaction detector 'transaction_vae_price':
        order_item_id                          order_id                        product_id                         seller_id   price  freight_value order_purchase_timestamp                       customer_id          product_category_name  product_name_lenght  product_description_lenght  product_photos_qty  product_weight_g  product_length_cm  product_height_cm  product_width_cm   product_category_name_english customer_state seller_state payment_type  payment_installments  payment_value  review_score  price_deviation_from_category_mean  freight_to_price_ratio  transaction_level_score  transaction_is_anomaly  trans_transaction_vae_price_score  trans_category_price_outlier_model_score  behavior_level_score  behavior_is_anomaly  behav_graph_graph_analysis_score  behav_seller_pricing_behavior_model_score  time_series_level_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score  time_series_is_anomaly  multilevel_score  is_anomaly detailed_explanations_json
117400              1  43bdbd9dc0931d72befdf4765af6c442  7e53e051875b2a0c9f22acd8a9a29a20  eeb6de78f79159600292e314a77cbd18  3089.0         317.47      2018-07-06 11:07:02  3c7c62e8d38fb18a33a45db8021f2d69  industria_comercio_e_negocios                 56.0                       508.0                 1.0           11300.0               44.0               34.0              25.0  industry_commerce_and_business             PB           SC       boleto                   1.0        3406.47           5.0                           20.936314                0.102774                 0.607251                    True                           0.967893                                  0.246608              0.147343                False                          0.163494                                   0.131193                 0.531505                           0.183946                       0.879064                    True          0.446555        True                       None
2025-05-22 02:46:37,433 - backend.ml_service.detector - DEBUG - (transaction_vae_price) Метод get_explanation_details не реализован специфично, будет использована реализация get_shap_explanations (если есть).
2025-05-22 02:46:37,435 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) [Detect_Preprocess] Scaler type: <class 'sklearn.preprocessing._data.StandardScaler'>
2025-05-22 02:46:37,435 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) [Detect_Preprocess] Scaler has mean_: True
2025-05-22 02:46:37,435 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) [Detect_Preprocess] Scaler mean_ shape: (4,)
2025-05-22 02:46:37,436 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) [Detect_Preprocess] Scaler params: {'copy': True, 'with_mean': True, 'with_std': True}
2025-05-22 02:46:37,436 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) StandardScaler обучен (mean_ присутствует). Выполняется transform.
2025-05-22 02:46:37,436 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Вычисление SHAP values для 1 экземпляров...
2025-05-22 02:46:37,436 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Используется nsamples=50 для SHAP
2025-05-22 02:46:37,437 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) Запрос SHAP объяснений: explainer=True, background_data_exists=True, model=True
2025-05-22 02:46:37,437 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Создание GradientExplainer с размерами данных: torch.Size([50, 4])
2025-05-22 02:46:37,459 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) SHAP values raw type: <class 'numpy.ndarray'>
2025-05-22 02:46:37,460 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) SHAP values raw (ndarray) shape: (1, 4, 1)
2025-05-22 02:46:37,460 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) SHAP GradientExplainer успешно создан и вычислены SHAP-значения
2025-05-22 02:46:37,460 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) SHAP values_raw уже является ndarray, shape: (1, 4, 1)
2025-05-22 02:46:37,460 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) Начальная форма shap_values_arr: (1, 4, 1), ndim: 3
2025-05-22 02:46:37,460 - backend.ml_service.vae_detector - DEBUG - (transaction_vae_price) SHAP values после squeeze(-1): (1, 4)
2025-05-22 02:46:37,460 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) SHAP values успешно вычислены для 1 экземпляров.
2025-05-22 02:46:37,461 - backend.ml_service.multilevel_detector - DEBUG - Explanation from transaction detector 'transaction_vae_price': [{"shap_values": {"price": -19.340234240055157, "freight_value": 69.68775161456259, "product_weight_g": -4.613856061012583, "freight_to_price_ratio": -1.6547178496778456}}]
2025-05-22 02:46:37,461 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'transaction_vae_price' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,461 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for transaction_level: [{"detector_name": "transaction_vae_price", "detector_type": "TransactionVAEDetector", "score": 0.9678932583605161, "explanation": {"shap_values": {"price": -19.340234240055157, "freight_value": 69.68775161456259, "product_weight_g": -4.613856061012583, "freight_to_price_ratio": -1.6547178496778456}}}]
2025-05-22 02:46:37,462 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 117400, order_id: 43bdbd9dc0931d72befdf4765af6c442, level: transaction): Detector Column: 'trans_category_price_outlier_model_score', Score: 0.2466, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:37,462 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 117400, order_id: 43bdbd9dc0931d72befdf4765af6c442, level: time_series): Detector Column: 'ts_seasonal_deviation_model_score', Score: 0.1839, Threshold: 0.3, Passes Threshold: False
2025-05-22 02:46:37,462 - backend.ml_service.multilevel_detector - DEBUG - Anomaly Explanation Check (idx: 117400, order_id: 43bdbd9dc0931d72befdf4765af6c442, level: time_series): Detector Column: 'ts_cumulative_sum_model_score', Score: 0.8791, Threshold: 0.3, Passes Threshold: True
2025-05-22 02:46:37,462 - backend.ml_service.multilevel_detector - DEBUG -     Detector instance for 'cumulative_sum_model': CumulativeSumDetector
2025-05-22 02:46:37,463 - backend.ml_service.multilevel_detector - DEBUG -     Looking for date=2018-07-06 00:00:00 in aggregated_ts_data_with_scores using column 'date'
2025-05-22 02:46:37,464 - backend.ml_service.multilevel_detector - DEBUG -     Found matching date row(s) in aggregated data for 2018-07-06 00:00:00
2025-05-22 02:46:37,466 - backend.ml_service.multilevel_detector - DEBUG - Data for get_explanation_details for time_series detector 'cumulative_sum_model':
          date  order_count  total_sales   avg_price  unique_sellers  unique_customers order_purchase_timestamp  sales_7d_avg  sales_deviation  time_series_score  ts_seasonal_deviation_model_score  ts_cumulative_sum_model_score merge_date_ts
560 2018-07-06          121     19667.34  147.874737             108               121               2018-07-06      25243.75         0.779097           0.531505                           0.183946                       0.879064    2018-07-06
2025-05-22 02:46:37,466 - backend.ml_service.multilevel_detector - DEBUG - Explanation from time_series detector 'cumulative_sum_model': [{"detector_specific_info": {"date": "2018-07-06 00:00:00", "current_value": 19667.34, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 15971.334285714285, "deviation_in_std": 3.933103064067317, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (19667.34) отклоняется от базовой линии (3696.01) на 15971.33, но накопленный эффект не достаточен для объявления аномалии."}}]
2025-05-22 02:46:37,466 - backend.ml_service.multilevel_detector - DEBUG -     Explanation for 'cumulative_sum_model' IS NOT EMPTY. Appending to list.
2025-05-22 02:46:37,467 - backend.ml_service.multilevel_detector - DEBUG -     Appended. Current explanations for time_series_level: [{"detector_name": "cumulative_sum_model", "detector_type": "CumulativeSumDetector", "score": 0.8790638175767516, "explanation": {"detector_specific_info": {"date": "2018-07-06 00:00:00", "current_value": 19667.34, "baseline_mean": 3696.0057142857145, "baseline_std": 4060.74644512314, "deviation": 15971.334285714285, "deviation_in_std": 3.933103064067317, "pos_cusum": null, "neg_cusum": null, "max_cusum": 0.0, "threshold": 2.5, "triggered_cusum_type": null, "anomaly_factors": [], "explanation_text": "Значение (19667.34) отклоняется от базовой линии (3696.01) на 15971.33, но накопленный эффект не достаточен для объявления аномалии."}}}]
2025-05-22 02:46:37,469 - backend.ml_service.multilevel_detector - INFO - Сгенерированы объяснения для 166 из 166 аномалий
2025-05-22 02:46:37,469 - backend.ml_service.multilevel_detector - INFO - Многоуровневая детекция завершена. Обнаружено 166 аномалий.
2025-05-22 02:46:37,486 - backend.ml_service.multilevel_service - INFO - Обнаружено 166 multilevel аномалий до сохранения.
2025-05-22 02:46:37,486 - backend.ml_service.multilevel_service - INFO - Начало сохранения multilevel аномалий в БД...
2025-05-22 02:46:38,416 - backend.ml_service.multilevel_service - INFO - Статистика сохранения multilevel аномалий: {'total_detected_anomalies_before_save': 166, 'newly_saved_anomalies_count': 162, 'newly_saved_anomaly_ids': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160, 161, 162], 'skipped_duplicates_count': 4, 'errors_on_save': 0}
2025-05-22 02:46:38,417 - backend.ml_service.multilevel_service - DEBUG - Сессия БД (db_for_crud) для multilevel detect закрыта.
2025-05-22 02:46:38,417 - backend.ml_service.multilevel_service - DEBUG - Сессия БД (db_for_load_detect) для multilevel detect закрыта.
2025-05-22 02:46:38,444 - backend.ml_service.multilevel_service - INFO - [TaskID: 2e73360b-e5d5-4553-a019-eb2a30a07817] Детекция и сохранение аномалий успешно завершены.
2025-05-22 03:20:58,233 - backend.ml_service.llm_explainer - DEBUG - Запрос на генерацию объяснения LLM для данных: {'product_id': '7e53e051875b2a0c9f22acd8a9a29a20', 'seller_id': 'eeb6de78f79159600292e314a77cbd18', 'final_threshold_used': 0.4, 'level_scores': {'transaction_score': 0.6072508247645493, 'behavior_score': 0.1473433995645816, 'time_series_score': 0.5315049074771873, 'final_score': 0.4465548220183504}, 'level_thresholds': {'transaction': 0.5, 'behavior': 0.5, 'time_series': 0.5}, 'contributing_detectors_explanations': {'transaction_level': [{'detector_name': 'transaction_vae_price', 'detector_type': 'TransactionVAEDetector', 'score': 0.9678932583605161, 'explanation': {'shap_values': {'price': -19.340234240055157, 'freight_value': 69.68775161456259, 'product_weight_g': -4.613856061012583, 'freight_to_price_ratio': -1.6547178496778456}}}], 'behavior_level': [], 'time_series_level': [{'detector_name': 'cumulative_sum_model', 'detector_type': 'CumulativeSumDetector', 'score': 0.8790638175767516, 'explanation': {'detector_specific_info': {'date': '2018-07-06 00:00:00', 'current_value': 19667.34, 'baseline_mean': 3696.0057142857145, 'baseline_std': 4060.74644512314, 'deviation': 15971.334285714285, 'deviation_in_std': 3.933103064067317, 'pos_cusum': None, 'neg_cusum': None, 'max_cusum': 0.0, 'threshold': 2.5, 'triggered_cusum_type': None, 'anomaly_factors': [], 'explanation_text': 'Значение (19667.34) отклоняется от базовой линии (3696.01) на 15971.33, но накопленный эффект не достаточен для объявления аномалии.'}}}]}}, SHAP: False, Details: False
2025-05-22 03:20:58,234 - backend.ml_service.llm_explainer - DEBUG - Полный промпт для Ollama (qwen3:latest):\nИнструкция для системы:
Ты — эксперт по анализу данных, специализирующийся на выявлении мошенничества и операционных аномалий в электронной коммерции. Твоя задача — предоставить менеджеру по операционной деятельности ОЧЕНЬ КРАТКОЕ (3-5 предложений) и МАКСИМАЛЬНО ИНФОРМАТИВНОЕ объяснение обнаруженной аномалии для обычного пользователя. Ключевая цель: четко объяснить, ПОЧЕМУ система считает данное событие аномальным, опираясь на предоставленные числовые данные, значения SHAP (если есть) и специфическую логику детектора (если предоставлена). Избегай общих фраз и излишне технического жаргона. Сосредоточься на конкретных фактах из данных.

ОБЯЗАТЕЛЬНАЯ СТРУКТУРА ОТВЕТА:
1. Суть аномалии (1 предложение): Кратко, что это за событие.
2. Причины аномальности (1-3 предложения): Конкретные факторы из данных (например, необычно высокая цена, редкая категория для продавца, несоответствие геолокации, высокие значения SHAP для определенных признаков), которые делают это событие подозрительным. ОБЯЗАТЕЛЬНО сошлись на значения, если они есть.
3. Возможные последстви/рекомендации (1 предложение): Краткий вывод о потенциальных рисках или что можно проверить.

Ответ должен быть на русском языке.

Контекст для анализа:
Обнаружена аномалия!
Оценка аномальности: 0.447

Детали аномалии (JSON):
{
  "product_id": "7e53e051875b2a0c9f22acd8a9a29a20",
  "seller_id": "eeb6de78f79159600292e314a77cbd18",
  "final_threshold_used": 0.4,
  "level_scores": {
    "transaction_score": 0.6072508247645493,
    "behavior_score": 0.1473433995645816,
    "time_series_score": 0.5315049074771873,
    "final_score": 0.4465548220183504
  },
  "level_thresholds": {
    "transaction": 0.5,
    "behavior": 0.5,
    "time_series": 0.5
  },
  "contributing_detectors_explanations": {
    "transaction_level": [
      {
        "detector_name": "transaction_vae_price",
        "detector_type": "TransactionVAEDetector",
        "score": 0.9678932583605161,
        "explanation": {
          "shap_values": {
            "price": -19.340234240055157,
            "freight_value": 69.68775161456259,
            "product_weight_g": -4.613856061012583,
            "freight_to_price_ratio": -1.6547178496778456
          }
        }
      }
    ],
    "behavior_level": [],
    "time_series_level": [
      {
        "detector_name": "cumulative_sum_model",
        "detector_type": "CumulativeSumDetector",
        "score": 0.8790638175767516,
        "explanation": {
          "detector_specific_info": {
            "date": "2018-07-06 00:00:00",
            "current_value": 19667.34,
            "baseline_mean": 3696.0057142857145,
            "baseline_std": 4060.74644512314,
            "deviation": 15971.334285714285,
            "deviation_in_std": 3.933103064067317,
            "pos_cusum": null,
            "neg_cusum": null,
            "max_cusum": 0.0,
            "threshold": 2.5,
            "triggered_cusum_type": null,
            "anomaly_factors": [],
            "explanation_text": "Значение (19667.34) отклоняется от базовой линии (3696.01) на 15971.33, но накопленный эффект не достаточен для объявления аномалии."
          }
        }
      }
    ]
  }
}

Технические детали от системы обнаружения (если доступны):


ЗАДАЧА:
Следуя ИНСТРУКЦИИ ДЛЯ СИСТЕМЫ и ОБЯЗАТЕЛЬНОЙ СТРУКТУРЕ ОТВЕТА, предоставь объяснение указанной аномалии.
Объяснение:

2025-05-22 03:21:37,781 - backend.ml_service.llm_explainer - INFO - LLM (qwen3:latest) сгенерировала объяснение (сырое): <think>
Хорошо, мне нужно разобраться с этой аномалией. Сначала посмотрю на структуру данных. Оценка аномальности 0.447, что чуть ниже порога 0.4, но все равно подозрительно. 

В деталях аномалии есть product_id и seller_id. Нужно понять, почему система считает это событие аномальным. Посмотрю на level_scores: final_score 0.4465, что чуть ниже final_threshold_used 0.4. Возможно, это связано с тем, что некоторые уровни превысили свои пороги. 

На transaction_level есть детектор transaction_vae_price с score 0.967. SHAP-значения показывают, что цена и стоимость доставки сильно влияют. Цена имеет SHAP -19.34, что может означать, что цена ниже средней, но freight_value 69.69 высока. Это может быть несоответствие, например, слишком высокая доставка по сравнению с ценой. 

На time_series_level детектор cumulative_sum_model показывает, что значение 19667.34 сильно отклоняется от средней 3696.01, но накопленный эффект не достаточен. Возможно, это временные колебания, но система всё равно подозревает. 

Нужно объединить эти данные. Основная причина — высокая стоимость доставки по сравнению с ценой товара, что не соответствует обычным паттернам. Также, отклонение значения от средней, хотя накопленный эффект не превысил порог. 

Теперь структурирую ответ по требованиям: суть аномалии, причины, рекомендации. Убедиться, что всё кратко и конкретно, без лишних деталей.
</think>

1. Суть аномалии: Покупка товара с высокой стоимостью доставки по сравнению с ценой товара, при отклонении от средней динамики продаж.  
2. Причины аномальности: Детектор *transaction_vae_price* выявил, что стоимость доставки (69.69) в 1.9 раза превышает цену товара (19.34), что не соответствует обычным паттернам. На уровне временных рядов значение (19667.34) отклоняется от средней (3696.01) на 15971.33, но накопленный эффект не достиг порога.  
3. Возможные последствия: Рекомендуется проверить согласованность цены и доставки, а также уточнить динамику продаж для данного товара.
2025-05-22 03:21:37,782 - backend.ml_service.llm_explainer - INFO - LLM (qwen3:latest) сгенерировала объяснение (очищенное): 1. Суть аномалии: Покупка товара с высокой стоимостью доставки по сравнению с ценой товара, при отклонении от средней динамики продаж.  
2. Причины аномальности: Детектор *transaction_vae_price* выявил, что стоимость доставки (69.69) в 1.9 раза превышает цену товара (19.34), что не соответствует обычным паттернам. На уровне временных рядов значение (19667.34) отклоняется от средней (3696.01) на 15971.33, но накопленный эффект не достиг порога.  
3. Возможные последствия: Рекомендуется проверить согласованность цены и доставки, а также уточнить динамику продаж для данного товара.
2025-05-22 03:41:06,034 - backend.ml_service - INFO - Логирование настроено с уровнем DEBUG
2025-05-22 03:41:06,034 - backend.ml_service - INFO - Логи записываются в файл: C:\Users\alex\Desktop\AnomaLens3.0\logs\ml_service_2025-05-22.log
2025-05-22 03:41:21,634 - backend.ml_service.multilevel_service - INFO - Базовый путь для моделей (MultilevelService): C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models
2025-05-22 03:41:21,634 - backend.ml_service.multilevel_service - INFO - Создание/инициализация многоуровневой системы на основе настроек из config.yaml.
2025-05-22 03:41:21,635 - backend.ml_service.multilevel_service - DEBUG - Используется следующая конфигурация для MultilevelAnomalyDetector: {
  "transaction_level": [
    {
      "type": "transaction_vae",
      "model_filename": "ml_trans_vae_model.joblib",
      "weight": 1.0,
      "features": [
        "price",
        "freight_value",
        "product_weight_g",
        "freight_to_price_ratio"
      ],
      "encoding_dim": 10,
      "hidden_dim1": 32,
      "hidden_dim2": 16,
      "epochs": 25,
      "kld_weight": 0.5,
      "dropout_rate": 0.1,
      "shap_background_samples": 50
    },
    {
      "type": "category_price_outlier",
      "model_filename": "ml_category_price_model.joblib",
      "weight": 1.0,
      "category_col": "product_category_name",
      "price_col": "price",
      "threshold": 2.8,
      "min_samples_per_category": 10
    }
  ],
  "behavior_level": [
    {
      "type": "graph",
      "model_filename": "ml_graph_model_v3.joblib",
      "weight": 1.0,
      "use_seller_state_spread": true,
      "use_category_diversity": true,
      "use_seller_degree": true,
      "seller_state_weight": 0.3,
      "category_diversity_weight": 0.4,
      "seller_degree_weight": 0.3
    },
    {
      "type": "seller_pricing_behavior",
      "model_filename": "ml_seller_pricing_model.joblib",
      "weight": 1.0,
      "volatility_threshold": 0.5,
      "range_threshold": 5.0,
      "freight_ratio_threshold": 1.0,
      "min_transactions": 5
    }
  ],
  "time_series_level": [
    {
      "type": "seasonal_deviation",
      "model_filename": "seasonal_deviation_model.joblib",
      "weight": 1.0,
      "window_size": 7,
      "threshold": 2.5
    },
    {
      "type": "cumulative_sum",
      "model_filename": "cumulative_sum_model.joblib",
      "weight": 1.0,
      "window_size": 14,
      "threshold": 2.5,
      "drift_threshold": 4.5
    }
  ],
  "combination_weights": {
    "transaction": 0.4,
    "behavior": 0.3,
    "time_series": 0.3
  },
  "transaction_level_combination_method": "weighted_average",
  "behavior_level_combination_method": "weighted_average",
  "time_series_level_combination_method": "average"
}
2025-05-22 03:41:21,635 - backend.ml_service.multilevel_detector - INFO - Инициализация многоуровневой системы обнаружения аномалий...
2025-05-22 03:41:21,635 - backend.ml_service.multilevel_detector - INFO - Инициализация детекторов для уровня 'transaction'...
2025-05-22 03:41:21,635 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) VAEDetector инициализирован. Устройство: cpu, Входная размерность: 4, Признаки: ['price', 'freight_value', 'product_weight_g', 'freight_to_price_ratio']
2025-05-22 03:41:21,636 - backend.ml_service.detector - DEBUG - (transaction_vae_price) Сброс базового состояния детектора (из AnomalyDetector._reset_state).
2025-05-22 03:41:21,636 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Специфичное состояние VAEDetector (порог, SHAP) сброшено.
2025-05-22 03:41:21,636 - backend.ml_service.transaction_detectors - INFO - (transaction_vae_price) TransactionVAEDetector инициализирован. Конфигурационные признаки: ['price', 'freight_value', 'product_weight_g', 'freight_to_price_ratio'], Реально используемые признаки (с генерируемыми): ['price', 'freight_value', 'product_weight_g', 'freight_to_price_ratio'], encoding_dim(latent_dim): 10, hidden_dim1(hidden_dim): 32, hidden_dim2: 16, epochs: 25, batch_size: 64, lr: 0.001, kld_w: 0.5, dropout: 0.1
2025-05-22 03:41:21,636 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора transaction_vae_price типа transaction_vae
2025-05-22 03:41:21,636 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='ml_trans_vae_model.joblib' установлен для transaction_vae_price
2025-05-22 03:41:21,637 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib'
2025-05-22 03:41:21,637 - backend.ml_service.detector - INFO - Попытка загрузки модели transaction_vae_price из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib...
2025-05-22 03:41:21,664 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Загружен порог аномальности: 3.656726
2025-05-22 03:41:21,664 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) StandardScaler успешно инициализирован с параметрами: n_features_in_=4, mean_=(4,), scale_=(4,)
2025-05-22 03:41:21,666 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Фоновые данные SHAP загружены (torch.Size([50, 4]))
2025-05-22 03:41:21,675 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Модель VAE успешно загружена и перемещена на cpu.
2025-05-22 03:41:21,675 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Попытка пересоздания SHAP GradientExplainer после загрузки...
2025-05-22 03:41:21,690 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) SHAP GradientExplainer успешно ПЕРЕСОЗДАН при загрузке модели. Device=cpu, background_data.shape=torch.Size([50, 4])
2025-05-22 03:41:21,690 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Статус SHAP после загрузки: background_data shape=torch.Size([50, 4]), device=cpu, explainer=создан
2025-05-22 03:41:21,691 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Детектор VAE (is_trained=True) успешно загружен.
2025-05-22 03:41:21,691 - backend.ml_service.detector - INFO - Модель transaction_vae_price успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib. is_trained=True
2025-05-22 03:41:21,691 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора transaction_vae_price из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib
2025-05-22 03:41:21,691 - backend.ml_service.multilevel_detector - INFO -   Детектор 'transaction_vae_price' (тип: transaction_vae) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib.
2025-05-22 03:41:21,691 - backend.ml_service.multilevel_detector - INFO -   Детектор 'transaction_vae_price' (тип: transaction_vae) инициализирован с весом 1.0.
2025-05-22 03:41:21,692 - backend.ml_service.transaction_detectors - INFO - CategoryPriceOutlierDetector 'category_price_outlier_model' инициализирован с параметрами: category_col='product_category_name', price_col='price', threshold=2.8, min_samples_per_category=10
2025-05-22 03:41:21,692 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора category_price_outlier_model типа category_price_outlier
2025-05-22 03:41:21,692 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='ml_category_price_model.joblib' установлен для category_price_outlier_model
2025-05-22 03:41:21,692 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib'
2025-05-22 03:41:21,693 - backend.ml_service.detector - INFO - Попытка загрузки модели category_price_outlier_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib...
2025-05-22 03:41:21,695 - backend.ml_service.detector - INFO - Модель category_price_outlier_model успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib. is_trained=True
2025-05-22 03:41:21,695 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора category_price_outlier_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib
2025-05-22 03:41:21,695 - backend.ml_service.multilevel_detector - INFO -   Детектор 'category_price_outlier_model' (тип: category_price_outlier) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib.
2025-05-22 03:41:21,695 - backend.ml_service.multilevel_detector - INFO -   Детектор 'category_price_outlier_model' (тип: category_price_outlier) инициализирован с весом 1.0.
2025-05-22 03:41:21,695 - backend.ml_service.multilevel_detector - INFO - Инициализация детекторов для уровня 'behavior'...
2025-05-22 03:41:21,695 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора graph_graph_analysis типа graph
2025-05-22 03:41:21,696 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='ml_graph_model_v3.joblib' установлен для graph_graph_analysis
2025-05-22 03:41:21,696 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib'
2025-05-22 03:41:21,696 - backend.ml_service.detector - INFO - Попытка загрузки модели graph_graph_analysis из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib...
2025-05-22 03:41:21,696 - backend.ml_service.detector - INFO - Модель graph_graph_analysis успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib. is_trained=True
2025-05-22 03:41:21,697 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора graph_graph_analysis из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib
2025-05-22 03:41:21,697 - backend.ml_service.multilevel_detector - INFO -   Детектор 'graph_graph_analysis' (тип: graph) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib.
2025-05-22 03:41:21,697 - backend.ml_service.multilevel_detector - INFO -   Детектор 'graph_graph_analysis' (тип: graph) инициализирован с весом 1.0.
2025-05-22 03:41:21,697 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора seller_pricing_behavior_model типа seller_pricing_behavior
2025-05-22 03:41:21,697 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='ml_seller_pricing_model.joblib' установлен для seller_pricing_behavior_model
2025-05-22 03:41:21,697 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib'
2025-05-22 03:41:21,698 - backend.ml_service.detector - INFO - Попытка загрузки модели seller_pricing_behavior_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib...
2025-05-22 03:41:21,698 - backend.ml_service.detector - INFO - Модель seller_pricing_behavior_model успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib. is_trained=True
2025-05-22 03:41:21,698 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора seller_pricing_behavior_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib
2025-05-22 03:41:21,698 - backend.ml_service.multilevel_detector - INFO -   Детектор 'seller_pricing_behavior_model' (тип: seller_pricing_behavior) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib.
2025-05-22 03:41:21,699 - backend.ml_service.multilevel_detector - INFO -   Детектор 'seller_pricing_behavior_model' (тип: seller_pricing_behavior) инициализирован с весом 1.0.
2025-05-22 03:41:21,699 - backend.ml_service.multilevel_detector - INFO - Инициализация детекторов для уровня 'time_series'...
2025-05-22 03:41:21,699 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора seasonal_deviation_model типа seasonal_deviation
2025-05-22 03:41:21,699 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='seasonal_deviation_model.joblib' установлен для seasonal_deviation_model
2025-05-22 03:41:21,699 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib'
2025-05-22 03:41:21,700 - backend.ml_service.detector - INFO - Попытка загрузки модели seasonal_deviation_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib...
2025-05-22 03:41:21,701 - backend.ml_service.detector - INFO - Модель seasonal_deviation_model успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib. is_trained=True
2025-05-22 03:41:21,701 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора seasonal_deviation_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib
2025-05-22 03:41:21,702 - backend.ml_service.multilevel_detector - INFO -   Детектор 'seasonal_deviation_model' (тип: seasonal_deviation) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib.
2025-05-22 03:41:21,702 - backend.ml_service.multilevel_detector - INFO -   Детектор 'seasonal_deviation_model' (тип: seasonal_deviation) инициализирован с весом 1.0.
2025-05-22 03:41:21,702 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора cumulative_sum_model типа cumulative_sum
2025-05-22 03:41:21,702 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='cumulative_sum_model.joblib' установлен для cumulative_sum_model
2025-05-22 03:41:21,702 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib'
2025-05-22 03:41:21,703 - backend.ml_service.detector - INFO - Попытка загрузки модели cumulative_sum_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib...
2025-05-22 03:41:21,703 - backend.ml_service.time_series_detectors - INFO - (cumulative_sum_model) Загружены baseline_mean=3696.0057142857145, baseline_std=4060.74644512314 из model_state.
2025-05-22 03:41:21,703 - backend.ml_service.time_series_detectors - INFO - (cumulative_sum_model) Детектор CUSUM успешно загружен и помечен как обученный.
2025-05-22 03:41:21,703 - backend.ml_service.detector - INFO - Модель cumulative_sum_model успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib. is_trained=True
2025-05-22 03:41:21,703 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора cumulative_sum_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib
2025-05-22 03:41:21,704 - backend.ml_service.multilevel_detector - INFO -   Детектор 'cumulative_sum_model' (тип: cumulative_sum) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib.
2025-05-22 03:41:21,704 - backend.ml_service.multilevel_detector - INFO -   Детектор 'cumulative_sum_model' (тип: cumulative_sum) инициализирован с весом 1.0.
2025-05-22 03:41:21,704 - backend.ml_service.multilevel_detector - INFO - Многоуровневая система инициализирована: 2 транзакционных детекторов (метод: weighted_average), 2 поведенческих детекторов (метод: weighted_average), 2 детекторов временных рядов (метод: average)
2025-05-22 03:41:21,704 - backend.ml_service.multilevel_service - INFO - Многоуровневая система успешно создана на основе конфигурации из settings.yaml.
2025-05-22 03:41:21,720 - backend.ml_service - INFO - ML Service Logger активен. Уровень: DEBUG. Директория логов ml_service: C:\Users\alex\Desktop\AnomaLens3.0\logs
2025-05-22 04:05:53,029 - backend.ml_service - INFO - Логирование настроено с уровнем DEBUG
2025-05-22 04:05:53,030 - backend.ml_service - INFO - Логи записываются в файл: C:\Users\alex\Desktop\AnomaLens3.0\logs\ml_service_2025-05-22.log
2025-05-22 04:06:07,570 - backend.ml_service - INFO - Логирование настроено с уровнем DEBUG
2025-05-22 04:06:07,571 - backend.ml_service - INFO - Логи записываются в файл: C:\Users\alex\Desktop\AnomaLens3.0\logs\ml_service_2025-05-22.log
2025-05-22 04:06:10,360 - backend.ml_service.multilevel_service - INFO - Базовый путь для моделей (MultilevelService): C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models
2025-05-22 04:06:10,360 - backend.ml_service.multilevel_service - INFO - Создание/инициализация многоуровневой системы на основе настроек из config.yaml.
2025-05-22 04:06:10,361 - backend.ml_service.multilevel_service - DEBUG - Используется следующая конфигурация для MultilevelAnomalyDetector: {
  "transaction_level": [
    {
      "type": "transaction_vae",
      "model_filename": "ml_trans_vae_model.joblib",
      "weight": 1.0,
      "features": [
        "price",
        "freight_value",
        "product_weight_g",
        "freight_to_price_ratio"
      ],
      "encoding_dim": 10,
      "hidden_dim1": 32,
      "hidden_dim2": 16,
      "epochs": 25,
      "kld_weight": 0.5,
      "dropout_rate": 0.1,
      "shap_background_samples": 50
    },
    {
      "type": "category_price_outlier",
      "model_filename": "ml_category_price_model.joblib",
      "weight": 1.0,
      "category_col": "product_category_name",
      "price_col": "price",
      "threshold": 2.8,
      "min_samples_per_category": 10
    }
  ],
  "behavior_level": [
    {
      "type": "graph",
      "model_filename": "ml_graph_model_v3.joblib",
      "weight": 1.0,
      "use_seller_state_spread": true,
      "use_category_diversity": true,
      "use_seller_degree": true,
      "seller_state_weight": 0.3,
      "category_diversity_weight": 0.4,
      "seller_degree_weight": 0.3
    },
    {
      "type": "seller_pricing_behavior",
      "model_filename": "ml_seller_pricing_model.joblib",
      "weight": 1.0,
      "volatility_threshold": 0.5,
      "range_threshold": 5.0,
      "freight_ratio_threshold": 1.0,
      "min_transactions": 5
    }
  ],
  "time_series_level": [
    {
      "type": "seasonal_deviation",
      "model_filename": "seasonal_deviation_model.joblib",
      "weight": 1.0,
      "window_size": 7,
      "threshold": 2.5
    },
    {
      "type": "cumulative_sum",
      "model_filename": "cumulative_sum_model.joblib",
      "weight": 1.0,
      "window_size": 14,
      "threshold": 2.5,
      "drift_threshold": 4.5
    }
  ],
  "combination_weights": {
    "transaction": 0.4,
    "behavior": 0.3,
    "time_series": 0.3
  },
  "transaction_level_combination_method": "weighted_average",
  "behavior_level_combination_method": "weighted_average",
  "time_series_level_combination_method": "average"
}
2025-05-22 04:06:10,361 - backend.ml_service.multilevel_detector - INFO - Инициализация многоуровневой системы обнаружения аномалий...
2025-05-22 04:06:10,361 - backend.ml_service.multilevel_detector - INFO - Инициализация детекторов для уровня 'transaction'...
2025-05-22 04:06:10,362 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) VAEDetector инициализирован. Устройство: cpu, Входная размерность: 4, Признаки: ['price', 'freight_value', 'product_weight_g', 'freight_to_price_ratio']
2025-05-22 04:06:10,362 - backend.ml_service.detector - DEBUG - (transaction_vae_price) Сброс базового состояния детектора (из AnomalyDetector._reset_state).
2025-05-22 04:06:10,362 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Специфичное состояние VAEDetector (порог, SHAP) сброшено.
2025-05-22 04:06:10,363 - backend.ml_service.transaction_detectors - INFO - (transaction_vae_price) TransactionVAEDetector инициализирован. Конфигурационные признаки: ['price', 'freight_value', 'product_weight_g', 'freight_to_price_ratio'], Реально используемые признаки (с генерируемыми): ['price', 'freight_value', 'product_weight_g', 'freight_to_price_ratio'], encoding_dim(latent_dim): 10, hidden_dim1(hidden_dim): 32, hidden_dim2: 16, epochs: 25, batch_size: 64, lr: 0.001, kld_w: 0.5, dropout: 0.1
2025-05-22 04:06:10,363 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора transaction_vae_price типа transaction_vae
2025-05-22 04:06:10,363 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='ml_trans_vae_model.joblib' установлен для transaction_vae_price
2025-05-22 04:06:10,363 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib'
2025-05-22 04:06:10,363 - backend.ml_service.detector - INFO - Попытка загрузки модели transaction_vae_price из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib...
2025-05-22 04:06:10,373 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Загружен порог аномальности: 3.656726
2025-05-22 04:06:10,373 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) StandardScaler успешно инициализирован с параметрами: n_features_in_=4, mean_=(4,), scale_=(4,)
2025-05-22 04:06:10,374 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Фоновые данные SHAP загружены (torch.Size([50, 4]))
2025-05-22 04:06:10,377 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Модель VAE успешно загружена и перемещена на cpu.
2025-05-22 04:06:10,377 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Попытка пересоздания SHAP GradientExplainer после загрузки...
2025-05-22 04:06:10,381 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) SHAP GradientExplainer успешно ПЕРЕСОЗДАН при загрузке модели. Device=cpu, background_data.shape=torch.Size([50, 4])
2025-05-22 04:06:10,382 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Статус SHAP после загрузки: background_data shape=torch.Size([50, 4]), device=cpu, explainer=создан
2025-05-22 04:06:10,382 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Детектор VAE (is_trained=True) успешно загружен.
2025-05-22 04:06:10,383 - backend.ml_service.detector - INFO - Модель transaction_vae_price успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib. is_trained=True
2025-05-22 04:06:10,383 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора transaction_vae_price из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib
2025-05-22 04:06:10,383 - backend.ml_service.multilevel_detector - INFO -   Детектор 'transaction_vae_price' (тип: transaction_vae) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib.
2025-05-22 04:06:10,383 - backend.ml_service.multilevel_detector - INFO -   Детектор 'transaction_vae_price' (тип: transaction_vae) инициализирован с весом 1.0.
2025-05-22 04:06:10,384 - backend.ml_service.transaction_detectors - INFO - CategoryPriceOutlierDetector 'category_price_outlier_model' инициализирован с параметрами: category_col='product_category_name', price_col='price', threshold=2.8, min_samples_per_category=10
2025-05-22 04:06:10,384 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора category_price_outlier_model типа category_price_outlier
2025-05-22 04:06:10,384 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='ml_category_price_model.joblib' установлен для category_price_outlier_model
2025-05-22 04:06:10,384 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib'
2025-05-22 04:06:10,384 - backend.ml_service.detector - INFO - Попытка загрузки модели category_price_outlier_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib...
2025-05-22 04:06:10,387 - backend.ml_service.detector - INFO - Модель category_price_outlier_model успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib. is_trained=True
2025-05-22 04:06:10,387 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора category_price_outlier_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib
2025-05-22 04:06:10,387 - backend.ml_service.multilevel_detector - INFO -   Детектор 'category_price_outlier_model' (тип: category_price_outlier) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib.
2025-05-22 04:06:10,387 - backend.ml_service.multilevel_detector - INFO -   Детектор 'category_price_outlier_model' (тип: category_price_outlier) инициализирован с весом 1.0.
2025-05-22 04:06:10,387 - backend.ml_service.multilevel_detector - INFO - Инициализация детекторов для уровня 'behavior'...
2025-05-22 04:06:10,388 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора graph_graph_analysis типа graph
2025-05-22 04:06:10,388 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='ml_graph_model_v3.joblib' установлен для graph_graph_analysis
2025-05-22 04:06:10,388 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib'
2025-05-22 04:06:10,388 - backend.ml_service.detector - INFO - Попытка загрузки модели graph_graph_analysis из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib...
2025-05-22 04:06:10,389 - backend.ml_service.detector - INFO - Модель graph_graph_analysis успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib. is_trained=True
2025-05-22 04:06:10,389 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора graph_graph_analysis из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib
2025-05-22 04:06:10,389 - backend.ml_service.multilevel_detector - INFO -   Детектор 'graph_graph_analysis' (тип: graph) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib.
2025-05-22 04:06:10,389 - backend.ml_service.multilevel_detector - INFO -   Детектор 'graph_graph_analysis' (тип: graph) инициализирован с весом 1.0.
2025-05-22 04:06:10,390 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора seller_pricing_behavior_model типа seller_pricing_behavior
2025-05-22 04:06:10,390 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='ml_seller_pricing_model.joblib' установлен для seller_pricing_behavior_model
2025-05-22 04:06:10,390 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib'
2025-05-22 04:06:10,390 - backend.ml_service.detector - INFO - Попытка загрузки модели seller_pricing_behavior_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib...
2025-05-22 04:06:10,391 - backend.ml_service.detector - INFO - Модель seller_pricing_behavior_model успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib. is_trained=True
2025-05-22 04:06:10,391 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора seller_pricing_behavior_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib
2025-05-22 04:06:10,391 - backend.ml_service.multilevel_detector - INFO -   Детектор 'seller_pricing_behavior_model' (тип: seller_pricing_behavior) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib.
2025-05-22 04:06:10,391 - backend.ml_service.multilevel_detector - INFO -   Детектор 'seller_pricing_behavior_model' (тип: seller_pricing_behavior) инициализирован с весом 1.0.
2025-05-22 04:06:10,391 - backend.ml_service.multilevel_detector - INFO - Инициализация детекторов для уровня 'time_series'...
2025-05-22 04:06:10,391 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора seasonal_deviation_model типа seasonal_deviation
2025-05-22 04:06:10,392 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='seasonal_deviation_model.joblib' установлен для seasonal_deviation_model
2025-05-22 04:06:10,392 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib'
2025-05-22 04:06:10,392 - backend.ml_service.detector - INFO - Попытка загрузки модели seasonal_deviation_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib...
2025-05-22 04:06:10,393 - backend.ml_service.detector - INFO - Модель seasonal_deviation_model успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib. is_trained=True
2025-05-22 04:06:10,393 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора seasonal_deviation_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib
2025-05-22 04:06:10,393 - backend.ml_service.multilevel_detector - INFO -   Детектор 'seasonal_deviation_model' (тип: seasonal_deviation) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib.
2025-05-22 04:06:10,393 - backend.ml_service.multilevel_detector - INFO -   Детектор 'seasonal_deviation_model' (тип: seasonal_deviation) инициализирован с весом 1.0.
2025-05-22 04:06:10,394 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора cumulative_sum_model типа cumulative_sum
2025-05-22 04:06:10,394 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='cumulative_sum_model.joblib' установлен для cumulative_sum_model
2025-05-22 04:06:10,394 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib'
2025-05-22 04:06:10,394 - backend.ml_service.detector - INFO - Попытка загрузки модели cumulative_sum_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib...
2025-05-22 04:06:10,395 - backend.ml_service.time_series_detectors - INFO - (cumulative_sum_model) Загружены baseline_mean=3696.0057142857145, baseline_std=4060.74644512314 из model_state.
2025-05-22 04:06:10,395 - backend.ml_service.time_series_detectors - INFO - (cumulative_sum_model) Детектор CUSUM успешно загружен и помечен как обученный.
2025-05-22 04:06:10,395 - backend.ml_service.detector - INFO - Модель cumulative_sum_model успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib. is_trained=True
2025-05-22 04:06:10,395 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора cumulative_sum_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib
2025-05-22 04:06:10,395 - backend.ml_service.multilevel_detector - INFO -   Детектор 'cumulative_sum_model' (тип: cumulative_sum) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib.
2025-05-22 04:06:10,396 - backend.ml_service.multilevel_detector - INFO -   Детектор 'cumulative_sum_model' (тип: cumulative_sum) инициализирован с весом 1.0.
2025-05-22 04:06:10,396 - backend.ml_service.multilevel_detector - INFO - Многоуровневая система инициализирована: 2 транзакционных детекторов (метод: weighted_average), 2 поведенческих детекторов (метод: weighted_average), 2 детекторов временных рядов (метод: average)
2025-05-22 04:06:10,396 - backend.ml_service.multilevel_service - INFO - Многоуровневая система успешно создана на основе конфигурации из settings.yaml.
2025-05-22 04:06:10,406 - backend.ml_service - INFO - ML Service Logger активен. Уровень: DEBUG. Директория логов ml_service: C:\Users\alex\Desktop\AnomaLens3.0\logs
2025-05-22 04:07:02,216 - backend.ml_service - INFO - Логирование настроено с уровнем DEBUG
2025-05-22 04:07:02,216 - backend.ml_service - INFO - Логи записываются в файл: C:\Users\alex\Desktop\AnomaLens3.0\logs\ml_service_2025-05-22.log
2025-05-22 04:07:05,503 - backend.ml_service.multilevel_service - INFO - Базовый путь для моделей (MultilevelService): C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models
2025-05-22 04:07:05,503 - backend.ml_service.multilevel_service - INFO - Создание/инициализация многоуровневой системы на основе настроек из config.yaml.
2025-05-22 04:07:05,503 - backend.ml_service.multilevel_service - DEBUG - Используется следующая конфигурация для MultilevelAnomalyDetector: {
  "transaction_level": [
    {
      "type": "transaction_vae",
      "model_filename": "ml_trans_vae_model.joblib",
      "weight": 1.0,
      "features": [
        "price",
        "freight_value",
        "product_weight_g",
        "freight_to_price_ratio"
      ],
      "encoding_dim": 10,
      "hidden_dim1": 32,
      "hidden_dim2": 16,
      "epochs": 25,
      "kld_weight": 0.5,
      "dropout_rate": 0.1,
      "shap_background_samples": 50
    },
    {
      "type": "category_price_outlier",
      "model_filename": "ml_category_price_model.joblib",
      "weight": 1.0,
      "category_col": "product_category_name",
      "price_col": "price",
      "threshold": 2.8,
      "min_samples_per_category": 10
    }
  ],
  "behavior_level": [
    {
      "type": "graph",
      "model_filename": "ml_graph_model_v3.joblib",
      "weight": 1.0,
      "use_seller_state_spread": true,
      "use_category_diversity": true,
      "use_seller_degree": true,
      "seller_state_weight": 0.3,
      "category_diversity_weight": 0.4,
      "seller_degree_weight": 0.3
    },
    {
      "type": "seller_pricing_behavior",
      "model_filename": "ml_seller_pricing_model.joblib",
      "weight": 1.0,
      "volatility_threshold": 0.5,
      "range_threshold": 5.0,
      "freight_ratio_threshold": 1.0,
      "min_transactions": 5
    }
  ],
  "time_series_level": [
    {
      "type": "seasonal_deviation",
      "model_filename": "seasonal_deviation_model.joblib",
      "weight": 1.0,
      "window_size": 7,
      "threshold": 2.5
    },
    {
      "type": "cumulative_sum",
      "model_filename": "cumulative_sum_model.joblib",
      "weight": 1.0,
      "window_size": 14,
      "threshold": 2.5,
      "drift_threshold": 4.5
    }
  ],
  "combination_weights": {
    "transaction": 0.4,
    "behavior": 0.3,
    "time_series": 0.3
  },
  "transaction_level_combination_method": "weighted_average",
  "behavior_level_combination_method": "weighted_average",
  "time_series_level_combination_method": "average"
}
2025-05-22 04:07:05,504 - backend.ml_service.multilevel_detector - INFO - Инициализация многоуровневой системы обнаружения аномалий...
2025-05-22 04:07:05,505 - backend.ml_service.multilevel_detector - INFO - Инициализация детекторов для уровня 'transaction'...
2025-05-22 04:07:05,505 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) VAEDetector инициализирован. Устройство: cpu, Входная размерность: 4, Признаки: ['price', 'freight_value', 'product_weight_g', 'freight_to_price_ratio']
2025-05-22 04:07:05,505 - backend.ml_service.detector - DEBUG - (transaction_vae_price) Сброс базового состояния детектора (из AnomalyDetector._reset_state).
2025-05-22 04:07:05,505 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Специфичное состояние VAEDetector (порог, SHAP) сброшено.
2025-05-22 04:07:05,505 - backend.ml_service.transaction_detectors - INFO - (transaction_vae_price) TransactionVAEDetector инициализирован. Конфигурационные признаки: ['price', 'freight_value', 'product_weight_g', 'freight_to_price_ratio'], Реально используемые признаки (с генерируемыми): ['price', 'freight_value', 'product_weight_g', 'freight_to_price_ratio'], encoding_dim(latent_dim): 10, hidden_dim1(hidden_dim): 32, hidden_dim2: 16, epochs: 25, batch_size: 64, lr: 0.001, kld_w: 0.5, dropout: 0.1
2025-05-22 04:07:05,506 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора transaction_vae_price типа transaction_vae
2025-05-22 04:07:05,506 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='ml_trans_vae_model.joblib' установлен для transaction_vae_price
2025-05-22 04:07:05,506 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib'
2025-05-22 04:07:05,506 - backend.ml_service.detector - INFO - Попытка загрузки модели transaction_vae_price из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib...
2025-05-22 04:07:05,516 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Загружен порог аномальности: 3.656726
2025-05-22 04:07:05,516 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) StandardScaler успешно инициализирован с параметрами: n_features_in_=4, mean_=(4,), scale_=(4,)
2025-05-22 04:07:05,517 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Фоновые данные SHAP загружены (torch.Size([50, 4]))
2025-05-22 04:07:05,520 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Модель VAE успешно загружена и перемещена на cpu.
2025-05-22 04:07:05,521 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Попытка пересоздания SHAP GradientExplainer после загрузки...
2025-05-22 04:07:05,524 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) SHAP GradientExplainer успешно ПЕРЕСОЗДАН при загрузке модели. Device=cpu, background_data.shape=torch.Size([50, 4])
2025-05-22 04:07:05,525 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Статус SHAP после загрузки: background_data shape=torch.Size([50, 4]), device=cpu, explainer=создан
2025-05-22 04:07:05,525 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Детектор VAE (is_trained=True) успешно загружен.
2025-05-22 04:07:05,525 - backend.ml_service.detector - INFO - Модель transaction_vae_price успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib. is_trained=True
2025-05-22 04:07:05,525 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора transaction_vae_price из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib
2025-05-22 04:07:05,526 - backend.ml_service.multilevel_detector - INFO -   Детектор 'transaction_vae_price' (тип: transaction_vae) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib.
2025-05-22 04:07:05,526 - backend.ml_service.multilevel_detector - INFO -   Детектор 'transaction_vae_price' (тип: transaction_vae) инициализирован с весом 1.0.
2025-05-22 04:07:05,526 - backend.ml_service.transaction_detectors - INFO - CategoryPriceOutlierDetector 'category_price_outlier_model' инициализирован с параметрами: category_col='product_category_name', price_col='price', threshold=2.8, min_samples_per_category=10
2025-05-22 04:07:05,526 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора category_price_outlier_model типа category_price_outlier
2025-05-22 04:07:05,526 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='ml_category_price_model.joblib' установлен для category_price_outlier_model
2025-05-22 04:07:05,527 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib'
2025-05-22 04:07:05,527 - backend.ml_service.detector - INFO - Попытка загрузки модели category_price_outlier_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib...
2025-05-22 04:07:05,529 - backend.ml_service.detector - INFO - Модель category_price_outlier_model успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib. is_trained=True
2025-05-22 04:07:05,529 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора category_price_outlier_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib
2025-05-22 04:07:05,529 - backend.ml_service.multilevel_detector - INFO -   Детектор 'category_price_outlier_model' (тип: category_price_outlier) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib.
2025-05-22 04:07:05,529 - backend.ml_service.multilevel_detector - INFO -   Детектор 'category_price_outlier_model' (тип: category_price_outlier) инициализирован с весом 1.0.
2025-05-22 04:07:05,529 - backend.ml_service.multilevel_detector - INFO - Инициализация детекторов для уровня 'behavior'...
2025-05-22 04:07:05,529 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора graph_graph_analysis типа graph
2025-05-22 04:07:05,530 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='ml_graph_model_v3.joblib' установлен для graph_graph_analysis
2025-05-22 04:07:05,530 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib'
2025-05-22 04:07:05,530 - backend.ml_service.detector - INFO - Попытка загрузки модели graph_graph_analysis из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib...
2025-05-22 04:07:05,530 - backend.ml_service.detector - INFO - Модель graph_graph_analysis успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib. is_trained=True
2025-05-22 04:07:05,530 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора graph_graph_analysis из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib
2025-05-22 04:07:05,530 - backend.ml_service.multilevel_detector - INFO -   Детектор 'graph_graph_analysis' (тип: graph) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib.
2025-05-22 04:07:05,531 - backend.ml_service.multilevel_detector - INFO -   Детектор 'graph_graph_analysis' (тип: graph) инициализирован с весом 1.0.
2025-05-22 04:07:05,531 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора seller_pricing_behavior_model типа seller_pricing_behavior
2025-05-22 04:07:05,531 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='ml_seller_pricing_model.joblib' установлен для seller_pricing_behavior_model
2025-05-22 04:07:05,531 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib'
2025-05-22 04:07:05,531 - backend.ml_service.detector - INFO - Попытка загрузки модели seller_pricing_behavior_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib...
2025-05-22 04:07:05,532 - backend.ml_service.detector - INFO - Модель seller_pricing_behavior_model успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib. is_trained=True
2025-05-22 04:07:05,532 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора seller_pricing_behavior_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib
2025-05-22 04:07:05,532 - backend.ml_service.multilevel_detector - INFO -   Детектор 'seller_pricing_behavior_model' (тип: seller_pricing_behavior) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib.
2025-05-22 04:07:05,533 - backend.ml_service.multilevel_detector - INFO -   Детектор 'seller_pricing_behavior_model' (тип: seller_pricing_behavior) инициализирован с весом 1.0.
2025-05-22 04:07:05,533 - backend.ml_service.multilevel_detector - INFO - Инициализация детекторов для уровня 'time_series'...
2025-05-22 04:07:05,533 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора seasonal_deviation_model типа seasonal_deviation
2025-05-22 04:07:05,534 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='seasonal_deviation_model.joblib' установлен для seasonal_deviation_model
2025-05-22 04:07:05,534 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib'
2025-05-22 04:07:05,534 - backend.ml_service.detector - INFO - Попытка загрузки модели seasonal_deviation_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib...
2025-05-22 04:07:05,535 - backend.ml_service.detector - INFO - Модель seasonal_deviation_model успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib. is_trained=True
2025-05-22 04:07:05,535 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора seasonal_deviation_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib
2025-05-22 04:07:05,535 - backend.ml_service.multilevel_detector - INFO -   Детектор 'seasonal_deviation_model' (тип: seasonal_deviation) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib.
2025-05-22 04:07:05,535 - backend.ml_service.multilevel_detector - INFO -   Детектор 'seasonal_deviation_model' (тип: seasonal_deviation) инициализирован с весом 1.0.
2025-05-22 04:07:05,535 - backend.ml_service.detector_factory - INFO - Создан экземпляр детектора cumulative_sum_model типа cumulative_sum
2025-05-22 04:07:05,535 - backend.ml_service.detector_factory - DEBUG - Атрибут model_filename='cumulative_sum_model.joblib' установлен для cumulative_sum_model
2025-05-22 04:07:05,536 - backend.ml_service.detector_factory - DEBUG - Проверка существования файла модели: CWD='C:\Users\alex\Desktop\AnomaLens3.0', Путь='C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib'
2025-05-22 04:07:05,536 - backend.ml_service.detector - INFO - Попытка загрузки модели cumulative_sum_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib...
2025-05-22 04:07:05,536 - backend.ml_service.time_series_detectors - INFO - (cumulative_sum_model) Загружены baseline_mean=3696.0057142857145, baseline_std=4060.74644512314 из model_state.
2025-05-22 04:07:05,536 - backend.ml_service.time_series_detectors - INFO - (cumulative_sum_model) Детектор CUSUM успешно загружен и помечен как обученный.
2025-05-22 04:07:05,536 - backend.ml_service.detector - INFO - Модель cumulative_sum_model успешно обработана при загрузке из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib. is_trained=True
2025-05-22 04:07:05,537 - backend.ml_service.detector_factory - INFO - Успешно загружена модель для детектора cumulative_sum_model из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib
2025-05-22 04:07:05,537 - backend.ml_service.multilevel_detector - INFO -   Детектор 'cumulative_sum_model' (тип: cumulative_sum) попытка создания и загрузки из C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib.
2025-05-22 04:07:05,537 - backend.ml_service.multilevel_detector - INFO -   Детектор 'cumulative_sum_model' (тип: cumulative_sum) инициализирован с весом 1.0.
2025-05-22 04:07:05,537 - backend.ml_service.multilevel_detector - INFO - Многоуровневая система инициализирована: 2 транзакционных детекторов (метод: weighted_average), 2 поведенческих детекторов (метод: weighted_average), 2 детекторов временных рядов (метод: average)
2025-05-22 04:07:05,537 - backend.ml_service.multilevel_service - INFO - Многоуровневая система успешно создана на основе конфигурации из settings.yaml.
2025-05-22 04:07:05,546 - backend.ml_service - INFO - ML Service Logger активен. Уровень: DEBUG. Директория логов ml_service: C:\Users\alex\Desktop\AnomaLens3.0\logs
2025-05-22 04:08:35,488 - backend.ml_service.multilevel_service - INFO - [TaskID: a44e596a-aefd-4aee-ba7c-49cf59b3b26c] Обертка train_task_wrapper запущена.
2025-05-22 04:08:35,488 - backend.ml_service.multilevel_service - INFO - Начало обучения многоуровневой системы...
2025-05-22 04:08:35,489 - backend.ml_service.multilevel_service - INFO - Загрузка данных из БД для обучения multilevel...
2025-05-22 04:08:35,490 - backend.ml_service.common - INFO - Загрузка данных из БД за период: None - None (с ассоциациями)
2025-05-22 04:08:39,055 - backend.ml_service.common - INFO - Загружено 118310 записей OrderItem.
2025-05-22 04:08:39,055 - backend.ml_service.multilevel_service - INFO - Данные для обучения multilevel (118310 строк) подготовлены. Инженерия признаков...
2025-05-22 04:08:39,193 - backend.ml_service.common - INFO - Добавлен признак: 'price_deviation_from_category_mean'
2025-05-22 04:08:39,195 - backend.ml_service.common - INFO - Добавлен признак: 'freight_to_price_ratio'
2025-05-22 04:08:39,196 - backend.ml_service.multilevel_service - INFO - Инженерия признаков завершена.
2025-05-22 04:08:39,196 - backend.ml_service.multilevel_service - INFO - Обучение детекторов транзакционного уровня...
2025-05-22 04:08:39,196 - backend.ml_service.multilevel_service - INFO -   Обучение транзакционного детектора: transaction_vae_price
2025-05-22 04:08:39,220 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Начало обучения...
2025-05-22 04:08:39,220 - backend.ml_service.detector - DEBUG - (transaction_vae_price) Сброс базового состояния детектора (из AnomalyDetector._reset_state).
2025-05-22 04:08:39,220 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Специфичное состояние VAEDetector (порог, SHAP) сброшено.
2025-05-22 04:08:39,220 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Предобработка данных для обучения...
2025-05-22 04:08:39,504 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Обучение StandardScaler на 118310 сэмплах.
2025-05-22 04:08:39,508 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) StandardScaler обучен.
2025-05-22 04:08:39,532 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Данные (118310 сэмплов) готовы для обучения VAE.
2025-05-22 04:08:39,535 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Модель VAE создана и перемещена на cpu.
2025-05-22 04:08:45,667 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Начало цикла обучения VAE...
2025-05-22 04:08:51,083 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Эпоха 1/25, Потери: 2.5342, Время: 5.42 сек.
2025-05-22 04:08:55,982 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Эпоха 2/25, Потери: 1.9766, Время: 4.90 сек.
2025-05-22 04:09:01,253 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Эпоха 3/25, Потери: 1.8302, Время: 5.27 сек.
2025-05-22 04:09:05,828 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Эпоха 4/25, Потери: 1.7772, Время: 4.57 сек.
2025-05-22 04:09:10,857 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Эпоха 5/25, Потери: 1.7412, Время: 5.03 сек.
2025-05-22 04:09:16,195 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Эпоха 6/25, Потери: 1.7231, Время: 5.34 сек.
2025-05-22 04:09:17,822 - backend.ml_service.multilevel_service - INFO - [TaskID: c38c2c70-ce50-41aa-91d5-d95969e9b929] Обертка train_task_wrapper запущена.
2025-05-22 04:09:17,823 - backend.ml_service.multilevel_service - INFO - Начало обучения многоуровневой системы...
2025-05-22 04:09:17,823 - backend.ml_service.multilevel_service - INFO - Загрузка данных из БД для обучения multilevel...
2025-05-22 04:09:17,823 - backend.ml_service.common - INFO - Загрузка данных из БД за период: None - None (с ассоциациями)
2025-05-22 04:09:22,134 - backend.ml_service.common - INFO - Загружено 118310 записей OrderItem.
2025-05-22 04:09:22,134 - backend.ml_service.multilevel_service - INFO - Данные для обучения multilevel (118310 строк) подготовлены. Инженерия признаков...
2025-05-22 04:09:22,264 - backend.ml_service.common - INFO - Добавлен признак: 'price_deviation_from_category_mean'
2025-05-22 04:09:22,267 - backend.ml_service.common - INFO - Добавлен признак: 'freight_to_price_ratio'
2025-05-22 04:09:22,267 - backend.ml_service.multilevel_service - INFO - Инженерия признаков завершена.
2025-05-22 04:09:22,267 - backend.ml_service.multilevel_service - INFO - Обучение детекторов транзакционного уровня...
2025-05-22 04:09:22,267 - backend.ml_service.multilevel_service - INFO -   Обучение транзакционного детектора: transaction_vae_price
2025-05-22 04:09:22,291 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Начало обучения...
2025-05-22 04:09:22,291 - backend.ml_service.detector - DEBUG - (transaction_vae_price) Сброс базового состояния детектора (из AnomalyDetector._reset_state).
2025-05-22 04:09:22,292 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Специфичное состояние VAEDetector (порог, SHAP) сброшено.
2025-05-22 04:09:22,292 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Предобработка данных для обучения...
2025-05-22 04:09:22,296 - backend.ml_service.multilevel_service - ERROR - Ошибка при обучении/сохранении транзакционного детектора transaction_vae_price: 'NoneType' object is not callable
Traceback (most recent call last):
  File "C:\Users\alex\Desktop\AnomaLens3.0\backend\ml_service\multilevel_service.py", line 156, in train
    detector_instance.train(training_data_with_features.copy()) # Обучаем
    ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\alex\Desktop\AnomaLens3.0\backend\ml_service\vae_detector.py", line 414, in train
    recon_batch, mu, log_var = self.model(batch_data)
                               ~~~~~~~~~~^^^^^^^^^^^^
TypeError: 'NoneType' object is not callable
2025-05-22 04:09:22,340 - backend.ml_service.multilevel_service - INFO -   Обучение транзакционного детектора: category_price_outlier_model
2025-05-22 04:09:22,373 - backend.ml_service.transaction_detectors - INFO - Обучение детектора category_price_outlier_model...
2025-05-22 04:09:22,750 - backend.ml_service.detector - INFO - Нормализатор для category_price_outlier_model обучен: min=0.0000, max=47.3942
2025-05-22 04:09:22,751 - backend.ml_service.transaction_detectors - INFO - Детектор category_price_outlier_model обучен: 72 категорий
2025-05-22 04:09:22,789 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Обучение StandardScaler на 118310 сэмплах.
2025-05-22 04:09:22,790 - backend.ml_service.detector - INFO - Состояние детектора category_price_outlier_model сохранено в C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib
2025-05-22 04:09:22,790 - backend.ml_service.multilevel_service - INFO -   Детектор category_price_outlier_model обучен и сохранен в C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib
2025-05-22 04:09:22,790 - backend.ml_service.multilevel_service - INFO - Обучение детекторов поведенческого уровня...
2025-05-22 04:09:22,804 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) StandardScaler обучен.
2025-05-22 04:09:22,843 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Данные (118310 сэмплов) готовы для обучения VAE.
2025-05-22 04:09:22,852 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Модель VAE создана и перемещена на cpu.
2025-05-22 04:09:22,853 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Начало цикла обучения VAE...
2025-05-22 04:09:23,093 - backend.ml_service.multilevel_service - INFO -   Обучение поведенческого детектора: graph_graph_analysis (тип: GraphAnomalyDetector)
2025-05-22 04:09:23,113 - backend.ml_service.multilevel_service - INFO -   Детектор graph_graph_analysis (GraphAnomalyDetector) будет использовать исходные транзакционные данные для обучения ((118310, 25)).
2025-05-22 04:09:23,114 - backend.ml_service.graph_detector - INFO - Запуск 'обучения' для graph_graph_analysis...
2025-05-22 04:09:23,114 - backend.ml_service.graph_detector - INFO - Построение графа...
2025-05-22 04:09:28,968 - backend.ml_service.graph_detector - INFO - Граф построен за 5.77 сек. Узлов: 346028, Ребер: 436616
2025-05-22 04:09:28,990 - backend.ml_service.graph_detector - INFO - Расчет сырых графовых метрик для обучения...
2025-05-22 04:09:29,658 - backend.ml_service.graph_detector - INFO - Min/Max для метрик вычислены: {'seller_states': (1.0, 3.0), 'categories': (0.0, 3.0), 'seller_degrees': (1.0, 2033.0)}
2025-05-22 04:09:29,658 - backend.ml_service.graph_detector - INFO - Расчет итоговых взвешенных скоров для обучения нормализатора...
2025-05-22 04:09:30,868 - backend.ml_service.detector - INFO - Нормализатор для graph_graph_analysis обучен: min=0.0000, max=0.8500
2025-05-22 04:09:30,869 - backend.ml_service.graph_detector - INFO - 'Обучение' graph_graph_analysis завершено (min/max метрик и нормализатор настроены).
2025-05-22 04:09:30,874 - backend.ml_service.detector - INFO - Состояние детектора graph_graph_analysis сохранено в C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib
2025-05-22 04:09:30,875 - backend.ml_service.multilevel_service - INFO -   Детектор graph_graph_analysis обучен и сохранен в C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib
2025-05-22 04:09:30,875 - backend.ml_service.multilevel_service - INFO -   Обучение поведенческого детектора: seller_pricing_behavior_model (тип: SellerPricingBehaviorDetector)
2025-05-22 04:09:30,888 - backend.ml_service.multilevel_service - INFO -   Детектор seller_pricing_behavior_model будет использовать агрегированные поведенческие данные для обучения ((3095, 16)).
2025-05-22 04:09:30,889 - backend.ml_service.behavior_detectors - INFO - Обучение детектора seller_pricing_behavior_model...
2025-05-22 04:09:30,896 - backend.ml_service.detector - INFO - Нормализатор для seller_pricing_behavior_model обучен: min=0.0000, max=14.3522
2025-05-22 04:09:30,896 - backend.ml_service.behavior_detectors - INFO - Детектор seller_pricing_behavior_model обучен: проанализировано 3095 продавцов
2025-05-22 04:09:30,898 - backend.ml_service.detector - INFO - Состояние детектора seller_pricing_behavior_model сохранено в C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib
2025-05-22 04:09:30,898 - backend.ml_service.multilevel_service - INFO -   Детектор seller_pricing_behavior_model обучен и сохранен в C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib
2025-05-22 04:09:30,898 - backend.ml_service.multilevel_service - INFO - Обучение детекторов временного уровня...
2025-05-22 04:09:30,989 - backend.ml_service.multilevel_service - INFO -   Обучение детектора временных рядов: seasonal_deviation_model
2025-05-22 04:09:30,990 - backend.ml_service.time_series_detectors - INFO - Обучение детектора seasonal_deviation_model...
2025-05-22 04:09:30,996 - backend.ml_service.detector - INFO - Нормализатор для seasonal_deviation_model обучен: min=0.0006, max=2.1700
2025-05-22 04:09:30,996 - backend.ml_service.time_series_detectors - INFO - Детектор seasonal_deviation_model обучен: проанализировано 616 временных точек
2025-05-22 04:09:30,998 - backend.ml_service.detector - INFO - Состояние детектора seasonal_deviation_model сохранено в C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib
2025-05-22 04:09:30,998 - backend.ml_service.multilevel_service - INFO -   Детектор seasonal_deviation_model обучен и сохранен в C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib
2025-05-22 04:09:30,998 - backend.ml_service.multilevel_service - INFO -   Обучение детектора временных рядов: cumulative_sum_model
2025-05-22 04:09:30,999 - backend.ml_service.time_series_detectors - INFO - Обучение детектора cumulative_sum_model...
2025-05-22 04:09:31,036 - backend.ml_service.detector - INFO - Нормализатор для cumulative_sum_model обучен: min=0.8922, max=2960.3917
2025-05-22 04:09:31,036 - backend.ml_service.time_series_detectors - INFO - Детектор cumulative_sum_model обучен: базовое среднее = 3696.01, стд = 4060.75
2025-05-22 04:09:31,037 - backend.ml_service.detector - INFO - Состояние детектора cumulative_sum_model сохранено в C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib
2025-05-22 04:09:31,038 - backend.ml_service.multilevel_service - INFO -   Детектор cumulative_sum_model обучен и сохранен в C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib
2025-05-22 04:09:31,038 - backend.ml_service.multilevel_service - WARNING - Обучение многоуровневой системы завершено, но были ошибки при обучении/сохранении некоторых детекторов.
2025-05-22 04:09:31,068 - backend.ml_service.multilevel_service - WARNING - [TaskID: a44e596a-aefd-4aee-ba7c-49cf59b3b26c] Обучение завершилось с ошибками.
2025-05-22 04:09:35,826 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Эпоха 1/25, Потери: 2.4301, Время: 12.97 сек.
2025-05-22 04:09:41,251 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Эпоха 2/25, Потери: 1.9374, Время: 5.42 сек.
2025-05-22 04:09:46,504 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Эпоха 3/25, Потери: 1.8307, Время: 5.25 сек.
2025-05-22 04:09:52,831 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Эпоха 4/25, Потери: 1.7761, Время: 6.33 сек.
2025-05-22 04:09:58,324 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Эпоха 5/25, Потери: 1.7418, Время: 5.49 сек.
2025-05-22 04:10:03,361 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Эпоха 6/25, Потери: 1.7282, Время: 5.04 сек.
2025-05-22 04:10:08,035 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Эпоха 7/25, Потери: 1.7167, Время: 4.67 сек.
2025-05-22 04:10:12,714 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Эпоха 8/25, Потери: 1.6895, Время: 4.68 сек.
2025-05-22 04:10:17,429 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Эпоха 9/25, Потери: 1.6806, Время: 4.71 сек.
2025-05-22 04:10:23,276 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Эпоха 10/25, Потери: 1.6794, Время: 5.85 сек.
2025-05-22 04:10:28,966 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Эпоха 11/25, Потери: 1.6654, Время: 5.69 сек.
2025-05-22 04:10:34,010 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Эпоха 12/25, Потери: 1.6618, Время: 5.04 сек.
2025-05-22 04:10:40,054 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Эпоха 13/25, Потери: 1.6710, Время: 6.04 сек.
2025-05-22 04:10:45,110 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Эпоха 14/25, Потери: 1.6515, Время: 5.06 сек.
2025-05-22 04:10:51,379 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Эпоха 15/25, Потери: 1.6422, Время: 6.27 сек.
2025-05-22 04:10:56,360 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Эпоха 16/25, Потери: 1.6373, Время: 4.98 сек.
2025-05-22 04:11:01,914 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Эпоха 17/25, Потери: 1.6421, Время: 5.55 сек.
2025-05-22 04:11:07,133 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Эпоха 18/25, Потери: 1.6274, Время: 5.22 сек.
2025-05-22 04:11:13,945 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Эпоха 19/25, Потери: 1.6417, Время: 6.81 сек.
2025-05-22 04:11:20,568 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Эпоха 20/25, Потери: 1.6270, Время: 6.62 сек.
2025-05-22 04:11:26,695 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Эпоха 21/25, Потери: 1.6256, Время: 6.13 сек.
2025-05-22 04:11:32,302 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Эпоха 22/25, Потери: 1.6110, Время: 5.61 сек.
2025-05-22 04:11:37,312 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Эпоха 23/25, Потери: 1.6493, Время: 5.01 сек.
2025-05-22 04:11:42,553 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Эпоха 24/25, Потери: 1.6257, Время: 5.24 сек.
2025-05-22 04:11:47,864 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Эпоха 25/25, Потери: 1.6332, Время: 5.31 сек.
2025-05-22 04:11:47,865 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Вычисление ошибок реконструкции на обучающих данных для определения порога...
2025-05-22 04:11:48,880 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Порог аномальности установлен: 1.889551 (99-й перцентиль ошибок реконструкции).
2025-05-22 04:11:48,884 - backend.ml_service.detector - INFO - Нормализатор для transaction_vae_price обучен: min=0.0005, max=12.7589
2025-05-22 04:11:48,884 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Нормализатор anomaly_score обучен: min=0.0005, max=12.7589
2025-05-22 04:11:48,884 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Обучение завершено. Общее время: 146.59 сек.
2025-05-22 04:11:48,891 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Сохранен фоновый набор данных SHAP (50 экземпляров) на устройстве cpu.
2025-05-22 04:11:48,893 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) SHAP GradientExplainer инициализирован.
2025-05-22 04:11:48,893 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Статус SHAP после загрузки: background_data shape=torch.Size([50, 4]), device=cpu, explainer=создан
2025-05-22 04:11:48,893 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Детектор VAE (is_trained=True) успешно загружен.
2025-05-22 04:11:48,914 - backend.ml_service.vae_detector - INFO - (transaction_vae_price) Сохранены фоновые данные SHAP размерностью (50, 4)
2025-05-22 04:11:48,931 - backend.ml_service.detector - INFO - Состояние детектора transaction_vae_price сохранено в C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib
2025-05-22 04:11:48,931 - backend.ml_service.multilevel_service - INFO -   Детектор transaction_vae_price обучен и сохранен в C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_trans_vae_model.joblib
2025-05-22 04:11:48,932 - backend.ml_service.multilevel_service - INFO -   Обучение транзакционного детектора: category_price_outlier_model
2025-05-22 04:11:48,956 - backend.ml_service.transaction_detectors - INFO - Обучение детектора category_price_outlier_model...
2025-05-22 04:11:49,088 - backend.ml_service.detector - INFO - Нормализатор для category_price_outlier_model обучен: min=0.0000, max=47.3942
2025-05-22 04:11:49,088 - backend.ml_service.transaction_detectors - INFO - Детектор category_price_outlier_model обучен: 72 категорий
2025-05-22 04:11:49,130 - backend.ml_service.detector - INFO - Состояние детектора category_price_outlier_model сохранено в C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib
2025-05-22 04:11:49,131 - backend.ml_service.multilevel_service - INFO -   Детектор category_price_outlier_model обучен и сохранен в C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_category_price_model.joblib
2025-05-22 04:11:49,131 - backend.ml_service.multilevel_service - INFO - Обучение детекторов поведенческого уровня...
2025-05-22 04:11:49,265 - backend.ml_service.multilevel_service - INFO -   Обучение поведенческого детектора: graph_graph_analysis (тип: GraphAnomalyDetector)
2025-05-22 04:11:49,288 - backend.ml_service.multilevel_service - INFO -   Детектор graph_graph_analysis (GraphAnomalyDetector) будет использовать исходные транзакционные данные для обучения ((118310, 25)).
2025-05-22 04:11:49,288 - backend.ml_service.graph_detector - INFO - Запуск 'обучения' для graph_graph_analysis...
2025-05-22 04:11:49,288 - backend.ml_service.graph_detector - INFO - Построение графа...
2025-05-22 04:11:54,839 - backend.ml_service.graph_detector - INFO - Граф построен за 5.46 сек. Узлов: 346028, Ребер: 436616
2025-05-22 04:11:54,865 - backend.ml_service.graph_detector - INFO - Расчет сырых графовых метрик для обучения...
2025-05-22 04:11:55,551 - backend.ml_service.graph_detector - INFO - Min/Max для метрик вычислены: {'seller_states': (1.0, 3.0), 'categories': (0.0, 3.0), 'seller_degrees': (1.0, 2033.0)}
2025-05-22 04:11:55,552 - backend.ml_service.graph_detector - INFO - Расчет итоговых взвешенных скоров для обучения нормализатора...
2025-05-22 04:11:56,670 - backend.ml_service.detector - INFO - Нормализатор для graph_graph_analysis обучен: min=0.0000, max=0.8500
2025-05-22 04:11:56,670 - backend.ml_service.graph_detector - INFO - 'Обучение' graph_graph_analysis завершено (min/max метрик и нормализатор настроены).
2025-05-22 04:11:56,676 - backend.ml_service.detector - INFO - Состояние детектора graph_graph_analysis сохранено в C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib
2025-05-22 04:11:56,677 - backend.ml_service.multilevel_service - INFO -   Детектор graph_graph_analysis обучен и сохранен в C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_graph_model_v3.joblib
2025-05-22 04:11:56,677 - backend.ml_service.multilevel_service - INFO -   Обучение поведенческого детектора: seller_pricing_behavior_model (тип: SellerPricingBehaviorDetector)
2025-05-22 04:11:56,690 - backend.ml_service.multilevel_service - INFO -   Детектор seller_pricing_behavior_model будет использовать агрегированные поведенческие данные для обучения ((3095, 16)).
2025-05-22 04:11:56,691 - backend.ml_service.behavior_detectors - INFO - Обучение детектора seller_pricing_behavior_model...
2025-05-22 04:11:56,695 - backend.ml_service.detector - INFO - Нормализатор для seller_pricing_behavior_model обучен: min=0.0000, max=14.3522
2025-05-22 04:11:56,696 - backend.ml_service.behavior_detectors - INFO - Детектор seller_pricing_behavior_model обучен: проанализировано 3095 продавцов
2025-05-22 04:11:56,697 - backend.ml_service.detector - INFO - Состояние детектора seller_pricing_behavior_model сохранено в C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib
2025-05-22 04:11:56,697 - backend.ml_service.multilevel_service - INFO -   Детектор seller_pricing_behavior_model обучен и сохранен в C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\ml_seller_pricing_model.joblib
2025-05-22 04:11:56,697 - backend.ml_service.multilevel_service - INFO - Обучение детекторов временного уровня...
2025-05-22 04:11:56,789 - backend.ml_service.multilevel_service - INFO -   Обучение детектора временных рядов: seasonal_deviation_model
2025-05-22 04:11:56,790 - backend.ml_service.time_series_detectors - INFO - Обучение детектора seasonal_deviation_model...
2025-05-22 04:11:56,794 - backend.ml_service.detector - INFO - Нормализатор для seasonal_deviation_model обучен: min=0.0006, max=2.1700
2025-05-22 04:11:56,794 - backend.ml_service.time_series_detectors - INFO - Детектор seasonal_deviation_model обучен: проанализировано 616 временных точек
2025-05-22 04:11:56,795 - backend.ml_service.detector - INFO - Состояние детектора seasonal_deviation_model сохранено в C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib
2025-05-22 04:11:56,795 - backend.ml_service.multilevel_service - INFO -   Детектор seasonal_deviation_model обучен и сохранен в C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\seasonal_deviation_model.joblib
2025-05-22 04:11:56,796 - backend.ml_service.multilevel_service - INFO -   Обучение детектора временных рядов: cumulative_sum_model
2025-05-22 04:11:56,796 - backend.ml_service.time_series_detectors - INFO - Обучение детектора cumulative_sum_model...
2025-05-22 04:11:56,831 - backend.ml_service.detector - INFO - Нормализатор для cumulative_sum_model обучен: min=0.8922, max=2960.3917
2025-05-22 04:11:56,831 - backend.ml_service.time_series_detectors - INFO - Детектор cumulative_sum_model обучен: базовое среднее = 3696.01, стд = 4060.75
2025-05-22 04:11:56,832 - backend.ml_service.detector - INFO - Состояние детектора cumulative_sum_model сохранено в C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib
2025-05-22 04:11:56,833 - backend.ml_service.multilevel_service - INFO -   Детектор cumulative_sum_model обучен и сохранен в C:\Users\alex\Desktop\AnomaLens3.0\backend/ml_service/models\cumulative_sum_model.joblib
2025-05-22 04:11:56,833 - backend.ml_service.multilevel_service - INFO - Обучение всех применимых детекторов в многоуровневой системе завершено.
2025-05-22 04:11:56,863 - backend.ml_service.multilevel_service - INFO - [TaskID: c38c2c70-ce50-41aa-91d5-d95969e9b929] Обучение успешно завершено.
